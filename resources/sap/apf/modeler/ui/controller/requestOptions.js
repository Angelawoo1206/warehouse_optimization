/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.viewValidator");jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");(function(){"use strict";var n=new sap.apf.modeler.ui.utils.NullObjectChecker();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();var t=new sap.apf.modeler.ui.utils.TextManipulator();function _(C){var s=C.getSource();C.byId("idSource").setValue("");if(!n.checkIsNotNullOrUndefinedOrBlank(s)){C.addOrRemoveMandatoryFieldsAndRequiredFlag(false);return;}C.byId("idSource").setValue(s);C.addOrRemoveMandatoryFieldsAndRequiredFlag(true);}function a(C){var m,s,e,A,v;s=C.byId("idSource").getValue();C.byId("idEntity").setModel(null);C.byId("idEntity").clearSelection();if(!n.checkIsNotNullOrUndefinedOrBlank(s)){return;}A=C.getAllEntities(s);e=C.getEntity();if(n.checkIsNotNullOrUndefinedOrBlank(e)){v=C.validateSelectedValues(C,[e],A);A=v.aValues;e=v.aSelectedValues[0];}m=o.convert(A);C.byId("idEntity").setModel(m);if(!n.checkIsNotNullOrUndefinedOrBlank(e)||A.indexOf(e)===-1){e=C.getAllEntities(s)[0];}if(n.checkIsNotNullOrUndefinedOrBlank(e)){C.byId("idEntity").setSelectedKey(e);}}function b(C){var s,e,S,p,m,v=[];s=C.byId("idSource").getValue();var i=C.getIdOfPropertiesControl();C.byId(i).setModel(null);C.byId(i).clearSelection();e=t.removePrefixText(C.byId("idEntity").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);p=C.getAllEntitySetProperties(s,e);S=C.getSelectProperties();if(n.checkIsNotNullOrUndefinedOrBlank(S)){v=C.validateSelectedValues(C,S,p);p=v.aValues;S=v.aSelectedValues;}m=o.convert(p);C.byId(i).setModel(m);C.setSelectedKeysForProperties(S);}function c(C){C.byId("idSource").attachEvent("selectService",C.handleSelectionOfService.bind(C));}sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.requestOptions",{viewValidator:{},oConfigurationEditor:{},oParentObject:{},onInit:function(){var C=this;C.viewValidator=new sap.apf.modeler.ui.utils.ViewValidator(C.getView());C.oConfigurationEditor=C.getView().getViewData().oConfigurationEditor;C.oParentObject=C.getView().getViewData().oParentObject;C.setDetailData();C.setDisplayText();c(C);},setDetailData:function(){var C=this;_(C);a(C);b(C);C.setOptionalRequestFieldProperty();},updateSubViewInstancesOnReset:function(e){var C=this;C.oConfigurationEditor=e.getParameter("oConfigurationEditor");C.oParentObject=e.getParameter("oParentObject");C.setDetailData();},setDisplayText:function(){},handleChangeForSource:function(e){var C=this,E,s;var S=C.byId("idSource").getValue().trim();if(n.checkIsNotNullOrUndefinedOrBlank(S)&&C.oConfigurationEditor.registerService(S)){C.addOrRemoveMandatoryFieldsAndRequiredFlag(true);C.updateSource(S);if(!n.checkIsNotNullOrUndefinedOrBlank(C.getAllEntities(S))){C.resetEntityAndProperties();return;}}else{C.clearSource();C.addOrRemoveMandatoryFieldsAndRequiredFlag(false);}a(C);E=t.removePrefixText(C.byId("idEntity").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);C.updateEntity(E);b(C);s=C.getSelectedKeysForProperties();C.updateSelectProperties(s);C.setOptionalRequestFieldProperty();C.oConfigurationEditor.setIsUnsaved();C.fireRelevantEvents(e);},handleChangeForEntity:function(e){var C=this,E,s;E=t.removePrefixText(C.byId("idEntity").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);C.updateEntity(E);b(C);s=C.getSelectedKeysForProperties();C.updateSelectProperties(s);C.setOptionalRequestFieldProperty();C.oConfigurationEditor.setIsUnsaved();C.fireRelevantEvents(e);},handleChangeForSelectProperty:function(e){var C=this;var s=C.getSelectedKeysForProperties();C.updateSelectProperties(s);C.setOptionalRequestFieldProperty();C.oConfigurationEditor.setIsUnsaved();C.fireRelevantEvents(e);},handleChangeForOptionalRequestField:function(e){var C=this;var f=[t.removePrefixText(C.byId("idOptionalRequestField").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)];C.updateOptionalRequestFieldProperty(f);C.oConfigurationEditor.setIsUnsaved();C.fireRelevantEvents(e);},handleSuggestions:function(e){var C=this;var E=C.oConfigurationEditor.getAllServices();var T=C.getView().getViewData().oConfigurationHandler.getTextPool();var s=new sap.apf.modeler.ui.utils.SuggestionTextHandler(T);s.manageSuggestions(e,E);},fireRelevantEvents:function(){},addOrRemoveMandatoryFieldsAndRequiredFlag:function(r){var C=this;C.byId("idEntityLabel").setRequired(r);C.byId(C.getIdOfPropertyLabel()).setRequired(r);if(r){C.viewValidator.addFields(["idEntity",C.getIdOfPropertiesControl()]);}else{C.viewValidator.removeFields(["idEntity",C.getIdOfPropertiesControl()]);}},handleSelectionOfService:function(e){var s=e.getParameter("sSelectedService");e.getSource().setValue(s);e.getSource().fireEvent("change");},handleShowValueHelpRequest:function(e){var C=this;var v={oTextReader:C.getView().getViewData().oTextReader,parentControl:e.getSource(),getCalatogServiceUri:C.getView().getViewData().getCalatogServiceUri};sap.ui.view({id:C.createId("idCatalogServiceView"),viewName:"sap.apf.modeler.ui.view.catalogService",type:sap.ui.core.mvc.ViewType.XML,viewData:v});},getNonCommonValues:function(e,T){var N=[];if(!n.checkIsNotNullOrUndefined(e)){return N;}N=e.filter(function(p){return T.indexOf(p)===-1;});return N;},validateSelectedValues:function(C,s,A){var v={},i=[],V=[],I=[],d=[],e;v=sap.apf.utils.validateSelectedValues(s,A);i=v.invalid;V=v.valid;I=t.addPrefixText(i,sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);d=I.concat(A).length!==0?I.concat(A):A;e=I.concat(V).length!==0?I.concat(V):s;return{aValues:d,aSelectedValues:e};},resetEntityAndProperties:function(){},setOptionalRequestFieldProperty:function(){},getIdOfPropertiesControl:function(){return"idSelectProperties";},getIdOfPropertyLabel:function(){return"idSelectPropertiesLabel";},setSelectedKeysForProperties:function(p){var C=this;C.byId("idSelectProperties").setSelectedKeys(p);},getSelectedKeysForProperties:function(){var C=this,s=[],S=[];s=C.byId("idSelectProperties").getSelectedKeys();s.forEach(function(k){S.push(t.removePrefixText(k,sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));});return S;},getSource:function(){},updateSource:function(s){},clearSource:function(){},getAllEntities:function(s){},getEntity:function(){},updateEntity:function(e){},clearEntity:function(){},getAllEntitySetProperties:function(s,e){},getSelectProperties:function(){},updateSelectProperties:function(s){},clearSelectProperties:function(){},removeSelectProperties:function(p){},getOptionalRequestFieldProperty:function(){},updateOptionalRequestFieldProperty:function(f){},clearOptionalRequestFieldProperty:function(){},removeOptionalRequestFieldProperty:function(p){}});}());
