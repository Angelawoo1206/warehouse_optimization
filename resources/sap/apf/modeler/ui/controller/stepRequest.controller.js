/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.controller.requestOptions");(function(){"use strict";var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();var t=new sap.apf.modeler.ui.utils.TextManipulator();var n=new sap.apf.modeler.ui.utils.NullObjectChecker();sap.apf.modeler.ui.controller.requestOptions.extend("sap.apf.modeler.ui.controller.stepRequest",{onBeforeRendering:function(){var c=this;c.byId("idOptionalRequestFieldLabel").setVisible(true);c.byId("idOptionalRequestField").setVisible(true);},onAfterRendering:function(){var c=this;c.addOrRemoveMandatoryFieldsAndRequiredFlag(true);},setDisplayText:function(){var c=this;var T=c.getView().getViewData().oTextReader;c.byId("idSourceLabel").setText(T("source"));c.byId("idEntityLabel").setText(T("entity"));c.byId("idSelectPropertiesLabel").setText(T("selectProperties"));c.byId("idOptionalRequestFieldLabel").setText(T("requiredFilters"));},setOptionalRequestFieldProperty:function(){var c=this;var p,m,f,N,v=[];N=[c.getView().getViewData().oTextReader("none")];c.byId("idOptionalRequestField").setSelectedKey(N[0]);p=c.byId("idSelectProperties").getSelectedKeys();f=c.oParentObject.getFilterProperties();if(n.checkIsNotNullOrUndefinedOrBlank(f)){v=c.validateSelectedValues(c,f,p);f=v.aSelectedValues;}m=o.convert(N.concat(p));c.byId("idOptionalRequestField").setModel(m);c.byId("idOptionalRequestField").setSelectedKey(f[0]);},addOrRemoveMandatoryFieldsAndRequiredFlag:function(r){var c=this;if(r===false){return;}c.byId("idSourceLabel").setRequired(r);c.byId("idEntityLabel").setRequired(r);c.byId("idSelectPropertiesLabel").setRequired(r);c.viewValidator.addFields(["idSource","idEntity","idSelectProperties"]);},fireRelevantEvents:function(e){var c=this,f,s;if(e.getSource()!==c.byId("idOptionalRequestField")){f=[t.removePrefixText(c.byId("idOptionalRequestField").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)];c.updateOptionalRequestFieldProperty(f);if(c.getSelectProperties().length===0){c.oParentObject.resetTopN();}c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETDATAREDUCTIONSECTION);}s=(c.byId("idOptionalRequestField").getSelectedKey()!==c.getView().getViewData().oTextReader("none"))?true:false;c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETVISIBILITYOFFILTERMAPPINGFIELDS,{"bShowFilterMappingLayout":s});c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.UPDATEFILTERMAPPINGFIELDS);},getSource:function(){var c=this;return c.oParentObject.getService();},getAllEntities:function(s){var c=this;return c.oConfigurationEditor.getAllEntitySetsOfService(s);},getEntity:function(){var c=this;return c.oParentObject.getEntitySet();},getAllEntitySetProperties:function(s,e){var c=this;return c.oConfigurationEditor.getAllPropertiesOfEntitySet(s,e);},clearSource:function(){var c=this;c.oParentObject.setService(undefined);c.clearEntity();},clearEntity:function(){var c=this;c.oParentObject.setEntitySet(undefined);c.clearSelectProperties();},clearSelectProperties:function(){var c=this;var O=c.oParentObject.getSelectProperties();O.forEach(function(p){c.oParentObject.removeSelectProperty(p);});c.clearOptionalRequestFieldProperty();},clearOptionalRequestFieldProperty:function(){var c=this;var O=c.oParentObject.getFilterProperties();O.forEach(function(p){c.oParentObject.removeFilterProperty(p);});},removeSelectProperties:function(p){var c=this;p.forEach(function(a){c.oParentObject.removeSelectProperty(a);});},removeOptionalRequestFieldProperty:function(p){var c=this;p.forEach(function(a){c.oParentObject.removeFilterProperty(a);});},updateSource:function(s){var c=this;c.oParentObject.setService(s);},updateEntity:function(e){var c=this;c.oParentObject.setEntitySet(e);},updateSelectProperties:function(s){var c=this;c.removeSelectProperties(c.oParentObject.getSelectProperties());s.forEach(function(p){c.oParentObject.addSelectProperty(p);});},updateOptionalRequestFieldProperty:function(f){var c=this;c.removeOptionalRequestFieldProperty(c.oParentObject.getFilterProperties());f.forEach(function(p){if(p!==c.getView().getViewData().oTextReader("none")){c.oParentObject.addFilterProperty(p);}});},getSelectProperties:function(){var c=this;return c.oParentObject.getSelectProperties();},getOptionalRequestFieldProperty:function(){var c=this;return c.oParentObject.getFilterProperties();},getValidationState:function(){var c=this;return c.viewValidator.getValidationState();}});}());
