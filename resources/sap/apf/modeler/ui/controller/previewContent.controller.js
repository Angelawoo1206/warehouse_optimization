/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.require("sap.apf.ui.utils.constants");jQuery.sap.require("sap.apf.utils.utils");(function(){'use strict';var r,R,p,c,t,o,s,a;var T=sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;function _(C){var S=!c.getTextPool().isInitialTextKey(p.getLongTitleId())?p.getLongTitleId():p.getTitleId();var M=r.getMainContent(b(S),480,330);C.byId("idMainChart").addItem(M);}function b(S){var i=S&&c.getTextPool().get(S),n;if(i!==undefined){n=i.TextElementDescription;}return n;}function d(M){var P=b(R[M]());if(P===undefined){P=b(p[M]());}return P;}function e(C){var S=b(p.getTitleId());C.byId("idStepTitleText").setText(S);C.byId("idThumbnailChartLayout").addItem(r.getThumbnailContent());C.byId("idLeftUpperCornerText").setText(d("getLeftUpperCornerTextKey"));C.byId("idRightUpperCornerText").setText(d("getRightUpperCornerTextKey"));C.byId("idLeftLowerCornerText").setText(d("getLeftLowerCornerTextKey"));C.byId("idRightLowerCornerText").setText(d("getRightLowerCornerTextKey"));}function f(C){_(C);e(C);}function g(D,S){return D.sort(function(n,q){var u,i;for(i=0;i<S.length;i++){if(n[S[i].property]<q[S[i].property]){u=-1;}else if(n[S[i].property]>q[S[i].property]){u=1;}u=u*[1,-1][+!S[i].ascending];if(u!==0){return u;}}});}function h(L,A,P){var i,n,q=[];A.forEach(function(D){if(D.sProperty===""){D.sProperty=P[0];}if(D.sProperty!==t("none")){n=L(D.sProperty);if(n!==undefined){i=c.getTextPool().get(n).TextElementDescription;}else{i=s.getDefaultLabel(D.sProperty);}q.push({fieldName:D.sProperty,sAggregationRole:s.getPropertyMetadata(D.sProperty)["aggregation-role"],fieldDesc:i,kind:D.sContext});}});return q;}function j(P){var i=[];if(P==="properties"&&R.getRepresentationType()===T){i=h(R.getPropertyTextLabelKey,o.getActualProperties(),s.getProperties());}else if(P==="dimensions"&&R.getRepresentationType()!==T){i=h(R.getDimensionTextLabelKey,o.getActualDimensions().concat(o.getActualLegends()),s.getDimensions());}else if(P==="measures"&&R.getRepresentationType()!==T){i=h(R.getMeasureTextLabelKey,o.getActualMeasures(),s.getMeasures());}return i;}function k(){var S=[],n=[],i=0,q=3;var P=s.getProperties();var D=s.getDimensions();var M=s.getMeasures();var C=R.getRepresentationType();var u=C!==T?Math.pow(q,D.length):7;for(i=0;i<u;i++){var v={};if(C===T){P.forEach(function(w){var x=w+" - "+Math.round(Math.random()*500);v[w]=x;});}else{D.forEach(function(w,x){var y=w+" - "+(Math.floor(i/Math.pow(q,x))%q+1);v[w]=y;});M.forEach(function(w){var x=Math.round(Math.random()*500);v[w]=x;});}S.push(v);}n=R.getOrderbySpecifications();if(n&&n.length){S=g(S,n);}return S;}function l(){var i=a.getConstructorOfRepresentationType(R.getRepresentationType());jQuery.sap.require(i);var n=sap.apf.utils.extractFunctionFromModulePathString(i);function q(u){return u;}function E(){}var A={getTextNotHtmlEncoded:q,getTextHtmlEncoded:q,getEventCallback:E,createFilter:function(){return{getOperators:function(){return{EQ:true};},getTopAnd:function(){return{addOr:E};},getInternalFilter:function(){return{getProperties:function(){return[];}};}};},createMessageObject:E,putMessage:E,updatePath:E,selectionChanged:E,getActiveStep:function(){return{getSelectedRepresentation:function(){return{bIsAlternateView:true};}};}};var P={dimensions:j("dimensions"),measures:j("measures"),properties:j("properties")};r=new n(A,P);var M={getPropertyMetadata:function(){return{label:undefined};}};r.setData(k(),M);}function m(C){var P=C.byId("idPreviewContentDialog");P.setTitle(t("preview"));P.getEndButton().setText(t("close"));}sap.ui.controller("sap.apf.modeler.ui.controller.previewContent",{onInit:function(){var C=this;var P=C.byId("idPreviewContentDialog");R=C.getView().getViewData().oRepresentation;p=C.getView().getViewData().oParentStep;c=C.getView().getViewData().oConfigurationHandler;t=C.getView().getViewData().oCoreApi.getText;o=C.getView().getViewData().oRepresentationHandler;s=C.getView().getViewData().oStepPropertyMetadataHandler;a=C.getView().getViewData().oRepresentationTypeHandler;m(C);l();f(C);P.open();},handleCloseButtonOfDialog:function(){var C=this;C.byId("idPreviewContentDialog").destroy();C.getView().destroy();}});}());
