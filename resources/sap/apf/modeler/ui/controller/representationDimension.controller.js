/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.core.constants");jQuery.sap.require("sap.apf.modeler.ui.utils.staticValuesBuilder");jQuery.sap.require("sap.apf.modeler.ui.controller.propertyType");jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");(function(){"use strict";var r=sap.apf.core.constants.representationMetadata;var t=new sap.apf.modeler.ui.utils.TextManipulator();sap.apf.modeler.ui.controller.propertyType.extend("sap.apf.modeler.ui.controller.representationDimension",{setLabelDisplayOptionType:function(o){var s,l,m,p,L,c=this,a=[];s=new sap.apf.modeler.ui.utils.StaticValuesBuilder(c.oTextReader,o);l=sap.apf.core.constants.representationMetadata.labelDisplayOptions;p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);L=c.oRepresentation.getLabelDisplayOption(p);m=s.getLabelDisplayOptions();if((L===l.KEY_AND_TEXT||L===l.TEXT)&&!c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(p)){m=s.getValidatedLabelDisplayOptions();a=t.addPrefixText([L],sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);L=a[0];}c.byId("idLabelDisplayOptionType").setModel(m);c.byId("idLabelDisplayOptionType").setSelectedKey(L);},getAllPropertiesAsPromise:function(){var c=this,a,s,p,A,d=[];var S=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;var b=jQuery.Deferred();S.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(R){a=R.consumable;a.forEach(function(P){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(P)){A=c.oStepPropertyMetadataHandler.getPropertyMetadata(P)["aggregation-role"];if(A===C.aggregationRoles.DIMENSION){d.push(P);}}});s=c.getSelectedProperty();if(s!==undefined){p=d.indexOf(s)!==-1?d:d.concat(s);d=R.available.indexOf(s)!==-1?p:d.concat(t.addPrefixText([s],sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));s=R.available.indexOf(s)!==-1?s:t.addPrefixText([s],sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)[0];}b.resolve({aAllProperties:d,sSelectedKey:s});});return b.promise();},getPropertyTextLabelKey:function(p){var c=this;return c.oRepresentation.getDimensionTextLabelKey(p);},removeProperties:function(){var c=this;c.getView().getViewData().oRepresentationHandler.getActualDimensions().forEach(function(p){c.oRepresentation.removeDimension(p.sProperty);});},updateProperties:function(p){var c=this;c.removeProperties();p.forEach(function(P){c.oRepresentation.addDimension(P.sProperty);c.oRepresentation.setDimensionKind(P.sProperty,P.sKind);c.oRepresentation.setLabelDisplayOption(P.sProperty,P.sLabelDisplayOption);c.oRepresentation.setDimensionTextLabelKey(P.sProperty,P.sTextLabelKey);});},createNewPropertyInfo:function(n){var c=this,N={};var i=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(n);N.sProperty=n;N.sKind=c.getView().getViewData().oPropertyTypeData.sContext;N.sLabelDisplayOption=i?r.labelDisplayOptions.KEY_AND_TEXT:r.labelDisplayOptions.KEY;N.sTextLabelKey=undefined;return N;},createCurrentProperiesInfo:function(d){var c={},C=this;c.sProperty=d;c.sKind=C.oRepresentation.getDimensionKind(d);c.sLabelDisplayOption=C.oRepresentation.getLabelDisplayOption(d);c.sTextLabelKey=C.oRepresentation.getDimensionTextLabelKey(d);return c;},setPropertyTextLabelKey:function(p,l){var c=this;c.oRepresentation.setDimensionTextLabelKey(p,l);},setNextPropertyInParentObject:function(){var c=this;var p=c.getView().getViewData().oPropertyTypeData.sProperty;var k=c.getView().getViewData().oPropertyTypeData.sContext;var i=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(p);var l=i?r.labelDisplayOptions.KEY_AND_TEXT:r.labelDisplayOptions.KEY;c.oRepresentation.addDimension(p);c.oRepresentation.setDimensionKind(p,k);c.oRepresentation.setLabelDisplayOption(p,l);c.setPropertyTextLabelKey(p,undefined);c.setDetailData();},enableDisableLabelDisplayOptionType:function(){var i,c=this;var d=c.byId("idLabelDisplayOptionType");var p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);var I=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(p);for(i=0;i<d.getItems().length;i++){d.getItems()[i].setEnabled(true);if(i>0&&!I){d.getItems()[i].setEnabled(false);}}},removePropertyFromParentObject:function(){var c=this;c.oRepresentation.removeDimension(t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));},addProperty:function(){var c=this,a,d=[];var s=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;s.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(R){R.consumable.forEach(function(p){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(p)){a=c.oStepPropertyMetadataHandler.getPropertyMetadata(p)["aggregation-role"];if(a===C.aggregationRoles.DIMENSION){d.push(p);}}});c.getView().fireEvent(C.events.ADDPROPERTY,{"sProperty":d[0],"sContext":c.getView().getViewData().oPropertyTypeData.sContext});c.oConfigurationEditor.setIsUnsaved();});},addRemovedProperty:function(e){var c=this;var p=e.getParameter("sProperty");if(p!==c.oTextReader("none")){var i=new sap.ui.core.Item({key:p,text:p});c.byId("idPropertyType").addItem(i);}},removeAddedProperty:function(e){var c=this;var p=e.getParameter("sProperty");var i=c.byId("idPropertyType").getItems();i.forEach(function(I){if(I.getKey()===p){if(p!==c.oTextReader("none")){c.byId("idPropertyType").removeItem(I);}}});}});}());
