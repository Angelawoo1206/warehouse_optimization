/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.controller.propertyType");jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");(function(){"use strict";var t=new sap.apf.modeler.ui.utils.TextManipulator();sap.apf.modeler.ui.controller.representationDimension.extend("sap.apf.modeler.ui.controller.representationLegend",{getAllPropertiesAsPromise:function(){var c=this,a,s,p,A,d=[];var S=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;var b=jQuery.Deferred();S.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(r){a=r.consumable;a.forEach(function(P){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(P)){A=c.oStepPropertyMetadataHandler.getPropertyMetadata(P)["aggregation-role"];if(A===C.aggregationRoles.DIMENSION){d.push(P);}}});s=c.getSelectedProperty();if(s!==c.oTextReader("none")&&s!==undefined){p=d.indexOf(s)!==-1?d:d.concat(s);d=r.available.indexOf(s)!==-1?p:d.concat(t.addPrefixText([s],sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));s=r.available.indexOf(s)!==-1?s:t.addPrefixText([s],sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)[0];}d.splice(0,0,c.oTextReader("none"));b.resolve({aAllProperties:d,sSelectedKey:s});});return b.promise();},removeProperties:function(){var c=this;c.getView().getViewData().oRepresentationHandler.getActualLegends().forEach(function(p){c.oRepresentation.removeDimension(p.sProperty);});},updatePropertyType:function(n){var c=this;var p=[],N={},a,d;var P=c.getView().getViewData().oPropertyTypeState;var C=P.getPropertyValueState();var b=P.indexOfPropertyTypeViewId(c.getView().getId());if(n!==c.oTextReader("none")){N=c.createNewPropertyInfo(n);}for(a=0;a<C.length;a++){d=C[a];if(d===c.oTextReader("none")){continue;}if(b===a){p.push(N);}else{p.push(c.createCurrentProperiesInfo(d,N));}}c.updateProperties(p);},enableDisableLabelDisplayOptionType:function(){var i,c=this;var d=c.byId("idLabelDisplayOptionType");var p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE);var I=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(p);if(p===c.oTextReader("none")){d.setEnabled(false);return;}d.setEnabled(true);for(i=0;i<d.getItems().length;i++){d.getItems()[i].setEnabled(true);if(i>0&&!I){d.getItems()[i].setEnabled(false);}}},addProperty:function(){var c=this,a,d=[];var s=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;s.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(r){r.consumable.forEach(function(p){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(p)){a=c.oStepPropertyMetadataHandler.getPropertyMetadata(p)["aggregation-role"];if(a===C.aggregationRoles.DIMENSION){d.push(p);}}});c.getView().fireEvent(C.events.ADDPROPERTY,{"sProperty":d[0],"sContext":c.getView().getViewData().oPropertyTypeData.sContext});c.oConfigurationEditor.setIsUnsaved();});},addRemovedProperty:function(e){var c=this;var p=e.getParameter("sProperty");if(p!==c.oTextReader("none")){var i=new sap.ui.core.Item({key:p,text:p});c.byId("idPropertyType").addItem(i);}},removeAddedProperty:function(e){var c=this;var p=e.getParameter("sProperty");var i=c.byId("idPropertyType").getItems();i.forEach(function(I){if(I.getKey()===p){if(p!==c.oTextReader("none")){c.byId("idPropertyType").removeItem(I);}}});}});}());
