/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.hierarchicalStep");jQuery.sap.require("sap.apf.core.step");jQuery.sap.require("sap.apf.core.utils.uriGenerator");jQuery.sap.require("sap.ui.model.odata.v2.ODataModel");(function(){'use strict';sap.apf.core.HierarchicalStep=function(m,s,f,r,c){sap.apf.core.Step.call(this,m,s,f,r);var a;var b;this.type="hierarchicalStep";var d=f.getConfigurationById(s.request).service;var e=f.getConfigurationById(s.request).entityType;var g=c.getAnnotationsForService(d);var h=s.hierarchyProperty;var i=c.getMetadata(d);var j=i.getHierarchyAnnotationsForProperty(e,h);var k=c.getEntityTypeMetadata(d,e);if(j.type==="messageObject"){m.putMessage(j);}else{a=l(h,j);}var M=new sap.ui.model.odata.v2.ODataModel(d,{annotationURI:g});function l(h,j){var n=[h];for(var o in j){n.push(j[o]);}n=n.concat(f.getConfigurationById(s.request).selectProperties);return sap.apf.core.utils.uriGenerator.getSelectString(n);}this.update=function(n,o){var p=n.restrictToProperties(i.getFilterableProperties(e));var F=!p.isEqual(b);if(!F){o({},true);return;}var q=sap.apf.core.utils.uriGenerator.generateOdataPath(m,i,e,p,i.getUriComponents(e).navigationProperty);if(b&&q===sap.apf.core.utils.uriGenerator.generateOdataPath(m,i,e,b,i.getUriComponents(e).navigationProperty)){q=undefined;}else{q="/"+q;}var t={};t.path=q;if(!p.isEmpty()){t.filters=[p.mapToSapUI5FilterExpression()];}t.parameters={select:a,operationMode:sap.ui.model.odata.OperationMode.Server,useServerSideApplicationFilters:true,treeAnnotationProperties:j};this.getBinding().updateTreetable(t,M,o,k);};this.setData=function(n,o){b=o.copy();};};})();
