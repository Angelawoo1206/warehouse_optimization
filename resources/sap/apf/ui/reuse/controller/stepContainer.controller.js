/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
*/
(function(){"use strict";var c,u,a,I=false;function _(){var i=a.getSelectedRepresentation();if(d()){i=a.getSelectedRepresentation().toggleInstance;}return i;}function b(){var R=a.getSelectedRepresentation();if(R.type===sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION){return true;}return false;}function d(){if(a.getSelectedRepresentation().bIsAlternateView===undefined||a.getSelectedRepresentation().bIsAlternateView===false){return false;}return true;}function e(){var R=_();var i=R.getParameter().requiredFilters;if(i===undefined||i.length===0){return undefined;}return i[0];}function f(i){if(!i){return undefined;}var R=_();var M=R.getMetaData();if(!M){return null;}var P=M.getPropertyMetadata(i);if(!P){return null;}var F=P.label;return F!==undefined?F:null;}function g(C,i){var j=C.byId("idChartContainer");var y="0";var z=jQuery(window).width();var A=j.getId();if(jQuery("#"+A).length!==0){y=jQuery("#"+A+" > div:first-child > div:nth-child(2)").offset().top;z=jQuery("#"+A+" > div:first-child > div:nth-child(2)").width();}var B=(jQuery(window).height()-y)-jQuery(".applicationFooter").height();var D=z;i.setHeight(B+"px");i.setWidth(D+"px");}function h(C){var i=C.byId("idChartContainer");var R=_();var T=a.longTitle&&!c.isInitialTextKey(a.longTitle.key)?a.longTitle:a.title;var S=c.getTextNotHtmlEncoded(T);var j=R.getMainContent(S);var y={onBeforeRendering:function(){g(C,j);}};j.addEventDelegate(y);i.removeAllContent();var z=new sap.suite.ui.commons.ChartContainerContent({content:j});i.addContent(z);}function k(C,i){var S=C.byId("idSelectedText");var j=v();var y=e()!==undefined?f(e()):null;var z=y+" ("+j+") ";var A=C.byId("idSelPropertyAndCount");if(!A){A=new sap.m.Link({id:C.createId("idSelPropertyAndCount"),press:C.handlePressSelectedPropertyCountLink.bind(C)});A.addAriaLabelledBy(S.getId());}A.setVisible(true);A.setText(z);i.addContent(A);i.onAfterRendering=function(){var B=this;if(B.getContent().length>=5){B.getContent()[4].focus();}};}function l(C){var i=C.byId("idChartContainer");i.removeAllCustomIcons();m(C);n(C);o(C);}function m(C){var i=C.byId("idChartContainer");var j=a.getSelectedRepresentationInfo();var y;if(j.parameter&&j.parameter.orderby){y=new sap.apf.ui.utils.Helper(c).getRepresentationSortInfo(j);}var z=c.getTextNotHtmlEncoded(j.label)+"\n"+((y!==undefined)?c.getTextNotHtmlEncoded("sortBy")+": "+y:"");var A=new sap.ui.core.Icon({src:j.picture,tooltip:z,press:function(E){C.handlePressChartIcon(E);}});i.addCustomIcon(A);}function n(C){if(b()){return;}var i=C.byId("idChartContainer");var j=c.getTextNotHtmlEncoded("listView");var y=new sap.ui.core.Icon({src:"sap-icon://table-view",tooltip:j,press:C.handlePressAlternateRepIcon.bind(C)});i.addCustomIcon(y);}function o(C){if((_().topN!==undefined)||(!d()&&!b())){return;}var i=C.byId("idChartContainer");var j=c.getTextNotHtmlEncoded("view-Settings-Button");var V=_().createViewSettingDialog();var y=new sap.ui.core.Icon({src:"sap-icon://drop-down-list",tooltip:j,press:function(){V.open();}});i.addCustomIcon(y);}function p(C,i){var S=C.byId("idSelectedText");if(!S){S=new sap.m.Label({id:C.createId("idSelectedText"),text:c.getTextNotHtmlEncoded("selectedValue")});}S.setVisible(true);i.addContent(S);}function q(C,i){var R=C.byId("idReset");if(!R){R=new sap.m.Button({text:c.getTextNotHtmlEncoded("reset"),id:C.createId("idReset"),type:"Transparent",press:C.handlePressResetButton.bind(C)});}R.setVisible(true);i.addContent(R);}function r(C,i){var j=v();if(j>0&&e()!==undefined){p(C,i);k(C,i);q(C,i);}}function s(C){var i=C.byId("idChartContainer");var j=i.getToolbar();if(j){j.removeAllContent();}else{j=new sap.m.OverflowToolbar();}var y=new sap.m.Label({text:c.getTextNotHtmlEncoded("currentStep")});j.addContent(y);var S=new sap.m.ToolbarSpacer();j.addContent(S);r(C,j);j.addContent(new sap.suite.ui.commons.ChartContainerToolbarPlaceholder());i.setToolbar(j);}function t(C){if(a===undefined){return;}h(C);l(C);s(C);}function v(){var i=_();var j=i.getSelections().length;return j;}function w(C,i){var A=new sap.m.List({mode:sap.m.ListMode.SingleSelectMaster,showSeparators:sap.m.ListSeparators.None,includeItemInSelection:true,selectionChange:C.handleSelectionChartSwitchIcon.bind(C)});var y;var R;for(var j=0;j<a.representationtypes.length;j++){R=a.representationtypes[j];y=undefined;if(R.parameter&&R.parameter.orderby){y=new sap.apf.ui.utils.Helper(c).getRepresentationSortInfo(R);}var D=y!==undefined?c.getTextNotHtmlEncoded("sortBy")+": "+y:"";var z=new sap.m.StandardListItem({description:D,icon:R.picture,title:c.getTextNotHtmlEncoded(R.label),customData:[new sap.ui.core.CustomData({key:'data',value:{oRepresentationType:R,icon:R.picture}})]});A.addItem(z);}if(!C.byId("idAllChartPopover")){var S=new sap.m.Popover({id:C.createId("idAllChartPopover"),placement:sap.m.PlacementType.Bottom,showHeader:false,content:[A],afterClose:function(){S.destroy();}});}C.byId("idAllChartPopover").openBy(i);}function x(C,i){C.byId("idReset").setVisible(i);C.byId("idSelPropertyAndCount").setVisible(i);C.byId("idSelectedText").setVisible(i);}sap.ui.controller("sap.apf.ui.reuse.controller.stepContainer",{onInit:function(){var C=this;c=C.getView().getViewData().oCoreApi;u=C.getView().getViewData().uiApi;a=c.getActiveStep();},onAfterRendering:function(){var C=this;jQuery(window).resize(function(){var i=90;if(c.getSmartFilterBarConfiguration()){i=165;}var j=jQuery(window).height()-i;jQuery('.layoutView').css({"height":j});C.drawStepContent();});},handlePressSelectedPropertyCountLink:function(){var C=this;C.oCoreApi=c;var i=new sap.ui.jsfragment("idSelectionDisplayFragment","sap.apf.ui.reuse.fragment.selectionDisplay",C);i.open();},handlePressResetButton:function(){var C=this;if(d()){_().removeAllSelection();}_().removeAllSelection();x(C,false);},createToggleRepresentationInstance:function(){a=c.getActiveStep();var R=a.getSelectedRepresentation();var j={};function y(C){var D=C.dimensions;var B=R.getMetaData();if(B===undefined){return C;}var i;for(i=0;i<D.length;i++){var S=B.getPropertyMetadata(D[i].fieldName).hasOwnProperty('text');if(S){var E={};E.fieldName=B.getPropertyMetadata(D[i].fieldName).text;C.dimensions.push(E);}}C.isAlternateRepresentation=true;return C;}var z=jQuery.extend(true,{},R.getParameter());delete z.alternateRepresentationTypeId;delete z.alternateRepresentationType;z=y(z);j=c.createRepresentation(R.getParameter().alternateRepresentationType.constructor,z);var A=R.getData(),B=R.getMetaData();if(A!==undefined&&B!==undefined){j.setData(A,B);}return j;},handlePressAlternateRepIcon:function(){var C=this;var i=a.getSelectedRepresentation();var j=c.getSteps().indexOf(a);i.bIsAlternateView=true;if(d()){i.toggleInstance=C.createToggleRepresentationInstance();}i.toggleInstance.adoptSelection(i);I=false;C.drawStepContent();u.getAnalysisPath().getCarousel().getStepView(j).getController().drawThumbnailContent(true);},handlePressChartIcon:function(E){var C=this;var i=a.getSelectedRepresentation();var j=c.getSteps().indexOf(a);a.representationtypes=a.getRepresentationInfo();if(a.representationtypes.length>1){var y=E.getParameter("controlReference");w(C,y);}else{i.bIsAlternateView=false;u.getAnalysisPath().getCarousel().getStepView(j).getController().drawThumbnailContent(true);C.drawStepContent();}},handleSelectionChartSwitchIcon:function(E){var C=this;C.byId("idAllChartPopover").close();var S=E.getParameter("listItem").getCustomData()[0].getValue();var i=c.getSteps().indexOf(a);var j=a.getSelectedRepresentationInfo().representationId;var y=S.oRepresentationType.representationId;if(j===y&&a.getSelectedRepresentation().bIsAlternateView===false){return;}I=false;a.getSelectedRepresentation().bIsAlternateView=false;a.setSelectedRepresentation(S.oRepresentationType.representationId);u.getAnalysisPath().getController().refresh(S.nActiveStepIndex);c.updatePath(u.getAnalysisPath().getController().callBackForUpdatePath.bind(u.getAnalysisPath().getController()));u.getAnalysisPath().getCarousel().getStepView(i).getController().drawThumbnailContent(true);},handleZoomInPress:function(){I=true;},handleZoomOutPress:function(){I=true;},drawStepContent:function(){var C=this,i=false;var P=a;a=c.getActiveStep();if(P!==a){i=true;}var j=c.getSteps().indexOf(a);var S=u.getAnalysisPath().getCarousel().getStepView(j);if(S===undefined){return;}var T=S.oThumbnailChartLayout.isBusy();if(T){C.byId("idStepLayout").setBusy(true);}if(!I||i){t(C);}else{s(C);}C.byId("idStepLayout").setBusy(false);}});}());
