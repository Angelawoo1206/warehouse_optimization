jQuery.sap.declare("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");jQuery.sap.require("sap.rules.ui.parser.infrastructure.util.utilsBase");sap.rules.ui.parser.resources.common.lib.resourcesConvertor=sap.rules.ui.parser.resources.common.lib.resourcesConvertor||{};sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib=(function(){var d=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var u=new sap.rules.ui.parser.infrastructure.util.utilsBase.lib.utilsBaseLib();var g=d.getOdataPropName;var a=d.getOdataPropertyValue;var b=d.getEnumPropertyValue;function c(D,p,q,r){var s,t,v,w;var x=a(D,d.PROPERTY_NAME_ID);if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_CONDITION){s={colID:x,type:"condition",expression:"",alias:""};v=g(D,d.PROPERTY_NAME_CONDITION);r=u.buildJsonPath(r,v);s.inputModelPath=r;s.expression=a(D[v],d.PROPERTY_NAME_EXPRESSION);if(s.expression==='true'){s.expression='';}w=a(D[v],d.PROPERTY_NAME_FIXED_OPERATOR);if(w){s.fixedOperator={};s.fixedOperator.operator=w;p[x]=w+' ';}}else if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_RESULT){s={colID:x,name:"",type:"output",businessDataType:""};t=g(D,d.PROPERTY_NAME_RESULT);s.businessDataType=a(D[t],d.PROPERTY_NAME_BUSINESS_DATA_TYPE);s.name=a(D[t],d.PROPERTY_NAME_DO_ATTRIBUTE_NAME);}q[x]=s.type;return s;}function e(D,p,q,r){var s,t,v,w,x,y,z,A=true;var B={rowID:0,row:[]};B.rowID=a(D,d.PROPERTY_NAME_ID);z=g(D,d.PROPERTY_NAME_CELLS);t=a(D,d.PROPERTY_NAME_CELLS);if(t){t.forEach(function(O,C){s=u.buildJsonPath(r,z,C);v={colID:0,content:""};v.colID=a(O,d.PROPERTY_NAME_COLUMN_ID);w=p[v.colID]||"";y=a(O,d.PROPERTY_NAME_CONTENT);x=q[v.colID];if(A&&y){A=false;}v.inputModelPath=s;v.content=(x==='output'&&!y)?null:w+y;if(!(x==='condition'&&!y)){B.row.push(v);}});}if(A){return null;}return B;}function f(D,p){var q=null;var r=null;D.forEach(function(s){q=g(s,d.PROPERTY_NAME_USAGE);if(q&&s[q]===d.TYPE_DO){q=g(s,d.PROPERTY_NAME_ID);if(q&&s[q]===p){r=a(s,d.PROPERTY_NAME_NAME);}}});return r;}function h(D,p){var q={};q.source=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_SOURCE);q.target=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_TARGET);p.push(q);}function i(p,q){var r=null;var s={};s.name=a(p,d.PROPERTY_NAME_NAME);s.businessDataType=a(p,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);s.dataType=a(p,d.PROPERTY_NAME_DATA_TYPE);r=g(p,d.PROPERTY_NAME_SIZE);if(r){s.size=p[r];}r=g(p,d.PROPERTY_NAME_MAPPING_INFO);if(r){s.dataMapping={};s.dataMapping.column=a(p[r],d.PROPERTY_NAME_NAME);}s.sourceType=d.SOURCE_TYPE_DATA;q.push(s);}function j(D,p,q){var r=null;var s={};s.name=a(p,d.PROPERTY_NAME_NAME);r=g(p,d.PROPERTY_NAME_TARGET_DATA_OBJECT_ID);s.target=f(D,p[r]);s.cardinality=b(p,d.PROPERTY_NAME_CARDINALITY);s.attributeMappings=[];r=g(p,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS);if(r&&p[r]&&Array.isArray(p[r])){p[r].forEach(function(t){h(t,s.attributeMappings);});}q.push(s);}function k(p,q){var r={};r.name=a(p,d.PROPERTY_NAME_NAME);r.businessDataType=a(p,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);r.dataType=a(p,d.PROPERTY_NAME_DATA_TYPE);r.size=a(p,d.PROPERTY_NAME_SIZE);q.push(r);}function l(D,p){var q=null;p.name=a(D,d.PROPERTY_NAME_NAME);p.type=a(D,d.PROPERTY_NAME_TYPE);q=g(D,d.PROPERTY_NAME_SCHEMA);p.schema="";if(D[q]){p.schema=D[q];}q=g(D,d.PROPERTY_NAME_PARAMETERS);if(D[q]){p.parameters=D[q];}}function m(D,p,q){var r=null;var s={};r=g(p,d.PROPERTY_NAME_USAGE);if(r){s.name=a(p,d.PROPERTY_NAME_NAME);if(p[r]===d.TYPE_DO){r=g(p,d.PROPERTY_NAME_ATTRIBUTES);if(r){s.attributes=[];var t=p[r];t.forEach(function(y){i(y,s.attributes);});}r=g(p,d.PROPERTY_NAME_ASSOCIATIONS);if(r){var v=p[r];s.associations=[];v.forEach(function(y){j(D,y,s.associations);});}r=g(p,d.PROPERTY_NAME_MAPPING_INFO);if(r){var w=p[r];s.mappingInfo={};l(w,s.mappingInfo);}q.dataObjects.push(s);}else if(p[r]===d.TYPE_RESULT){s.id=a(p,d.PROPERTY_NAME_ID);r=g(p,d.PROPERTY_NAME_ATTRIBUTES);if(r){s.inputParams=[];var x=p[r];x.forEach(function(y){k(y,s.inputParams);});}q.outputs.push(s);}}}var n=function(D,p){var q={"id":"","output":"","ruleBody":{"content":{"headers":[],"rows":[]},"type":"","hitPolicy":"","ruleFormat":""}};var r=g(D,d.PROPERTY_NAME_DECISION_TABLE);var s=u.buildJsonPath(p,r);var t={};var v={};q.id=a(D,d.PROPERTY_NAME_ID);q.ruleBody.ruleFormat=b(D,d.PROPERTY_NAME_RULE_FORMAT);q.output=a(D,d.PROPERTY_NAME_RESULT_DO_NAME);q.ruleBody.type=b(D,d.PROPERTY_NAME_TYPE);q.ruleBody.hitPolicy=b(D[r],d.PROPERTY_NAME_HIT_POLICY);var w=a(D[r],d.PROPERTY_NAME_DT_COLUMNS);var x=g(D[r],d.PROPERTY_NAME_DT_COLUMNS);var y=a(D[r],d.PROPERTY_NAME_DDT_ROWS);var z=g(D[r],d.PROPERTY_NAME_DDT_ROWS);if(w){var A;w.forEach(function(C,E){p=u.buildJsonPath(s,x,E);A=c(C,t,v,p);q.ruleBody.content.headers.push(A);});}if(y){var B;y.forEach(function(C,E){p=u.buildJsonPath(s,z,E);B=e(C,t,v,p);if(B){q.ruleBody.content.rows.push(B);}});}return q;};var o=function(D){var p=null;var q={"dataObjects":[],"outputs":[]};p=g(D,d.PROPERTY_NAME_DATA_OBJECTS);if(p){D[p].forEach(function(r){m(D[p],r,q);});}return q;};return{"convertRuleODataToInternalModel":n,"convertVocabularyODataToInternalModel":o};}());
