jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.conversionUtils");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.localeConversion");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");sap.rules.ui.parser.businessLanguage.lib.conversionUtils=sap.rules.ui.parser.businessLanguage.lib.conversionUtils||{};sap.rules.ui.parser.businessLanguage.lib.conversionUtils.lib=(function(){var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var l=sap.rules.ui.parser.businessLanguage.lib.localeConversion.lib;var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();function b(){}function v(n,d,m){var e={args:[]};if(n===null){e.key="error_in_expression_invalid_value_from_list_message";e.args[0]=d.token.slice(1,-1);e.args[1]=d.info.key;m.parseResult.cursorPosition=d.start;m.parseResult.convertedExpression=null;a.handleError(e.key,e.args,m);throw new h.HrfException();}}function t(e,d,m){var f={args:[]};f.key="techincal_error";f.args[0]=e.message;m.parseResult.cursorPosition=d.start;m.parseResult.convertedExpression=null;a.handleError(f.key,f.args,m);throw new h.HrfException();}b.prototype.needsNativeValueListConversion=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.conversionOutput)&&((m.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toKeys)||(m.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toDescriptions));};b.prototype.needsLocaleConversion=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.locale)&&m.flags.locale.hasOwnProperty(c.propertiesEnum.convert);};b.prototype.needsConversion=function(m){return this.needsNativeValueListConversion(m)||this.needsLocaleConversion(m);};b.prototype.convertValueNativeList=function(d,e,m,f){var g=m.flags[c.propertiesEnum.conversionOutput];var i=(g===c.conversionOutputEnum.toKeys);var n="";var j;if(f.tokenType===c.tokenTypesEnum.valueList&&d.IsValueListDescriptionExist(e,f.info.key)){j=f.info.key;try{n=(i?d.GetValueFromValueListDescription(e,j,f.token):d.GetDescriptionFromValueListValue(e,j,f.token));}catch(k){t(k,f,m);}v(n,f,m);n=(n.indexOf("'")!==0)?"'"+n+"'":n;}else{n=f.token;}return n;};b.prototype.convertLocale=function(m,d){var n=l.convertLocaleFormat(d.token,m,d.info.type);v(n,d,m);return n;};b.prototype.convert=function(d,e,m,f,o){var g=o;var j=0;var n="";var i;var k;var q;for(i=0;i<f.length;i++){k=false;q=f[i];switch(q.tokenType){case c.tokenTypesEnum.valueList:if(this.needsNativeValueListConversion(m)){k=true;n=this.convertValueNativeList(d,e,m,q);}break;case c.tokenTypesEnum.constant:if(this.needsLocaleConversion(m)){switch(q.info.type){case c.TYPE_DATE:case c.TYPE_TIMESTAMP:case c.TYPE_TIME:case c.TYPE_NUMERIC:k=true;n=this.convertLocale(m,q);break;}}break;}if(k){g=g.slice(0,q.start+j)+n+g.slice(q.end+1+j);j+=n.length-q.token.length;}}return g;};return{conversionUtilsLib:b};}());
