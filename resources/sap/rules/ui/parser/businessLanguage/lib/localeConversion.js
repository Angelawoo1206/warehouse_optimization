jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.localeConversion");jQuery.sap.require("sap.rules.ui.parser.infrastructure.locale.lib.moment_JS_min");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.numberConversion");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");sap.rules.ui.parser.businessLanguage.lib.localeConversion=sap.rules.ui.parser.businessLanguage.lib.localeConversion||{};sap.rules.ui.parser.businessLanguage.lib.localeConversion.lib=(function(){var m=sap.rules.ui.parser.infrastructure.locale.lib.moment_JS_min.lib;var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var n=sap.rules.ui.parser.businessLanguage.lib.numberConversion.lib;var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();var H="YYYY-MM-DD";var N=["D/M/YYYY","D-M-YYYY","D.M.YYYY"];var b="HH:mm:ss.SSSSSS";var d=["H:mm:ss","TH:mm:ss"];var e="YYYY-MM-DD HH:mm:ss.SSSSSS";var f=["YYYY-MM-DD HH:mm:ss","D/M/YYYY H:mm:ss","D-M-YYYY H:mm:ss","D.M.YYYY H:mm:ss","D/M/YYYYTH:mm:ss","D-M-YYYYTH:mm:ss","D.M.YYYYTH:mm:ss"];var t={toUTC:"toUTC",toTimeZone:"toTimeZone"};var s={"DD.MM.YYYY":null,"D.M.Y":null,"DD.MM.YY":null,"D.M.YY":null,"D.M.YY.":null,"D.MM.YY":null,"D.MM.Y":null,"D.M.Y.":null,"DD.MM.Y":null,"DD.MM.Y.":null,"DD.MM.YY.":null,"DD. MM. YY":null,"DD.MM.YY Г.":null,"YYYY.MM.DD":null,"YY. M. D.":null,"Y. MM. DD.":null,"Y.MM.DD":null,"Y.MM.DD.":null,"DD-MM-YY":null,"DD-MM-YYYY":null,"MM-DD-YYYY":null,"YYYY-MM-DD":null,"Y-MM-DD":null,"DD-MM-Y":null,"DD/MM/Y":null,"D/M/Y":null,"DD/MM/YY":null,"D/M/YY":null,"MM/DD/YY":null,"M/D/YY":null,"DD/MM/YYYY":null,"MM/DD/YYYY":null,"YYYY/MM/DD":null,"Y/M/D":null,"Y/MM/DD":null,"M/D/Y":null};var g={"hh:mm:ss a":null,"hh:mm:ss A":null,"h:mm:ss a":null,"h:mm:ss A":null,"H:mm:ss":null,"HH:mm:ss":null,"ah:mm:ss":null,"kl. HH:mm:ss":null};var i={"123,456,789.00":null,"123.456.789,00":null,"123456789,00":null};var j=function(O){var P=O;if(P.charAt(0)==="'"&&P.charAt(P.length-1)==="'"){P=P.slice(1,P.length-1);}return P;};var k=function(O,P){if(O===null){return P;}if(P===null){return O.toUpperCase();}return O.toUpperCase()+" "+P;};var l=function(O,P,Q){var R={str:O,dateFormat:P,timeFormat:Q};if(Q){var S=Q.indexOf('z');if(S>=0){R.timeFormat=Q.substring(0,S-1);}}if(R.dateFormat&&((R.str.indexOf("г")>=0&&R.dateFormat.indexOf("г")>=0)||(R.str.indexOf("Ð³")>=0&&R.dateFormat.indexOf("Ð³")>=0))){var T=R.str.indexOf("г");var U=R.dateFormat.indexOf("г");if(T<0){T=R.str.indexOf("Ð");U=R.dateFormat.indexOf("Ð");}R.str=R.str.slice(0,T-1)+(R.timeFormat!==null?R.str.slice(T+2):'');R.dateFormat=R.dateFormat.slice(0,U-1);}if(R.timeFormat&&(R.str.indexOf("下午")>=0||R.str.indexOf("上午")>=0)&&R.timeFormat.indexOf("a")===0){if(R.str.indexOf("下午")>=0){R.str=R.str.replace("下午",'')+" pm";}else{R.str=R.str.replace("上午",'')+" am";}R.timeFormat=R.timeFormat.replace("a","")+" a";}if(R.timeFormat&&R.str.indexOf("kl. ")>=0&&R.timeFormat.indexOf("kl. ")===0){R.str=R.str.replace("kl. ",'');R.timeFormat=R.timeFormat.replace("kl. ","");}return R;};var o=function(O,P,Q){var R=j(O);var S=null;var T='';var U=l(R,P,Q);T=k(U.dateFormat,U.timeFormat);S=m.moment(U.str,T,true);return S;};var q=function(O,P){var Q=null;var R=j(O);if(P&&P.length>0){Q=m.moment(R,P,true);}return Q;};var r=function(O,P,Q){var R=null;var S=j(O);R=m.moment(S,P,true);if(!R.isValid()){R=q(O,Q);}return R;};var u=function(O,P,Q){var R={};R.key="error_in_expression_unsupported_locale_settings";R.args=[O,P];a.handleError(R.key,R.args,Q);throw new h.HrfException();};var v=function(O){function P(R){if(!R.hasOwnProperty(c.propertiesEnum.number)){u('Number format',null,O);}if(!R.number.hasOwnProperty(c.propertiesEnum.groupSeparator)){u('Group separator',null,O);}if(!R.number.hasOwnProperty(c.propertiesEnum.decimalSeparator)){u('Decimal separator',null,O);}var V=R[c.propertiesEnum.number][c.propertiesEnum.groupSeparator];V=(V===' ')?'':V;var W=R[c.propertiesEnum.number][c.propertiesEnum.decimalSeparator];var X="123"+V+"456"+V+"789"+W+"00";if(!i.hasOwnProperty(X)){u('Number format',X,O);}}var Q=O.flags;if(!Q.locale.hasOwnProperty(c.propertiesEnum.localeSettings)||!Q.locale.localeSettings){u('Date format',null,O);}var R=Q.locale.localeSettings;if(!R.hasOwnProperty(c.propertiesEnum.dateFormat)||!R.dateFormat){u('Date format',null,O);}var S=R.dateFormat;if(!s.hasOwnProperty(S.toUpperCase())){u('Date format',S,O);}if(!R.hasOwnProperty(c.propertiesEnum.timeFormat)||!R.timeFormat){u('Time format',null,O);}var T=R.timeFormat;var U=T.indexOf('z');if(U>=0){T=T.substring(0,U-1);}if(!g.hasOwnProperty(T)){u('Time format',R.timeFormat,O);}P(R);};var w=function(O){var P=O.flags;if(!P||!P.hasOwnProperty(c.propertiesEnum.locale)){return false;}v(O);return true;};var x=function(O){var P=O.flags;var Q={};Q.isLocaleExists=w(O);Q.isCodeText=Q.isLocaleExists&&P.locale.hasOwnProperty(c.propertiesEnum.convert)&&P.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&P.locale.convert.target===c.DISPLAY_TEXT;return Q;};var y=function(O){return O.isLocaleExists&&!O.isCodeText;};var z=function(O){return!O.isLocaleExists||O.isCodeText;};var A=function(O,P){switch(P){case t.toUTC:return(-1)*Number(O);default:return Number(O);}};var B=function(O,P,Q){if(!O.isValid()||!P||!Q){return;}var R=A(P,Q);O.add(R,'Minutes');};var C=function(O,P){var Q=null;var R='';var S=false;var T=P.flags;var U=x(P);if(y(U)){R=T.locale.localeSettings.dateFormat.replace('z','');Q=o(O,R,null);}if(z(U)&&(!Q||!Q.isValid())){Q=r(O,H,N);}if(Q){S=Q.isValid();}return S;};var D=function(O,P){var Q=null;var R='';var S='';var T=false;var U=P.flags;var V=x(P);if(y(V)){R=U.locale.localeSettings.dateFormat.replace('z','');S=U.locale.localeSettings.timeFormat;Q=o(O,R,S);}if(z(V)&&(!Q||!Q.isValid())){Q=r(O,e,f);}if(Q){T=Q.isValid();}return T;};var E=function(O,P){var Q=null;var R='';var S=false;var T=P.flags;var U=x(P);if(y(U)){R=T.locale.localeSettings.timeFormat;Q=o(O,null,R);}if(z(U)&&(!Q||!Q.isValid())){Q=r(O,b,d);}if(Q){S=Q.isValid();}return S;};var F=function(O,P){var Q=P;var R='';var S='';if(P&&(P.indexOf("г")>=0||P.indexOf("Ð³")>=0)){var T=P.indexOf("г");if(T<0){T=P.indexOf("Ð");}R=P.substr(T-1,3);Q=P.slice(0,T-1);}S=O.format(Q.toUpperCase())+R;return S;};var G=function(O,P){var Q=P;var R='';var S='';if(P.indexOf("a")===0){R=O.hour()>=12?'下午':'上午';Q=Q.replace("a","");}if(P.indexOf("kl. ")===0){R="kl. ";Q=Q.replace("kl. ","");}S=R+O.format(Q);return S;};var I=function(O,P,Q,R,S,T,U,V,W){var X=null;var Y='';var Z='';X=o(O,P,Q);if(!X.isValid()&&U){X=r(O,T,U);}if(X.isValid()){B(X,V,W);if(R){Y=F(X,R);}if(S){var $=S;var _=$.indexOf('z');if(_>=0){$=$.substring(0,_-1);}Z=G(X,$);Y+=(R?" ":"")+Z;}}return Y;};var J=function(O){return(O.locale.hasOwnProperty(c.propertiesEnum.convert)&&O.locale.convert.hasOwnProperty(c.propertiesEnum.source)&&O.locale.convert.source===c.CODE_TEXT&&O.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&O.locale.convert.target===c.DISPLAY_TEXT);};var K=function(O){return(O.locale.hasOwnProperty(c.propertiesEnum.convert)&&O.locale.convert.hasOwnProperty(c.propertiesEnum.source)&&O.locale.convert.source===c.DISPLAY_TEXT&&O.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&O.locale.convert.target===c.CODE_TEXT);};var L=function(O,P,Q){var R='';var S='';var T=null;var U=null;var V=0;var W=P.flags;var X=x(P);if(y(X)){R=W.locale.localeSettings.dateFormat.replace('z','');S=W.locale.localeSettings.timeFormat;if(W.locale.localeSettings.timeZoneOffset){V=W.locale.localeSettings.timeZoneOffset;}}switch(Q){case c.TYPE_DATE:if(R!==''){U=I(O,R,null,H,null,H,N,null,null);}else{T=r(O,H,N);if(T.isValid){U=T.format(H);}}break;case c.TYPE_TIME:if(S!==''){U=I(O,null,S,null,b,b,d,V,t.toUTC);}else{T=r(O,b,d);if(T.isValid){U=T.format(b);}}break;case c.TYPE_TIMESTAMP:if(R!==''&&S!==''){U=I(O,R,S,H,b,e,f,V,t.toUTC);}else{T=r(O,e,f);if(T.isValid){U=T.format(e);}}break;case c.TYPE_NUMERIC:U=n.convertNumber(O,W);break;}if(Q!==c.TYPE_NUMERIC){U=(U&&U.indexOf("'")!==0)?"'"+U+"'":U;}return U;};var M=function(O,P,Q){var R=P.flags;var S='';var T='';var U=0;var V='';var W=null;if(w(P)){S=R.locale.localeSettings.dateFormat.replace('z','');T=R.locale.localeSettings.timeFormat;if(R.locale.localeSettings.timeZoneOffset){U=R.locale.localeSettings.timeZoneOffset;}if(R.locale.hasOwnProperty(c.propertiesEnum.convert)&&R.locale.convert.hasOwnProperty(c.propertiesEnum.target)){V=R.locale.convert.target;}}if(V===c.CODE_TEXT){W=L(O,P,Q);}else if(V===c.DISPLAY_TEXT){switch(Q){case c.TYPE_DATE:W=I(O,H,null,S,null,H,N,null,null);break;case c.TYPE_TIME:W=I(O,null,b,null,T,b,d,U,t.toTimeZone);break;case c.TYPE_TIMESTAMP:W=I(O,H,b,S,T,e,f,U,t.toTimeZone);break;case c.TYPE_NUMERIC:W=n.convertNumber(O,R);break;}}if(Q!==c.TYPE_NUMERIC){W=(W&&W.indexOf("'")!==0)?"'"+W+"'":W;}return W;};return{"isLocaleExistsInFlags":w,"isLocaleConversionFromCodeText":J,"isLocaleConversionFromDisplayText":K,"isDateStr":C,"isTimestampStr":D,"isTimeStr":E,"convertToHanaLocaleFormat":L,"convertLocaleFormat":M};}());
