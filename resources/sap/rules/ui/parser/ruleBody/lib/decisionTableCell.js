jQuery.sap.declare("sap.rules.ui.parser.ruleBody.lib.decisionTableCell");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");jQuery.sap.require("sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.constants");sap.rules.ui.parser.ruleBody.lib.decisionTableCell=sap.rules.ui.parser.ruleBody.lib.decisionTableCell||{};sap.rules.ui.parser.ruleBody.lib.decisionTableCell.lib=(function(){var p=new sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator.lib.parsingBackendMediatorLib();var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;var r=sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector.lib.ResponseCollector;var a=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var b=sap.rules.ui.parser.ruleBody.lib.constants.lib;function D(d,f,e,g,v,i){this.cellExpression=e;this.headerExpression=d;this.operator=f;this.businessDataType=g;this.vocabulary=v;this.vocaDataProvider=i;this.status=a.statusEnum.SUCCESS;this.convertedHeader=null;this.convertedCell=null;this.convertedCondition=null;this.currCursorInfo={};}var c=function c(d,e,o){var f='';if(d){f+=d;}if(o){f+=" "+o;}if(e){f+=" "+e;}return f;};var s=function s(d,e,o){var f,g=0,i=e.length;if(d){g=d.length+1;i=e.length-d.length-1;if(o){g+=o.length+1;i-=(o.length+1);}}f=e.substr(g,i);return f;};D.prototype.getParserAST=function getParserAST(e,d,v,f,g){function i(e){if(e===null||e===undefined||e===""){return true;}return false;}var j=p.parseInputRT(e,d,this.vocaDataProvider,v,f,this.vocabulary,g);if(j===undefined||(j===null&&i(e)===false)){r.getInstance().addMessage("error_in_parsing_expression",[e]);throw new h.HrfException("error_in_parsing_expression: "+e,false);}if(d===p.PARSE_MODE){if(j!==null&&j.status===a.statusEnum.ERROR){throw new h.HrfException('',false);}}return j;};D.prototype.getParserConvertedExpression=function getParserConvertedExpression(d){return d[b.parserResultEnum.convertedExpression];};D.prototype.hasParserConvertedExpression=function hasParserConvertedExpression(d){if(d.status===a.statusEnum.SUCCESS){if(!d.hasOwnProperty(a.propertiesEnum.convertedExpression)){this.status=a.statusEnum.ERROR;}else{return true;}}return false;};D.prototype.validateAndConvert=function validateAndConvert(f){var d;var e;var g;function u(k){var l={};if(this.convertedHeader&&k>this.convertedHeader.length){l.position=k-this.convertedHeader.length-this.operator.length-2;l.expressionPart=b.expressionParts.cell;}else{l.position=k;l.expressionPart=b.expressionParts.header;}return l;}function i(k){var l={};if(k){if(k.hasOwnProperty('cursorPosition')&&k.cursorPosition!==undefined&&k.cursorPosition!==null){l.cursorInfo=u.call(this,k.cursorPosition);}r.getInstance().addMessage(k.errorID,undefined,null,l,k.errorDetails);}}function j(){var g={};g.status=this.status;if(this.status===a.statusEnum.SUCCESS){if(this.convertedCell||this.convertedHeader){g.converted={};g.converted.header=this.convertedHeader;g.converted.fixedOperator=this.operator;g.converted.cell=this.convertedCell;}g.actualReturnType=this.actualReturnType;}return g;}function v(k,e,f){var l,m=null;l=this.getParserAST(k,a.VALIDATE_MODE,null,e,f);if(this.hasParserConvertedExpression(l)){m=this.getParserConvertedExpression(l);this.actualReturnType=l.actualReturnType;}else{i.call(this,l);this.status=a.statusEnum.ERROR;}return m;}if(this.headerExpression){this.convertedHeader=v.call(this,this.headerExpression,a.TYPE_SINGLE_EXPRESSION,f);}if(this.status===a.statusEnum.SUCCESS&&this.cellExpression){d=c(this.headerExpression,this.cellExpression,this.operator);e=this.businessDataType||a.TYPE_BOOLEAN_ENHANCED;this.convertedCondition=v.call(this,d,e,f);if(this.status===a.statusEnum.SUCCESS){this.convertedCell=s(this.convertedHeader,this.convertedCondition,this.operator);}}g=j.call(this);return g;};return{DecisionTableCell:D,concatToDecisionTableCondition:c,splitDecisionTableCondition:s};}());
