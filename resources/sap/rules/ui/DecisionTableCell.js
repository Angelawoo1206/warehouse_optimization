/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/rules/ui/DecisionTableCellExpressionAdvanced","sap/rules/ui/type/DecisionTableCell",],function(q,l,D,a){"use strict";var b=sap.ui.core.Control.extend("sap.rules.ui.DecisionTableCell",{metadata:{library:"sap.rules.ui",properties:{valuePath:{type:"string",defaultValue:"",bindable:"bindable"},headerValuePath:{type:"string",defaultValue:"",bindable:"bindable"},fixedOperatorPath:{type:"string",defaultValue:"",bindable:"bindable"},typePath:{typePath:"string",bindable:"bindable"},valueStateTextPath:{type:"string",defaultValue:"null",bindable:"bindable"},valueModelName:{type:"string",defaultValue:"",bindable:"bindable"},displayModelName:{type:"string",defaultValue:"",bindable:"bindable"},editable:{type:"boolean",defaultValue:true},inFocus:{type:"boolean",defaultValue:false}},aggregations:{_displayedControl:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{expressionLanguage:{type:"sap.rules.ui.services.ExpressionLanguage",multiple:false,validateOnLoad:true,singularName:"expressionLanguage"}}}});b.prototype.onFocusOut=function(){this.setInFocus(false);};b.prototype.onClick=function(){this.setInFocus(true);};b.prototype.onFocusIn=function(){this.setInFocus(true);};b.prototype.onBeforeRendering=function(){this._setDisplayedControl();};b.prototype.onAfterRendering=function(){};b.prototype.init=function(){this._decisionTableCellFormatter=new a();};b.prototype._setDisplayedControl=function(){var d=this.getAggregation("_displayedControl");var r=this.getParent().getParent().getParent();if(this.getInFocus()&&r.getEditable()){d=this._createExpressionEditor();}else{d=this._createStaticControl();}this.setAggregation("_displayedControl",d,true);};b.prototype._createStaticControl=function(){var m=this;var d=this.getAggregation("_displayedControl");if(!(d instanceof sap.m.Input)){if(d){d.destroy();}d=new sap.m.Input({editable:false});d.addStyleClass("sapRULDecisionTableSCellTextOverflow");d.addDelegate({onfocusin:function(){m.onFocusIn();}});d.addDelegate({onclick:function(e){m.onFocusIn();}});}var v=this.getDisplayModelName()+">"+this.getValuePath();if(v&&v!=="null"){d.bindValue(v);d.bindProperty("tooltip",{path:v,formatter:function(V){return V;}});}var c=this.getValueStateTextPath();if(c&&c!=="null"){d.bindProperty("valueState",{path:c,formatter:function(V){if(V){d.addStyleClass("sapMInputBaseErrorInner");return sap.ui.core.ValueState.Error;}d.removeStyleClass("sapMInputBaseErrorInner");return sap.ui.core.ValueState.None;}});}return d;};b.prototype._createExpressionEditor=function(){var e=new D({editable:this.getEditable(),expressionLanguage:this.getExpressionLanguage(),focusOnLoad:true});var d=this.getDisplayModelName()+">"+this.getValuePath();var v=this.getValueModelName()?this.getValueModelName()+">"+this.getValuePath():this.getValuePath();var c=this.getDisplayModelName()?this.getDisplayModelName()+">"+this.getHeaderValuePath():this.getHeaderValuePath();if(v&&v!=="null"){if(!this.getTypePath()){e.bindValue({parts:[{path:c},{path:this.getFixedOperatorPath()},{path:v},{path:d}],type:this._decisionTableCellFormatter});}else{e.bindValue({parts:[{path:v},{path:this.getTypePath()},{path:d}],type:this._decisionTableCellFormatter});}}if(this.getTypePath()){e.bindType(this.getTypePath());}if(c){e.bindHeaderValue(c);if(this.getFixedOperatorPath()){e.bindFixedOperator(this.getFixedOperatorPath());}}var f=this.getValueStateTextPath();if(f&&f!=="null"){e.bindValueStateText(f);}e.addDelegate({onfocusout:(function(E){var o=this.getAggregation("_displayedControl");if(!o.codeMirror||(o.codeMirror.state&&o.codeMirror.state.completionActive)){return;}var r=E.relatedTarget;var u=window.navigator.userAgent;var m=u.indexOf("MSIE ");if(r){if(r.id&&(m>0||!!navigator.userAgent.match(/Trident.*rv\:11\./))&&r.id==="content"){return;}}this.onFocusOut();}).bind(this)});return e;};b.prototype.setExpressionLanguage=function(e){this._decisionTableCellFormatter.setExpressionLanguage(e);return this.setAssociation("expressionLanguage",e,true);};return b;},true);
