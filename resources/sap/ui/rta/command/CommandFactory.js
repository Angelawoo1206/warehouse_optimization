/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory','sap/ui/dt/ElementUtil','sap/ui/fl/registry/ChangeRegistry'],function(M,C,E,a){"use strict";var g=function(s,n){var r=a.getInstance().getRegistryItems({controlType:s,changeTypeName:n});if(r&&r[s]&&r[s][n]){var R=r[s][n];return R.getChangeTypeMetadata().getChangeHandler();}else{jQuery.sap.log.warning("No '"+n+"' change handler for "+s+" registered");}};var c=function(o,n,s){var p=n.getName();var A=C.getControlAnalyzerFor(o);if(A.mapSettings){s=A.mapSettings(p,o,s);}var q=A.getConfiguredElement(o);var r=q.getMetadata().getName();var t=A.getFlexChangeType(p,o,s);if(t){var u=g(r,t);if(u){n.setChangeHandler(u);n.setChangeType(t);if(o!==q&&n.setOriginalElement){var S=A._getStableElementForCommand(o);n.setOriginalElement(S);}}}else{jQuery.sap.log.warning("No "+p+" change type registered for "+r);}return true;};var G=function(s,o){var S=s.source.publicAggregation;var A=o.createAggregationDesignTimeMetadata(S);var n=s.movedElements[0].element||sap.ui.getCore().byId(s.movedElements[0].id);var p=A.getMoveAction(n);A.destroy();return p;};var f=function(o,n,A){var s;if(typeof(A)==="string"){s=A;}else{s=A&&A.changeType;}if(!s){return false;}var p=o.getMetadata().getName();var q=g(p,s);if(!q){return false;}n.setChangeHandler(q);n.setChangeType(s);return true;};var b=function(o,n,s,D){var N=s.element||sap.ui.getCore().byId(s.element.id);var A=D.getAggregationAction("createContainer",N)[0];var S=f(o,n,A);if(S){n.setCreateContainerMetadata(A);return true;}else{return false;}};var d=function(o,n,s,p){var A=G(s,p);return f(o,n,A);};var e=function(o,n,s,D){var r=s.renamedElement;var A=D.getAction("rename",r);var S=f(o,n,A);if(S){n.setRenameMetadata(A);return true;}else{return false;}};var h=function(o,n,s,D){var r=s.removedElement||sap.ui.getCore().byId(s.removedElement.id);var A=D.getAction("remove",r);var S=f(o,n,A);if(S){n.setRemoveMetadata(A);return true;}else{return false;}};var i=function(o,n,s,D){var N=s.element;var A=D.getAggregationAction("addODataProperty",N)[0];return f(o,n,A);};var j=function(o,n,s,D){var r=s.hiddenParent;var A=D.getAction("reveal",r);return f(o,n,A);};var F=function(o,s){var A=C.getControlAnalyzerFor(o);return A.getCommandClass(s);};var k=function(o){if(o.getMetadata){var A=C.getControlAnalyzerFor(o);return A.getConfiguredElement(o);}else{return o;}};var m={"hide":{findClass:F,configure:c},"unhide":{findClass:F,configure:c},"stash":{clazz:'sap.ui.rta.command.Stash'},"unstash":{clazz:'sap.ui.rta.command.Unstash'},"group":{clazz:'sap.ui.rta.command.Group'},"ungroup":{clazz:'sap.ui.rta.command.Ungroup'},"add":{findClass:F,configure:c},"createContainer":{clazz:'sap.ui.rta.command.CreateContainer',configure:b},"move":{clazz:'sap.ui.rta.command.Move',configure:d,getAction:G},"remove":{clazz:'sap.ui.rta.command.Remove',configure:h},"composite":{clazz:'sap.ui.rta.command.CompositeCommand'},"rename":{clazz:'sap.ui.rta.command.Rename',configure:e},"property":{clazz:'sap.ui.rta.command.Property'},"bindProperty":{clazz:'sap.ui.rta.command.BindProperty'},"addODataProperty":{clazz:'sap.ui.rta.command.AddODataProperty',configure:i},"reveal":{clazz:'sap.ui.rta.command.Reveal',configure:j},"settings":{clazz:'sap.ui.rta.command.Settings'}};var l=M.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});l.getCommandFor=function(o,s,S,D){s=s[0].toLowerCase()+s.slice(1);var n=m[s];if(!n){throw new Error("Command '"+s+"' doesn't exist, check typing");}var p;if(n.findClass){p=n.findClass(o,s);}else{p=n.clazz;}jQuery.sap.require(p);var q=jQuery.sap.getObject(p);var r=k(o);S=jQuery.extend(S,{element:r,name:s});var A;if(n.getAction){A=n.getAction(S,D);}if(A&&A.changeOnRelevantContainer){S=jQuery.extend(S,{element:D.getRelevantContainer(r)});o=S.element;}var t=new q(S);var u=true;if(n.configure){u=n.configure(o,t,S,D);}if(u){t.prepareActionData();return t;}else{t.destroy();}};return l;},true);
