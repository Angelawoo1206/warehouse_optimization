sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/View","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/testableHelper"],function(q,V,J,R,T,a,A,C,b,c,d,e,t){"use strict";var f;var m={};var g={};var r;function h(){r=r||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return r.getText.apply(r,arguments);}function i(o){var I=o.getId();var n=m[I];return n;}function j(o){return i(o.getAppComponent()).oTemplateContract.componentRegistry[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var n=v&&v.getController();var p=n&&n.getOwnerComponent();if(p instanceof a){var s=j(p);return s;}else{o=p&&p.oContainer;}}}function k(n,s,o,p,u){o=o||{};o.constructor=function(){T.prototype.constructor.apply(this,arguments);var M=n(p,this);this._templateEventHandlers=Object.freeze(M.handlers||{});this._templateFormatters=Object.freeze(M.formatters||{});this.extensionAPI=Object.freeze(M.extensionAPI||{});this.fnGenericOnInit=function(v){var w=v.getView();var I=w.getId();q.sap.log.info("Init view "+I+" of template "+s);var x=v.getOwnerComponent();var y=j(x);g[I]={onExit:M.onExit||q.noop,oTemplateUtils:p,oAppRegistryEntry:u};p.oServices.oApplicationController.registerView(w);p.oCommonUtils=new b(v,p.oServices,p.oComponentUtils);p.oServices.oCRUDManager=new C(v,p.oComponentUtils,p.oServices,p.oCommonUtils,u.oTemplateContract.oBusyHelper);p.oCommonEventHandlers=new d(v,p.oComponentUtils,p.oServices,p.oCommonUtils);w.addStyleClass(p.oCommonUtils.getContentDensityClass());(M.onInit||q.noop)();y.oController=this;y.fnViewRegisteredResolve();delete y.fnViewRegisteredResolve;};};o.onInit=function(){this.fnGenericOnInit(this);delete this.fnGenericOnInit;};o.onExit=function(){var v=this.getView().getId();var w=g[v];w.oAppRegistryEntry.oTemplateContract.oApplicationProxy.destroyView(v);w.onExit();delete g[v];q.sap.log.info("View "+v+" of template "+s+" exited");};return T.extend(s,o);}function l(o){var n=o.methods.oControllerSpecification;return n&&function(){var p=o.oComponent.getAppComponent();var s=i(p);var u=p.getTransactionController();var v={oComponentUtils:o.utils,oServices:{oTemplateCapabilities:{},oApplicationController:p.getApplicationController(),oTransactionController:u,oNavigationController:p.getNavigationController(),oDraftController:u.getDraftController(),oApplication:s.application,oViewDependencyHelper:s.oViewDependencyHelper}};return k(n.getMethods,o.oComponent.getTemplateName(),n.oControllerDefinition,v,s);};}return{getTemplateComponent:function(n,s,o){o=o||{};o.init=function(){var p=this.getComponentData().registryEntry;var v=new Promise(function(u){p.fnViewRegisteredResolve=u;});(a.prototype.init||q.noop).apply(this,arguments);p.componentName=s;p.oComponent=this;p.activationTakt=0;p.utils=new c(this,p);p.methods=n(this,p.utils)||{};p.viewRegisterd=v;p.oGenericData={mRefreshInfos:{}};(p.methods.init||q.noop)();};o.exit=function(){var I=this.getId();var p=j(this);var u=i(this.getAppComponent());var M=p.methods;(M.exit||q.noop)();delete u.oTemplateContract.componentRegistry[I];(a.prototype.exit||q.noop).apply(this,arguments);};o.onBeforeRendering=function(){var p=j(this);(a.prototype.onBeforeRendering||q.noop).bind(this,p).apply(this,arguments);var M=p.methods;(M.onBeforeRendering||q.noop)();};o.onActivate=function(B,I){var p=j(this);p.sCurrentBindingPath=B;var u=function(){p.utils.bindComponent(p.sCurrentBindingPath,I);var U=this.getIsRefreshRequired();if(U||!q.isEmptyObject(p.oGenericData.mRefreshInfos)){(p.methods.refreshBinding||q.noop)(U,U?{}:p.oGenericData.mRefreshInfos);this.setIsRefreshRequired(false);p.oGenericData.mRefreshInfos={};}return(p.methods.onActivate||q.noop)(B);}.bind(this);return p.fnViewRegisteredResolve?p.viewRegisterd.then(u):(u()||Promise.resolve());};o.setContainer=function(){a.prototype.setContainer.apply(this,arguments);var I=this.getId();var p=this.getAppComponent();var u=i(p);if(!u.oTemplateContract.componentRegistry[I]){var v=this.getComponentData().registryEntry;v.componentCreateResolve(this);delete v.componentCreateResolve;u.oTemplateContract.componentRegistry[I]=v;u.oTemplateContract.oBusyHelper.setBusy(v.viewRegisterd,true);v.oApplication=u.application;v.createViewController=l(v);(v.methods.setContainer||q.noop)();}};o.onDeactivate=q.noop;return a.extend(s,o);},getAppComponent:function(n,o,s,p){p=p||{};p.constructor=function(){var u=t.startApp();var v={appId:u,appComponent:this,oTemplateContract:{componentRegistry:{},getText:h,mRouteToTemplateComponentPromise:{},oTemplatePrivateGlobalModel:new J(),aStateChangers:[]}};v.oTemplateContract.oTemplatePrivateGlobalModel.setDefaultBindingMode("TwoWay");v.application=new A(v.oTemplateContract);v.methods=n(this,v.oTemplateContract);v.oViewDependencyHelper=new e(v.oTemplateContract);var P=q.extend({},v.methods.publicMethods);delete P.init;delete P.exit;q.extend(this,P);var S=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");var w=S&&S.createInstance();v.oTemplateContract.oNoOwnTitlePromise=w?w.then(function(x){v.oTemplateContract.oShellService=x;return x.getUxdVersion()===2;}):Promise.resolve(false);f=v.methods.init||q.noop;(o.prototype.constructor||q.noop).apply(this,arguments);v.oTemplateContract.oBusyHelper.setBusy(v.oTemplateContract.oNoOwnTitlePromise);m[this.getId()]=v;};p.init=function(){(o.prototype.init||q.noop).apply(this,arguments);f();f=null;};p.exit=function(){var u=i(this);(u.methods.exit||q.noop)();(o.prototype.exit||q.noop).apply(this,arguments);delete m[this.getId()];t.endApp(u.appId);};return o.extend(s,p);},getExtensionAPIPromise:function(o){var n=G(o);if(!n){return Promise.reject();}return n.viewRegisterd.then(function(){return n.oController.extensionAPI;});},getExtensionAPI:function(o){var n=G(o);return n&&n.oController&&n.oController.extensionAPI;}};});
