sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/m/ObjectIdentifier","sap/m/Table","sap/m/Text","sap/ui/comp/smartfield/SmartField","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/base/EventProvider","sap/suite/ui/generic/template/AnalyticalListPage/extensionAPI/ExtensionAPI","sap/ui/core/ResizeHandler","sap/suite/ui/generic/template/AnalyticalListPage/controller/SmartChartController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DetailController","sap/suite/ui/generic/template/AnalyticalListPage/controller/FilterBarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/ToolbarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController","sap/suite/ui/generic/template/AnalyticalListPage/control/KpiTag","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterBarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/suite/ui/generic/template/lib/MessageUtils","sap/m/MessageBox","sap/ui/table/Table","sap/ui/table/AnalyticalTable"],function(q,B,J,O,T,a,S,b,E,c,R,d,D,F,e,K,f,V,g,M,h,U,A){"use strict";var j="sap.suite.ui.generic.template.customData",k="sap.suite.ui.generic.template.genericData",C="Chart",l="compact";function n(o){if(o){for(var p in o){o[p]=null;}}}return{getMethods:function(t,o){var m=new E();var s;var p={attachSearchButtonPressed:function(i,L,N){return m.attachEvent("SearchButtonPressed",i,L,N);},detachSearchButtonPressed:function(i,L){return m.detachEvent("SearchButtonPressed",i,L);},fireSearchButtonPressed:function(i){return m.fireEvent("SearchButtonPressed",i);}};function r(){var i={};i[j]={};i[k]={};var L=o.byId("editStateFilter");if(L){i[k].editStateFilter=L.getSelectedKey();}o.getCustomAppStateDataExtension(i[j]);return i;}function u(){var L=new b(p.oSmartFilterbar.getDataSuiteFormat());var N=o.getVisibleSelectionsWithDefaults();for(var i=0;i<N.length;i++){if(!L.getValue(N[i])){L.addSelectOption(N[i],"I","EQ","");}}return{selectionVariant:L.toJSONString(),tableVariantId:p.oSmartTable.getCurrentVariantId(),customData:r()};}function v(i){i=i||u();try{t.oCommonUtils.getNavigationHandler().storeInnerAppState(i);}catch(L){q.sap.log.error("AnalyticalListPage.fnStoreCurrentAppStateAndAdjustURL: "+L);}}function w(){var i=o.getOwnerComponent();var L=i.getModel("_templPriv");L.setProperty("/listReport/isLeaf",i.getIsLeaf());}function x(){var i=q.sap.getObject("sap.ushell.Container.getUser");var L=o.getOwnerComponent().getAppComponent().getMetadata().getManifestEntry("sap.ui");var N=(L&&L.icons&&L.icons.icon)||"";var Q={bookmarkIcon:N,bookmarkCustomUrl:function(){v();return hasher.getHash()?("#"+hasher.getHash()):window.location.href;},bookmarkServiceUrl:function(){var X=p.oSmartTable.getTable();var Y=X.getBinding("rows")||X.getBinding("items");return Y?Y.getDownloadUrl()+"&$top=0&$inlinecount=allpages":"";},isShareInJamActive:!!i&&i().isJamActive()};var W=o.getOwnerComponent().getModel("_templPriv");W.setProperty("/listReport/share",Q);}function y(i){if(i&&i.editStateFilter!==undefined){var L=o.byId("editStateFilter");if(L){L.setSelectedKey((i.editStateFilter===null)?0:i.editStateFilter);}}}function z(i){o.restoreCustomAppStateDataExtension(i||{});}function G(i){i=i||{};if(i.hasOwnProperty(j)&&i.hasOwnProperty(k)){y(i[k]);z(i[j]);}else{if(i._editStateFilter!==undefined){y({editStateFilter:i._editStateFilter});delete i._editStateFilter;}z(i);}}var P;function H(i){o.onInitSmartFilterBarExtension(i);P=t.oCommonUtils.getNavigationHandler().parseNavigation();}function I(){P.done(function(L,N,Q){if(Q!==sap.ui.generic.app.navigation.service.NavType.initial){var W=L&&L.bNavSelVarHasDefaultsOnly;var X=new b(L.selectionVariant);var Y=X.getParameterNames().concat(X.getSelectOptionsPropertyNames());for(var i=0;i<Y.length;i++){p.oSmartFilterbar.addFieldToAdvancedArea(Y[i]);}if(!W||p.oSmartFilterbar.getCurrentVariantId()===""){p.oSmartFilterbar.clearVariantSelection();p.oSmartFilterbar.clear();p.oSmartFilterbar.setDataSuiteFormat(L.selectionVariant,true);}if(L.tableVariantId){p.oSmartTable.setCurrentVariantId(L.tableVariantId);}G(L.customData);if(!W||p.oSmartFilterbar.getMode()==="visual"){p.oSmartFilterbar.search();}}else if(p.oSmartFilterbar.getMode()==="visual"){p.oSmartFilterbar.search();}});P.fail(function(i){if(i instanceof Error){i.showMessageBox();}});}return{onInit:function(){var i=o.getOwnerComponent();p.hideVisualFilter=i.getHideVisualFilter();p.hideVisualFilter=(p.hideVisualFilter===undefined||p.hideVisualFilter!==true)?false:true;p.oSmartFilterbar=o.byId("analyticalListPageFilter");p.oSmartTable=o.byId("table");p.oPage=o.byId("page");p.oSmartChart=o.byId("chart");p.oContentContainer=o.byId("alr_contentContainer");p.alr_dshContainer=o.byId("alr_dshContainer");p.alr_chartContainer=o.byId("alr_chartContainer");p.alr_detailContainer=o.byId("alr_detailContainer");p.alr_compactFilterContainer=o.byId("alr_compactFilterContainer");p.alr_visualFilterContainer=o.byId("alr_visualFilterContainer");p.alr_dshToolbar=o.byId("alr_dshToolbar");p.alr_visualFilterToolbar=o.byId("alr_visualFilterToolbar");p.alr_visualFilterBar=o.byId("alr_visualFilterBar");p.alr_visualFilterFiltersBtn=o.byId("alr_visualFilterFiltersButton1");p.alr_filterContainer=o.byId("alr_filterContainer");p.alr_pageFooterBar=o.byId("alr_pageFooterBar");p.alr_pageVariant=i.getProperty('smartVariantManagement')||i.getProperty('smartVariantManagement')===undefined?o.byId("alrPageVariant"):null;p.oKpiTagContainer=o.byId("alrKpiTagContainer");p.chartController=new d();p.detailController=new D();p.toolbarController=new e();p.oController=o;p.fiterBarController=new F();p.fiterBarController.init(p);p.toolbarController.setState(p);p.chartController.setState(p);p.detailController.setState(p);p.detailController.setDetailViewController(o);K.init(p);if(!p.hideVisualFilter){p.visualFilterBarContainer=new V();p.visualFilterBarContainer.init(p);p.visualFilterDialogContainer=new g();p.visualFilterDialogContainer.init(p);}w();x();p.oTitle.attachEvent("_titlePress",function(){if(!p.oPage.getHeaderExpanded()){p.alr_visualFilterToolbar.addContent(p.filterSwitch);}else{if(p.oSmartFilterbar.getMode()===l){var $=p.oSmartFilterbar.retrieveFiltersWithValuesAsText();p.oController.byId("template::FilterText").setText($);}p.alr_visualFilterToolbar.removeContent(p.filterSwitch);}});o.byId("template::FilterText").attachBrowserEvent("click",function(){o.byId("page").setHeaderExpanded(true);p.alr_visualFilterToolbar.addContent(p.filterSwitch);});var L=i.getModel("_templPriv");L.setProperty("/listReport/isHeaderExpanded",true);i.getService("ShellUIService").then(function($){$.setTitle(t.oCommonUtils.getText("PAGEHEADER"));});s=t.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.ShareSheet",{shareEmailPressed:function(){v();sap.m.URLHelper.triggerEmail(null,t.oCommonUtils.getText("EMAIL_HEADER",[t.oCommonUtils.getText("PAGEHEADER")]),document.URL);},shareJamPressed:function(){v();var $=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,share:t.oCommonUtils.getText("PAGEHEADER")}}});$.open();}},"share",function($,_){var a1=sap.ui.getCore().getLibraryResourceBundle("sap.m");_.setProperty("/emailButtonText",a1.getText("SEMANTIC_CONTROL_SEND_EMAIL"));_.setProperty("/jamButtonText",a1.getText("SEMANTIC_CONTROL_SHARE_IN_JAM"));_.setProperty("/bookmarkButtonText",a1.getText("SEMANTIC_CONTROL_SAVE_AS_TILE"));var b1=q.sap.getObject("sap.ushell.Container.getUser");_.setProperty("/jamVisible",!!b1&&b1().isJamActive());});var N=p.oSmartTable.getTable();var Q="sapUiSizeCompact",W="sapUiSizeCondensed";if(N instanceof U||N instanceof A){var X=o.getView();var Y=q(document.body);if(Y.hasClass(Q)||X.hasStyleClass(Q)){var Z=i.getComponentContainer().getSettings().condensedTableLayout;if(Z===false){p.oSmartTable.addStyleClass(Q);}else{p.oSmartTable.addStyleClass(W);}}}},handlers:{onBack:function(){t.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){window.history.back();},q.noop,p);},addEntry:function(i){var L=i.getSource();t.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){t.oCommonEventHandlers.addEntry(L,false,p.oSmartFilterbar).then(function(){if(!L.data("CrossNavigation")){t.oComponentUtils.addDataForNextPage({isObjectRoot:true});}},q.noop);},q.noop,p);},deleteEntries:function(i){t.oCommonEventHandlers.deleteEntries(i);},onSelectionChange:function(L){var N=L.getSource(),Q=N.getModel(),W=N.getModel("_templPriv");var X=Q.getMetaModel(),Y=X.getODataEntitySet(this.getOwnerComponent().getEntitySet()),Z=Y["Org.OData.Capabilities.V1.DeleteRestrictions"];var $=(Z&&Z.Deletable&&Z.Deletable.Path)?Z.Deletable.Path:"";var _=false;var a1=true;var b1=($&&$!=="");var c1=t.oCommonUtils.getSelectedContexts(N);if(c1.length>0){for(var i=0;i<c1.length;i++){var d1=Q.getObject(c1[i].getPath());if(!(d1.IsActiveEntity&&d1.HasDraftEntity&&d1.DraftAdministrativeData&&d1.DraftAdministrativeData.InProcessByUser)){a1=false;}if(b1){if(Q.getProperty($,c1[i])){b1=false;}}if(!a1&&!b1){_=true;break;}}}W.setProperty("/listReport/deleteEnabled",_);},onChange:function(i){t.oCommonEventHandlers.onChange(i);},onSmartFieldUrlPressed:function(i){t.oCommonEventHandlers.onSmartFieldUrlPressed(i,p);},onContactDetails:function(i){t.oCommonEventHandlers.onContactDetails(i);},onSmartFilterBarInitialise:H,onSmartFilterBarInitialized:I,onEditStateFilterChanged:function(i){i.getSource().fireChange();},onFilterPress:function(i){p.fiterBarController.showDialog();},onClearPress:function(i){p.fiterBarController.clearFilters();o.onClearFilterExtension(i);},onSetHeaderState:function(i){p.oPage.setHeaderExpanded(!p.oPage.getHeaderExpanded());if(p.oPage.getHeaderExpanded()){i.getSource().setText(t.oCommonUtils.getText("VISUAL_FILTER_HIDE"));}else{i.getSource().setText(t.oCommonUtils.getText("VISUAL_FILTER_SHOW"));}},onVisualFilterToggle:function(i){p.alr_visualFilterBar.setVisible(!p.alr_visualFilterBar.getVisible());if(p.alr_visualFilterBar.getVisible()){i.getSource().setText(t.oCommonUtils.getText("VISUAL_FILTER_HIDE"));}else{i.getSource().setText(t.oCommonUtils.getText("VISUAL_FILTER_SHOW"));}setTimeout(function(){p.alr_visualFilterToolbar.toggleStyleClass("closed");},0);},onBeforeSFBVariantSave:function(){var i=u();p.oSmartFilterbar.setFilterData({_CUSTOM:i.customData});v(i);},onAfterSFBVariantLoad:function(){var i=p.oSmartFilterbar.getFilterData();if(i._CUSTOM!==undefined){G(i._CUSTOM);}else{var L=r();n(L[j]);n(L[k]);G(L);}v();},onBeforeRebindTable:function(i){t.oCommonEventHandlers.onBeforeRebindTable(i);o.onBeforeRebindTableExtension(i);},onBeforeRebindChart:function(i){},onShowDetails:function(i){t.oCommonEventHandlers.onShowDetails(i.getSource(),p);},onListNavigate:function(i){t.oCommonEventHandlers.onListNavigate(i.getSource(),p);},onCallActionFromToolBar:function(i){var L=t.oCommonUtils.getParentTable;t.oCommonUtils.getParentTable=function(){return p.oSmartTable;};t.oCommonEventHandlers.onCallActionFromToolBar(i,p);t.oCommonUtils.getParentTable=L;L=null;},onShowDetailsIntent:function(i){t.oCommonEventHandlers.onShowDetailsIntent(i,p.oSmartFilterbar);},onCallActionFromList:function(i){},onDataFieldForIntentBasedNavigation:function(i){t.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(i,p);},onBeforeSemanticObjectLinkPopoverOpens:function(i){var L=i.getParameters();t.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var N=t.oCommonUtils.getNavigationHandler();if(N){var Q=p.oSmartFilterbar.getDataSuiteFormat();N.processBeforeSmartLinkPopoverOpens(L,Q);}else{L.open();}},q.noop,p,q.noop);},onAssignedFiltersChanged:function(i){if(i&&i.getSource()){o.byId("template::FilterText").setText(i.getSource().retrieveFiltersWithValuesAsText());if(p&&p.fiterBarController){p.fiterBarController.updateFilterCount();}}},onAssignedVisualFiltersChanged:function(i){o.byId("template::FilterText").setText(i);},onToggleFiltersPressed:function(){var i=o.getOwnerComponent();var L=i.getModel("_templPriv");L.setProperty("/listReport/isHeaderExpanded",(L.getProperty("/listReport/isHeaderExpanded")===true)?false:true);},onSearchButtonPressed:function(){var i=o.getOwnerComponent().getModel();i.attachEventOnce("requestSent",function(){v();});var L=function(N){M.handleError("getCollection",this,t.oServices,N.getParameters());var Q=this.getView().byId("table");Q.getTable().setBusy(false);M.handleTransientMessages(t.oServices.oApplication.getDialogFragmentForView.bind(null,null));}.bind(this);i.attachEvent("requestFailed",L);i.attachEventOnce("requestCompleted",function(N){if(N.getParameter("success")){i.detachEvent("requestFailed",L);}});if(p._filterMode=='visual'){this._templateEventHandlers.onAssignedVisualFiltersChanged(p.alr_visualFilterBar.retrieveFiltersWithValuesAsText());}p.fireSearchButtonPressed();},onSemanticObjectLinkPopoverLinkPressed:function(i){v();t.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(i,p);},onAfterTableVariantSave:function(){v();},onAfterApplyTableVariant:function(){v();},onAfterChartVariantSave:function(){v();},onAfterApplyChartVariant:function(){v();},onShareListReportActionButtonPress:function(i){s.openBy(i.getSource());},onChartDeterminingDataFieldForAction:function(i){var L=t.oCommonUtils.getSelectedContexts(p.oSmartChart);var N=i.getSource();var Q=t.oCommonUtils.getElementCustomData(N);var W=this.getView().getBindingPath();t.oCommonUtils.triggerAction(L,W,Q);},onDeterminingDataFieldForAction:function(i){var L=p.oSmartTable.getTable();var N=t.oCommonUtils.getSelectedContexts(L);if(N.length===0){h.error(t.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:t.oCommonUtils.getContentDensityClass()});}else{var Q=i.getSource();var W=t.oCommonUtils.getElementCustomData(Q);var X=p.oSmartTable.getTableBindingPath();t.oCommonUtils.triggerAction(N,X,W,L);}},onDeterminingDataFieldForIntentBasedNavigation:function(i){var L=i.getSource();var N=t.oCommonUtils.getElementCustomData(L);var Q=p.oSmartTable.getTable();var W=t.oCommonUtils.getSelectedContexts(Q);if(N.Filter===C){W=t.oCommonUtils.getSelectedContexts(p.oSmartChart);}var X=!(N.RequiresContext&&N.RequiresContext==="false");if(X&&W.length===0){h.error(t.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:t.oCommonUtils.getContentDensityClass()});}else if(X&&W.length>1){h.error(t.oCommonUtils.getText("ST_GENERIC_MULTIPLE_ITEMS_SELECTED"),{styleClass:t.oCommonUtils.getContentDensityClass()});}else{var Y=X?W[0]:null;t.oCommonEventHandlers.onDataFieldForIntentBasedNavigationSelectedContext(Y,N,p);}}},extensionAPI:new c(t,o,p)};}};});
