sap.ui.define(["sap/m/SegmentedButtonItem","sap/m/Button","sap/m/ButtonType","sap/ui/base/EventProvider","../control/VariantSegmentedButton","sap/ui/core/mvc/Controller"],function(S,B,a,E,V,C){"use strict";var b="table",c="crosstab",d="chart",e="charttable",F="Filter";var f=new E();function _(o,i,s){var h=i.data(F);if(h&&s===e){i.setVisible(true);return true;}else{if(h&&(h).toLowerCase()===s){o.setVisible(true);i.setVisible(true);return true;}else if(h&&(h).toLowerCase()!==s){i.setVisible(false);return true;}}}function g(o,v){o.setVisible(false);if(v===b){var i=o.findElements(false);for(var n=0;n<i.length;n++){_(o,i[n],b);}}else if(v==c){o.setVisible(false);}else if(v==d){var i=o.findElements(false);for(var n=0;n<i.length;n++){_(o,i[n],d);}}else if(v==e){o.setVisible(true);var i=o.findElements(false);for(var n=0;n<i.length;n++){_(o,i[n],e);}}}var t=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.ToolbarController",{setState:function(s){var m=this;m.oState=s;m._uiCompRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var h=s.oController.getOwnerComponent().getDefaultContentView();if(!h)h=d;m.oState._pendingTableToolbarInit=true;m.oState._pendingChartToolbarInit=true;var o=this.oState.oController.getOwnerComponent();var i=o.getDsAppName();if(i){jQuery.sap.require("sap.suite.ui.generic.template.AnalyticalListPage.control.DshExt");m.initDSHPage();}m.setDefaultView(h);},switchContainerView:function(m){var h=this;h.oState._containerView=m;h.updateToolbarContent(m);if(m==b){if(h.oState.alr_dshContainer){h.oState.alr_dshContainer.setVisible(false);}h.oState.alr_chartContainer.setVisible(false);h.oState.alr_detailContainer.setVisible(true);}else if(m==c){h.oState.alr_chartContainer.setVisible(false);h.oState.alr_detailContainer.setVisible(false);if(h.oState.alr_dshContainer){h.oState.alr_dshContainer.setVisible(true);}}else if(m==d){if(h.oState.alr_dshContainer){h.oState.alr_dshContainer.setVisible(false);}h.oState.alr_detailContainer.setVisible(false);h.oState.alr_chartContainer.setVisible(true);if(!h.oState.oSmartChart._oChartViewMetadata){jQuery.sap.log.error("Missing Chart Annotation");}}else if(m==e){if(h.oState.alr_dshContainer){h.oState.alr_dshContainer.setVisible(false);}h.oState.alr_chartContainer.setVisible(true);h.oState.alr_detailContainer.setVisible(true);}g(h.oState.alr_pageFooterBar,m);h.fireContainerViewChange();},setDefaultView:function(m){var h=this;h.switchContainerView(m);if(m=="crosstab"){h.createDSHPage();}},attachContainerViewChange:function(D,h,l){return f.attachEvent("ContainerViewChange",D,h,l);},detachContainerViewChange:function(h,l){return f.detachEvent("ContainerViewChange",h,l);},fireContainerViewChange:function(A){return f.fireEvent("ContainerViewChange",A);},updateToolbarContent:function(){var m=this;var v=m.oState._containerView;if(!m.oState.alr_viewSwitchButton){m.oState.alr_viewSwitchButton=m.createViewSwitchButton();}if(!m.oState.alr_fullScreenButton){m.oState.alr_fullScreenButton=m.createFullScreenToggleButton();}if(v==d){if(m.oState._lastContentView!=e){if(m.oState._lastContentViewToolbar){m.oState._lastContentViewToolbar.removeContent(m.oState.alr_viewSwitchButton);m.oState._lastContentViewToolbar.removeContent(m.oState.alr_fullScreenButton);}if(!m.oState._pendingChartToolbarInit){m.oState.oSmartChart.getToolbar().addContent(m.oState.alr_fullScreenButton);m.oState.oSmartChart.getToolbar().addContent(m.oState.alr_viewSwitchButton);}}m.oState._lastContentViewToolbar=m.oState.oSmartChart.getToolbar();}else if(v==b){if(m.oState._lastContentViewToolbar){m.oState._lastContentViewToolbar.removeContent(m.oState.alr_viewSwitchButton);m.oState._lastContentViewToolbar.removeContent(m.oState.alr_fullScreenButton);}if(!m.oState._pendingTableToolbarInit){m.oState.oSmartTable._oToolbar.addContent(m.oState.alr_fullScreenButton);m.oState.oSmartTable._oToolbar.addContent(m.oState.alr_viewSwitchButton);}m.oState._lastContentViewToolbar=m.oState.oSmartTable.getCustomToolbar();}else if(v==e){if(m.oState._lastContentView!=d){if(m.oState._lastContentViewToolbar){m.oState._lastContentViewToolbar.removeContent(m.oState.alr_viewSwitchButton);m.oState._lastContentViewToolbar.removeContent(m.oState.alr_fullScreenButton);}if(!m.oState._pendingChartToolbarInit){m.oState.oSmartChart.getToolbar().addContent(m.oState.alr_fullScreenButton);m.oState.oSmartChart.getToolbar().addContent(m.oState.alr_viewSwitchButton);}}m.oState._lastContentViewToolbar=m.oState.oSmartChart.getToolbar();}else if(v==c){if(m.oState._lastContentViewToolbar){m.oState._lastContentViewToolbar.removeContent(m.oState.alr_fullScreenButton);m.oState._lastContentViewToolbar.removeContent(m.oState.alr_viewSwitchButton);}m.oState.alr_dshToolbar.addContent(m.oState.alr_fullScreenButton);m.oState.alr_dshToolbar.addContent(m.oState.alr_viewSwitchButton);m.oState._lastContentViewToolbar=m.oState.alr_dshToolbar;}m.oState._lastContentView=v;},_addComponentInstanceToUI:function(o){var m=this;var M=m.oState.alr_detailContainer;sap.ui.core.ResizeHandler.register(M,function(){h.setHeight(M.getDomRef().clientHeight+"px");});M.removeAllItems();if(o.getRouter()&&!o.getRouter()._bIsInitialized){o.getRouter().initialize();}var h=new sap.ui.core.ComponentContainer({component:o});if(M.getDomRef()){h.setHeight(M.getDomRef().clientHeight+"px");}M.addItem(h);},createViewSwitchButton:function(){var o=this.oState.oController.getOwnerComponent();var h=o.getDsAppName();var i=[new sap.m.SegmentedButtonItem({tooltip:"{i18n>CONTAINER_VIEW_CHARTTABLE}",key:e,icon:"sap-icon://chart-table-view"}),new sap.m.SegmentedButtonItem({tooltip:"{i18n>CONTAINER_VIEW_CHART}",key:d,icon:"sap-icon://vertical-bar-chart-2"}),new sap.m.SegmentedButtonItem({tooltip:"{i18n>CONTAINER_VIEW_CROSSTAB}",key:c,icon:"sap-icon://table-chart"}),new sap.m.SegmentedButtonItem({tooltip:"{i18n>CONTAINER_VIEW_TABLE}",key:b,icon:"sap-icon://table-view"})];if(!h){i.splice(2,1);}var m=this;var s=new V("alr_contentSegmentedBtn",{persistencyKey:"alr_viewmode_segmentedButton",smartVariant:m.oState.alr_pageVariant,select:jQuery.proxy(m.onToolbarSegBtnPressed,m),layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),items:i,selectedKey:m.oState._containerView});return s;},onToolbarSegBtnPressed:function(h,i,k){var m=this;if(!k&&h){k=h.getParameter("key");}if(k){m.switchContainerView(k);if(k==c){m.createDSHPage();}}},createFullScreenToggleButton:function(){return new sap.m.ToggleButton({icon:"sap-icon://full-screen",visible:true,pressed:false,press:function(){this.onFullScreenToggle(!this.bFullScreen);}.bind(this)});},onFullScreenToggle:function(v,h){var m=this;if(!m.oState.alr_fullScreenButton||(v===m.bFullScreen&&!h)){return;}m.bFullScreen=v;if(!m._oFullScreenUtil){m._oFullScreenUtil=sap.ui.requireSync("sap/ui/comp/util/FullScreenUtil");}m._oFullScreenUtil.toggleFullScreen(m.oState.oContentContainer,m.bFullScreen);if(m.oState._containerView==c){m.oState.oController.oDsh.refreshCrosstab(true,true);}m.oState.alr_fullScreenButton.setTooltip(m.bFullScreen?m._uiCompRb.getText("CHART_MINIMIZEBTN_TOOLTIP"):m._uiCompRb.getText("CHART_MAXIMIZEBTN_TOOLTIP"));m.oState.alr_fullScreenButton.setIcon(m.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");},initDSHPage:function(){var m=this;sap.zen.dsh.scriptLoaded=true;var u=false;var o=m.oState.oController.getOwnerComponent();var h=o.getDsAppName();var x=o.getDsQueryName();var i=m.oState.oController.getOwnerComponent().getAppComponent();var j=m.oState.oController.getOwnerComponent().getAppComponent().getMetadata().getConfig();var k=i.getComponentData();if(!k){k={startupParameters:{}};}var n={};if(j){if(j.appName){h=j.appName;}if(j.useHybridHandlers){u=true;}}if(k.startupParameters){if(k.startupParameters.appName){h=k.startupParameters.appName;}if(k.startupParameters.useHybridHandlers){u=true;}}var D=m.oState.oController.oDsh=new sap.suite.ui.generic.template.AnalyticalListPage.control.DshExt({height:"100%",width:"100%",deployment:"bw",useWebproxy:u,dshAppName:h,appComponent:i,deferCreation:true,smartVariant:m.oState.alr_pageVariant,persistencyKey:"alr_dsh_crosstab",client:"000"});D.setViewController(m.oState.oController,m.oState);D.addParameter("XQUERY",x);if(sap.ushell.Container){sap.ushell.Container.getService("CrossApplicationNavigation").getStartupAppState(m.oState.oController.getOwnerComponent().getAppComponent()).always(function(s){D.initializeAppState.call(D,s,n);if(j.navigationSourceObjects){D.addParameter("NAV_SOURCES",JSON.stringify(j.navigationSourceObjects));}});}var l=m.oState.oController.getView().byId("alr_InnerDshContainer");if(l){l.addItem(D);m.oState.oController.oDsh=D;m.oState.oController.oDshContainer=l;}},createDSHPage:function(){var m=this;var h=m.oState.oController.oDsh.getPage();if(!h){jQuery(m.oState.oController.oDsh.getDomRef()).css("height",m.oState.oController.oDsh.calculateDshContainerHeight());m.oState.oController.oDsh.createPage();m.oState.oController.oDsh.addCrosstabPersonalisationToToolbar(m.oState);if(!m.oState.oToolbarCrosstabGroup){m.oState.oToolbarCrosstabGroup=m.oState.oController.byId("alr_contentContainerToolbar_crosstabGroup");}var i=m.oState.alr_dshToolbar.indexOfContent(m.oState.alr_fullScreenButton);if(i>=0){m.oState.alr_dshToolbar.insertContent(m.oState.oController.oDsh._oDshPersonalisationButton,i);}}}});return t;});
