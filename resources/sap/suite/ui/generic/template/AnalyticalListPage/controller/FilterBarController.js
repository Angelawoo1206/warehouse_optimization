sap.ui.define(["sap/m/SegmentedButtonItem","sap/m/Button","sap/m/ButtonType","sap/m/Text","sap/m/Dialog","../control/VariantSegmentedButton","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/core/mvc/Controller"],function(S,B,a,T,D,V,b,C){"use strict";var F="visual",c="compact";var f=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.FilterBarController",{init:function(s){var m=this;if(s.oSmartFilterbar.getCurrentVariantId()){var _=s.oSmartFilterbar._oVariantManagement._oControlPersistence.getChange(s.oSmartFilterbar.getCurrentVariantId()).getContent();var d=_.alr_filter_segmentedButton.selectedKey;}else{var d=s.oController.getOwnerComponent().getDefaultFilterMode();}if(!d){d=F;}m.oState=s;if(d===F&&m.oState.hideVisualFilter){jQuery.sap.log.error("Visual filter is hidden defaulting to compact");d=c;}var e=m.oState.oController.getOwnerComponent().getShowGoButtonOnFilterBar()?true:false;s.oSmartFilterbar.setShowGoOnFB(e);if(!e){var g=function(){var i=function(j){if(j.getParameter("overlay"))j.getParameter("overlay").show=false;};s.oSmartTable.attachShowOverlay(i);s.oSmartChart.attachShowOverlay(i);s.oSmartFilterbar.search();setTimeout(function(){s.oSmartTable.detachShowOverlay(i);s.oSmartChart.detachShowOverlay(i);},0);};s.oSmartFilterbar.attachFilterChange(g);s.oSmartTable.setEnableAutoBinding(!e);}m.oState.oSmartFilterbar._oFiltersButton.setVisible(false);s.oHeader=s.oPage.getHeader();s.oTitle=s.oPage.getTitle();var h=function(){if(!this.oState.oPage.getHeaderExpanded())this.oState.alr_visualFilterToolbar.addContent(this.filterSwitch);else this.oState.alr_visualFilterToolbar.removeContent(this.filterSwitch);s.oTitle.detachEvent("_titlePress",h);};s.oTitle.attachEvent("_titlePress",h,this);if(s.oSmartFilterbar){s.oSmartFilterbar.addStyleClass("alrFilterbar");}m.transferFooterShareButton();if(s.oKpiTagContainer){s.alr_filterContainer.removeContent(s.oKpiTagContainer);s.oKpiTagContainer.addStyleClass("alrKpiTagContainer");}m.setDefaultFilter(d);},setDefaultFilter:function(m){this.handleFilterSwitch(m,true);},createFilterSwitch:function(){var m=this,d=[new S({icon:"sap-icon://filter-fields",width:"inherit",key:c,tooltip:"{i18n>FILTER_COMPACT}"})];if(!m.oState.hideVisualFilter){d.push(new S({icon:"sap-icon://filter-analytics",width:"inherit",key:F,tooltip:"{i18n>FILTER_VISUAL}"}));}var e=new V({width:"inherit",persistencyKey:"alr_filter_segmentedButton",smartVariant:this.oState.oController.byId("alrPageVariant"),selectedKey:m.oState._filterMode,items:d}).addStyleClass("alr_filterSwitchButton");e.attachSelect(function(g){if(g.getParameter('key')===c&&m.oState.oController.getOwnerComponent().getShowGoButtonOnFilterBar()){m.oState.oSmartFilterbar.setShowMessages(true);}else{m.oState.oSmartFilterbar.setShowMessages(false);}m.showFilterSwitchWarning(g);});return e;},_requireWarning:function(o){if(this.oState._filterMode!==F){for(var k in o){if(o[k].ranges!==undefined&&o[k].ranges.length>0){return true;}}}return false;},_handleEventSwitch:function(){this.handleFilterSwitch(this.oState.filterSwitch.getSelectedKey());this._oDialog.close();this._oDialog.destroy();this._oDialog=undefined;},_restoreSwitchButtonState:function(){this.oState.filterSwitch.setSelectedKey(this.oState._filterMode);this._oDialog.close();this._oDialog.destroy();this._oDialog=undefined;},showFilterSwitchWarning:function(e){var o=this.oState.oSmartFilterbar.getFilterData();var m=this;if(!this._requireWarning(o)||e.oSource._bApplyingVariant){this.handleFilterSwitch(e.getParameter("key"),undefined,true,e.oSource._bApplyingVariant);return;}var _=this.oState.oController.getView().getModel("i18n");if(!this._oDialog){this._oDialog=new D({title:_.getResourceBundle().getText("FILTER_SWITCH_WARNING_HEADER"),type:"Message",state:"Warning",content:new T({text:_.getResourceBundle().getText("FILTER_SWITCH_WARNING_MESSAGE")}),beginButton:new B({text:_.getResourceBundle().getText("YES"),press:[m._handleEventSwitch,m]}),endButton:new B({text:_.getResourceBundle().getText("NO"),press:[m._restoreSwitchButtonState,m]})}).addStyleClass("sapUiPopupWithPadding").addStyleClass("sapUiSizeCompact").addStyleClass("sapUiCompAddRemoveFilterDialog").setVerticalScrolling(true);this.oState.oController.getView().addDependent(this._oDialog);}this._oDialog.open();},handleFilterSwitch:function(m,s,d,A){var e=this,o;e.oState._filterMode=m;if(!e.oState.filterSwitch&&!e.oState.hideVisualFilter){e.oState.filterSwitch=e.createFilterSwitch();e.oState.alr_visualFilterToolbar.addContent(e.oState.filterSwitch);}if(e.oState._filterMode==F){e.oState.alr_compactFilterContainer.addStyleClass("sapUiHidden");e.oState.alr_visualFilterContainer.removeStyleClass("sapUiHidden");if(!s){o=this.oState.oSmartFilterbar.getFilterData();if(!A){this.oState.alr_visualFilterBar.mergeCompactFilters(o);}}}else if(e.oState._filterMode==c){if(!s){o=e.oState.alr_visualFilterBar.getFilterDataForCompactFilter();this.oState.oSmartFilterbar.setFilterData(o,true);}if(e.oState.oSmartFilterbar._oToolbar)e.oState.oSmartFilterbar._oToolbar.addStyleClass("sapUiHidden");if(!e.oState.hideVisualFilter){e.oState.alr_visualFilterContainer.addStyleClass("sapUiHidden");}e.oState.alr_compactFilterContainer.removeStyleClass("sapUiHidden");}e.oState.oSmartFilterbar.setMode(m,s||(d&&m===F));this.updateFilterCount();},showDialog:function(){var m=this;if(m.oState._filterMode==c)m.oState.oSmartFilterbar._showFilterDialog();else if(m.oState._filterMode==F)m.oState.visualFilterDialogContainer.launchDialog.call(m.oState.visualFilterDialogContainer);},clearFilters:function(){var m=this;if(m.oState._filterMode==c){var o=m.oState.oSmartFilterbar.getFilterData();for(var p in o){if(o.hasOwnProperty(p)){delete o[p];}}m.oState.oSmartFilterbar.setFilterData(o,true);}else if(m.oState._filterMode==F){m.oState.alr_visualFilterBar.clearFilters();}this.oState.chartController.updateTable();},transferFooterShareButton:function(){var m=this;if(m.oState.oPage._getSegmentedFooter){var d=m.oState.oPage._getSegmentedFooter();if(d&&d._oContainer){for(var i=0;i<d._oContainer.getContent().length;i++){var e=d._oContainer.getContent()[i];if(e instanceof sap.m.Button){m.footerShareBtn=d._oContainer.removeContent(e);m.footerShareBtn.setType(a.Transparent);}}}var s=m.oState.oPage._getSegmentedShareMenu();if(s&&s._oContainer&&s._oContainer._oActionSheet){s._oContainer._oActionSheet.setPlacement(sap.m.PlacementType.Bottom);}}},updateFilterCount:function(){var i=this.oState.oController.oView.getModel("i18n");if(!i)return;var r=i.getResourceBundle();var d=this.oState.oSmartFilterbar.getFilterCount();var e=d==0?r.getText("VISUAL_FILTER_FILTERS"):r.getText("VISUAL_FILTER_FILTERS_WITH_COUNT",[d]);this.oState.alr_visualFilterFiltersBtn.setText(e);}});return f;});
