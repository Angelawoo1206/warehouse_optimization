sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterBar","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/suite/ui/commons/HeaderCell","sap/suite/ui/commons/HeaderCellItem","sap/m/Label","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/smartfilterbar/FilterProvider","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Link","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil"],function(V,a,H,b,L,O,F,c,P,S,d,e,T,f,M,g){"use strict";var h=V.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{properties:{config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}}},renderer:{}});h.prototype.init=function(){if(V.prototype.init)V.prototype.init.apply(this,arguments);this.labelHeight=2.0;this.compHeight=7.9;this.cellHeightPadding=1;this.cellHeight=(this.labelHeight+this.compHeight+this.cellHeightPadding)+"rem";this.cellWidth=320;this._globalFilters={};this._dialogFilters={};this._compactFilters={};this._hiddenFilters={};};h.prototype.propagateProperties=function(){V.prototype.propagateProperties.apply(this,arguments);this._initMetadata();};h.prototype._initMetadata=function(){if(!this.bIsInitialised)O.handleModelInit(this,this._onMetadataInit);};h.prototype._onMetadataInit=function(){if(this.bIsInitialised)return;this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider)return;this.bIsInitialised=true;this._updateFilterBar();};h.prototype._createVisualFilterProvider=function(){var m=this.getModel();var i=this.getEntitySet();if(!m||!i)return null;return new c(this);};h.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE");};h.prototype._getFieldGroupForProperty=function(E,C){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(E,C):undefined;};h.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[];};h.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{};};h.prototype._getMeasureList=function(){return this._annoProvider?this._annoProvider.getMeasureList():[];};h.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{};};h.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{};};h.prototype._updateFilterBar=function(){var v=this._getVariantConfig();if(v&&v.config){if(v.hiddenFilters){this._hiddenFilters=v.hiddenFilters;}this.setConfig(v.config);return;}var i=this._getAnnotationSettings();if(i&&i.filterList){var j=this._convertSettingsToConfig(i);this.setConfig(j);return;}this.setConfig({filterCompList:[]});};h.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null;};h.prototype._convertSettingsToConfig=function(s){var k={filterCompList:[]};var l=this._getGroupList();var m={};for(var i=0;i<l.length;i++){var n=l[i];for(var j=0;j<n.fieldList.length;j++){var o=n.fieldList[j];m[o.name]={name:n.name,label:n.label};}}var p=this._getGroupMap();var q=p["_BASIC"];var r=[];if(q&&q.fieldList){for(var i=0;i<q.fieldList.length;i++)r.push(q.fieldList[i].name);}var t=this._getMeasureMap();var u=s.filterList;for(var i=0;i<u.length;i++){var v=u[i];var w=v.dimension.field;var x=t[v.collectionPath][v.measure.field];k.filterCompList.push({shownInFilterBar:v.selected,shownInFilterDialog:v.selected||r.indexOf(w)!=-1,cellHeight:this.cellHeight,group:m[v.parentProperty],component:{type:v.type,cellHeight:this.compHeight+"rem",properties:{sortOrder:v.sortOrder,scaleFactor:v.scaleFactor,filterRestriction:v.filterRestriction,width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:v.collectionPath?v.collectionPath:this.getEntitySet(),dimensionField:w,dimensionFieldDisplay:v.dimension.fieldDisplay,dimensionFilter:v.dimensionFilter,measureField:v.measure.field,measureSortDescending:v.measure.descending===true||v.measure.descending=="true",unitField:x?x.fieldInfo.unit:"",outParameter:v.outParameter?v.outParameter:undefined,inParameters:v.inParameters?v.inParameters:undefined,parentProperty:v.parentProperty?v.parentProperty:undefined}}});}return k;};h.prototype._setVariantModified=function(){if(this._oVariantManagement)this._oVariantManagement.currentVariantSetModified(true);};h.prototype._onFilterChange=function(j){this._setVariantModified();var k=this.getItems();var l=[];for(var i=0;i<k.length;i++)l.push(k[i].getSouth().getContent());this._removeGlobalFilters(j.getParameter('removeGlobalFilter'),j.getParameter('removeGlobalFilterValue'),true);this._updateFilterItemList(l);this.fireFilterChange();};h.prototype._removeGlobalFilters=function(r,j,s){var p,n=[];if(r&&j){var p=this._globalFilters[r];delete this._globalFilters[r];for(var i=0;i<p.length;i++){if(p[i]!==j){n.push(p[i]);}}if(n.length>0){this._globalFilters[r]=n;}}if(!s){this.fireFilterChange();}};h.prototype._applyDialogFilters=function(i){this._setDialogFilters(i);this._globalFilters=this._dialogFilters;this._dialogFilters={};};h.prototype._setDialogFilters=function(k){this._dialogFilters={};for(var i=0;i<k.length;i++){var l=k[i];var m=l.getDimensionFilter();if(!m)m=[];var o=l.getOutParameter();if(o&&m.length>0){if(this._dialogFilters[o]===undefined){this._dialogFilters[o]=[];}for(var j=0;j<m.length;j++){if(this._dialogFilters[o].indexOf(m[j].dimValue)===-1){this._dialogFilters[o].push(m[j].dimValue);}}}}};h.prototype.groupHiddenFilters=function(m){var o=jQuery.extend(true,[],this._hiddenFilters);this._groupByFieldName=[];var j=new M(this.getModel());var k=j.getEntityTypeNameFromEntitySetName(this.getEntitySet());var l=this.getModel().getMetaModel();var n=l.getODataEntityType(k);this._allSelectionFields=n["com.sap.vocabularies.UI.v1.SelectionFields"];var E=n['com.sap.vocabularies.Common.v1.Label']?n['com.sap.vocabularies.Common.v1.Label'].String:n.name;var p;var q=function(w){return w.PropertyPath===r;};for(var r in o){for(var s in m){if(m[s].fieldName===r){p=m[s].label;break;}}for(var t in n.property){if(n.property[t].name===r){p=n.property[t]['com.sap.vocabularies.Common.v1.Label']?n.property[t]['com.sap.vocabularies.Common.v1.Label'].String:n.property[t].name;break;}}for(var i=0;i<o[r].length;i++){o[r][i].parentProperty=p;}var u=this._getFieldGroupForProperty(n,r);var v=this._allSelectionFields.filter(q);if(v.length>0){if(this._groupByFieldName['_BASIC']&&this._groupByFieldName['_BASIC'][r]){this._groupByFieldName['_BASIC'][r].push(o[r]);continue;}if(this._groupByFieldName['_BASIC']&&!this._groupByFieldName['_BASIC'][r]){this._groupByFieldName['_BASIC'][r]=[];this._groupByFieldName['_BASIC'][r].push(o[r]);continue;}this._groupByFieldName['_BASIC']=[];this._groupByFieldName['_BASIC'][r]=[];this._groupByFieldName['_BASIC'][r].push(o[r]);}else if(u){if(this._groupByFieldName[u]&&this._groupByFieldName[u][r]){this._groupByFieldName[u][r].push(o[r]);continue;}if(this._groupByFieldName[u]&&!this._groupByFieldName[u][r]){this._groupByFieldName[u][r]=[];this._groupByFieldName[u][r].push(o[r]);continue;}this._groupByFieldName[u]=[];this._groupByFieldName[u][r]=[];this._groupByFieldName[u][r].push(o[r]);}else{if(this._groupByFieldName[E]&&this._groupByFieldName[E][r]){this._groupByFieldName[E][r].push(o[r]);continue;}if(this._groupByFieldName[E]&&!this._groupByFieldName[E][r]){this._groupByFieldName[E][r]=[];this._groupByFieldName[E][r].push(o[r]);continue;}this._groupByFieldName[E]=[];this._groupByFieldName[E][r]=[];this._groupByFieldName[E][r].push(o[r]);}}};h.prototype._getGroupType=function(i){var m=new M(this.getModel());var j=m.getEntityTypeNameFromEntitySetName(this.getEntitySet());var k=this.getModel().getMetaModel();var l=k.getODataEntityType(j);for(var o in l){var s=null;if(o.indexOf("com.sap.vocabularies.UI.v1.FieldGroup")>-1){s=(l[o].Label&&l[o].Label.String)?l[o].Label.String:"";if(s===i){return 0;}}}return 1;};h.prototype._updateFilterItemListOnMerge=function(A){var k=[];for(var i=0;i<A.length;i++){var o=A[i].component.properties,s=o.outParameter,l=o.dimensionFilter;if(s){if(!this._globalFilters[s]&&l&&l.length>0){this._globalFilters[s]=[];for(var j=0;j<l.length;j++){if(this._globalFilters[s].indexOf(l[j].dimValue)===-1){this._globalFilters[s].push(l[j].dimValue);}}}}if(!l)l=[];k.push({dimensionField:o.dimensionField,inParameters:o.inParameters,parentProperty:o.parentProperty,filterList:l});}var I=this.getItems(),m=[];for(var i=0;i<I.length;i++){m.push(I[i].getSouth().getContent());}for(var i=0;i<m.length;i++){var n=m[i],p=n.getParentProperty(),E,q,D;for(var j=0;j<k.length;j++){D=k[j].filterList;if(p===k[j].parentProperty){E=j;break;}}if(E>=0){q=this._combineFilterLists(k,E);n.setProperty('dimensionFilter',D);n.setDimensionFilterExternal(q,true);}}this._updateSelectedIndicator();};h.prototype._updateFilterItemList=function(k){var l=[];for(var i=0;i<k.length;i++){var m=k[i];var n=m.getDimensionFilter(),o=m.getOutParameter();if(o){if(n&&n.length>0){if(!this._globalFilters[o]){this._globalFilters[o]=[];}for(var j=0;j<n.length;j++){if(this._globalFilters[o].indexOf(n[j].dimValue)===-1){this._globalFilters[o].push(n[j].dimValue);}}}}if(!n)n=[];l.push({dimensionField:m.getDimensionField(),inParameters:m.getInParameters(),parentProperty:m.getParentProperty(),filterList:n,filterItem:m});}for(var i=0;i<l.length;i++){var m=l[i].filterItem;var p=this._combineFilterLists(l,i);m.setDimensionFilterExternal(p);}this._updateSelectedIndicator();};h.prototype._combineFilterLists=function(l,m){var n={},o=(l.length>0&&l[m]&&l[m].inParameters)?l[m].inParameters:undefined,p=(l.length>0&&l[m]&&l[m].parentProperty)?l[m].parentProperty:undefined,q=[];if(m==-1){for(var i=0;i<l.length;i++){if(i==m)continue;var r=l[i],v=r.filterList;var s=r.dimensionField;if(!n[s])n[s]=[];if(v){for(var j=0;j<v.length;j++){n[s].push(v[j].dimValue);}}}}else{if(o){var q=[],t;for(var u=(o.length-1);u>-1;u--){var w=o[u].localDataProperty,x=o[u].valueListProperty;if(Object.keys(this._dialogFilters).length>0){t=this._dialogFilters;}else{t=this._globalFilters;}if(w!==p&&q.indexOf(w)===-1){if(t[w]!==undefined){if(n[x]===undefined){n[x]=t[w];q.push(w);}}var y=[];if(Object.keys(this._hiddenFilters).length>0&&this._hiddenFilters[w]){var z=this._hiddenFilters[w];if(!n[w]){for(var k=0;k<z.length;k++){y.push(z[k].dimValue);}n[w]=y;}}}}}}var A=new sap.ui.model.Filter({aFilters:[],and:true});for(var s in n){var v=n[s];v.sort();var B=null;for(var i=v.length-1;i>=0;i--){if(v[i]==B)v.splice(i,1);else B=v[i];}if(v.length==0)continue;var C=[];for(var i=0;i<v.length;i++){C.push(new d({path:s,operator:sap.ui.model.FilterOperator.EQ,value1:v[i]}));}A.aFilters.push(new sap.ui.model.Filter({aFilters:C,and:false}));}return A;};h.prototype._updateSelectedIndicator=function(){var j=this.getItems();var r=this.getModel("i18n").getResourceBundle();for(var i=0;i<j.length;i++){var k=j[i].getSouth().getContent();var l=k.getDimensionFilter();var m=l?l.length:0;var s=j[i].getNorth().getContent().getContent()[2];s.setVisible(m>0);s.setText(r.getText("VISUAL_FILTER_SELECTED_FILTERS",[m]));}};h.prototype._createTitleToolbar=function(p,i){var t=new L({text:{path:"i18n>VIS_FILTER_TITLE_MD",formatter:function(){return i.getTitle();}}});var s=new f({text:"",visible:false,press:function(k){a.launchAllFiltersPopup(s,i,k.getSource().getModel('i18n'));},layoutData:new sap.m.ToolbarLayoutData({shrinkable:false})});var j=new e({design:sap.m.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[t,new T(),s]});j.addStyleClass("alr_visualFilterTitleToolbar");return j;};h.prototype.getTitleByFilterItemConfig=function(i,u,s){var p=i.component.properties;var j=p.entitySet;var m=this.getModel();if(!m)return"";var k="/"+j+"/";var l=m.getData(k+p.measureField+"/#@sap:label");var n=m.getData(k+p.dimensionField+"/#@sap:label");if(!u)u="";if(!s)s="";var t="";var r=this.getModel("i18n").getResourceBundle();if(s&&u)t=r.getText("VIS_FILTER_TITLE_MD_UNIT_CURR",[l,n,s,u]);else if(u)t=r.getText("VIS_FILTER_TITLE_MD_UNIT",[l,n,u]);else if(s)t=r.getText("VIS_FILTER_TITLE_MD_UNIT",[l,n,s]);else t=r.getText("VIS_FILTER_TITLE_MD",[l,n]);return t;};h.prototype._onTitleChange=function(j){var s=j.getSource();var k=this.getItems();for(var i=0;i<k.length;i++){var l=k[i];var m=l.getSouth().getContent();if(m==s){var n=l.getNorth().getContent().getContent()[0];n.setText(m.getTitle());n.setTooltip(m.getTitle());break;}}};h.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemChartBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemChartDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemChartLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}];}return this._supportedFilterItemList;};h.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var j=this._getSupportedFilterItemList();for(var i=0;i<j.length;i++){var k=j[i];this._supportedFilterItemMap[k.type]=k;}}return this._supportedFilterItemMap;};h.prototype.setConfig=function(j){var l=this.getProperty("config");this.setProperty("config",j);this.removeAllItems();if(!j.filterCompList){jQuery.sap.log.warning("Expecting a filterCompList as part of the configuration");return;}var k=this._getDimensionMap();var m=[];for(var i=0;i<j.filterCompList.length;i++){var n=j.filterCompList[i];if(!n.shownInFilterBar)continue;var o=n.component;o.type=this._resolveChartType(o.type);var p=jQuery.extend({},o.properties);var q=k[p.entitySet][p.dimensionField];p.dimensionFieldIsDateTime=q?q.fieldInfo.type=="Edm.DateTime":false;var r=this._createFilterItemOfType(o.type,p);r.setModel(this.getModel());if(r.attachFilterChange)r.attachFilterChange(this._onFilterChange,this);if(r.attachTitleChange)r.attachTitleChange(this._onTitleChange,this);var t=this._createTitleToolbar(p,r);var s=new H({height:n.cellHeight,north:new b({height:this.labelHeight+"rem",content:t}),south:new b({height:o.cellHeight,content:r})});m.push(r);this.addItem(s);}this._updateFilterItemList(m);if(l)this.fireFilterChange();};h.prototype._resolveChartType=function(t){var i=this._getSupportedFilterItemMap();var j=i[t];if(!j){var k;for(k in i){j=i[k];break;}jQuery.sap.log.error("Could not resolve the filter component type: \""+t+"\", falling back to "+k);t=k;}return t;};h.prototype._createFilterItemOfType=function(t,p){var i=this._getSupportedFilterItemMap();var j=i[t];var k=j.className;jQuery.sap.require(k);var l=jQuery.sap.getObject(k);var m=new l(p);return m;};h.prototype.getConfig=function(){var j=this.getProperty("config"),o;if(!j)return{filterCompList:[]};var k=0;var l=this.getItems();for(var i=0;i<j.filterCompList.length;i++){var m=j.filterCompList[i];if(!m.shownInFilterBar)continue;var n=l[k];if(!n){jQuery.sap.log.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]};}k++;var p=n.getSouth().getContent();o=m.component.properties.outParameter;m.component.properties=p.getP13NConfig();m.component.properties.outParameter=o;}return j;};h.prototype.setSmartVariant=function(s){this.setAssociation("smartVariant",s);if(s){var p=new P({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});p.setControl(this);}this._oVariantManagement=this._getVariantManagementControl(s);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(p);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this);}else if(s){if(typeof s==="string")jQuery.sap.log.error("Variant with id="+s+" cannot be found");else if(s instanceof sap.ui.core.Control)jQuery.sap.log.error("Variant with id="+s.getId()+" cannot be found");}else{jQuery.sap.log.error("Missing SmartVariant");}};h.prototype._getVariantManagementControl=function(s){var o=null;if(s){o=typeof s=="string"?sap.ui.getCore().byId(s):s;if(o&&!(o instanceof S)){jQuery.sap.log.error("Control with the id="+s.getId?s.getId():s+" not of expected type");return null;}}return o;};h.prototype._variantInitialised=function(){if(!this._oCurrentVariant)this._oCurrentVariant="STANDARD";};h.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD")this._oCurrentVariant={config:this.getConfig(),hiddenFilters:this._hiddenFilters,compactFilters:this._compactFilters};};h.prototype.applyVariant=function(v,C){this._oCurrentVariant=v;if(this._oCurrentVariant=="STANDARD")this._oCurrentVariant=null;if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var i=this._getAnnotationSettings();if(i&&i.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(i);}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};h.prototype._getVariantConfig=function(){return this._oCurrentVariant;};h.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var i=this._getAnnotationSettings();if(i&&i.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(i),hiddenFilters:this._hiddenFilters,compactFilters:this._compactFilters};return this._oCurrentVariant;}else{return{config:null,hiddenFilters:this._hiddenFilters,compactFilters:this._compactFilters};}}return{config:this.getConfig(),hiddenFilters:this._hiddenFilters,compactFilters:this._compactFilters};};h.prototype.clearFilters=function(){var j=this.getProperty('config');for(var i=0;i<j.filterCompList.length;i++){var k=j.filterCompList[i];k.component.properties.dimensionFilter=[];}this.setConfig(j);this.fireFilterChange();};h.prototype.getFilterDataForCompactFilter=function(){var C=this.getConfig(),o,k=(C.filterCompList.length)?C.filterCompList:[];if(k.length){for(var i=0;i<k.length;i++){var l=k[i],p=l.component.properties,m=p.dimensionFilter,s=p.parentProperty,n=p.filterRestriction,u,q=false;if(!this._compactFilters[s]){if(n==='single-value'){this._compactFilters[s]="";}else{this._compactFilters[s]={};}}else{if(n!=='single-value'){this._compactFilters[s].items=[];u=this._compactFilters[s].value;}else{this._compactFilters[s]="";}}if(m&&m.length){if(n!=='single-value'&&!this._compactFilters[s].items){this._compactFilters[s].items=[];}for(var j=0;j<m.length;j++){var r=m[j],K=r.dimValue,t=g.createTitle(r.dimValueDisplay,r.dimValue);if(n==='single-value'){this._compactFilters[s]=K;}else{if(u===t){q=true;}else{this._compactFilters[s].items.push({key:K,text:t});}}}}if(n!=='single-value'&&!q){this._compactFilters[s].value=null;}}}o=jQuery.extend(true,{},this._compactFilters);this._compactFilters={};this._hiddenFilters={};return o;};h.prototype.mergeCompactFilters=function(j){this._compactFilters={};this._hiddenFilters={};this._globalFilters={};if(!j){return;}this._compactFilters=j;var C=Object.keys(this._compactFilters),A,D={},p=[];var o=this.getConfig();if(o&&o.filterCompList.length>0){A=o.filterCompList;for(var i=0;i<A.length;i++){var k=A[i].component.properties,s=k.outParameter,l=k.parentProperty,m=[];k.dimensionFilter=[];if(s){var m=[];if(this._compactFilters[s]){p.push(s);m=this._addToFiltersFromCompact(s);}}k.dimensionFilter=m;D[l]=m;}}this._createHiddenFilters(C,p);this._updateFilterItemListOnMerge(A);this.fireFilterChange();};h.prototype._createHiddenFilters=function(C,E){this._hiddenFilters={};if(!C||C.length===0){return;}for(var i=0;i<C.length;i++){var p=C[i],j=[];if(E.indexOf(p)===-1){if(p!=='_CUSTOM'){j=this._addToFiltersFromCompact(p);if(j.length>0){this._hiddenFilters[p]=j;}}}}};h.prototype._addToFiltersFromCompact=function(p){var i=[],k=this._compactFilters[p].items;if(k){for(var j=0;j<k.length;j++){i.push({dimValue:k[j].key,dimValueDisplay:k[j].text});}if(this._compactFilters[p].value){i.push({dimValue:this._compactFilters[p].value,dimValueDisplay:this._compactFilters[p].value});}}else if(this._compactFilters[p]&&(typeof this._compactFilters[p]!=='object')){i.push({dimValue:this._compactFilters[p],dimValueDisplay:this._compactFilters[p]});}return i;};h.prototype.retrieveFiltersWithValuesAsText=function(){var j,_=[],k=this.getFilters();var l=this.getModel('i18n');if(!l){return;}var r=this.getModel('i18n').getResourceBundle();if(!k||k.length===0){j=r.getText("FILTER_BAR_ASSIGNED_FILTERS_ZERO");}else{var m=this.getItems();for(var i=0;i<m.length;i++){var n=m[i].getSouth().getContent();var o=(n.getDimensionFilter()!==undefined&&n.getDimensionFilter().length!==0)?true:false;if(o){_.push(n.getTitle());}}if(this._hiddenFilters){for(var p in this._hiddenFilters){_.push(p);}}j=r.getText("FILTER_BAR_ASSIGNED_FILTERS",[_.length,_.join(", ")]);}return j;};h.prototype.getFilters=function(){var j=this.getConfig();if(!j&&!j.filterCompList)return[];var l=[];for(var i=0;i<j.filterCompList.length;i++){var m=j.filterCompList[i].component.properties;if(!m.dimensionFilter||m.dimensionFilter.length==0)continue;if(m.outParameter!==undefined){l.push({dimensionField:m.outParameter,filterList:m.dimensionFilter});}}var n=[];if(Object.keys(this._hiddenFilters).length>0){for(var o in this._hiddenFilters){if(o.indexOf('$Parameter')<0){var p=this._hiddenFilters[o];for(var k=0;k<p.length;k++){n.push(p[k]);}l.push({dimensionField:o,filterList:n});}}}var q=this._combineFilterLists(l,-1);return(q&&q.aFilters&&q.aFilters.length>0)?[q]:[];};h.prototype.getFilterData=function(){var k=this.getFilters();var m=new M(this.getModel());var l=m.getEntityTypeNameFromEntitySetName(this.getEntitySet());var n=this.getModel().getMetaModel();var o=n.getODataEntityType(l);if(k.length==0)return{};k=k[0];var p={};for(var i=0;i<k.aFilters.length;i++){var q=k.aFilters[i].aFilters;var r=[];var s=q[0];p[s.sPath]={ranges:r};var t=n.getODataProperty(o,s.sPath);var u=t.type=="Edm.DateTime";for(var j=0;j<q.length;j++){var s=q[j];var v=s.oValue1;if(u){v=new Date(s.oValue1);v=new Date(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate());r.push({exclude:false,keyField:s.sPath,operation:"EQ",value1:v});}else{r.push({exclude:false,keyField:s.sPath,operation:s.sOperator,value1:v});}}}return p;};h.prototype.getFilterCount=function(){var j=0,k,l=this.getConfig();if(!l&&!l.filterCompList)return j;for(var i=0;i<l.filterCompList.length;i++){var m=l.filterCompList[i].component.properties.dimensionFilter;j+=m&&m.length>0?1:0;}k=(Object.keys(this._hiddenFilters).length>0)?Object.keys(this._hiddenFilters).length:0;j+=k;return j;};return h;},true);
