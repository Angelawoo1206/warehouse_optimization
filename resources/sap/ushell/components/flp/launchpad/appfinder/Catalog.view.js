// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ui.core.IconPool");jQuery.sap.require("sap.ushell.ui.launchpad.Tile");jQuery.sap.require("sap.ushell.ui.launchpad.CatalogTileContainer");jQuery.sap.require("sap.ushell.ui.launchpad.Panel");jQuery.sap.require("sap.ui.core.HTML");jQuery.sap.require("sap.ushell.ui.appfinder.AppBox");jQuery.sap.require("sap.ushell.ui.launchpad.TileContainerUtils");jQuery.sap.require("sap.ushell.ui.launchpad.CatalogEntryContainer");jQuery.sap.require("sap.ushell.ui.launchpad.CatalogsContainer");jQuery.sap.require("sap.ushell.ui.appfinder.PinButton");sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.Catalog",{oController:null,createContent:function(c){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oController=c;function i(l){return((l!==null)&&(l==="1x2"||l==="2x2"))||false;}function a(v){return parseInt(v,10)||0;}function g(e,k,G,l,n,p){var q;if(l){var r=sap.ushell.resources.i18n,u=$.inArray(n,G);q=r.getText(u!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup",p);}else{q=G&&G.length?k:e;}return q;}var T=new sap.ushell.ui.appfinder.PinButton({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,k,G,l){if(G){var n=$.inArray(l,e);return n!==-1;}else{return!!k;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,k,G,l,n,p,q){return g(e,k,G,n,p,q);}},press:[c.onTilePinButtonClick,c]});var A=new sap.ushell.ui.appfinder.PinButton({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,k,G,l){if(G){var n=$.inArray(l,e);return n!==-1;}else{return!!k;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,k,G,l,n,p,q){return g(e,k,G,n,p,q);}},press:[c.onTilePinButtonClick,c]});this.oAppBoxesTemplate=new sap.ushell.ui.appfinder.AppBox({title:'{title}',icon:'{icon}',subtitle:'{subtitle}',url:'{url}',pinButton:A,press:[c.onAppBoxPressed,c]});A.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));A.addStyleClass("sapUshellPinButton");T.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));T.addStyleClass("sapUshellPinButton");this.oTileTemplate=new sap.ushell.ui.launchpad.Tile({tileViews:{path:"content",factory:function(I,e){return e.getObject();}},"long":{path:"size",formatter:i},index:{path:"id",formatter:a},tileCatalogId:"{id}",pinButton:T,press:[c.catalogTilePress,c],afterRendering:c.onTileAfterRendering});this.oCatalogSelect=new sap.m.List("catalogSelect",{visible:"{/catalogSelection}",name:"Browse",tooltip:"{i18n>catalogSelect_tooltip}",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new sap.m.StandardListItem({type:"Active",title:"{title}"})},showNoData:false,itemPress:[c._handleCatalogListItemPress,c]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var o=this.oCatalogSelect.onAfterRendering;this.oCatalogSelect.addEventDelegate({onsaptabnext:function(k){try{k.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(k){try{k.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(k){try{k.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);var l=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(l.getVisible()){l.focus();}else{sap.ushell.components.flp.ComponentKeysHandler.appFinderFocusMenuButtons(k);}}catch(e){}}});if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass('help-id-catalogCategorySelect');}this.setCategoryFilterSelection=function(S){var e=t.getCatalogSelect(),k=e.getItems(),l=t.oController.oSubHeaderModel.getProperty('/tag/tagMode'),n=t.oController.oSubHeaderModel.getProperty('/search/searchMode'),p=S;if(n||l){e.setSelectedItem();}else{k.forEach(function(L,q){if(L.getTitle()===p){e.setSelectedItem(L);}});}};this.oCatalogSelect.onAfterRendering=function(){var S=t.oController.categoryFilter||sap.ushell.resources.i18n.getText('all');t.setCategoryFilterSelection(S);if(o){o.apply(this,arguments);}setTimeout(function(){var e=jQuery("#catalog, #userMenu, #sapMenu").filter("[tabindex=0]");if(e.length){e.eq(0).focus();}else{jQuery("#catalog").focus();}},0);};var b=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(b){b.apply(this,arguments);}};var E=sap.ui.getCore().getEventBus();E.subscribe("launchpad","catalogContentLoaded",function(){this.splitApp.toMaster('catalogSelect','show');if(sap.ui.Device.system.phone){this.splitApp.toDetail(this._calculateDetailPageId());}},this);var d=new sap.ui.core.HTML("sapUshellCatalogAccessibilityTileText",{content:"<div style='height: 0px; width: 0px; overflow: hidden; float: left;'>"+sap.ushell.resources.i18n.getText("tile")+"</div>"});var C=new sap.ushell.ui.launchpad.CatalogEntryContainer({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new sap.m.MessagePage({visible:true,showHeader:false,text:sap.ushell.resources.i18n.getText('EasyAccessMenu_NoAppsToDisplayMessagePage_Text'),description:''});this.oCatalogsContainer=new sap.ushell.ui.launchpad.CatalogsContainer("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:C},busy:true});this.oCatalogsContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var k=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader"),l=jQuery(e.srcControl.getDomRef());if(k.getVisible()&&!k.getPressed()&&!l.hasClass("sapUshellPinButton")){e.preventDefault();var n=sap.ui.getCore().byId("appFinderSearch");n.focus();}},onsapskipback:function(e){var k=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(k.getVisible()&&!k.getPressed()){e.preventDefault();k.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId('catalogTilesDetailedPage');if(!this.getBusy()){e.setBusy(false);jQuery.sap.measure.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}jQuery("#catalogTilesDetailedPage-cont").scroll(function(){var p=sap.ui.getCore().byId('catalogTilesDetailedPage'),k=p.getScrollDelegate(),l=k.getScrollTop(),n=k.getMaxScrollTop();if(n-l<=30+t.oController.PagingManager.getTileHeight()){t.oController.allocateNextPage();}});};this.oCatalogEntrySearchContainer=new sap.ushell.ui.launchpad.CatalogEntryContainer({header:"{i18n>results_count}"});this.oCatalogEntrySearchContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsSearchContainer=new sap.ushell.ui.launchpad.CatalogsContainer("catalogSearchContainer",{catalogs:[this.oCatalogEntrySearchContainer]});this.wrapCatalogsContainerInDetailPage=function(e,I){var D=new sap.m.Page(I,{showHeader:false,showFooter:false,showNavButton:false,content:[new sap.ushell.ui.launchpad.Panel({translucent:true,content:e}).addStyleClass("sapUshellCatalogPage")]});return D},this.getCatalogContainer=function(){return this.oCatalogsContainer;};new sap.m.Page({showHeader:false,showFooter:false,showNavButton:false,content:[new sap.ushell.ui.launchpad.Panel({translucent:true,content:[d,this.getCatalogContainer()]}).addStyleClass("sapUshellCatalogPage")]});var f=this.wrapCatalogsContainerInDetailPage([d,this.getCatalogContainer()],'catalogTilesDetailedPage'),h=new sap.m.Page('catalogMessagePage',{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]}),j=this.wrapCatalogsContainerInDetailPage([this.oCatalogsSearchContainer],'catalogTilesSearchPage');var s=new sap.m.BusyIndicator('catalogSelectBusyIndicator',{size:"1rem"});this.splitApp=new sap.m.SplitApp('catalogViewMasterDetail',{masterPages:[s,this.oCatalogSelect],detailPages:[f,j,h]});document.toSearch=function(){this.splitApp.toDetail('catalogTilesSearchPage');}.bind(this);document.toDetail=function(){this.splitApp.toDetail('catalogTilesDetailedPage');}.bind(this);document.toMessage=function(){this.splitApp.toDetail('catalogMessagePage');}.bind(this);return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel('subHeaderModel');var S=s.getProperty('/search/searchMode');var t=s.getProperty('/tag/tagMode');var i;if(S||t){i=this.getController().bSearchResults?'catalogTilesSearchPage':'catalogMessagePage';}else{i="catalogTilesDetailedPage";}return i;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.Catalog";}});}());
