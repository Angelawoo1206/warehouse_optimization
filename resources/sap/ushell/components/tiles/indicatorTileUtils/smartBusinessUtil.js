jQuery.sap.declare("sap.ushell.components.tiles.indicatorTileUtils.smartBusinessUtil");sap=sap||{};sap.ushell=sap.ushell||{};sap.ushell.components=sap.ushell.components||{};sap.ushell.components.tiles.indicatorTileUtils=sap.ushell.components.tiles.indicatorTileUtils||{};sap.ushell.components.tiles.indicatorTileUtils.util=sap.ushell.components.tiles.indicatorTileUtils.util||{};sap.ushell.components.tiles.indicatorTileUtils.util=(function(g,$){"use strict";var f=function(){var o={};$.ajax({type:"GET",async:false,dataType:"json",url:"/sap/hba/apps/kpi/s/logic/__token.xsjs",headers:{"X-CSRF-Token":"Fetch"},success:function(d,s,x){o.userName=d.userName;o.token=x.getResponseHeader("X-CSRF-Token");},error:function(){$.sap.log.error("Error Fetching AUTH TOKEN");}});return o;};var a=function(s){var r=[];for(var i=0;i<s.length;i++){r.push(JSON.parse(s[i]));}return r;};var c={};var t={"ANN":"years","WEE":"weeks","DAY":"days","HUR":"hours","MIN":"minutes"};var b={};var h={};return{getScheduledJob:function(k){return b[k];},setScheduledJob:function(k,d){b[k]=d;},isCallInProgress:function(k){return h[k];},setUnsetCallInProgress:function(k,v){h[k]=v;},getTimeUnitMap:function(){return t;},getAuthToken:function(){return f().token;},getHanaUser:function(){return authObject.userName;},getEdmType:function(u,p){var d=null;if(u instanceof sap.ui.model.odata.ODataModel){d=u;}else{d=this.getODataModelByServiceUri(u);}if(d&&d.getServiceMetadata()){var s=d.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var k=e[i];var l=k.property;for(var j=0;j<l.length;j++){var m=l[j];if(m.name==p){return m.type;}}}}}return null;},getODataModelByServiceUri:function(s){s=this.addSystemToServiceUrl(s);if(!c[s]){var m=new sap.ui.model.odata.ODataModel(s,{loadMetadataAsync:true,json:true});c[s]=m;}return c[s];},addSystemToServiceUrl:function(u,s){jQuery.sap.log.info("Hana Adapter --> Add System to Service Url");if(sap.ushell&&sap.ushell.Container){if(s){u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u,s);}else{u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u);}}return u;},isCacheValid:function(d,e,i,j,k){var l=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(d);if(!l){return false;}else if(!(i&&Number(i))){return true;}else{var m=this.getMillisecond(i,t[j]);if(jQuery.type(l.CachedTime)=="date"){var n=l.CachedTime&&l.CachedTime.getTime();}else{var n=l.CachedTime&&parseInt(l.CachedTime.substr(6),10);}var o=this.getUTCDate();return(n>=e&&m>=(o-n)&&!k);}},getUTCDate:function(){var n=new Date();var u=new Date(n.getTime()+n.getTimezoneOffset()*60000);return n;},getMantissaLength:function(n){var N=n.toString();var i=0;if(n<0){i=1;}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length;},getLocaleFormattedValue:function(n,s,d,i,e){jQuery.sap.require("sap.ui.core.format.NumberFormat");i=i||false;e=e||null;if(i){return sap.ui.core.format.NumberFormat.getCurrencyInstance({style:"short",showMeasure:false}).format(n,e);}var D=2;var F={style:"short"};var N;if(!(d==-1||d==null)){F.shortDecimals=Number(d);F.minFractionDigits=Number(d);F.maxFractionDigits=Number(d);}var v=sap.ui.core.format.NumberFormat.getInstance(F);if(s==-2){if(n>9999){N="????";}else if(n<0.001){N="0";}else{if(n.toString().indexOf('.')!=-1){N=Number(n).toFixed(4-n.toString().indexOf('.'));}else{N=Number(n);}N=v.format(N);}}else if(d==-1||d==null){var m=this.getMantissaLength(n);if(!(m%3)){D=1;}if(m%3===1){D=3;}if(m%3===2){D=2;}if(Math.abs(n)%Math.pow(10,m-1)==0){D=0;}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){D=0;}v=sap.ui.core.format.NumberFormat.getInstance({style:"short",shortDecimals:D});N=v.format(n);}else{N=v.format(n);}return N;},getPlatform:function(p){return(jQuery.sap.getUriParameters().get("sb_metadata")||p||"HANA").toUpperCase();},getRunTimeUri:function(p){if(p.toUpperCase()=="HANA"){return"/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";}return"/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV";},getTileTitleSubtitle:function(C){var d={};if(C.bag&&C.bag.getBagIds()&&C.bag.getBagIds().length){d.title=C.bag.getBag("sb_tileProperties").getText("title")||C.bag.getBag("sb_tileProperties").getProperty("title")||C.preview.getTitle();d.subTitle=C.bag.getBag("sb_tileProperties").getText("description")||C.bag.getBag("sb_tileProperties").getProperty("description")||C.preview.getDescription();}else{d.title=C.preview.getTitle();d.subTitle=C.preview.getDescription();}return d;},scheduleFetchDataJob:function(i){var d;if(this.getView().getViewName().indexOf("DualTile")!==-1){d=this.oKpiTileView.oConfig;}else{d=this.oConfig;}var k=d.TILE_PROPERTIES.id+"data";var r=sap.ushell.components.tiles.indicatorTileUtils.util.getScheduledJob(k);if(r){clearTimeout(r);r=undefined;}var t=sap.ushell.components.tiles.indicatorTileUtils.util.getTimeUnitMap();var e=sap.ushell.components.tiles.indicatorTileUtils.util.getCachingTime(d);var j=sap.ushell.components.tiles.indicatorTileUtils.util.getCachingTimeUnit(d);var l=sap.ushell.components.tiles.indicatorTileUtils.util.getMillisecond(e,t[j]);if(jQuery.type(this.cacheTime)=="date"){var m=this.cacheTime;}else{var m=new Date(parseInt(this.cacheTime.substr(6),10));}var n=l-(sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate()-m);if(n<=0){n=0;}else if(n>2147483646){n=2147483646;}if(!i){n=300000;}if(this.getView().getViewName().indexOf("DualTile")!==-1){r=setTimeout(this.refreshPress.bind(this),n);}else{r=setTimeout(this.refreshHandler.bind(this,false,true),n);sap.ushell.components.tiles.indicatorTileUtils.util.setScheduledJob(k,r);}this.updateDatajobScheduled=true;},scheduleTimeStampJob:function(i){var k=this.oConfig.TILE_PROPERTIES.id+"time";var r=sap.ushell.components.tiles.indicatorTileUtils.util.getScheduledJob(k);if(r){clearTimeout(r);r=undefined;}if(jQuery.type(this.cacheTime)=="date"){var d=this.cacheTime;}else{var d=new Date(parseInt(this.cacheTime.substr(6),10),13);}var e=sap.ushell.components.tiles.indicatorTileUtils.util.getTimeDifference(sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate()-d);r=setTimeout(this.setTimeStamp.bind(this,this.cacheTime),e.timer);sap.ushell.components.tiles.indicatorTileUtils.util.setScheduledJob(k,r);this.updateTimeStampjobScheduled=true;},getBoolValue:function(v){var r=false;if(typeof v=="boolean"&&v){r=true;}return r;},getTimeDifference:function(d){var r={};if(d){var m=this.getMinutes(d);var e=this.getHours(d);var i=this.getDays(d);if(m<5){r.time=0;r.unit="minutes";r.timer=Math.round(this.getMillisecond(5-m,"minutes"));}else if(m>=5&&m<60){if(m<10){r.time=5;}else{r.time=(m-(m%10));}r.unit="minutes";r.timer=Math.round(this.getMillisecond(10-(m%10),"minutes"));}else if(e>=1&&e<24){r.unit="hours";r.time=(e-(e%1));r.timer=Math.round(this.getMillisecond(1-(e%1),"hours"));}else if(i>=1&&i<2){r.unit="days";r.time=(i-(i%1));r.timer=Math.round(this.getMillisecond(1-(i%1),"days"));}else{r.unit="days";r.time=(i-(i%1));r.timer=this.getMillisecond(2,"days");}}else{r.timer=6000;r.unit="days";r.timer=2000;}return r;},getMillisecond:function(d,u){var r;switch(u){case"seconds":r=d*1000;break;case"minutes":r=d*60*1000;break;case"hours":r=d*60*60*1000;break;case"days":r=d*24*60*60*1000;break;case"weeks":r=d*7*24*60*60*1000;break;case"months":r=d*4*7*24*60*60*1000;break;case"years":r=d*12*4*7*24*60*60*1000;break;}return r;},getSeconds:function(d){return(d/1000);},getMinutes:function(d){return(this.getSeconds(d)/60);},getHours:function(d){return(this.getMinutes(d)/60);},getDays:function(d){return(this.getHours(d)/24);},getWeeks:function(d){return(this.getDays(d)/7);},getMonths:function(d){return(this.getWeeks(d)/4);},getYears:function(d){return(this.getMonths(d)/12);},getCachingTime:function(C){return((C.CACHINGTIME&&Number(C.CACHINGTIME))||(C.TILE_PROPERTIES.cachingTime&&Number(C.TILE_PROPERTIES.cachingTime)));},getCachingTimeUnit:function(C){return(C.CACHINGUNIT||C.TILE_PROPERTIES.cachingTimeUnit);},getFrontendCacheQuery:function(d,u,p,T){var e;try{var i=T.url.addSystemToServiceUrl('/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV');e=this.getODataModelByServiceUri(i);var i="/CacheParameters(P_CacheType=1)/Results";return{oModel:e,uri:i};}catch(j){jQuery.sap.log.error("FrontEnd cache Metadata failed");return null;}},isDualTile:function(C){var d=C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.tileType;if(d.indexOf("DT-")==-1){return false;}return true;},writeFrontendCacheByChipAndUserId:function(T,d,e,u,i){try{var j=T.url.addSystemToServiceUrl("/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV/");var k=this.getODataModelByServiceUri(j);var l="/CacheData";k.create(l,e,{async:true,success:function(e){jQuery.sap.log.info("cache write successFully");i(e);},error:function(){jQuery.sap.log.error("cache update failed");i(null);}});}catch(m){jQuery.sap.log.error(m);}},getFrontendCache:function(C,T){var d=this;var e=sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED||jQuery.Deferred();var i=C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.id;var j=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(i);if(j){sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.resolve(true);}else if(sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED){return sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.promise();}else{sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED=e;this.getKpiChipsOnPage(i,function(i,p){if(p){var k=d.getFrontendCacheQuery(p,sap.ushell.Container.getUser().getId(),p,T);if(k){var l=k.oModel;var m=k.uri;var n=false;var o=l.read(m,null,null,true,function(q){if(q&&q.results&&q.results instanceof Array&&q.results.length){jQuery.each(q.results,function(r,s){sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(s.ChipId,s);});}if(sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(i)){n=true;}sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.resolve(n);},function(q){if(q&&q.response){jQuery.sap.log.error(q.message+" : "+q.request.requestUri);}sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.reject();});}else{sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.reject();}}else{sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.resolve(false);}});}return sap.ushell.components.tiles.indicatorTileUtils.util.FRONTEND_CACHE_DEFERRED.promise();},getModelerRuntimeServiceModel:function(){return this.getODataModelByServiceUri("/sap/hba/apps/kpi/s/odata/smart_business_runtime_services.xsodata");},getSapFontErrorCode:function(){return String.fromCharCode(0xe0b1);},getSapFontBusyCode:function(){return String.fromCharCode(0xe1f2);},prepareFilterStructure:function(d,e){var v=[];if(e){d=d.concat(e);}for(var i=0;i<d.length;i++){var p={};p.comparator=d[i].OPERATOR;p.filterPropertyName=d[i].NAME;if(d[i].ID){p.id=d[i].ID;}p.type=d[i].TYPE;p.value=d[i].VALUE_1;p.valueTo=d[i].VALUE_2;v.push(p);}return v;},getODataModelByServiceUriFromChipAPI:function(s,T){s=T.url.addSystemToServiceUrl(s);if(!c[s]){var m=new sap.ui.model.odata.ODataModel(s,true);c[s]=m;}return c[s];},getFilterFromRunTimeService:function(C,T,s,e){var p=C.TILE_PROPERTIES.sb_metadata;var K=this.getODataModelByServiceUriFromChipAPI(this.getRunTimeUri(p),T);var d="ID eq '#EVALUATIONID'".replace("#EVALUATIONID",C.EVALUATION.ID);var k=K.read("/EVALUATION_FILTERS",null,{"$filter":d},true,function(i){var j=[];if(i.results.length){j=i.results;}s.call(this,j);},e);return k;},findTextPropertyForDimension:function(u,d,i){try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var D=q.findDimensionByName(i);if(D.getTextProperty()){return D.getTextProperty().name;}else{return i;}}catch(e){$.sap.log.error("Error Fetching Text Property for "+i+" : "+e.toString());}},getEvalValueMeasureName:function(C,d,r){var e=C.EVALUATION_VALUES;for(var i=0;i<e.length;i++){if(e[i].TYPE==d){if(r==="FIXED"){return e[i].FIXED;}else{return e[i].COLUMN_NAME;}}}},getSemanticColorName:function(d){var s="";if(d=="Error"){s="sb.error";}if(d=="Neutral"){s="sb.neutral";}if(d=="Critical"){s="sb.critical";}if(d=="Good"){s="sb.good";}return s;},setTooltipInTile:function(C,d,v){var e="";var r=sap.ushell.components.tiles.utils.getResourceBundleModel().getResourceBundle();if(d=="NT"||d=="DT"){if(v.status){e+=r.getText("sb.status")+": "+r.getText(v.status)+"\n";}if(v.actual){e+=r.getText("sb.actual")+": "+v.actual+"\n";}if(v.target){e+=r.getText("sb.target")+": "+v.target+"\n";}if(v.cH){e+=r.getText("sb.ch")+": "+v.cH+"\n";}if(v.wH){e+=r.getText("sb.wh")+": "+v.wH+"\n";}if(v.wL){e+=r.getText("sb.wl")+": "+v.wL+"\n";}if(v.cL){e+=r.getText("sb.cl")+": "+v.cL+"\n";}}if(d=="CONT"||d=="COMP"){if(v.measure&&d=="CONT"){if(v&&v.contributionTile.contributionTile&&v.contributionTile.contributionTile[1]==="asc"){e+=r.getText("sb.bottomn")+": "+v.contributionTile[0]+"\n";}else if(v&&v.contributionTile.contributionTile&&v.contributionTile.contributionTile.length){e+=r.getText("sb.topn")+": "+v.contributionTile[0]+"\n";}}if(v.m1&&((v.v1==undefined||v.v1==null)?false:v.v1.toString())&&v.c1){e+=v.m1+": "+v.v1+" "+r.getText(v.c1)+"\n";}if(v.m2&&((v.v2==undefined||v.v2==null)?false:v.v2.toString())&&v.c2){e+=v.m2+": "+v.v2+" "+r.getText(v.c2)+"\n";}if(v.m3&&((v.v3==undefined||v.v3==null)?false:v.v3.toString())&&v.c3){e+=v.m3+": "+v.v3+" "+r.getText(v.c3)+"\n";}}C&&C.setTooltip&&C.setTooltip(e);},_getFormattedTileProperties:function(d){d=d||{};var p=["sb_metadata","sb_navigation","sb_catalog"];var e=false;for(var i=0;!e&&i<p.length;i++){e=e||jQuery.sap.getUriParameters().get(p[i])||d[p[i]];}d.sb_metadata=(jQuery.sap.getUriParameters().get("sb_metadata")||d.sb_metadata||"HANA").toLowerCase();d.sb_navigation=(jQuery.sap.getUriParameters().get("sb_navigation")||d.sb_navigation||"abap").toLowerCase();d.sb_catalog=(jQuery.sap.getUriParameters().get("sb_catalog")||d.sb_catalog||"HANA").toLowerCase();d.isPlatformInfoPresent=e;return d;},getParsedChip:function(C,i,d){try{var p={};var e=JSON.parse(C);var j=JSON.parse(e.TILE_PROPERTIES).evaluationId||"";if(e.TILE_PROPERTIES){var k=JSON.parse(e.TILE_PROPERTIES);if(k&&(k.instanceId||k.catalogId)){return false;}}var l=this;if(e.blankTile){p["BLANKTILE"]=e.blankTile;}if(e.cachingTime){p["CACHINGTIME"]=e.cachingTime;}if(e.cachingTimeUnit){p["CACHINGUNIT"]=e.cachingTimeUnit;}if(e.TAGS){p["TAGS"]=JSON.parse(e.TAGS);}if(e.ADDITIONAL_FILTERS){p["ADDITIONAL_FILTERS"]=JSON.parse(e.ADDITIONAL_FILTERS);}if(e.ADDITIONAL_APP_PARAMETERS){p["ADDITIONAL_APP_PARAMETERS"]=JSON.parse(e.ADDITIONAL_APP_PARAMETERS);}p.TILE_PROPERTIES=this._getFormattedTileProperties(JSON.parse(e.TILE_PROPERTIES));var P=p.TILE_PROPERTIES.sb_metadata;if(e.EVALUATION_FILTERS){p["EVALUATION_FILTERS"]=JSON.parse(e.EVALUATION_FILTERS);if(e.EVALUATION_VALUES){p["EVALUATION_VALUES"]=JSON.parse(e.EVALUATION_VALUES);if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{if(!i){l.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,j,function(n){p.EVALUATION=n;if(d){d(p);}else{return p;}});}else{if(d){d(p);}else{return p;}}}}else{if(!i){l.getEvaluationDetailsFromRunTimeService("/EVALUATION_VALUES",P,j,function(n){p["EVALUATION_VALUES"]=n;if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{l.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,j,function(n){p.EVALUATION=n;if(d){d(p);}else{return p;}});}});}else{if(d){d(p);}else{return p;}}}}else if(i){if(d){d(p);}else{return p;}}else{l.getEvaluationDetailsFromRunTimeService("/EVALUATION_FILTERS",P,j,function(n){p["EVALUATION_FILTERS"]=n;if(e.EVALUATION_VALUES){p["EVALUATION_VALUES"]=JSON.parse(e.EVALUATION_VALUES);if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{l.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,j,function(n){p.EVALUATION=n;if(d){d(p);}else{return p;}});}}else{l.getEvaluationDetailsFromRunTimeService("/EVALUATION_VALUES",P,j,function(n){p["EVALUATION_VALUES"]=n;if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{l.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,j,function(n){p.EVALUATION=n;if(d){d(p);}else{return p;}});}});}});}}catch(m){return false;}},getEvaluationDetailsFromRunTimeService:function(e,p,i,d){var K=this.getODataModelByServiceUri(this.getRunTimeUri(p));var j="ID eq '#EVALUATIONID'".replace("#EVALUATIONID",i);var k=K.read(e,null,{"$filter":j},true,function(l){var m=[];if(l.results.length){m=l.results;}d.call(this,m);});},getNavigationTarget:function(C,s){var d=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var o=d&&d("CrossApplicationNavigation");var e;var p={};p["evaluationId"]=C.EVALUATION.ID;p["chipId"]=C.TILE_PROPERTIES.id;if(s){p["sap-system"]=s;}p["tileType"]=C.TILE_PROPERTIES.tileType;if(C.TILE_PROPERTIES.dimension){p["dimension"]=C.TILE_PROPERTIES.dimension;}if(C.TILE_PROPERTIES.storyId){p["storyId"]=C.TILE_PROPERTIES.storyId;}if(C.TILE_PROPERTIES.apfConfId){p["sap-apf-configuration-id"]=C.TILE_PROPERTIES.apfConfId;}if(C.TILE_PROPERTIES.isPlatformInfoPresent){p["sb_metadata"]=C.TILE_PROPERTIES.sb_metadata;p["sb_navigation"]=C.TILE_PROPERTIES.sb_navigation;p["sb_catalog"]=C.TILE_PROPERTIES.sb_catalog;}if(C.ADDITIONAL_APP_PARAMETERS){for(e in C.ADDITIONAL_APP_PARAMETERS){if(C.ADDITIONAL_APP_PARAMETERS.hasOwnProperty(e)){if(C.ADDITIONAL_APP_PARAMETERS[e].constructor==Array){var k=C.ADDITIONAL_APP_PARAMETERS[e];for(var i=0;i<k.length;i++){p[e]=k[i];}}else{p[e]=C.ADDITIONAL_APP_PARAMETERS[e];}}}}var l=o&&o.hrefForExternal({target:{semanticObject:C.TILE_PROPERTIES.semanticObject,action:C.TILE_PROPERTIES.semanticAction},params:p})||"";if(C.ADDITIONAL_FILTERS){var m=C.ADDITIONAL_FILTERS;var n="&";for(var j=0;j<m.length;j++){if(m[j].OPERATOR==="EQ"){n=n+"/"+m[j].NAME+"="+m[j].VALUE_1;}}l+=n;}return l;},getChipTitle:function(C){var d="";if(C){var e=C.EVALUATION||{};d=e.INDICATOR_TITLE||"";}return d;},getstringifyTileConfig:function(C){var s={};s.EVALUATION=JSON.stringify(C.EVALUATION);s.EVALUATION_FILTERS=JSON.stringify(C.EVALUATION_FILTERS);s.EVALUATION_VALUES=JSON.stringify(C.EVALUATION_VALUES);s.TILE_PROPERTIES=JSON.stringify(C.TILE_PROPERTIES);return JSON.stringify(s);},getChipSubTitle:function(C){var T="";if(C){var d=C.EVALUATION||{};T=d.TITLE||"";}return T;},getFormattingMetadata:function(u,e,p){var d={};d._hasCurrency=false;d._hasSapText=false;var m=null;if(u instanceof sap.ui.model.odata.ODataModel){m=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(u);}else{var j=this.getODataModelByServiceUri(u);m=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(j);}var O=new sap.ui.model.analytics.odata4analytics.Model(m);var q=O.findQueryResultByName(e);var k=q.getAllMeasures();if(k[p]){var s=(k[p]._oTextProperty&&k[p]._oTextProperty.name)?k[p]._oTextProperty.name:"";if(s!=""){d._hasSapText=true;d._sapTextColumn=s;}else if(k[p].hasOwnProperty("_oUnitProperty")){var l=k[p]._oUnitProperty.extensions;for(var i=0;i<k[p]._oUnitProperty.extensions.length;i++){if(l[i].name==="semantics"&&l[i].value==="currency-code"){d._hasCurrency=true;d._currencyColumn=k[p]._oUnitProperty.name;}}}}return d;},prepareQueryServiceUri:function(u,d,m,n,v,o,p){function _(U){return U.replace(/'/g,"''");}var q=null;try{var r=null;if(u instanceof sap.ui.model.odata.ODataModel){r=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(u);}else{var s=this.getODataModelByServiceUri(u);r=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(s);}var O=new sap.ui.model.analytics.odata4analytics.Model(r);var Q=O.findQueryResultByName(d);var w=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(Q);if(m){w.setMeasures(m.split(","));w.includeMeasureRawFormattedValueUnit(null,true,true,true);}if(n){if(typeof n=="string"){q=n;q=q.split(",");}for(var i=0;i<q.length;i++){w.addToAggregationLevel([q[i]]);var x=Q.getAllDimensions();if(x[q[i]].getTextProperty()!=null){w.includeDimensionKeyTextAttributes([q[i]],true,true,null);}}}if(v&&v.length){var A=[];var B=[];for(var i=0,l=v.length;i<l;i++){var C=v[i];if(C.type==="PA"){B.push(C);}else if(C.type==="FI"){A.push(C);}}function D(U){var V=U.toJSON();var W=V.charAt(V.length-1).toUpperCase();if(W.charCodeAt(0)>=65&&W.charCodeAt(0)<=90){V=V.slice(0,-1);}return V;};function E(U){if(U){try{if(U==+U){U=window.parseInt(U);}var V=new Date(U);var W=V.getTime();if(isNaN(W)){return U;}else{return D(V);}}catch(e){jQuery.sap.log.error(e);}}return U;};if(A.length){var F=w.getFilterExpression();for(var i=0,l=A.length;i<l;i++){var C=A[i];if(this.getEdmType(u,C.filterPropertyName)=="Edm.DateTime"){C.value=E(C.value);C.valueTo=E(C.valueTo);}if(C.comparator==sap.ui.model.FilterOperator.BT){F.addCondition(C.filterPropertyName,C.comparator,_(C.value),C.valueTo);}else{var G=C.value.split(",");for(var j=0,k=G.length;j<k;j++){F.addCondition(C.filterPropertyName,C.comparator,_(G[j].replace(/\^\|/g,",")),null);}}}}if(B.length){if(Q.getParameterization()){var P=new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(Q.getParameterization());var H=Q.getParameterization();var I,J,K,L,M;for(var y=0,z=B.length;y<z;y++){I=B[y];J=H.findParameterByName(I.filterPropertyName);if(J.isIntervalBoundary()===true&&J.isLowerIntervalBoundary()===true){M=J.getPeerIntervalBoundaryParameter();for(var i=0,l=B.length;i<l;i++){if(B[i].filterPropertyName===M.getName()){L=_(B[i].value);break;}}K=_(I.value);if(L){P.setParameterValue(I.filterPropertyName,K,L);}}else if(J.isIntervalBoundary()===true&&J.isLowerIntervalBoundary()===false){jQuery.sap.log.info("Future development");}else{P.setParameterValue(I.filterPropertyName,_(I.value));}}w.setParameterizationRequest(P);}}}var N=w.getURIToQueryResultEntries();if(o&&o.length){N=N+"&$orderby=";for(var y=0,z=o.length;y<z;y++){var R=o[y].sortOrder||"asc";if(R){N+=o[y].element+" "+R+",";}}N=N.slice(0,N.length-1);}if(p){N=N+"&$top="+p;}var S=Q.getAllMeasures();var T=[];for(var i=0;i<m.split(",").length;i++){T.push(S[m.split(",")[i]].getUnitProperty());}return{uri:N,model:O.getODataModel(),unit:T};}catch(e){$.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());if(arguments.length){$.sap.log.error("Arguments Passed to this function");$.sap.log.error(arguments[0]+","+arguments[1]+","+arguments[2]+","+arguments[3]);}else{$.sap.log.error("NO Arguments passed to this function");}return null;}},_getOData4AnalyticsObject:function(u){var m=null;if(u instanceof sap.ui.model.odata.ODataModel){m=u;}else if(typeof u=="string"){m=this.getODataModelByServiceUri(u);}else{throw new Error("Invalid Input to Create ODataModel Object : "+u);}var O=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(m));return O;},getAllEntitySet:function(u){var d=[];try{var o=this._getOData4AnalyticsObject(u);d=o.getAllQueryResultNames();}catch(e){$.sap.log.error("Error fetching Enity Set : "+e.toString());}return d;},getAllMeasures:function(u,d){var m=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);m=q.getAllMeasureNames();}catch(e){$.sap.log.error("Error Fetching All Measures : "+e.toString());}return m;},getAllMeasuresWithLabelText:function(u,d){var m=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var j=q.getAllMeasureNames();for(var i=0;i<j.length;i++){var k=j[i];g.oMeasure=q.findMeasureByName(k);m.push({key:k,value:oMeasure.getLabelText()});}}catch(e){$.sap.log.error("Error Fetching All Measures : "+e.toString());}return m;},getAllDimensions:function(u,d){function i(l,m){var n=0,p=0;var r=[];while(n<l.length&&p<m.length){if(l[n]<m[p]){n++;}else if(l[n]>m[p]){p++;}else{r.push(l[n]);n++;p++;}}return r;}var j=[];var F=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var k=q.getEntityType();F=k.getFilterablePropertyNames();j=q.getAllDimensionNames();if(F&&F.length){j=i(F.sort(),j.sort());}}catch(e){$.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return j;},getAllDimensionsWithLabelText:function(u,d){var j=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var k=q.getAllDimensionNames();for(var i=0;i<k.length;i++){var l=k[i];var D=q.findDimensionByName(l);var m=null;if(D.getTextProperty()!=null){m=D.getTextProperty().name;}j.push({key:l,value:D.getLabelText(),textProperty:m});}}catch(e){$.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return j;},getAllInputParams:function(u,d){var i=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames();}}catch(e){$.sap.log.error("Error Fetching Input Params : "+e.toString());}return i;},getAllInputParamsWithFlag:function(u,d){var j=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);if(q.getParameterization()){var p=q.getParameterization();var k=p.getAllParameterNames();for(var i=0;i<k.length;i++){var l=k[i];var m=p.findParameterByName(l);j.push({name:l,optional:m.isOptional()});}}}catch(e){$.sap.log.error("Error Fetching Input Params : "+e.toString());}return j;},formatOdataObjectToString:function(v){if(v&&v.constructor==Object){if(v.__edmType=="Edm.Time"){var m=v.ms;var s=Math.floor((m/1000)%60);var d=Math.floor((m/60000)%60);var e=Math.floor((m/3600000)%24);return e+"H"+d+"M"+s+"S";}}return v;},generateCombinations:function(d){function e(k,s){while(s.length<k){s='0'+s;}return s;}var m=Math.pow(2,d.length);var r=[];var j=0;while(m>1){var s=(m-1).toString(2);s=e(d.length,s);r[j]=[];for(var i=0;i<s.length;i++){if(Number(s[i])){r[j].push(d[i]);}}m--;j++;}return r;},logError:function(e,C){if(e=="no data"&&C){var r=sap.ushell.components.tiles.utils.getResourceBundleModel().getResourceBundle();C.setFailedText(r.getText("sb.noData"));}jQuery.sap.log.error(e.toString());},numberOfLeadingZeros:function(n){n=String(n);var d=0;var e=n.indexOf('.');if(e==-1){return 0;}if(Number(n.split('.')[0])!=0){return 0;}var i=e+1;while(n[i++]=='0'){++d;}return d;},formatValue:function(v,s,M){M=M||3;var u={3:"K",6:"M",9:"B",12:"T",0:""};u["-3"]="m";u["-6"]="u";u["-9"]="n";u["-12"]="t";u["-2"]="%";var d,p,e;d=Number(v).toPrecision(M);var z=this.numberOfLeadingZeros(d);if(z>0&&s<0){p=d*Math.pow(10,z+M);e=-(z+M);}else{p=Number(d.split("e")[0]);e=Number(d.split("e")[1])||0;}if(!v&&v!=0){return{value:"",unitPrefix:""};}if(s>=0){if(e%3!=0){if(e%3==2){if(e+1==s){e=e+1;p=p/10;}else{e=e-2;p=p*100;}}else{if(e+2==s){e=e+2;p=p/100;}else{e--;p=p*10;}}}else if(e==15){p=p*1000;e=12;}}else{if(s=="-2"){var x=this.formatValue((v*100),0);}else if(e>=0&&v<10&&s=="-3"){p=v*Math.pow(10,3);e=-3;}else if(e>=0){return this.formatValue(v,0);}else{e=Math.abs(e);s=Math.abs(s);if(s>e){p=p/(Math.pow(10,e%3));e=e-(e%3);}else{var i=e-s;p=p/(Math.pow(10,i));e=e-i;}e=0-e;}}p+="";if(s=="-2"){var j=(x.unitPrefix=="")?Number(x.value+"").toFixed(4-(x.value+"").indexOf('.')):Number(x.value+"").toFixed(3-(x.value+"").indexOf('.'));return{value:Number(j),unitPrefix:(x.unitPrefix)+u[-2]};}p=Number(p).toFixed(4-p.indexOf('.'));return{value:Number(p),unitPrefix:u[e]};},getKpiChipsOnPage:function(d,e){var i=[];var j=this;var l=sap.ushell.Container.getService("LaunchPage");l.getGroups().done(function(G){if(G&&G instanceof Array&&G.length){jQuery.sap.log.info("Group Chip fetch");}e(d,i);});},isSmartbusinessChipAndCachable:function(d){var C=this.getParsedChip(d&&d.getConfigurationParameter("tileConfiguration"));return(C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.tileType&&this.getCachingTime(C));},getHanaClient:function(){var e;var i=sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED||jQuery.Deferred();var j=sap.ushell.components.tiles.indicatorTileUtils.cache.getCacheHanaClient();if(j!=undefined){e=j;sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.resolve(e);}else if(sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED){return sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.promise();}else{sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED=i;jQuery.ajax({type:"GET",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/GetSessionClient.xsjs",success:function(d,s,x){e=d.sessionClient;sap.ushell.components.tiles.indicatorTileUtils.cache.setCacheHanaClient(e);sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.resolve(e);},error:function(d,k,l){jQuery.sap.log.error(d.responseText);jQuery.sap.log.error("session client call failed");sap.ushell.components.tiles.indicatorTileUtils.cache.setCacheHanaClient(null);sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.reject();}});}return sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.promise();},abortPendingODataCalls:function(d){try{if(d){d.abort();}}catch(e){this.logError(e);}}};})(window,jQuery);sap.ushell.components.tiles.indicatorTileUtils.cache=(function(){"use strict";var B={};var K={};var s="HANA_CLIENT";return{getCacheHanaClient:function(){return B[s];},setCacheHanaClient:function(d){B[s]=d;},getEvaluationById:function(k){return this.getEvaluationByChipId(k);},getEvaluationByChipId:function(k){if(B[k]){return B[k];}return null;},setEvaluationById:function(k,d){B[k]=d;},getKpivalueById:function(k){if(K[k]){return K[k];}return null;},setKpivalueById:function(k,d){K[k]=d;}};})();
