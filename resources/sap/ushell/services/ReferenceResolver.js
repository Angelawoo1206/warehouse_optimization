// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.ReferenceResolver");jQuery.sap.require("sap.ushell.User");function U(){this.getValue=function(r){var d=new jQuery.Deferred();var v;if(r==="User.env.sap-ui-legacy-date-format"){v=sap.ui.getCore().getConfiguration().getFormatSettings().getLegacyDateFormat();}if(r==="User.env.sap-ui-legacy-number-format"){v=sap.ui.getCore().getConfiguration().getFormatSettings().getLegacyNumberFormat();}if(r==="User.env.sap-ui-legacy-time-format"){v=sap.ui.getCore().getConfiguration().getFormatSettings().getLegacyTimeFormat();}if(r==="User.env.sap-language"){v=sap.ushell.Container.getUser().getLanguage();}if(r==="User.env.sap-languagebcp47"){v=sap.ushell.Container.getUser().getLanguageBcp47();}if(r==="User.env.sap-accessibility"){v=(sap.ushell.Container.getUser().getAccessibilityMode())?'X':undefined;}if(r==="User.env.sap-statistics"){v=(sap.ui.getCore().getConfiguration().getStatistics())?"true":undefined;}if(r==="User.env.sap-theme"){v=sap.ushell.Container.getUser().getTheme(sap.ushell.User.prototype.constants.themeFormat.THEME_NAME_PLUS_URL);}if(r==="User.env.sap-theme-name"){v=sap.ushell.Container.getUser().getTheme();}if(r==="User.env.sap-theme-NWBC"){v=sap.ushell.Container.getUser().getTheme(sap.ushell.User.prototype.constants.themeFormat.NWBC);}d.resolve({"value":v});return d.promise();};}sap.ushell.services.ReferenceResolver=function(c,p,C){this._getUserEnvReferenceResolver=function(){if(!this.oUserEnvReferenceResolver){this.oUserEnvReferenceResolver=new U();}return this.oUserEnvReferenceResolver;};this.resolveReferences=function(r){var t=this,d=new jQuery.Deferred(),u,R=[],a=true,D={},o={},b;var e=r.map(function(s){var f;if(s.indexOf("User.env.")===0){f=s;o[f]=1;}if(s.indexOf("UserDefault.")===0){f=t._extractAnyUserDefaultReferenceName(s);D[f]=1;}if(typeof f!=="string"){a=false;jQuery.sap.log.error("'"+s+"' is not a legal reference name","sap.ushell.services.ReferenceResolver");}return{full:s,name:f};});if(!a){return d.reject("One or more references could not be resolved").promise();}Object.keys(D).forEach(function(n){u=u||sap.ushell.Container.getService("UserDefaultParameters");R.push(u.getValue(n));});Object.keys(o).forEach(function(n){b=b||t._getUserEnvReferenceResolver();R.push(b.getValue(n));});jQuery.when.apply(jQuery,R).done(function(){var k={};var i=0,f=arguments;Object.keys(D).forEach(function(n){D[n]=f[i];i=i+1;});Object.keys(o).forEach(function(n){o[n]=f[i];i=i+1;});e.forEach(function(g){var m;if(g.full.indexOf("UserDefault.extended.")===0){m=t.mergeSimpleAndExtended(D[g.name]);if(!jQuery.isEmptyObject(m)){k[g.full]=m;}else{k[g.full]=undefined;}}else if(g.full.indexOf("UserDefault.")===0){k[g.full]=D[g.name].value;}else if(g.full.indexOf("User.env.")===0){k[g.full]=o[g.name].value;}});d.resolve(k);});return d.promise();};this._extractAnyUserDefaultReferenceName=function(r){var P=this.extractExtendedUserDefaultReferenceName(r);if(typeof P==="string"){return P;}return this.extractUserDefaultReferenceName(r);};this.extractExtendedUserDefaultReferenceName=function(r){if(typeof r!=="string"||r.indexOf("UserDefault.extended.")!==0){return undefined;}return r.replace(/^UserDefault[.]extended[.]/,"");};this.extractUserDefaultReferenceName=function(r){if(typeof r!=="string"||r.indexOf("UserDefault.")!==0||r.indexOf("UserDefault.extended.")===0){return undefined;}return r.replace(/^UserDefault[.]/,"");};this.mergeSimpleAndExtended=function(v){var m=jQuery.extend(true,{},v.extendedValue);if(typeof v.value==="string"){if(!jQuery.isArray(m.Ranges)){m.Ranges=[];}m.Ranges.push({"Sign":"I","Option":"EQ","Low":v.value,"High":null});}return m;};};sap.ushell.services.ReferenceResolver.hasNoAdapter=true;}());
