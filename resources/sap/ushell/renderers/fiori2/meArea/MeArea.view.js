// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";sap.ui.jsview("sap.ushell.renderers.fiori2.meArea.MeArea",{createContent:function(c){jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.m.OverflowToolbar');jQuery.sap.require('sap.ushell.resources');jQuery.sap.require('sap.ushell.ui.launchpad.UserStatusItem');jQuery.sap.require("sap.ushell.ui.launchpad.AccessibilityCustomData");this.addStyleClass('sapUshellMeAreaView');this.aDanglingControls=[];var u=sap.ushell.Container.getUser().getFullName(),p,t=sap.ushell.resources.i18n,C=(this.getViewData()?this.getViewData().config:{})||{},s=C.appState,b=(s==='embedded'||s==='embedded-home'||s==='standalone'||s==='blank-home'||s==='blank'),U,S=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.UserStatus"),o=S.createInstance(),f=function(i){o.then(function(S){S.setStatus(i);p.close();});}.bind(this);U=[new sap.ushell.ui.launchpad.UserStatusItem({status:sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM.AVAILABLE,id:"userStatusItem1",isOpener:false,press:function(E){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AVAILABLE);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new sap.ushell.ui.launchpad.UserStatusItem({status:sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM.AWAY,id:"userStatusItem2",isOpener:false,press:function(E){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AWAY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new sap.ushell.ui.launchpad.UserStatusItem({status:sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM.BUSY,id:"userStatusItem3",isOpener:false,press:function(E){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.BUSY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new sap.ushell.ui.launchpad.UserStatusItem({status:sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM.APPEAR_OFFLINE,id:"userStatusItem4",isOpener:false,press:function(E){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.APPEAR_OFFLINE);}.bind(this)}).addStyleClass('sapUserStatusContainer')];if(!C.disableSignOut){U.push(new sap.ushell.ui.launchpad.UserStatusItem({status:sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM.SIGNOUT,id:"userStatusLogout",isOpener:false,press:[c.logout,c]}).addStyleClass('sapUserStatusSignOutContainer'));}var a=new sap.m.List({id:"sapUshellUserStatusItemList",showSeparators:"None",items:U});a.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-labelledBy",value:"userStatusItem1",writeToDom:true}));p=new sap.m.Popover("statuses",{placement:sap.m.PlacementType.Bottom,showArrow:false,showHeader:false,content:a}).addStyleClass('sapUserStatusPopOver');p.addStyleClass("sapContrastPlus");p.setOffsetX(-3);U=[new sap.m.Text({text:u}).addStyleClass('sapUshellMeAreaUserName')];var d=new sap.ushell.ui.launchpad.UserStatusItem({id:"userStatusOpener",visible:{path:"/userStatusEnabled",formatter:function(i){if(i){return true;}else{return false;}}.bind(this)},status:{path:"/userStatus",formatter:function(i){return sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM[i];}},tooltip:t.getText("userStatus_tooltip"),image:sap.ui.core.IconPool.getIconURI("account"),press:function(E){var B=sap.ui.getCore().byId(E.mParameters.id);if(p.isOpen()){p.close();}else{p.openBy(B);}}.bind(this),contentList:p}).addStyleClass('sapUserStatusOpener');d.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"0",writeToDom:true}));d.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-label",value:sap.ushell.resources.i18n.getText("OnlineStatus")+" "+t.getText("userStatus_tooltip"),writeToDom:true}));d.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"role",value:"listbox",writeToDom:true}));U.push(d);if(!C.disableSignOut){var l;if(!b){l=new sap.m.Button("logoutBtn",{visible:{parts:["/userStatusEnabled","/userStatusUserEnabled"],formatter:function(i,v){if(i&&v){return false;}else{return true;}}.bind(this)},type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});U.push(l);}else{l=new sap.ushell.ui.launchpad.ActionItem("logoutBtn",{visible:true,type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});}}var e=new sap.m.VBox({tabindex:"0",items:[U]}).addStyleClass("sapUshellUserArea");var g=sap.ushell.Container.getUser().getImage(),h;if(!g){h=new sap.ui.core.Icon({src:sap.ui.core.IconPool.getIconURI("person-placeholder"),size:'4rem'});}else{h=new sap.m.Image({src:g});}h.addStyleClass("sapUshellMeAreaUserImage");var j=new sap.m.HBox({items:[h,e]});j.addStyleClass('sapUshellMeAreaUserInfo');j.addStyleClass('sapContrastPlus');var k=c.createSaveButton(),m=c.createCancelButton();this.oSettingsDialog=new sap.m.Dialog({id:"userSettingsDialog",showHeader:false,content:null,buttons:[k,m],afterClose:function(){sap.ushell.Container.getUser().resetChangedProperties();},stretch:sap.ui.Device.system.phone}).addStyleClass("sapUshellUserSetting");this.oSettingsDialog.addContent(c.getSettingsDialogContent());this.aDanglingControls.push(m,k,this.oSettingsDialog);j.addEventDelegate({onsapskipback:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);},onsaptabprevious:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}});var A=new sap.m.OverflowToolbar({id:"overflowActions",design:sap.m.ToolbarDesign.Transparent,content:{path:"/currentState/actions",factory:function(i,v){var w=sap.ui.getCore().byId(v.getObject());if(w){if(w.setActionType){w.setActionType("action");}c._addPressHandlerToActions(w);}return w;}}}).addStyleClass('sapContrastPlus');A._getOverflowButtonSize=function(){return 82.4;};if(A._getOverflowButton){var n=A._getOverflowButton();if(n){var q=n.onAfterRendering;n.onAfterRendering=function(){if(q){q.apply(this,arguments);}this.addStyleClass('sapUshellActionItem');this.setText(sap.ushell.resources.i18n.getText('meAreaMoreActions'));};}}A.updateAggregation=function(N){var B=this.mBindingInfos[N],w=this.getMetadata().getJSONKeys()[N],x;jQuery.each(this[w._sGetter](),jQuery.proxy(function(i,v){this[w._sRemoveMutator](v);},this));jQuery.each(B.binding.getContexts(),jQuery.proxy(function(i,v){x=B.factory(this.getId()+"-"+i,v)?B.factory(this.getId()+"-"+i,v).setBindingContext(v,B.model):"";this[w._sMutator](x);},this));};if(C.enableRecentActivity){var I=new sap.m.IconTabBar('meAreaIconTabBar',{backgroundDesign:sap.m.BackgroundDesign.Transparent,expandable:false,items:[this.createIconTab("recentActivities",true,c),this.createIconTab("frequentActivities",false,c)]}).addStyleClass('sapUshellMeAreaTabBar');I.addEventDelegate({onsaptabnext:function(E){var O=E.originalEvent,i=O.srcElement,v=i.classList,w;w=jQuery.inArray('sapUshellMeAreaActivityItem',v)>-1;if(w===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}},onsapskipforward:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}});var r=I.onAfterRendering;I.onAfterRendering=function(){if(r){r.apply(this,arguments);}var T=sap.ui.getCore().byId('meAreaIconTabBar--header');if(T){T.addStyleClass('sapContrastPlus');T.addStyleClass('sapUshellTabBarHeader');}};this.actionBox=A;return new sap.m.ScrollContainer({vertical:true,horizontal:false,height:"100%",content:new sap.m.VBox("sapUshellMeAreaContent",{items:[j,A,I]})});}else{A.addEventDelegate({onsaptabnext:function(E){var O=E.originalEvent,i=O.srcElement,v=jQuery('.sapUshellActionItem:last')[0].id,w;w=v===i.id;if(w===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}},onsapskipforward:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}});}return new sap.m.ScrollContainer({vertical:true,horizontal:false,height:"100%",content:new sap.m.VBox("sapUshellMeAreaContent",{items:[j,A]})});},createIconTab:function(i,s,c){jQuery.sap.require('sap.m.StandardListItem');var a=function(b,C){var d=C.getProperty("icon");var t=C.getProperty("title");var D=sap.ushell.services.AppType.getDisplayName(C.getProperty("appType"));var l={title:t,description:D,icon:d,type:sap.m.ListType.Active};if(s){l.info=C.getProperty("timestamp");}var L=new sap.m.StandardListItem(l).addStyleClass('sapUshellMeAreaActivityItem');L.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-describedby",value:I.getId(),writeToDom:true}));if(!d){L.addStyleClass('sapUshellMeAreaActivityItemNoIcon');}return L;};var I=new sap.m.IconTabFilter({id:"sapUshellIconTabBar"+i,text:sap.ushell.resources.i18n.getText(i)});var A=new sap.m.List({id:"sapUshellActivityList"+i,showSeparators:"None",items:{path:"meAreaModel>/apps/"+i,factory:a.bind(this)},noDataText:sap.ushell.resources.i18n.getText(i+'NoDataText'),itemPress:function(e){var m=this.getModel('meAreaModel'),v=sap.ui.getCore().byId("viewPortContainer");if(v){v.switchState("Center");}var p=e.getParameter('listItem').getBindingContextPath();c.setLastVisited(m.getProperty(p).url);setTimeout(function(){hasher.setHash(m.getProperty(p).url);},200);}});I.addContent(A);return I;},onViewStateShow:function(){this.getController().refreshRecentActivities();this.getController().refreshFrequentActivities();if(this.actionBox){this.actionBox.updateAggregation("content");}this.getController().updateScrollBar(hasher.getHash());},getControllerName:function(){return"sap.ushell.renderers.fiori2.meArea.MeArea";}});}());
