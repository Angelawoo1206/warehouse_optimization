(function(){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchText');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchLink');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchLogger');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchNavigationObject');var S=sap.ushell.renderers.fiori2.search.controls.SearchText;var a=sap.ushell.renderers.fiori2.search.controls.SearchLink;var b=sap.ushell.renderers.fiori2.search.SearchHelper;var c=sap.ushell.renderers.fiori2.search.SearchLogger;var f=sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar;var n='\u2013';sap.ui.core.Control.extend("sap.ushell.renderers.fiori2.search.controls.SearchResultListItem",{metadata:{properties:{title:"string",titleUrl:"string",titleNavigation:"object",type:"string",imageUrl:"string",attributes:{type:"object",multiple:true},navigationObjects:{type:"object",multiple:true},selected:"boolean",expanded:"boolean",parentListItem:"object"},aggregations:{_titleLink:{type:"sap.ushell.renderers.fiori2.search.controls.SearchLink",multiple:false,visibility:"hidden"},_typeText:{type:"sap.ushell.renderers.fiori2.search.controls.SearchText",multiple:false,visibility:"hidden"},_selectionCheckBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"},_expandButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_attributeLabels:{type:"sap.m.Label",multiple:true,visibility:"hidden"},_attributeValues:{type:"sap.ushell.renderers.fiori2.search.controls.SearchText",multiple:true,visibility:"hidden"},_relatedObjectActionsToolbar:{type:"sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar",multiple:false,visibility:"hidden"},_titleLabeledByText:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}}},init:function(){var t=this;t.setAggregation("_titleLink",new a({}).addStyleClass("sapUshellSearchResultListItem-Title").addStyleClass("sapUshellSearchResultListItem-MightOverflow").attachPress(function(E){var l="";var d=t.getTitleNavigation();if(d){l=d.getHref();}if(l&&l.length>0){try{var N=new c.NavigationEvent();N.addUserHistoryEntry(l);var m=sap.ushell.renderers.fiori2.search.getModelSingleton();m.analytics.logCustomEvent('FLP: Search','Launch Object',[l]);}catch(e){}var p=t._getPhoneSize();var w=$(window).width();if(w<=p){E.preventDefault();var g=t.fireNavigate(d);g();}}}));t.setAggregation("_typeText",new S().addStyleClass("sapUshellSearchResultListItem-Category").addStyleClass("sapUshellSearchResultListItem-MightOverflow"));t.setAggregation("_selectionCheckBox",new sap.m.CheckBox({select:function(e){t.setProperty("selected",e.getParameters().selected,true);}}));t.setAggregation("_expandButton",new sap.m.Button({type:sap.m.ButtonType.Transparent,press:function(e){t.toggleDetails();}}));t.setAggregation("_relatedObjectActionsToolbar",new f().addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar"));t.setAggregation("_titleLabeledByText",new sap.ui.core.InvisibleText());},renderer:function(r,C){C._renderer(r);},_renderer:function(r){this._resetPrecalculatedValues();this._renderContainer(r);this._renderAccessibilityInformation(r);},_renderContainer:function(r){var t=this;r.write('<div');r.writeControlData(t);r.addClass("sapUshellSearchResultListItem-Container");r.writeClasses();r.write('>');t._renderContentContainer(r);t._renderExpandButtonContainer(r);r.write('</div>');},_renderContentContainer:function(r){r.write('<div class="sapUshellSearchResultListItem-Content">');this._renderTitleContainer(r);this._renderAttributesContainer(r);r.write('</div>');},_renderExpandButtonContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-ExpandButtonContainer">');r.write('<div class="sapUshellSearchResultListItem-ExpandButton">');var i,d;var e=t.getProperty("expanded");if(e){i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");d=sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip");}else{i=sap.ui.core.IconPool.getIconURI("slim-arrow-down");d=sap.ushell.resources.i18n.getText("showDetailBtn_tooltip");}var g=t.getAggregation("_expandButton");g.setIcon(i);g.setTooltip(d);g.onAfterRendering=function(){sap.m.Button.prototype.onAfterRendering.apply(this,arguments);t.setAriaExpandedState();};r.renderControl(g);r.write('</div>');r.write('</div>');},_renderTitleContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-TitleAndImageContainer">');r.write('<div class="sapUshellSearchResultListItem-TitleContainer">');t._renderCheckbox(r);var d="";var e;var g=t.getTitleNavigation();if(g){d=g.getHref();e=g.getTarget();}var h=t.getAggregation("_titleLink");h.setHref(d);h.setText(t.getTitle());if(e){h.setTarget(e);}if(d.length==0){h.setEnabled(false);}r.renderControl(h);var i=t.getAggregation("_typeText");i.setText(t.getType());r.renderControl(i);r.write('</div>');t._renderImageForPhone(r);r.write('</div>');},_renderCheckbox:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-CheckboxExpandContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxAlignmentContainer">');var d=t.getAggregation("_selectionCheckBox");var s=t.getProperty("selected");d.setSelected(s);r.renderControl(d);r.write('</div>');r.write('</div>');r.write('</div>');},_renderImageForPhone:function(r){var t=this;if(t.getImageUrl()){r.write('<div class="sapUshellSearchResultListItem-TitleImage">');r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');r.write('</div>');}},_renderAttributesContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-AttributesExpandContainer');var e=t.getProperty("expanded");if(e){r.write(" sapUshellSearchResultListItem-AttributesExpanded");}r.write('">');r.write('<div class="sapUshellSearchResultListItem-AttributesAndActions">');r.write('<ul class="sapUshellSearchResultListItem-Attributes">');t._renderImageAttribute(r);var i=t.getAttributes();t._renderAllAttributes(r,i);r.write('<div class="sapUshellSearchResultListItem-ExpandSpacerAttribute" aria-hidden="true"></div>');r.write('</ul>');t._renderRelatedObjectsToolbar(r);r.write('</div>');r.write('</div>');},_renderAllAttributes:function(r,d){var t=this;var e;var l;var v;var g,h;var i=0,j=0;var k=12;if(t.getImageUrl()){k--;}t.destroyAggregation("_attributeLabels");t.destroyAggregation("_attributeValues");for(;j<k&&i<d.length;i++){e=d[i];if(e.isTitle){continue;}l=e.name;v=e.value;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-MainAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(h);r.write('</li>');t.addAggregation("_attributeLabels",g,true);t.addAggregation("_attributeValues",h,true);j++;}var m=false;for(;i<d.length;i++){e=d[i];if(!e.whyfound){continue;}l=e.name;v=e.value;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(h);r.write('</li>');t.addAggregation("_attributeLabels",g,true);t.addAggregation("_attributeValues",h,true);m=true;}if(m){r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundSpacerAttribute" aria-hidden="true"></div>');}},_renderImageAttribute:function(r){var t=this;if(!t.getImageUrl()){return;}r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-ImageAttribute');if(!t.getImageUrl()){r.write(' sapUshellSearchResultListItem-ImageAttributeHidden');}r.write('">');r.write('<div class="sapUshellSearchResultListItem-ImageContainer">');if(t.getImageUrl()){r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');}r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('</div>');r.write('</div>');},_renderRelatedObjectsToolbar:function(r){var t=this;var d=t.getNavigationObjects();if(!d||d.length==0){return;}t._showExpandButton=true;var e=t.getAggregation("_relatedObjectActionsToolbar");e.setProperty("navigationObjects",d);r.renderControl(e);},_renderAccessibilityInformation:function(r){var t=this;var p=t.getProperty("parentListItem");if(p){var l=t.getTitle()+", "+t.getType();var d=t.getAggregation("_titleLabeledByText");d.setText(l);r.renderControl(d);p.onAfterRendering=function(){sap.m.CustomListItem.prototype.onAfterRendering.apply(this,arguments);var e=$(this.getDomRef());e.attr("aria-labelledby",d.getId());};p.addEventDelegate({onsapspace:function(e){if(e.target===e.currentTarget){t.toggleDetails();}},onsapenter:function(E){if(E.target===E.currentTarget){var g="";var h=t.getTitleNavigation();if(h){g=h.getHref();}try{var N=new c.NavigationEvent();N.addUserHistoryEntry(g);var m=sap.ushell.renderers.fiori2.search.getModelSingleton();m.analytics.logCustomEvent('FLP: Search','Launch Object',[g]);}catch(e){}if(g&&g.length>0){var i=t.fireNavigate(h);i();}}}});}},_getExpandAreaObjectInfo:function(){var t=this;var r=$(t.getDomRef());var d=r.find(".sapUshellSearchResultListItem-AttributesExpandContainer");var e=r.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");var g=false;if(e.css("display")==="none"){e.css("display","block");g=true;}var h=d.height();var i=r.find(".sapUshellSearchResultListItem-AttributesAndActions").height();if(g){e.css("display","");}var j=[];r.find(".sapUshellSearchResultListItem-GenericAttribute").each(function(){var o=$(this);if(o.css("order")>2){j.push(this);}});var k=200;var l=k/10;var m={resultListItem:r,attributesExpandContainer:d,currentHeight:h,expandedHeight:i,elementsToFadeInOrOut:j,expandAnimationDuration:k,fadeInOrOutAnimationDuration:l,relatedObjectsToolbar:e};return m;},isShowingDetails:function(){var e=this._getExpandAreaObjectInfo();if(e.currentHeight<e.expandedHeight){return false;}return true;},showDetails:function(d){var t=this;if(t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();e.relatedObjectsToolbar.css("display","block");var r=t.getAggregation("_relatedObjectActionsToolbar");if(r){r._layoutToolbarElements();}e.attributesExpandContainer.animate({"height":e.expandedHeight},e.expandAnimationDuration,function(){t.setProperty("expanded",true,true);$(this).addClass("sapUshellSearchResultListItem-AttributesExpanded");$(this).css("height","");$(e.elementsToFadeInOrOut).css("opacity","");var i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");var g=t.getAggregation("_expandButton");g.setTooltip(sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip"));g.setIcon(i);g.rerender();e.relatedObjectsToolbar.css("display","");});$(e.elementsToFadeInOrOut).animate({"opacity":1},e.fadeInOrOutAnimationDuration);},hideDetails:function(d){var t=this;var r=$(t.getDomRef());if(!t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();var g=r.find(".sapUshellSearchResultListItem-MainAttribute").outerHeight(true)+r.find(".sapUshellSearchResultListItem-ExpandSpacerAttribute").outerHeight(true);var s=false;var h=e.attributesExpandContainer.animate({"height":g},{"duration":e.expandAnimationDuration,"progress":function(i,p,j){if(!s&&j<=e.fadeInOrOutAnimationDuration){s=true;var k=$(e.elementsToFadeInOrOut).animate({"opacity":0},e.fadeInOrOutAnimationDuration).promise();jQuery.when(h,k).done(function(){t.setProperty("expanded",false,true);e.attributesExpandContainer.removeClass("sapUshellSearchResultListItem-AttributesExpanded");$(e.elementsToFadeInOrOut).css("opacity","");var l=sap.ui.core.IconPool.getIconURI("slim-arrow-down");var m=t.getAggregation("_expandButton");m.setTooltip(sap.ushell.resources.i18n.getText("showDetailBtn_tooltip"));m.setIcon(l);m.rerender();});}}}).promise();},toggleDetails:function(d){if(this.isShowingDetails()){this.hideDetails(d);}else{this.showDetails(d);}},isSelectionModeEnabled:function(){var t=this;var i=false;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");if(s){i=s.css("opacity")>0;}return i;},enableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;var h=false;s.animate({width:"2rem"},{"duration":g,"progress":function(i,p,r){if(!h&&p>0.5){e.css("display","");e.animate({opacity:"1.0"},g/2);h=true;}}});},disableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;e.animate({opacity:"0.0"},g/2,function(){e.css("display","none");});s.animate({width:"0"},g);},toggleSelectionMode:function(d){if(this.isSelectionModeEnabled()){this.disableSelectionMode(d);}else{this.enableSelectionMode(d);}},onAfterRendering:function(){var t=this;t.showOrHideExpandButton();var p=t._getPhoneSize();$(t.getDomRef()).bind('click',function(){var w=$(window).width();if(w<=p){var d="";var e=t.getTitleNavigation();if(e){d=e.getHref();}if(d&&d.length>0){var g=t.fireNavigate(e);g();}}});t.forwardEllipsis($(t.getDomRef()).find(".sapUshellSearchResultListItem-Title, .sapUshellSearchResultListItem-AttributeKey, .sapUshellSearchResultListItem-AttributeValue"));$(this.getDomRef()).find('.sapUshellSearchResultListItem-MightOverflow').on('mouseenter',function(){var d=$(this);var e=d.attr('title');if((this.offsetWidth<this.scrollWidth||this.offsetHeight<this.scrollHeight)&&!d.attr('title')){d.attr("title",d.text());}else if(e===d.text()){d.removeAttr('title');}}).on('mouseout',function(){var d=$(this);var e=d.attr('title');if(e===d.text()){d.removeAttr('title');}});},_getPhoneSize:function(){return 767;},_resetPrecalculatedValues:function(){this._visibleAttributes=undefined;this._detailsArea=undefined;this._showExpandButton=false;},showOrHideExpandButton:function(){var t=this;var e=$(t.getDomRef());var d=e.find(".sapUshellSearchResultListItem-ExpandButtonContainer");var i=d.css("visibility")!="hidden";var s=false;var g=e.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");s=g.length>0;if(!s){e.find(".sapUshellSearchResultListItem-MainAttribute,.sapUshellSearchResultListItem-WhyFoundAttribute").each(function(){if($(this).css("order")>2){s=true;return false;}});}if(i&&!s){d.css("visibility","hidden");d.attr("aria-hidden","true");t.setAriaExpandedState();}else if(!i&&s){d.css("visibility","");d.removeAttr("aria-hidden");t.setAriaExpandedState();}},setAriaExpandedState:function(){var t=this;var e=t.getAggregation("_expandButton");var d=$(e.getDomRef());var g=$(t.getDomRef());var h=t.getParentListItem()?$(t.getParentListItem().getDomRef()):g.closest("li");var i=g.find(".sapUshellSearchResultListItem-ExpandButtonContainer");if(i.css("visibility")=="hidden"){d.removeAttr("aria-expanded");h.removeAttr("aria-expanded");}else{var j=t.getProperty("expanded");if(j){d.attr("aria-expanded","true");h.attr("aria-expanded","true");}else{d.attr("aria-expanded","false");h.attr("aria-expanded","false");}}},fireNavigate:function(d){return function(){if(d){try{var u=d.getHref();var N=new c.NavigationEvent();N.addUserHistoryEntry(u);var m=sap.ushell.renderers.fiori2.search.getModelSingleton();m.analytics.logCustomEvent('FLP: Search','Launch Object',[u]);}catch(e){}d.performNavigation();}};},forwardEllipsis:function(o){o.each(function(i,d){b.forwardEllipsis4Whyfound(d);});}});})();
