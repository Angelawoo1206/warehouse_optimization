;(function(){
/*
     * sap-ina-sina - SAP HANA Simple Info Access API/Enterprise Search API
     * version 3.1.0 - 2016-09-13

     * Copyright (c) 2016 SAP SE; All rights reserved
     */
/*
     * @file Simple info access (SINA) API: Filter Interface
     * @namespace sap.bc.ina.api.sina.base.filter
     * @copyright 2014 SAP SE. All rights reserved.
     */
var f,s,q,g,p,t,u,v,w,x,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;f=function(){var e={};if(typeof window!=='undefined'){e.removeHtmlTags=function(h){var d=document.createElement('div');d.innerHTML=h;return d.textContent||d.innerText||'';};e.extend=jQuery.extend;e.Deferred=jQuery.Deferred;e.ajax=jQuery.ajax;e.when=jQuery.when;}else{e.removeHtmlTags=function(h){var a=a;return a(h);};e.extend=extend;e.Deferred=jquery_deferred.Deferred;e.when=jquery_deferred.when;}return e;}();s=function(){var e={};e.provider={};e.registerProvider=function(a){this.provider[a.impl_type]=a;};e.QueryOptions={FUZZY:'Fuzzy'};e.SuggestionType={HISTORY:'history',DATASOURCE:'datasource',OBJECTDATA:'objectdata'};e.FacetType={ATTRIBUTE:'attribute',DATASOURCE:'datasource',SEARCH:'searchresult'};e.ChartQueryType={ATTRIBUTE:'attribute',DATASOURCE:'datasource'};e.Sina=function(){this.init.apply(this,arguments);};e.Sina.prototype={init:function(a){a=a||{};if(a.system){this.setSystem(a.system);}},_initQueryProperties:function(a){a=a||{};a.sina=this;a.system=a.system||this.getSystem();if(a.dataSource){a.dataSource=this.createDataSource(a.dataSource);}return a;},createChartQuery:function(a){a=this._initQueryProperties(a);return new this._provider.chartQuery(a);},createSearchQuery:function(a){a=this._initQueryProperties(a);return new this._provider.searchQuery(a);},createGroupBarChartQuery:function(a){a=this._initQueryProperties(a);return new this._provider.groupBarChartQuery(a);},createLineChartQuery:function(a){a=this._initQueryProperties(a);a.dimensions=[a.dimensionLine,a.dimensionX];a.measures=[{name:a.measureY.name,aggregationFunction:a.measureY.aggregationFunction}];return new this._provider.lineChartQuery(a);},createSuggestionQuery:function(a){a=this._initQueryProperties(a);return new this._provider.suggestionQuery(a);},createPerspectiveQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveQuery(a);},createPerspectiveSearchQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveSearchQuery(a);},createPerspectiveGetQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveGetQuery(a);},sinaSystem:function(a){if(a){this.sys=a;}else{return this.sys;}return{};},getSystem:function(){if(this.sys){return this.sys;}return{};},setSystem:function(y){this.sys=y;},createFacet:function(a){a.sina=this;return new this._provider.Facet(a);},ResultElementKeyStatus:{OK:'ok',NO_KEY:'no_key',NO_VALUE:'no_value'},createFilter:function(a){a=a||{};a.sina=this;return new this._provider.Filter(a);},createFilterCondition:function(a,o,b,c,d,l){a=a||{};var h;if(typeof a==='object'){h=a;h.sina=this;}else{h={attribute:a,operator:o,value:b,sina:this,attributeLabel:c,valueLabel:d,label:l};}if(h&&h.conditions){return new this._provider.FilterConditionGroup(h);}return new this._provider.FilterCondition(h);},createFilterConditionGroup:function(a){a=a||{};a.sina=this;return new this._provider.FilterConditionGroup(a);},createDataSource:function(a){var o={};if(a){o=a;}o.sina=o.sina||this;return new this._provider.DataSource(o);},createDataSourceQuery:function(a){a=this._initQueryProperties(a);return new this._provider.DataSourceQuery(a);},getRootDataSource:function(){properties=this._initQueryProperties(properties);return this._provider.getRootDataSource(properties);},getSearchConfiguration:function(a){a=this._initQueryProperties(a);return new this._provider.searchConfiguration(a);},addUserHistoryEntry:function(o){properties=this._initQueryProperties(properties);properties.oEntry=o;return this._provider.addUserHistoryEntry(properties);},emptyUserHistory:function(a){a=this._initQueryProperties(a);return this._provider.emptyUserHistory(a);},getDataSources:function(a){a=this._initQueryProperties(a);return this._provider.metaDataService.getDataSources(a);},getDataSourcesSync:function(a){a=this._initQueryProperties(a);return this._provider.metaDataService.getDataSourcesSync(a);},getDataSource:function(d){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSource(properties,d);},getDataSourceByBusinessObjectName:function(b){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSourceByBusinessObjectName(properties,b);},getDataSourceSync:function(d){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSourceSync(properties,d);},getDataSourceSyncByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getDataSourceSyncByBusinessObjectName(a,b);},getBusinessObjectsMetaData:function(){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectsMetaData(a);},getBusinessObjectsMetaDataSync:function(){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectsMetaDataSync(a);},getBusinessObjectMetaData:function(d){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaData(a,d);},getBusinessObjectMetaDataByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataByBusinessObjectName(a,b);},getBusinessObjectMetaDataSync:function(d){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataSync(a,d);},getBusinessObjectMetaDataSyncByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataSyncByBusinessObjectName(a,b);},setBusinessObjectMetaDataSync:function(v,d){var a=this._initQueryProperties();return this._provider.metaDataService.setBusinessObjectMetaDataSync(a,v,d);}};e.SinaError=function(){this.init.apply(this,arguments);};e.SinaError.SEVERITY_ERROR=3;e.SinaError.SEVERITY_WARNING=2;e.SinaError.SEVERITY_INFO=1;e.SinaError.prototype={init:function(a){this.message=a.message||'';this.errorCode=a.errorCode||null;this.severity=a.severity||e.SinaError.SEVERITY_ERROR;},getErrorCode:function(){return this.errorCode;},getMessage:function(){return this.message;},getSeverity:function(){return this.severity;},setSeverity:function(a){this.severity=a;},toString:function(){var m='';switch(this.severity){case e.SinaError.SEVERITY_ERROR:m+='SINA ERROR: ';break;case e.SinaError.SEVERITY_WARNING:m+='SINA WARNING: ';break;case e.SinaError.SEVERITY_INFO:m+='SINA INFO: ';break;}m+=this.message;return m;}};return e;}();q=function(){var e={};var a=function(){};e.Query=function(){this.init.apply(this,arguments);};e.Query.prototype={init:function(b){b=b||{};this.sina=b.sina;this.system=b.system;this.onSuccess=b.onSuccess;this.onError=b.onError;this.options=[];this._responseJson=null;this.setTop(b.top||10);this.setSkip(b.skip||0);this.resultSetProperties=b;this.filter=this.filter||b.filter||this.sina.createFilter({dataSource:b.dataSource});this.datasource=this.datasource||b.dataSource;if(b.filterConditions&&b.filterConditions.length>0){for(var i=0,l=b.filterConditions.length;i<l;i++){var c=b.filterConditions[i];if(c&&c instanceof Array&&c.length>0){this.addFilterCondition(c[0],c[1],c[2]);}else if(c&&typeof c==='string'){this.addFilterCondition(b.filterConditions[0],b.filterConditions[1],b.filterConditions[2]);break;}}}this.setSearchTerms(b.searchTerms||'');},addOption:function(o){if(this.options.indexOf(o)===-1){this._resetResultSet();}this.options.push(o);},removeOption:function(o){if(this.options.indexOf(o)!==-1){this.options.splice(this.options.indexOf(o),1);this._resetResultSet();}},dataSource:function(n){if(n){this.setDataSource(n);return this;}else{return this.getDataSource();}},getDataSource:function(){return this.filter.getDataSource();},setDataSource:function(d){if(d===undefined){return this;}if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},setFacetOptions:function(o){this._resetResultSet();this.facetOptions=o;},getFacetOptions:function(){return this.facetOptions;},getFilter:function(){return this.filter;},setFilter:function(b){if(!this.filter.equals(b)){this._resetResultSet();}this.filter=b;return this;},setSearchTerms:function(b){if(this.filter.getSearchTerms()!==b){this.filter.setSearchTerms(b);this._resetResultSet();}return this;},getSearchTerms:function(){return this.filter.getSearchTerms();},skip:function(n){if(n!==undefined){this.setSkip(n);}else{return this._skip;}return this;},getSkip:function(){return this._skip;},setSkip:function(b){if(this._skip!==b){this._resetResultSet();}this._skip=b;return this;},top:function(n){if(n!==undefined){this.setTop(n);}else{return this._top;}return this;},getTop:function(){return this._top;},setTop:function(b){if(isNaN(b)){return false;}this._top=parseInt(this._top,10);if(this._top!==b){this._top=b;this._resetResultSet();}return this;},addFilterCondition:function(b,o,c){if(typeof b==='string'){b=this.sina.createFilterCondition(b,o,c);}if(this.filter.hasFilterCondition(b,o,c)===false){this.filter.addFilterCondition(b,o,c);this._resetResultSet();}return this;},removeFilterCondition:function(b,o,c){this.filter.removeFilterCondition(b,o,c);this._resetResultSet();return this;},resetFilterConditions:function(){this.filter.resetFilterConditions();this._resetResultSet();return this;},getResultSetSync:function(){this.resultSet=this.executeSync();return this.resultSet;},getResultSet:function(o,b){var c=this;o=o||this.onSuccess||a;b=b||this.onError||a;var r=this.execute();r.done(function(d){c.resultSet=d;o(d);});r.fail(function(d){b(d);});return r.promise();},_resetResultSet:function(){},resetResultSet:function(){this._resetResultSet();},execute:function(){},executeSync:function(){}};return e;}();g=function(f,q){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);}});return e;}(f,q);p=function(f){var e={};e.getDataSourceMetaDataRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Metadata':{'Context':'Search','Expand':['Cube']},'ServiceVersion':204});};e.getCatalogRequest=function(){return f.extend({},{'DataSource':{'ObjectName':'$$DataSources$$','PackageName':'ABAP'},'Options':['SynchronousRun'],'Search':{'Top':1000,'Skip':0,'OrderBy':[{'AttributeName':'Description','SortOrder':'ASC'},{'AttributeName':'ObjectName','SortOrder':'ASC'}],'Expand':['Grid','Items'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'SupportedService','Comparison':'=','Value':'Search'}}]}}},'NamedValues':[{'AttributeName':'ObjectName','Name':'ObjectName'},{'AttributeName':'Description','Name':'Description'},{'AttributeName':'DescriptionPlural','Name':'DescriptionPlural'},{'AttributeName':'Type','Name':'Type'}]},'SearchTerms':'*','ServiceVersion':204});};e.getESHConnectorRequest=function(){return f.extend({},{'DataSource':{'SchemaName':'','PackageName':'ABAP','ObjectName':'~ESH_CONNECTOR~','Type':'Connector'},'Search':{'Top':1000,'Skip':0,'OrderBy':[{'AttributeName':'DESCRIPTION','SortOrder':'ASC'}],'Expand':['Grid','Items','TotalCount'],'Filter':{},'NamedValues':[{'AttributeName':'$$ResultItemAttributes$$','Name':'$$ResultItemAttributes$$'},{'AttributeName':'$$RelatedActions$$','Name':'$$RelatedActions$$'}],'SearchTerms':'*','SelectedValues':[]}});};e.getSuggestionRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Suggestions':{'Expand':['Grid','Items'],'Precalculated':false,'SearchTerms':'','AttributeNames':[]},'ServiceVersion':204});};e.getSuggestion2Request=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Suggestions2':{'Expand':['Grid','Items'],'Precalculated':false,'AttributeNames':[]},'ServiceVersion':204});};e.getPerspectiveRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items','ResultsetFacets','TotalCount'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}}]}}},'Top':10,'Skip':0,'SearchTerms':'S*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'Function':'RelatedActions','Name':'$$RelatedActions$$'}]},'ServiceVersion':204});};e.getPerspectiveSearchRequest=function(){return f.extend({},{'DataSource':{'ObjectName':'$$Perspectives$$','Type':'View'},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items'],'Filter':{'Selection':{'Operator':{'Code':'Or','SubSelections':[{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'3'}},{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'4'}},{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'5'}}]}}},'SearchTerms':'*','SelectedValues':[{'AttributeName':'PACKAGE_ID','Name':'PACKAGE_ID'},{'AttributeName':'PERSPECTIVE_ID','Name':'PERSPECTIVE_ID'},{'AttributeName':'TITLE_TEXT','Name':'TITLE_TEXT'},{'AttributeName':'SUMMARY_TEXT','Name':'SUMMARY_TEXT'}],'Skip':0,'Top':30}});};e.getPerspectiveRequestFactsheet=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items','ResultsetFacets','TotalCount'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}}]}}},'Top':10,'Skip':0,'SearchTerms':'S*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'AttributeName':'$$RelatedActions$$'},{'AttributeName':'$$RelatedActions.Proxy$$'}]},'ServiceVersion':204});};e.getSearchRequest=function(){return f.extend({},{'DataSource':{},'SearchTerms':'DUMMY','Search':{'Expand':['Grid','Items','TotalCount'],'Top':'DUMMY','Skip':'DUMMY','SelectedValues':'DUMMY','NamedValues':[{'AttributeName':'$$ResultItemAttributes$$','Name':'$$ResultItemAttributes$$'},{'AttributeName':'$$RelatedActions$$','Name':'$$RelatedActions$$'}]}});};e.getABAPChartRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items','ResultsetFacets','TotalCount'],'Filter':{},'Top':10,'Skip':0,'SearchTerms':'*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'AttributeName':'$$RelatedActions$$'},{'AttributeName':'$$RelatedActions.Proxy$$'}],'OrderBy':[]},'ServiceVersion':204,'Facets':{'MaxNumberOfReturnValues':1000,'Attributes':[]}});};e.getChartRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'SearchTerms':'','Analytics':{'Definition':{'Dimensions':[{'Axis':'Rows','Name':'CATEGORY','SortOrder':1,'Top':5},{'Axis':'Columns','Name':'CustomDimension1','Members':[{'Aggregation':'COUNT','AggregationDimension':'CATEGORY','MemberOperand':{'AttributeName':'Measures','Comparison':'=','Value':'COUNT'},'Name':'COUNT','SortOrder':2}]}],'Filter':{}}}});};e.getSearchConfigurationRequest=function(){return f.extend({},{'SearchConfiguration':{'Action':'Update','Data':{'PersonalizedSearch':{'PersonalizationPolicy':'','SessionUserActive':true,'ResetUserData':true},'NavigationEvent':{'SourceApplication':'','TargetApplication':'','Parameter':[]}}}});};return e;}(f);t=function(){var e={};e.Filter=function(){this.init.apply(this,arguments);};e.Condition=function(){this.init.apply(this,arguments);};e.ConditionGroup=function(){this.init.apply(this,arguments);};e.Filter.prototype={init:function(a){a=a||{};this.sina=a.sina;this.setDataSource(a.dataSource);this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:'DefaultRoot',operator:'And'});this.searchTerms=a.searchTerms||'';},_findAttributeOfCondition:function(c){if(c instanceof e.Condition){return{attribute:c.attribute,attributeLabel:c.attributeLabel};}return this._findAttributeOfCondition(c.conditions[0]);},_findAttributeLabelOfGroup:function(a){if(!a||!a.conditions){return'';}for(var i=0;i<a.conditions.length;i++){var b=a.conditions[i];if(b instanceof e.Condition){return b.attributeLabel;}else if(b instanceof e.ConditionGroup){return this._findAttributeLabelOfGroup(b);}}},addFilterCondition:function(a,o,b,c,d){var h;var l;if(typeof a==='object'){if(a instanceof e.Condition){h=a;l=h.attribute;}else if(a instanceof e.ConditionGroup){h=a;l=this._findAttributeOfCondition(h).attribute;}else{var i=a;if(i.conditions){h=this.sina.createFilterConditionGroup(i);l=this._findAttributeOfGroup(h);}else{h=this.sina.createFilterCondition(i.attribute,i.operator,i.value,i.attributeLabel,i.valueLabel);l=i.attribute;}}}else{if(a===undefined||o===undefined||b===undefined){return this;}h=this.sina.createFilterCondition(a,o,b,c,d);l=h.attribute;}if(this.defaultConditionGroup.hasCondition(h)){return this;}if(this.conditionGroupsByAttribute[l]===undefined){this.conditionGroupsByAttribute[l]=this.sina.createFilterConditionGroup({operator:'OR',label:this._findAttributeOfCondition(h).attributeLabel||''});this.defaultConditionGroup.addCondition(this.conditionGroupsByAttribute[l]);}this.conditionGroupsByAttribute[l].addCondition(h);return this;},setDefaultConditionGroup:function(d){this.defaultConditionGroup=d;this._initConditionGroupsByAttribute();},_initConditionGroupsByAttribute:function(){this.conditionGroupsByAttribute={};var c=this.defaultConditionGroup.getConditions();for(var i=0;i<c.length;++i){var a=c[i];var b=this._findAttributeOfCondition(a).attribute;this.conditionGroupsByAttribute[b]=a;}},empty:function(){this.resetFilterConditions();this.searchTerms='';return this;},hasFilterCondition:function(a,o,b){if(typeof a==='string'){a=this.sina.createFilterCondition(a,o,b);}return this.defaultConditionGroup.hasCondition(a);},resetFilterConditions:function(){this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:'DefaultRoot',operator:'And',sina:this.sina});return this;},removeFilterCondition:function(a,o,b,c,d){var h;var l;if(typeof a==='object'){if(a instanceof e.Condition){h=a;l=h.attribute;}else if(a instanceof e.ConditionGroup){h=a;l=this._findAttributeOfCondition(h).attribute;}else{var i=a;h=this.sina.createFilterCondition(i.attribute,i.operator,i.value,i.attributeLabel,i.valueLabel);l=i.attribute;}}else{if(a===undefined||o===undefined||b===undefined){return this;}h=this.sina.createFilterCondition(a,o,b,c,d);l=h.attribute;}this.defaultConditionGroup.removeCondition(h);var j=this.conditionGroupsByAttribute[l];if(j){j.removeCondition(h);if(j.conditions.length===0){delete this.conditionGroupsByAttribute[l];this.defaultConditionGroup.removeCondition(j);}}return this;},addFilterConditionGroup:function(c){this.addFilterCondition(c);},getFilterConditions:function(){return this.defaultConditionGroup;},getSearchTerms:function(){return this.searchTerms;},removeFilterConditionGroup:function(c){this.defaultConditionGroup.removeCondition(c);var a=c.conditions[0].attribute;if(this.conditionGroupsByAttribute[a]){this.conditionGroupsByAttribute[a].removeCondition(c);if(this.conditionGroupsByAttribute[a].conditions.length===0){delete this.conditionGroupsByAttribute[a];}}},setSearchTerms:function(a){this.searchTerms=a||'';},getDataSource:function(){return this.dataSource;},setDataSource:function(d){if(this.dataSource&&!this.dataSource.equals(d)){this.resetFilterConditions();}this.dataSource=d;},getJson:function(){return{dataSource:this.dataSource.getJson(),defaultConditionGroup:this.defaultConditionGroup.getJson(),searchTerms:this.searchTerms};},setJson:function(j){var d;this.empty();if(j.dataSource){var a=this.sina.createDataSource();a.setJson(j.dataSource);this.setDataSource(a);}this.setSearchTerms(j.searchTerms);if(typeof j.defaultConditionGroup==='object'){d=this.sina.createFilterConditionGroup(j.defaultConditionGroup);}if(d){this.setDefaultConditionGroup(d);}},clone:function(){var n=this.sina.createFilter();n.dataSource=this.dataSource;n.searchTerms=this.searchTerms;n.conditionGroupsByAttribute={};if(this.defaultConditionGroup&&this.defaultConditionGroup.clone){n.defaultConditionGroup=this.defaultConditionGroup.clone();for(var i=0;i<n.defaultConditionGroup.conditions.length;i++){var a=n.defaultConditionGroup.conditions[i];var b=this._getAttributeName(a);n.conditionGroupsByAttribute[b]=a;}}return n;},_getAttributeName:function(c){if(c.attribute){return c.attribute;}else{var a=c.conditions[0];return this._getAttributeName(a);}},equals:function(o){if(!(o instanceof e.Filter)){return false;}if(this.dataSource&&o.dataSource){if(!this.dataSource.equals(o.dataSource)){return false;}}else if(!this.dataSource&&o.dataSource){return false;}else if(this.dataSource&&!o.dataSource){return false;}if(this.searchTerms!==o.searchTerms){return false;}if(!this.defaultConditionGroup.equals(o.defaultConditionGroup)){return false;}return true;}};e.Condition.prototype={init:function(a,o,b,Y,c,d,l){if(typeof a==='object'){var h=a;a=h.attribute;o=h.operator;b=h.value;Y=h.sina;c=h.attributeLabel;d=h.valueLabel;l=h.label;}this.attribute=a||'';this.operator=o||'=';this.value=b;this.sina=Y;this.attributeLabel=c||'';this.valueLabel=d||'';this.label=l||'';},equals:function(o){if(!(o instanceof e.Condition)){return false;}return this.attribute===o.attribute&&this.operator===o.operator&&this.value===o.value;},toString:function(){return this.attributeLabel+this.operator+this.valueLabel+'';},getJson:function(){return{attribute:this.attribute,value:this.value,operator:this.operator,attributeLabel:this.attributeLabel,valueLabel:this.valueLabel,label:this.label};},setJson:function(j){if(!j.attribute||!j.value||!j.operator){throw'Following filter condition JSON does not have all necessary properties(attribute, value, operator): '+JSON.stringify(j);}this.attribute=j.attribute;this.value=j.value;this.operator=j.operator;this.attributeLabel=j.attributeLabel;this.valueLabel=j.valueLabel;this.label=j.label;},clone:function(){var n=this.sina.createFilterCondition();n.operator=this.operator;n.attribute=this.attribute;n.value=this.value;n.attributeLabel=this.attributeLabel;n.valueLabel=this.valueLabel;n.label=this.label;return n;}};e.ConditionGroup.prototype={init:function(a){a=a||{};this.label=a.label||'';this.setOperator(a.operator||'And');this.sina=a.sina;this.conditions=a.conditions||[];for(var i=0;i<this.conditions.length;i++){var b=this.conditions[i];if(typeof b==='object'){if(b.conditions){this.conditions[i]=this.sina.createFilterConditionGroup(b);}else{this.conditions[i]=this.sina.createFilterCondition(b);}}}},addCondition:function(c){if(c instanceof e.ConditionGroup||c instanceof e.Condition){this.conditions.push(c);return this;}throw'Condition of type '+typeof c+' can not be added to a filterConditionGroup';},equals:function(o){if(!(o instanceof e.ConditionGroup)){return false;}if(this.conditions.length!==o.conditions.length){return false;}for(var i=0,l=this.conditions.length;i<l;i++){var c=this.conditions[i];var a=false;for(var j=0,b=o.conditions.length;j<b;j++){var d=o.conditions[j];if(c.equals(d)){a=true;break;}}if(!a){return false;}}if(this.label!==o.label){return false;}return true;},getConditions:function(){return this.conditions;},getConditionsAsArray:function(a,c){c=c||[];a=a||this;for(var i=0;i<a.conditions.length;i++){if(a.conditions[i]instanceof e.ConditionGroup){this.getConditionsAsArray(a.conditions[i],c);}else{c.push(a.conditions[i]);}}return c;},hasCondition:function(c){for(var i=0,l=this.conditions.length;i<l;i++){var a=this.conditions[i];if(a instanceof e.ConditionGroup){if(c instanceof e.ConditionGroup){if(a.equals(c)){return true;}}else if(c instanceof e.Condition){if(a.hasCondition(c)){return true;}}}else if(a instanceof e.Condition){if(c instanceof e.ConditionGroup){if(c.hasCondition(a)){return true;}}else if(c instanceof e.Condition){if(a.equals(c)){return true;}}}}return false;},removeCondition:function(c){var a;for(var i=0,l=this.conditions.length;i<l;i++){a=this.conditions[i];if(a instanceof e.ConditionGroup){if(c instanceof e.ConditionGroup){if(a.equals(c)){this.conditions.splice(i,1);}}else if(c instanceof e.Condition){a.removeCondition(c);}}else if(a instanceof e.Condition){if(c instanceof e.ConditionGroup){c.removeCondition(a);}else if(c instanceof e.Condition){if(a.equals(c)){this.conditions.splice(i,1);}}}}for(var j=0,b=this.conditions.length;j<b;j++){a=this.conditions[j];if(a instanceof e.ConditionGroup&&a.conditions.length===0){this.conditions.splice(j,1);}}return this;},setLabel:function(l){this.label=l;return this;},setOperator:function(o){switch(o.toLowerCase()){case'or':o='Or';break;case'and':o='And';break;default:throw{message:'unknown operator for condition group: '+o};}this.operator=o;return this;},toString:function(){return this.label;},getJson:function(){var a=this;var b=function(){var c=[];for(var i=0;i<a.conditions.length;i++){c.push(a.conditions[i].getJson());}return c;};return{operator:this.operator,label:this.label,conditions:b()};},setJson:function(j){this.operator=j.operator;this.label=j.label||'';var a=j.conditions;for(var i=0;i<a.length;i++){var b=a[i];var c=null;if(b.attribute){c=this.sina.createFilterCondition();}else if(Object.prototype.toString.call(b.conditions)==='[object Array]'&&b.conditions.length>0){c=this.sina.createFilterConditionGroup();}else{throw'Following filter condition group JSON has neither attribute nor sub conditions:'+JSON.stringify(b);}c.setJson(b);this.conditions.push(c);}},clone:function(){var n=this.sina.createFilterConditionGroup();n.operator=this.operator;n.label=this.label;n.sina=this.sina;n.conditions=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];n.conditions.push(c.clone());}return n;}};return e;}();u=function(t,f){var e={};e.Filter=function(){this.init.apply(this,arguments);};e.Condition=function(){this.init.apply(this,arguments);};e.ConditionGroup=function(){this.init.apply(this,arguments);};e.Filter.prototype=f.extend(Object.create(t.Filter.prototype),{init:function(a){t.Filter.prototype.init.apply(this,[a]);},getDataForRequest:function(){var r=[];this.defaultConditionGroup.getDataForRequest(r);r[0].Selection.Operator=r[0].Selection.Operator||{'Code':'And'};r[0].Selection.Operator.SubSelections=r[0].Selection.Operator.SubSelections||[];r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ItemDetails'}});return r[0];},setJsonFromResponse:function(j){if(j.Selection===undefined){return;}var a=this.sina.createFilterConditionGroup();a.setJsonFromResponse(j);this.defaultConditionGroup.addCondition(a);}});e.Condition.prototype=f.extend(Object.create(t.Condition.prototype),{init:function(a,o,b,Y){t.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(a){var o;var j={};if(this.operator.toLowerCase()==='contains'){o='SearchOperand';}else{o='MemberOperand';}j[o]={'AttributeName':this.attribute,'Comparison':this.operator,'Value':this.value};if(o==='SearchOperand'){delete j[o].Comparison;}j[o]=f.extend({},j[o],this.inaV2_extended_properties);if(this.operator==='='&&this.value===null){j.MemberOperand.Comparison='IS NULL';j.MemberOperand.Value='';}a.push(j);},setJsonFromResponse:function(j){this.attribute=j.MemberOperand.AttributeName;this.operator=j.MemberOperand.Comparison;this.value=j.MemberOperand.Value;if(j.MemberOperand.Comparison==='IS NULL'&&j.MemberOperand.Value===''){this.operator='=';this.value=null;}}});e.ConditionGroup.prototype=f.extend(Object.create(t.ConditionGroup.prototype),{init:function(a){t.ConditionGroup.prototype.init.apply(this,[a]);},getDataForRequest:function(a){var r={Selection:{}};var c=[];if(this.conditions.length>0){for(var i=0;i<this.conditions.length;++i){this.conditions[i].getDataForRequest(c);}r.Selection={'Operator':{'Code':this.operator,'SubSelections':c}};}if(a){a.push(r);}else{return r;}},setJsonFromResponse:function(j){if(j.Selection===undefined&&j.Operator){j.Selection={};j.Selection.Operator=j.Operator;}this.setOperator(j.Selection.Operator.Code);var c=j.Selection.Operator.SubSelections;for(var i=0;i<c.length;i++){var a;if(c[i].Operator){a=this.sina.createFilterConditionGroup();}else{a=this.sina.createFilterCondition();}a.setJsonFromResponse(c[i]);this.addCondition(a);}}});return e;}(t,f);v=function(){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSourceMetaData=function(){this.init.apply(this,arguments);};e.DataSourceMetaData.prototype={init:function(){}};e.DataSourceType={CATEGORY:'Category',BUSINESSOBJECT:'BusinessObject'};e.DataSourceType.DEFAULT=e.DataSourceType.CATEGORY;e.DataSource.prototype={init:function(a){a=a||{};this.type=a.type||e.DataSourceType.DEFAULT;this.name=a.name||'';this.label=a.label||a.name;this.labelPlural=a.labelPlural||a.label;this.key='';this._constructKey();},equals:function(o){if(this.key!==o.key){return false;}return true;},clone:function(){},getMetaData:function(){if(this.equals(this.sina.getRootDataSource())){return null;}return this.sina.getBusinessObjectMetaData(this);},getMetaDataSync:function(){if(this.equals(this.sina.getRootDataSource())){return null;}return this.sina.getBusinessObjectMetaDataSync(this);},getType:function(){return this.type;},setType:function(a){this.type=a;},getLabel:function(){return this.label;},getLabelPlural:function(){return this.labelPlural;},getIdentifier:function(){},_constructKey:function(){this.key=this.type+'/'+this.name;},getJson:function(){return{'type':this.type,'name':this.name,'label':this.label,'labelPlural':this.labelPlural};},setJson:function(j){this.type=j.type||'';this.name=j.name||'';this.label=j.label||'';this.labelPlural=j.labelPlural||'';this._constructKey();}};return e;}();w=function(q,s,f){var e={};e.SuggestionQuery=function(){this.init.apply(this,arguments);};e.SuggestionQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);this.suggestionTypes=[s.SuggestionType.OBJECTDATA,s.SuggestionType.HISTORY,s.SuggestionType.DATASOURCE];},resetResultSet:function(){this._resetResultSet();return this;},setSuggestionTypes:function(a){this.suggestionTypes=a;this._resetResultSet();}});return e;}(q,s,f);x=function(f){var e={};e.Proxy=function(){this.init.apply(this,arguments);};e.inaReqResBuffer={};e.Proxy.prototype={init:function(a){this.properties=a||{};this.system=this.properties.system;this.xsrfToken='';this.xsrfService=this.properties.xsrfService;this.xsrfRetries=0;this.xsrfRequest={'headers':{'X-CSRF-Token':'Fetch'},'cache':false,'url':this.xsrfService};this.properties.httpMethod=this.properties.httpMethod||'post';this.properties.recordFile=this.properties.recordFile;this.properties.demoMode=this.properties.demoMode||'';if(typeof window!=='undefined'){this._checkRecordingURLValues();}},setSystem:function(y){this.system=y;},_checkRecordingURLValues:function(){function a(n){return decodeURI((new RegExp(n+'='+'(.+?)(&|$)').exec(window.location.search)||[null])[1]);}function h(n){if(window.location.search.toLowerCase().indexOf('&'+n.toLowerCase())!==-1){return true;}if(window.location.search.toLowerCase().indexOf('?'+n.toLowerCase())!==-1){return true;}return false;}if(h('record')){this.properties.recordFile=a('record');}if(h('demoMode')){this.properties.demoMode=a('demoMode');}},_requestHashValue:function(a,d){if(d){var b=a.indexOf('?')===-1?'?':'&';a=a+b+'Request=';if(typeof d==='string'){a+=d;}else{a+=JSON.stringify(d);}}return a;},_handleRequestFromRecords:function(r,a){var b=this;function _(d,h,j){if(typeof d==='string'){d=JSON.parse(d);}var k=d[b._requestHashValue(h,j)];if(k){return k;}else{var l=new Error('Could not find request hash '+b._requestHashValue(h,j)+' in record file '+a);if(r.async){return new f.Deferred().reject(l);}else{throw l;}}}if(r.async===false){if(!this.recordings){this.recordings=this._loadRecordings(a).responseText;this.recordings=JSON.parse(this.recordings);}var c={};if(Object.prototype.toString.call(this.recordings)==='[object Array]'){for(var i=0;i<this.recordings.length;i++){c[b._requestHashValue(this.recordings[i].requestUrl,this.recordings[i].requestData)]=this.recordings[i].responseData;}this.recordings=c;}return{responseText:JSON.stringify(_(this.recordings,r.url,r.data))};}return this._loadRecordingsAsync(r.async,a).then(function(d){return _(d,r.url,r.data);});},_loadRecordings:function(r){return this._ajax({async:false,dataType:'json',url:r});},_loadRecordingsAsync:function(a,r){var b=this;if(this.recordingsDefer){return this.recordingsDefer;}this.recordingsDefer=f.Deferred();var j=this._ajax({dataType:'json',url:r});j.done(function(c){var d={};if(Object.prototype.toString.call(c)==='[object Array]'){for(var i=0;i<c.length;i++){d[b._requestHashValue(c[i].requestUrl,c[i].requestData)]=c[i].responseData;}c=d;}b.recordingsDefer.resolve(c);});j.fail(function(c){b.recordingsDefer.resolve({});});return this.recordingsDefer;},_saveRecordingsAsync:function(r){var a=this;return this._ajax({type:'PUT',url:a.properties.recordFile,data:JSON.stringify(r)});},setXSRFService:function(a){this.xsrfService=a;this.xsrfRequest.url=a;},_getXSRFToken:function(){var a=this;if(!this.xsrfDeferred){this.xsrfRetries++;this.xsrfDeferred=this._ajax(this.xsrfRequest);this.xsrfDeferred.done(function(d){a.xsrfToken=a.xsrfDeferred.getResponseHeader('X-CSRF-Token')||a.xsrfToken||'';if(a.xsrfToken){a.xsrfRetries=0;}});}return this.xsrfDeferred.promise();},_requestWithXSRFToken:function(r){var a=this;if(r.async===false){if(this.xsrfDeferred&&this.xsrfDeferred.state()==='pending'){this.xsrfDeferred.abort();}this.xsrfRequest.async=false;this.xsrfDeferred=this._ajax(this.xsrfRequest);if(r.url===this.xsrfService){return this.xsrfDeferred;}this.xsrfToken=this.xsrfDeferred.getResponseHeader('X-CSRF-Token')||this.xsrfToken||'';r.headers={'X-CSRF-Token':this.xsrfToken};return this._ajax(r);}else{if(r.url===this.xsrfService){return this._getXSRFToken();}var d=f.Deferred();this._getXSRFToken().done(function(b){r.headers={'X-CSRF-Token':a.xsrfToken};a._ajax(r).done(function(b){d.resolve(b);}).fail(function(c,h,i){if(c.status===400){if(c.responseJSON&&c.responseJSON.Error&&c.responseJSON.Error.Code&&c.responseJSON.Error.Code===403){if(a.xsrfRetries<5){a.xsrfDeferred=null;a._requestWithXSRFToken(r).done(function(b){d.resolve(b);}).fail(function(c){d.reject(c);});}}else{d.reject(c);}}else{if(c.status>=200&&c.status<=299&&(h||i)){c.status=500;c.statusText=h;var j=h+': ';if(i&&i.stack){j=j+i.stack;}c.responseText=j;}d.reject(c);}});}).fail(function(b){d.reject(b);});return d.promise();}},_ajax:function(a){var d={async:true,dataType:'json',url:'',type:'GET',data:''};a=f.extend({},d,a);a.type=a.type.toUpperCase();if(this.system.user&&this.system.password&&this.system.host&&this.system.port){a.url=this.system.protocol+'://'+this.system.user+':'+this.system.password+'@'+this.system.host+':'+this.system.port+a.url;}if(typeof window==='undefined'){var b=this;var c=f.Deferred();c.getResponseHeader=function(n){n=n.toLowerCase();return b.responseHeaders[n];};var h=bluebird;var i=h.promisify(i);i=i.defaults({strictSSL:false,jar:true});h.promisifyAll(i);if(a.async===false){throw new Error('synchronous ajax calls are not supported by server side sina');}a.method=a.type;if(a.dataType==='json'){a.json=true;}if(a.method==='GET'){a.qs=a.data;}else if(a.method==='POST'){a.body=a.data;}var r=i(a);r.then(function(j){b.responseHeaders=j.headers;return c.resolve(j.body);});r.error(function(j){return c.reject(j);});return c;}else{if(a.type.toLowerCase()==='post'){a.data=JSON.stringify(a.data);}return f.ajax(a);}},ajax:function(r){var a=this;var j;if(this.properties.demoMode){j=this._handleRequestFromRecords(r,this.properties.demoMode);}else{r.processData=r.processData||false;r.type=r.type||this.properties.httpMethod||'POST';if(r.data&&!r.noXSRFToken){if(r.type.toLowerCase()==='get'){r.data='Request='+JSON.stringify(r.data);}}if(r.noXSRFToken){j=this._ajax(r);}else{j=this._requestWithXSRFToken(r);}}if(j&&j.done){j.done(function(b){if(a.properties.recordFile){a._recordResponseAsync(r,b,a.properties.recordFile);}});}return j;},_recordResponseAsync:function(r,a,b){a=f.extend(true,{},a);var c=this;this._loadRecordingsAsync(false,b).then(function(d){if(typeof d==='string'){d=JSON.parse(d);}d[c._requestHashValue(r.url,r.data)]=a;return d;}).then(function(d){if(b===c.properties.demoMode){throw'Recording: source file must not be the same as target file';}c._saveRecordingsAsync(d);});}};return e;}(f);y=function(x,f){var e={};e.System=function(){this.init.apply(this,arguments);};e.Service=function(){this.init.apply(this,arguments);};e.Capability=function(){this.init.apply(this,arguments);};e.Capability.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Capability||'';this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;}};e.Service.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Service;this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;this.capabilities={};for(var i=0;i<this.properties.Capabilities.length;i++){this.capabilities[this.properties.Capabilities[i].Capability]=new e.Capability(this.properties.Capabilities[i]);}},getCapability:function(n){return this.capabilities[n];},getCapabilities:function(){return this.capabilities;}};e.System.prototype={init:function(a){this.services={};this.host=a.host||'';this.port=a.port||'';this.user=a.user||'';this.password=a.password||'';this.protocol=a.protocol||'https';this.servicePath=a.servicePath||'';this.proxy=a.proxy||new x.Proxy({system:this});},_getUrlParameter:function(n){if(typeof window!=='undefined'){var a=window.location.href;var b=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(a)||[null])[1];if(!b){return b;}b=decodeURIComponent(b.replace(/\+/g,' '));return b;}return'';},getService:function(n){return this.services[n];},getServices:function(){return this.services;},getSystemType:function(){return this.systemType;},_deleteServerInfo:function(){if(this.jqXHR){this.jqXHR=f.Deferred();}},_getServerInfo:function(i){var a=this;if(this.jqXHR&&i){return this.jqXHR.promise();}if(this.jqXHR&&i===false){if(this.jqXHR.state()==='resolved'){return this.properties;}if(this.jqXHR.state()==='pending'){this.deprecatedJqXHR=f.extend({},this.jqXHR);}}this.jqXHR=f.Deferred();var r={async:i,type:'GET',url:this.infoUrl,getServerInfo:true,processData:false,contentType:'application/json',dataType:'json',error:function(j,c,d){throw new Error('Error while fetching GetServerInfo: '+j.statusText);}};if(i===true){this.proxy.ajax(r).done(function(d){a.setServerInfo(d);a.jqXHR.resolve(a.properties);if(a.deprecatedJqXHR){a.deprecatedJqXHR.resolve(a.properties);}}).fail(function(c){a.jqXHR.reject(c);if(a.deprecatedJqXHR){a.deprecatedJqXHR.reject(c);}});return this.jqXHR.promise();}var b=this.proxy.ajax(r);this.setServerInfo(JSON.parse(b.responseText));return this.properties;},getServerInfo:function(){return this._getServerInfo(true);},getServerInfoSync:function(){return this._getServerInfo(false);}};return e;}(x,f);A=function(x,f){var e={};e.Proxy=function(){this.init.apply(this,arguments);};e.Proxy.prototype=f.extend({},x.Proxy.prototype,{init:function(a){var b=this;b.properties=a||{};x.Proxy.prototype.init.apply(this,[a]);}});return e;}(x,f);B=function(b,w,y,x,f){var e={};e.ABAPSystem=function(){this.init.apply(this,arguments);};e.HANASystem=function(){this.init.apply(this,arguments);};e.ABAPSystem.prototype=f.extend({},y.System.prototype,{init:function(a){a=a||{};this.systemType='ABAP';this.inaUrl=a.inaUrl||'/sap/es/ina/GetResponse';this.infoUrl=a.infoUrl||'/sap/es/ina/GetServerInfo';a.proxy=a.proxy||new x.Proxy({'xsrfService':this.infoUrl,system:this});this.noSapClientFromUrl=a.noSapClientFromUrl;y.System.prototype.init.apply(this,[a]);this.properties={};if(a.sapclient){this.sapclient(a.sapclient);}else if(typeof window!=='undefined'){var c=this._readSapClientFromUrl();this.sapclient(c);}if(a.saplanguage){this.saplanguage(a.saplanguage);}else{var d=this._getUrlParameter('sap-language');this.saplanguage(d);}},setSinaUrlParameter:function(n,a){a=''+a;if(n.toUpperCase()==='SAP-CLIENT'&&a.length<3){for(var i=0;i<2;i++){a='0'+a;}}var c=function(d){var h=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(d)||[null])[1];if(!h){if(d.indexOf('?')===-1){d+='?'+encodeURIComponent(n)+'='+encodeURIComponent(a);}else{d+='&'+encodeURIComponent(n)+'='+encodeURIComponent(a);}}else{d=d.replace(n+'='+h,encodeURIComponent(n)+'='+encodeURIComponent(a));}return d;};this.infoUrl=c(this.infoUrl);this.inaUrl=c(this.inaUrl);},_readSapClientFromUrl:function(){if(typeof this.noSapClientFromUrl!=='undefined'&&this.noSapClientFromUrl===true){return'';}return this._getUrlParameter('sap-client');},sapclient:function(a){if(a){this.properties.sapclient=a;this.setSinaUrlParameter('sap-client',this.properties.sapclient);this._deleteServerInfo();}else{return this.properties.sapclient;}},saplanguage:function(l){if(l){this.properties.saplanguage=l;this.setSinaUrlParameter('sap-language',this.properties.saplanguage);}else{return this.properties.saplanguage;}},setServerInfo:function(j){this.properties.rawServerInfo=j;if(this instanceof e.ABAPSystem){this.properties.dbms=j.ServerInfo.DataBaseManagementSystem;this.properties.sapclient=j.ServerInfo.Client;this.properties.saplanguage=j.ServerInfo.UserLanguageCode;this.properties.systemid=j.ServerInfo.SystemId;}var a;for(var i=0;i<j.Services.length;i++){var c=j.Services[i];switch(c.Service){case'Suggestions2':c.Service='Suggestions';a=new e.SuggestionService(c);break;default:a=new y.Service(c);}this.services[c.Service]=a;}this.properties.services=this.services;}});e.HANASystem.prototype=f.extend({},y.System.prototype,{init:function(a){a=a||{};this.systemType='HANA';this.infoUrl=a.infoUrl||'/sap/bc/ina/service/v2/GetServerInfo';this.inaUrl=a.inaUrl||'/sap/bc/ina/service/v2/GetResponse';a.proxy=a.proxy||new x.Proxy({'xsrfService':this.infoUrl});y.System.prototype.init.apply(this,[a]);this._setUpAjaxErrorHandler();}});e.SuggestionService=function(){this.init.apply(this,arguments);};e.SuggestionService.prototype=f.extend(Object.create(y.Service.prototype),{init:function(a){y.Service.prototype.init.apply(this,arguments);var c=false;for(var j=0;j<a.Capabilities.length;++j){var d=a.Capabilities[j];if(d.Capability==='ScopeTypes'){c=true;}}if(c){this.suggestionTypes=[b.SuggestionType.OBJECTDATA,b.SuggestionType.HISTORY,b.SuggestionType.DATASOURCE];}else{this.suggestionTypes=[b.SuggestionType.OBJECTDATA];}}});return e;}(s,w,y,A,f);C=function(b,f){var e={};e.Query=function(){this.init.apply(this,arguments);};e.Query.prototype=f.extend({},{init:function(a){this.filter=a.filter||a.sina.createFilter({dataSource:a.dataSource});this.system=a.system;},_resetResultSet:function(){this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},_getInAV2Error:function(d){var a=[];if(d&&d.error){a.push(new b.SinaError({message:'INA V2 Service Error '+d.error.code+': '+d.error.message,errorCode:d.error.code}));}if(d&&d.Messages){for(var i=0;i<d.Messages.length;i++){if(d.Messages[i].Type>=2){a.push(new b.SinaError({message:'INA V2 Service Error '+d.Messages[i].Number+': '+d.Messages[i].Text,errorCode:d.Messages[i].Number}));}}}return a;},setDataSource:function(d){if(d===undefined){return this;}d=this.sina.createDataSource(d);if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},execute:function(){var a=this;var j=a.createJsonRequest();var d=f.Deferred();this.serverInfojqXHR=this.system.getServerInfo();this.serverInfojqXHR.fail(function(c){d.reject(c);});this.serverInfojqXHR.done(function(c){if(!a.jqXHR){a.jqXHR=a._fireRequest(j,true);}a.jqXHR.done(function(h){var i=a._getInAV2Error(h);if(h&&i&&i.length>0){if(h.error){d.reject(i[0]);return;}else if(h.Messages){if(i.length>=h.Messages.length){d.reject(i);return;}}}a.resultSetProperties.sina=a.sina;a.resultSetProperties.query=a;var r=new a.resultSetClass(a.resultSetProperties);r.setJsonFromResponse(h);d.resolve(r);}).fail(function(h){d.reject(h);}).always(function(h){a._responseJson=h;});});return d.promise();},executeSync:function(){var a=this;if(a.resultSet!==null){return a.resultSet;}var j=a.createJsonRequest();a.system.getServerInfoSync();var d=JSON.parse(a._fireRequest(j,false).responseText);a._responseJson=d;a.resultSet=new a.resultSetClass(a.resultSetProperties);if(d){var c=a._getInAV2Error(d);if(c&&c.length>0){throw c[0];}a.resultSet.setJsonFromResponse(d);}return a.resultSet;},_fireRequest:function(d,a,c){a=a===undefined?true:a;var r={async:a,url:this.system.inaUrl,contentType:'application/json',dataType:c||'json',data:d};var j=this.system.proxy.ajax(r);return j;},_assembleOrderBy:function(){var o=[];function a(d,h){var i={};if(d.toLowerCase()==='$$score$$'){i.Function='Score';}else{i.AttributeName=d;}i.SortOrder=h.toUpperCase();return i;}var c;if(Object.prototype.toString.call(this.orderBy)==='[object Array]'){for(var j=0;j<this.orderBy.length;j++){c=a(this.orderBy[j].orderBy,this.orderBy[j].sortOrder);o.push(c);}}else if(typeof this.orderBy==='object'&&this.orderBy.orderBy){c=a(this.orderBy.orderBy,this.orderBy.sortOrder);o.push(c);}return o;}});return e;}(s,f);D=function(s,g,a,b,d,f){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},g.SearchQuery.prototype,b.Query.prototype,{init:function(c){c=c||{};b.Query.prototype.init.apply(this,[c]);g.SearchQuery.prototype.init.apply(this,[c]);this.sqlSearch=c.sqlSearch===undefined||c.sqlSearch===true?true:false;this.attributes=c.attributes||[];c.orderBy=c.orderBy||{};this.setOrderBy(c.orderBy);this.resultSetClass=e.SearchResultSet;},addResponseAttribute:function(c){this.attributes.push(c);this._resetResultSet();return this;},createJsonRequest:function(){var c=d.getSearchRequest();c.DataSource=this.filter.dataSource.getDataForRequest();if(this.system instanceof inaV2System.HANASystem){if(this.attributes.length===0){throw{message:'Add at least one response attribute to your query'};}if(this.sqlSearch===true){c.Options=['SqlSearch'];}}var h=[];for(var i=0;i<this.attributes.length;++i){var j=this.attributes[i];if(f.type(j)==='string'){h.push({Name:j,AttributeName:j});}else if(f.type(j)==='object'){var k={Name:j.name||j.attributeName,AttributeName:j.attributeName||j.name};if(j.highlighted===true){k.Function='Highlighted';}if(j.snippet===true){k.Function='Snippet';}if(j.startPosition!==undefined){k.StartPosition=j.startPosition;}if(j.maxLength!==undefined){k.MaxLength=j.maxLength;}h.push(k);}}c.Search.SelectedValues=h;var l=this.filter.getSearchTerms();if(!l){l='*';}c.SearchTerms=l;c.Search.Top=this._top;c.Search.Skip=this._skip;c.Search.Filter=this.filter.getDataForRequest();c.Search.OrderBy=this._assembleOrderBy();return c;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};},getOrderBy:function(){return this.orderBy;}});e.SearchResultSet=function(){this.init.apply(this,arguments);};e.SearchResultSet.prototype={init:function(c){c=c||{};this.sina=c.sina;this.elements=[];this.totalcount=0;},toString:function(r){var c=this.elements;var h=[];var i;for(i=0;i<c.length;++i){var j=c[i];var k={};for(var l in j){if(l.slice(0,2)==='$$'||l.slice(0,1)==='_'){continue;}var m=j[l];if(!m.label||!m.value){continue;}var n={label:m.label,value:m.value};k[l]=n;}h.push(k);}return JSON.stringify(h);},setJsonFromResponse:function(h){var r=this;this.elements=[];function Z(){this.type='';this.platform='';this.technology='';this.width='';this.height='';this.variant='';this.uri='';}Z.prototype={_fromInaJson:function(k){this.type=k.Type||'';this.platform=k.Platform||'';this.technology=k.Technology||'';this.width=k.Width||'';this.height=k.Height||'';this.variant=k.Variant||'';this.uri=k.Uri||'';}};function _(){this.type='';this.description='';this.uri='';this.request=null;this.encodedJSON='';}_.prototype={_fromInaJson:function(k){var l=this;l.description=k.Description;l.uri=k.Uri;switch(k.Type){case'RelatedRequest':l.type='Search';var m={};m.dataSource=r.sina.createDataSource();m.dataSource.setJsonFromResponse(k.Request.DataSource);m.system=r.sina.getSystem();m.top=1;l.request=r.sina.createSearchQuery(m);l.request.filter.setJsonFromResponse(k.Request.Filter);if(k.Request.Filter.Selection===undefined){l.request.invalid=true;l.request.invalidMessage='Related request \''+l.description+'\' is invalid because of missing filter conditions.';}break;case'GeneralUri':l.type='Link';l.url=l.uri;break;case'SAPNavigation':l.type='Navigation';l.url=l.uri;break;}l.encodedJSON=encodeURIComponent(l);}};function a1(k){this.resultElementAttribute=k;this.correspondingSearchAttributeName='';this.description='';this.isTitle=false;this.presentationUsage=[];this.displayOrder=null;this.semanticObjectType='';this.isSortable=false;}a1.prototype={_fromInaJson:function(k){var l=this;l.correspondingSearchAttributeName=k.correspondingSearchAttributeName||'';l.dataType=k.DataType||'';l.description=k.Description||'';l.presentationUsage=k.presentationUsage||[];l.accessUsage=k.accessUsage||[];l.semanticObjectType=k.SemanticObjectType||'';l.isSortable=k.IsSortable||false;if(k.IsTitle!==undefined){l.isTitle=k.IsTitle;}l.isKey=k.IsKey;if(l.isTitle){if(!l.resultElementAttribute.resultElement.title){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.getLabel()+':';}l.resultElementAttribute.resultElement._registerPostProcessor(function(){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.title+' '+l.resultElementAttribute.value;});}if(l.isKey){if(!l.resultElementAttribute.resultElement.key){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.key+':';}l.resultElementAttribute.resultElement._registerPostProcessor(function(){if(l.resultElementAttribute.labelRaw&&l.resultElementAttribute.value){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.key+l.resultElementAttribute.labelRaw+'#'+l.resultElementAttribute.value+'/';}});}}};function b1(k){this.resultElement=k;this.$$MetaData$$=new a1(this);this.label='';this.labelRaw='';this.value='';this.valueRaw='';}b1.prototype={_fromInaJson:function(k){var l=this;l.labelRaw=this.$$MetaData$$.correspondingSearchAttributeName||k.Name||'';l.label=this.$$MetaData$$.description||k.Name||'';l.valueRaw=k.Value||null;l.value=k.ValueFormatted||null;},toString:function(){return this.value;}};function c1(){this.title='';this.$$DataSourceMetaData$$={};this.$$RelatedActions$$={};this.$$RenderingTemplateSpecification$$={};this.$$WhyFound$$=[];this.$$PostProcessors$$=[];}c1.prototype={_fromInaJson:function(l1){var r1=this;var s1=null;var t1=null;for(var k=0;k<l1.length;++k){var u1=l1[k];switch(u1.Name){case'$$DataSourceMetaData$$':var v1=u1.Value[0];s1=r.sina.createDataSource(f.extend(true,{},v1));r1.$$DataSourceMetaData$$=s1;break;case'$$AttributeMetadata$$':for(var m=0;m<u1.Value.length;++m){t1=u1.Value[m];if(!r1[t1.Name]){r1[t1.Name]=new b1(r1);}r1[t1.Name].$$MetaData$$._fromInaJson(t1);r1[t1.Name].$$MetaData$$.displayOrder=m;}break;case'$$ResultItemAttributes$$':for(var l=0;l<u1.Value.length;++l){var w1=u1.Value[l];if(!r1[w1.Name]){r1[w1.Name]=new b1(r1);}r1[w1.Name]._fromInaJson(w1);}break;case'$$RelatedActions$$':var x1={};for(var n=0;n<u1.Value.length;++n){var y1=u1.Value[n];var z1=new _();z1._fromInaJson(y1);x1[y1.ID]=z1;}r1.$$RelatedActions$$=x1;break;case'$$RenderingTemplateSpecification$$':for(var o=0;o<u1.Value.length;++o){var A1=new Z();A1._fromInaJson(u1.Value[o]);if(A1.type==='ItemDetails'){r1._detailTemplate=A1;}else{r1.$$RenderingTemplateSpecification$$=A1;}}break;case'$$WhyFound$$':for(var z=0;z<u1.Value.length;++z){var B1={};B1.label=u1.Value[z].Description;B1.labelRaw=u1.Value[z].Name;B1.value=u1.Value[z].Value;B1.valueHighlighted=B1.value;B1.valueRaw=u1.Value[z].Value;r1.$$WhyFound$$.push(B1);}break;default:r1[u1.Name]=new b1();r1[u1.Name].label=u1.Name||'';r1[u1.Name].valueRaw=u1.Value||u1.ValueFormatted||null;r1[u1.Name].value=u1.ValueFormatted||u1.Value||null;}}for(var i=0;i<this.$$PostProcessors$$.length;i++){this.$$PostProcessors$$[i]();}var C1=s.Sina.prototype.ResultElementKeyStatus;if(this.key){if(this.key.indexOf(':')===this.key.length-1){this.keystatus=C1.NO_VALUE;}else{this.keystatus=C1.OK;}}else{this.keystatus=C1.NO_KEY;this.key='';}},_registerPostProcessor:function(k){this.$$PostProcessors$$.push(k);}};function d1(h1){if(h1._detailTemplate&&!h1.$$RelatedActions$$.$$DETAILS$$){h1.$$RelatedActions$$.$$DETAILS$$={request:r.sina.createSearchQuery(),description:'',encodedJSON:'',type:'Search',uri:''};}if(h1._detailTemplate&&h1.$$RelatedActions$$.$$DETAILS$$){var k=new e.SearchResultSet({sina:r.sina});k.elements[0]=f.extend(true,{},h1);k.elements[0].$$RenderingTemplateSpecification$$=h1._detailTemplate;k.totalcount=1;delete k.elements[0].$$RelatedActions$$.$$DETAILS$$;h1.$$RelatedActions$$.$$DETAILS$$.request.resultSet=k;return k.elements[0];}return{};}var e1={};if(!h.ItemLists){return{};}for(var i=0;i<h.ItemLists.length;i++){e1[h.ItemLists[i].Name]=h.ItemLists[i];if(h.ItemLists[i].Name.toLowerCase()==='searchresult'){this.totalcount=h.ItemLists[i].TotalCount.Value;}}var f1;if(h&&h.Grids&&h.Grids[0]&&h.Grids[0].Axes&&h.Grids[0].Axes[0]){f1=h.Grids[0].Axes[0];}else{return{};}for(var j=0;j<f1.Tuples.length;j++){var g1=f1.Tuples[j];if(g1===undefined){continue;}var h1=new c1();for(var c=g1.length-1;c>=0;c--){var i1=f1.Dimensions[c];var j1=g1[c];var k1=e1[i1.ItemListName];var l1=k1.Items[j1].NamedValues;h1._fromInaJson(l1);}if(f1&&f1.Dimensions[1]){var m1=f1.Dimensions[1];var n1=e1[m1.ItemListName];var o1=g1[1];if(n1&&n1.Items&&n1.Items[o1]){var p1=n1.Items[o1].NamedValues[2];if(p1){h1=this._postProcess4WhyFound(h1,p1.Value);}}}var q1=d1(h1);this._postProcessRelatedAction(h1);if(q1){this._postProcessRelatedAction(q1);}this.elements.push(h1);var v=h1.$$DataSourceMetaData$$;if(v&&v.getObjectName&&v.getObjectName().value!=='$$DataSources$$'&&v.getObjectName().value!=='$$All$$'){this.sina.setBusinessObjectMetaDataSync(v,h1);}}return{};},getElements:function(){return this.elements;},_postProcessRelatedAction:function(c){if(!c.$$RelatedActions$$){return;}for(var r in c.$$RelatedActions$$){var h=c.$$RelatedActions$$[r];if(h.type==='Search'){this.sina._postprocess(h,c.title);}}},_postProcess4WhyFound:function(c,m){if(c.$$WhyFound$$&&c.$$WhyFound$$.length>0){var i=c.$$WhyFound$$.length;while(i--){if(c[c.$$WhyFound$$[i].labelRaw]!==undefined&&m!==undefined){var j=m.length;while(j--){if(m[j].Name===c.$$WhyFound$$[i].labelRaw&&m[j].correspondingSearchAttributeName){c.$$WhyFound$$[i].labelRaw=m[j].correspondingSearchAttributeName;}}}}}return c;}};return e;}(s,g,B,C,p,f);E=function(g,v,a,j,f){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSourceMetaData=function(){this.init.apply(this,arguments);};e.DataSourceQuery=function(){this.init.apply(this,arguments);};e.ESHConnectorDataSourceQuery=function(){this.init.apply(this,arguments);};e.DataSource.prototype=f.extend(Object.create(v.DataSource.prototype),{init:function(b){v.DataSource.prototype.init.apply(this,[b]);if(!b){return{};}var d;if(b.key){this.key=b.key;d=true;}b.schemaName=b.schemaName||b.SchemaName||{label:'',value:''};this.setSchemaName(b.schemaName,d);b.packageName=b.packageName||b.PackageName||'ABAP';this.setPackageName(b.packageName,d);b.objectName=b.objectName||b.ObjectName||{label:'',value:''};this.setObjectName(b.objectName,d);this.setType(b.type||b.Type||v.DataSourceType.DEFAULT,d);this.label=b.label||b.Label||b.Description||'';this.labelPlural=b.labelPlural||b.LabelPlural||b.DescriptionPlural||this.label||'';this.semanticObjectType=b.semanticObjectType||b.SemanticObjectType||'';this.systemId=b.systemId||b.SystemId||'';this.client=b.client||b.Client||'';this.sina=b.sina||null;if(b.metaData){this.setMetaData(b.metaData);}if(!this.key){throw'Datasource has no key'+JSON.stringify(b);}},setMetaData:function(d){this.metaData=d;},getIdentifier:function(){return this.key;},getSchemaName:function(){if(!this.schemaName){this.schemaName={label:'',value:''};}return this.schemaName;},_getSchemaNameAsString:function(){if(typeof this.schemaName==='object'){return this.schemaName.value;}if(typeof this.schemaName==='string'){return this.schemaName;}return'';},setSchemaName:function(b,d){if(!this.schemaName){this.schemaName={};}if(typeof b==='object'){this.schemaName.label=b.label||b.value||'';this.schemaName.value=b.value||'';}if(typeof b==='string'){this.schemaName.label=b;this.schemaName.value=b;}if(d!==true){this._constructKey();}},getPackageName:function(){if(!this.packageName){this.packageName={label:'',value:''};}return this.packageName;},getPackageNameAsString:function(){if(typeof this.packageName==='object'){return this.packageName.value;}if(typeof this.packageName==='string'){return this.packageName;}return'';},setPackageName:function(b,d){if(!this.packageName){this.packageName={};}if(typeof b==='object'){this.packageName.label=b.label||b.value||'';this.packageName.value=b.value||'';}if(typeof b==='string'){this.packageName.label=b;this.packageName.value=b;}if(d!==true){this._constructKey();}},getObjectName:function(){if(!this.objectName){this.objectName={label:'',value:''};}return this.objectName;},setObjectName:function(o,d){if(!this.objectName){this.objectName={};}if(typeof o==='object'){this.objectName.label=o.label||o.value||'';this.objectName.value=o.value||'';}if(typeof o==='string'){this.objectName.label=o;this.objectName.value=o;}if(d!==true){this._constructKey();}},_constructKey:function(){this.key=this.getTypeAsString()+'/'+this.getPackageNameAsString()+'/'+this.getObjectNameAsString();},setObjectNameValue:function(b,d){if(!this.objectName){this.objectName={};}this.objectName.value=b||'';if(d!==true){this._constructKey();}},setObjectNameLabel:function(l){if(!this.objectName){this.objectName={};}this.objectName.label=l||'';if(!this.label){this.setLabel(l);}if(!this.labelPlural){this.setLabelPlural(l);}},getObjectNameAsString:function(){if(typeof this.objectName==='object'){return this.objectName.value;}if(typeof this.objectName==='string'){return this.objectName;}return'';},setType:function(b,d){var c=v.DataSourceType.DEFAULT;if(typeof b==='object'){if(b.value.toLowerCase()==='view'||b.value.toLowerCase()==='businessobject'){c=v.DataSourceType.BUSINESSOBJECT;}else{c=v.DataSourceType.DEFAULT;}}else{if(b.toLowerCase()==='view'||b.toLowerCase()==='businessobject'){c=v.DataSourceType.BUSINESSOBJECT;}else{c=v.DataSourceType.DEFAULT;}}this.type=c;if(d!==true){this._constructKey();}},getTypeAsString:function(){if(typeof this.type==='object'){return this.type.value;}if(typeof this.type==='string'){return this.type;}return'';},getLabel:function(){if(typeof this.label!=='undefined'&&this.label!==''){return this.label;}if(typeof this.getObjectName().label!=='undefined'&&this.getObjectName().label!==''){return this.getObjectName().label;}if(typeof this.getObjectName().value!=='undefined'&&this.getObjectName().value!==''){return this.getObjectName().value;}return'';},setLabel:function(l){this.label=l||'';this.labelPlural=this.labelPlural||this.label;},getLabelPlural:function(){if(typeof this.labelPlural!=='undefined'&&this.labelPlural!==''){return this.labelPlural;}return this.getLabel();},setLabelPlural:function(l){this.labelPlural=l||'';},setJsonFromResponse:function(i){this.setSchemaName({value:i.SchemaName,label:i.SchemaLabel});this.setPackageName({value:i.PackageName,label:i.PackageLabel});this.setObjectName({value:i.ObjectName,label:i.ObjectLabel});this.setType({value:i.Type,label:''});},getDataForRequest:function(){var b={'SchemaName':this.getSchemaName().value,'PackageName':this.getPackageName().value,'ObjectName':this.getObjectName().value};if(this.getType()===v.DataSourceType.BUSINESSOBJECT){b.Type='View';}else{b.Type=this.getType();}return b;},clone:function(){var n=this.sina.createDataSource();n.setSchemaName(this.schemaName);n.setPackageName(this.packageName);n.setObjectName(this.objectName);n.setType(this.type);n.label=this.label;n.labelPlural=this.labelPlural;n.semanticObjectType=this.semanticObjectType;n.systemId=this.systemId;n.client=this.cliet;n.setMetaData(this.metaData);n.key=this.key;return n;},setJson:function(b){for(var c in b){if(b.hasOwnProperty(c)){b[c.toLowerCase()]=b[c];}}this.schemaName=b.schemaname;this.packageName=b.packagename;this.objectName=b.objectname;if(b.Type==='View'){this.setType(v.DataSourceType.BUSINESSOBJECT);}else{this.setType(b.type);}this.label=b.label;this.labelPlural=b.labelplural;this.semanticObjectType=undefined;this.systemId=undefined;this.client=undefined;this.metaData=undefined;this._constructKey();},getJson:function(){var b={'label':this.label,'labelPlural':this.labelPlural,'SchemaName':{'label':this.getSchemaName().label,'value':this.getSchemaName().value},'PackageName':{'label':this.getPackageName().label,'value':this.getPackageName().value},'ObjectName':{'label':this.getObjectName().label,'value':this.getObjectName().value}};b.Type=this.getType();return b;}});e.DataSourceQuery.prototype=f.extend({},g.SearchQuery.prototype,a.SearchQuery.prototype,{init:function(b){g.SearchQuery.prototype.init.apply(this,[b]);a.SearchQuery.prototype.init.apply(this,[b]);this.template=j.getCatalogRequest();this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();var c={'MemberOperand':{'AttributeName':'Type','Comparison':'=','Value':'View'}};this.template.Search.Filter.Selection.Operator.SubSelections.push(c);},createJsonRequest:function(){return this.template;}});e.ESHConnectorDataSourceQuery.prototype=f.extend({},g.SearchQuery.prototype,a.SearchQuery.prototype,{init:function(b){g.SearchQuery.prototype.init.apply(this,[b]);a.SearchQuery.prototype.init.apply(this,[b]);this.template=j.getESHConnectorRequest();var c=this.system.getServerInfoSync();var d=c.rawServerInfo.ServerInfo.SystemId;var h=d+this.system.sapclient()+'~ESH_CONNECTOR~';var i=b.dataSource||{SchemaName:'',PackageName:'ABAP',ObjectName:h,type:'Connector'};this.template.DataSource=i;this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();},createJsonRequest:function(){return this.template;}});return e;}(g,v,D,p,f);F=function(q,f){var e={};e.ChartQuery=function(){this.init.apply(this,arguments);};e.ChartQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);}});return e;}(q,f);G=function(s,a,q,w,f){var e={};e.Perspective=function(){this.init.apply(this,arguments);};e.Perspective.prototype={init:function(b){var c=this;c.sina=b.sina;c.chartFacets=[];c.searchFacet=null;c.layout=null;c.dataSource=b.dataSource||null;b=b||{};},getSearchResultSet:function(){return this.searchFacet.getQuery().getResultSetSync();},getChartFacets:function(){return this.chartFacets;},getSearchFacet:function(){return this.searchFacet;},getLayout:function(){return this.layout;}};e.PerspectiveQuery=function(){this.init.apply(this,arguments);};e.PerspectiveQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);this.facets=[];this.requestedEntities=['SearchResults','Facets','TotalCount'];this.facetLoader=new e.FacetLoader({sina:this.sina});this.includeFacetsWithFilters=false;},addFacet:function(b){this.facets.push(b);return this;},getFacets:function(){return this.facets;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};return this;},getOrderBy:function(){return this.orderBy;},setRequestedEntities:function(r){if(JSON.stringify(r)===JSON.stringify(this.requestedEntities)){return;}this.requestedEntities=r;this._resetResultSet();},getRequestedEntities:function(){return this.requestedEntities;},setIncludeFacetsWithFilters:function(i){if(i===this.includeFacetsWithFilters){return;}this.includeFacetsWithFilters=i;this._resetResultSet();},_resetResultSet:function(){this.resultSetAndFacetsPromise=null;},getResultSet:function(o,b){var c=this;if(!this.includeFacetsWithFilters){return q.Query.prototype.getResultSet.apply(this,arguments);}if(c.resultSetAndFacetsPromise){if(o){c.resultSetAndFacetsPromise.done(o);}if(b){c.resultSetAndFacetsPromise.fail(b);}return c.resultSetAndFacetsPromise;}var d=q.Query.prototype.getResultSet.apply(this,[]);var h=this.facetLoader.loadFacets(this.filter);c.resultSetAndFacetsPromise=f.when(d,h).then(function(i,j){c.addFacetsToPerspective(i,j);return i;});if(o){c.resultSetAndFacetsPromise.done(o);}if(b){c.resultSetAndFacetsPromise.fail(b);}return c.resultSetAndFacetsPromise;},addFacetsToPerspective:function(b,c){for(var i=0;i<c.length;++i){var d=c[i];var h=false;var j;for(j=0;j<b.chartFacets.length;++j){var k=b.chartFacets[j];if(k.getDimension()===d.getDimension()){h=true;break;}}if(h){d.title=b.chartFacets[j].title;b.chartFacets.splice(j,1,d);}else{b.chartFacets.push(d);}}}});e.FacetLoader=function(){this.init.apply(this,arguments);};e.FacetLoader.prototype={init:function(b){this.sina=b.sina;},loadFacets:function(t){var b=this;var c=this.collectAttributes(t);c=c.filter(function(h){if(h.slice(0,2)==='$$'){return false;}return true;});var d=[];for(var i=0;i<c.length;++i){var h=c[i];d.push(this.createChartQuery(h,t));}var k=[];for(var j=0;j<d.length;j++){k.push(d[j].getResultSet());}return f.when.apply(f.Deferred,k).then(function(){var l=[];for(var i=0;i<arguments.length;++i){l.push(b.sina.createFacet({dimension:c[i],query:d[i],facetType:s.FacetType.ATTRIBUTE,sina:b.sina,title:d[i].getTitle()}));}return l;});},collectAttributes:function(t){var c=t.getFilterConditions();var b={};var d=[];this.doCollectAttributes(c,b);for(var h in b){if(b.hasOwnProperty(h)){d.push(h);}}return d;},doCollectAttributes:function(c,b){if(!(c instanceof a.ConditionGroup)){b[c.attribute]=true;}else{var d=c.getConditions();for(var i=0;i<d.length;++i){c=d[i];this.doCollectAttributes(c,b);}}},createChartQuery:function(b,t){t=t.clone();this.removeFilterConditionsByAttribute(t,b);var c=this.sina.createChartQuery();c.setFilter(t);c.addDimension(b);c.setAttributeLimit(5);return c;},removeFilterConditionsByAttribute:function(t,b){var c=t.getFilterConditions();if(!(c instanceof a.ConditionGroup)){if(c.attribute===b){t.resetFilterConditions();return;}else{return;}}this.doRemoveFilterConditionsByAttribute(b,c);},doRemoveFilterConditionsByAttribute:function(b,c){var d=c.getConditions();for(var i=0;i<d.length;++i){var h=d[i];if(!(h instanceof a.ConditionGroup)){if(h.attribute===b){d.splice(i,1);i--;}}else{this.doRemoveFilterConditionsByAttribute(b,h);}}}};return e;}(s,t,q,w,f);H=function(b){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype={init:function(a){a=a||{};this.sina=a.sina;this.dataSource=a.dataSource||null;this.title=a.title||'';this.query=a.query||null;this.dimension=a.dimension||null;a.facetType=a.facetType||'';this.facetType=a.facetType.toLowerCase();if(a.query){this.setQuery(a.query);}},getChartType:function(){},getTitle:function(){return this.title;},getDimension:function(){return this.dimension;},getQuery:function(){return this.query;},getLayout:function(){},getLayoutBinding:function(){},getColorPalette:function(){},setQuery:function(a){this.query=a;}};return e;}(s);I=function(s,q,G,H,a,b,f){var c={};c.PerspectiveQuery=function(){this.init.apply(this,arguments);};c.PerspectiveQuery.prototype=f.extend({},G.PerspectiveQuery.prototype,a.Query.prototype,{init:function(d){var e=this;e.chartFacets=[];e.searchFacet=null;e.searchresultset=null;e.layout=null;e.templateFactsheet=d.templateFactsheet||false;d=d||{};a.Query.prototype.init.apply(this,arguments);G.PerspectiveQuery.prototype.init.apply(this,arguments);d.orderBy=d.orderBy||{};this.setOrderBy(d.orderBy);this.resultSetClass=c.Perspective;this.resetFilterConditions();},_resetResultSet:function(){a.Query.prototype._resetResultSet.apply(this,arguments);G.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);},getExpand:function(){var e=[];for(var i=0;i<this.requestedEntities.length;i++){switch(this.requestedEntities[i]){case'SearchResults':e.push('Grid','Items');break;case'Facets':e.push('ResultsetFacets');break;case'TotalCount':e.push('TotalCount');break;default:throw'Unknown requested entity!';}}return e;},resetFilterConditions:function(){q.Query.prototype.resetFilterConditions.apply(this,arguments);},createJsonRequest:function(){var d=b.getPerspectiveRequest();if(this.templateFactsheet){d=b.getPerspectiveRequestFactsheet();}d.DataSource=this.filter.dataSource.getDataForRequest();var e=this.filter.getSearchTerms();d.Search.SearchTerms=e;d.Search.Top=this._top;d.Search.Skip=this._skip;d.Search.Filter=this.filter.getDataForRequest();d.Search.OrderBy=this._assembleOrderBy();d.Search.Expand=this.getExpand();if(this.facetOptions){d.Facets=this.facetOptions;}d.Options=d.Options.concat(this.options);return d;},getPerspective:function(o,d){this.getResultSet(o,d);},generatePerspectiveSync:function(){return this.getResultSetSync();}});c.Perspective=function(){this.init.apply(this,arguments);};c.Perspective.prototype=f.extend({},G.Perspective.prototype,{determineFacetType:function(r){try{if(r.ResultSet.ItemLists[0].Items[0].NamedValues[0].Name==='$$DataSource$$'){return s.FacetType.DATASOURCE;}else{return s.FacetType.ATTRIBUTE;}}catch(e){return s.FacetType.ATTRIBUTE;}},setJsonFromResponse:function(d){var e=this;e.searchFacet=this.sina.createFacet({'facetType':'searchresult'});e.searchFacet.setJsonFromResponse(d);if(d.ResultsetFacets&&d.ResultsetFacets.Elements){for(var j=0;j<d.ResultsetFacets.Elements.length;j++){var h=e.determineFacetType(d.ResultsetFacets.Elements[j]);var i=this.sina.createFacet({'facetType':h});i.setJsonFromResponse(d.ResultsetFacets.Elements[j]);e.chartFacets.push(i);}}}});c.PerspectiveGetQuery=function(){this.init.apply(this,arguments);};c.PerspectiveGetQuery.prototype=f.extend({},a.Query.prototype,{init:function(d){d=d||{};this.perspectiveId=d.perspectiveId;a.Query.prototype.init.apply(this,[d]);this.resultSetClass=module.Perspective2;},setPerspectiveId:function(d){this.perspectiveId=d;},getPerspective:function(o,d){var e=this;var r={async:true,url:'/sap/bc/ina/service/v2/Perspectives(\''+this.perspectiveId+'\')',type:'GET'};var j=this.system.proxy.ajax(r);j.done(function(h){if(h&&h.error){d(h.error);}e.resultSet=new e.resultSetClass(e.resultSetProperties);e.resultSet.setJsonFromResponse(h);if(o){o(e.resultSet);}}).fail(function(h){if(d){d(h);}});}});c.Perspective2=function(){this.init.apply(this,arguments);};c.Perspective2.prototype={init:function(d){d=d||{};},getFacetForID:function(d){var e=this;for(var j=0;j<e.facets.length;j++){if(e.facets[j].facetId===d){return e.facets[j];}}return undefined;},getDimensionForID:function(d){var e=this;for(var j=0;j<e.dimensions.length;j++){if(e.dimensions[j].Name===d){return e.dimensions[j];}}return undefined;},getPreviewDimension:function(){if(this.bindings['WIDGET-4']&&this.bindings['WIDGET-4'].dimension){return this.bindings['WIDGET-4'].dimension;}if(this.bindings['WIDGET-1']&&this.bindings['WIDGET-1'].dimension){return this.bindings['WIDGET-1'].dimension;}if(this.bindings['WIDGET-2']&&this.bindings['WIDGET-2'].dimension){return this.bindings['WIDGET-2'].dimension;}if(this.bindings['WIDGET-3']&&this.bindings['WIDGET-3'].dimension){return this.bindings['WIDGET-3'].dimension;}return undefined;},setJsonFromResponse:function(d){var e=this;e.rawdata=d;e.ChangedAt=d.ChangedAt;e.ChangedBy=d.ChangedBy;e.content=JSON.parse(d.Content);e.perspectiveId=d.Id;e.name=d.Name;e.packageName=d.Package;e.isActive=d.isActive;e.isGenerated=d.isGenerated;e.datasource=e.content.Model.Queries[0].Datasource;e.measures=[];var m=e.content.Model.Queries[0].CustomDimension1.Members;for(var k=0;k<m.length;k++){e.measures.push(m[k]);}e.dimensions=[];var h=e.content.Model.Queries[0].Dimensions;for(var j=0;j<h.length;j++){e.dimensions.push(h[j]);}e.facets=[];var n=e.content.Model.Facets;for(var i=0;i<n.length;i++){e.facets.push({isActive:n[i].Active,facetId:n[i].FacetId,dimension:e.getDimensionForID(n[i].SeriesChart.ScaleDimensions[0].DimensionName)});}e.bindings={};var o=e.content.Bindings;for(var l=0;l<o.length;l++){var r=o[l];e.bindings[r.WidgetId]=e.getFacetForID(r.FacetId);}}};c.PerspectiveSearchQuery=function(){this.init.apply(this,arguments);};c.PerspectiveSearchQuery.prototype=f.extend({},a.Query.prototype,{init:function(d){d=d||{};a.Query.prototype.init.apply(this,[d]);this.filter.searchTerms=d.searchTerms||'*';this.resultSetClass=module.PerspectiveSearchResultSet;},createJsonRequest:function(){var d=b.getPerspectiveSearchRequest();d.Search.SearchTerms=this.filter.searchTerms;d.Search.Top=this._top;d.Search.Skip=this._skip;return d;},getPerspectiveResults:function(o,d){this.getResultSet(o,d);}});c.PerspectiveSearchResultSet=function(){this.init.apply(this,arguments);};c.PerspectiveSearchResultSet.prototype={init:function(d){var e=this;e.perspectives=[];d=d||{};},getPerspectiveSearchResultSet:function(){return this.perspectives;},setJsonFromResponse:function(d){var e=this;var h=d['ItemLists'][0]['Items'];for(var i=0;i<h.length;i++){var n=h[i]['NamedValues'];var j={packageId:n[0].Value,perspectiveId:n[0].Value+'/'+n[1].Value,perspectiveDescription:n[3].Value,title:n[2].Value};e.perspectives.push(j);}}};return c;}(s,q,G,H,C,p,f);J=function(F,b,e,l,f){var m={};m.ResultSetParser=function(){this.init.apply(this,arguments);};m.ResultSetParser.prototype={init:function(o){this.resultSet=o.resultSet;},parse:function(){this.enhance(this.resultSet);var a=this.resultSet.Grids[0];var r=a.Axes[0];var c=a.Axes[1];var k=function(c1){return c1.__key;};var d=function(c1){var d1;var e1;var f1;for(var g1 in c1){switch(g1){case'Name':e1=c1[g1];break;case'Value':d1=c1[g1];break;default:if(!f1){f1={};}f1[g1]=c1[g1];}}if(f1){f1.Value=d1;return{name:e1,value:f1};}else{return{name:e1,value:d1};}};var h=function(c1){if(!c1.NamedValues){return c1;}var d1={};for(var i=0;i<c1.NamedValues.length;++i){var e1=c1.NamedValues[i];var f1=d(e1);d1[f1.name]=f1.value;}return d1;};var j=new n({keyFunction:k,formatFunction:h});for(var i=0;i<a.Cells.length;++i){var o=a.Cells[i];var z=o.Index[0];var Z=this.resolve(r,z);var _=o.Index[1];var a1=this.resolve(c,_);a1=[f.extend({},a1[0])];a1[0].cell=o;var b1=Z;b1.push.apply(b1,a1);j.insert(b1);}return j;},resolve:function(a,c){var d=[];if(a.Tuples.length===0){return d;}var h=a.Tuples[c];for(var i=0;i<h.length;++i){var j=h[i];var k=a.Dimensions[i].ItemList.Items[j];k.__key=j;d.push(k);}return d;},enhance:function(r){var a={};for(var i=0;i<r.ItemLists.length;++i){var c=r.ItemLists[i];a[c.Name]=c;}for(var h=0;h<r.Grids.length;++h){var d=r.Grids[h];for(var j=0;j<d.Axes.length;++j){var o=d.Axes[j];for(var k=0;k<o.Dimensions.length;++k){var z=o.Dimensions[k];z.ItemList=a[z.ItemListName];}}}}};var n=function(){this.init.apply(this,arguments);};n.prototype={init:function(o){this.root={data:'root',subTree:{},children:[]};if(o&&o.keyFunction){this.keyFunction=o.keyFunction;}else{this.keyFunction=function(a){return a;};}if(o&&o.formatFunction){this.formatFunction=o.formatFunction;}else{this.formatFunction=function(a){return a;};}},insert:function(a){var c=this.root;for(var i=0;i<a.length;++i){var d=a[i];var k=this.keyFunction(d);var h=this.formatFunction(d);if(!c.subTree.hasOwnProperty(k)){var j={subTree:{},children:[],data:d,dataFormatted:h};c.subTree[k]=j;c.children.push(j);}c=c.subTree[k];}},toString:function(){var a=[];this.toStringHelper(this.root,[],a);return a.join('');},toStringHelper:function(a,c,d){var h=null;if(a===this.root){h=a.data;}else{h=this.keyFunction(a.data);}c.push(h);var i=false;for(var j in a.subTree){if(a.subTree.hasOwnProperty(j)){i=true;var k=a.subTree[j];var o=c.slice(0);this.toStringHelper(k,o,d);}}if(!i){d.push(c.toString()+'\n');}}};m.ABAPChartQuery=function(){this.init.apply(this,arguments);};m.ABAPChartQuery.prototype=f.extend({},F.ChartQuery.prototype,e.Query.prototype,{init:function(a){a=a||{};e.Query.prototype.init.apply(this,[a]);F.ChartQuery.prototype.init.apply(this,[a]);this.dimensions=[];this.attributeLimit=a.attributeLimit||1000;if(Object.prototype.toString.call(a.dimensions)==='[object Array]'){this.dimensions=a.dimensions;}else if(a.dimension){this.dimensions.push(a.dimension);}this.resultSetClass=m.ABAPChartResultSet;},getTitle:function(){if(this.resultSet&&this.resultSet.title){return this.resultSet.title;}else{return'unkown title';}},addDimension:function(d){this.dimensions.push(d);},setAttributeLimit:function(a){this.attributeLimit=a;},createJsonRequest:function(){var a=b.getABAPChartRequest();a.DataSource=this.filter.dataSource.getDataForRequest();a.Search.SearchTerms=this.filter.getSearchTerms();a.Search.Filter=this.filter.getDataForRequest();a.Search.Top=this.getTop();a.Search.Skip=this.getSkip();a.Facets.Attributes=this.dimensions;a.Facets.MaxNumberOfReturnValues=this.attributeLimit;a.Options=a.Options.concat(this.options);return a;}});m.ABAPChartResultSet=function(){this.init.apply(this,arguments);};m.ABAPChartResultSet.prototype={init:function(a){this.properties=a||{};this.dimensions=[];this.elements=[];},setJsonFromResponse:function(d){var a=new l.Perspective(this.properties);a.setJsonFromResponse(d);for(var i=0;i<a.chartFacets.length;i++){if(a.chartFacets[i].dimension==='$$DataSources$$')continue;this.dimensions.push(a.chartFacets[i].dimension);this.elements.push.apply(this.elements,a.chartFacets[i].query.resultSet.elements);this.title=a.chartFacets[i].title;break;}}};m.ChartQuery=function(){this.init.apply(this,arguments);};m.ChartQuery.prototype=f.extend({},F.ChartQuery.prototype,e.Query.prototype,{init:function(a){a=a||{};e.Query.prototype.init.apply(this,[a]);F.ChartQuery.prototype.init.apply(this,[a]);this.dimensions={};this.dimensions.CustomDimension1={Axis:'Columns',Name:'CustomDimension1',Members:[]};a.dimensions=a.dimensions||{};if(Object.prototype.toString.call(a.dimensions)==='[object Array]'){for(var i=0;i<a.dimensions.length;i++){this.addDimension(a.dimensions[i]);}}else if(typeof a.dimensions==='string'||typeof a.dimensions==='object'){this.addDimension(a.dimensions);}a.measures=a.measures||{};if(Object.prototype.toString.call(a.measures)==='[object Array]'){for(var j=0;j<a.measures.length;j++){this.addMeasure(a.measures[j]);}}else if(typeof a.measures==='object'){this.addMeasure(a.measures);}this.resultSetClass=m.ChartResultSet;},createJsonRequest:function(){var a=b.getChartRequest();a.DataSource=this.filter.dataSource.getDataForRequest();a.SearchTerms=this.filter.getSearchTerms();a.Analytics.Definition.Filter=this.filter.getDataForRequest();a.Analytics.Definition.Dimensions=[];for(var d in this.dimensions){a.Analytics.Definition.Dimensions.push(this.dimensions[d]);}return a;},count:function(d){this.addMeasure({name:d,aggregationFunction:'COUNT'});return this;},addMeasure:function(a){if(Object.keys(a).length===0){return{};}var c;if(a.aggregationFunction.toUpperCase()==='COUNT'||a.aggregationFunction.toUpperCase()==='AVG'){c=this._createAggregationDimension(a.aggregationFunction,a.name,a.aggregationFunction,a.sortOrder||undefined,a.top||undefined);}else{c=this._createAggregationDimension(a.aggregationFunction,'',a.name,a.sortOrder,a.top);delete c.AggregationDimension;delete c.Name;delete c.SortOrder;}this.dimensions.CustomDimension1.Members.push(c);return this;},addDimension:function(d,a,c){if(typeof d==='object'){if(Object.keys(d).length===0){return{};}this.dimensions[d.name]=this._createDimension(d.name,null,d.sortOrder,d.top);}else if(typeof d==='string'){if(!d){return{};}this.dimensions[d]=this._createDimension(d,null,a,c);}return this;},_createDimension:function(d,a,c,h){return{'Axis':a||'Rows','Name':d,'SortOrder':c||1,'Top':h||5};},_createAggregationDimension:function(a,c,d,h){return{'Aggregation':a,'AggregationDimension':c,'MemberOperand':{'AttributeName':'Measures','Comparison':'=','Value':d},'Name':d,'SortOrder':h||2};}});m.ChartResultSet=function(){this.init.apply(this,arguments);};m.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.elements=[];this.sina=a.sina;},_parseNamedValues:function(a,c,d){var h=this;for(var i=0;i<c.length;i++){var j=c[i].Name;var k=c[i].Value;a.label=c[i].ValueFormatted;a.labelRaw=c[i].Value;switch(j){case'$$DataSource$$':h._parseNamedValuesForDataSource(a,k);break;case'$$AttributeValue$$':h._parseNamedValuesForRange(a,k,d);break;}}},_parseNamedValuesForRange:function(a,c,h){var i,j,k;for(var d=0;d<c.length;++d){var o=c[d];switch(o.Name){case'ValueID':a.label=o.ValueFormatted;i=o.Value;break;case'Value1':if(h.Cube.ObjectName&&o.Value!==undefined){j=this.sina.createFilterCondition(h.Cube.ObjectName,'>=',o.Value,h.Cube.Description,o.ValueFormatted,o.ValueFormatted);}break;case'Value2':if(h.Cube.ObjectName&&o.Value!==undefined){k=this.sina.createFilterCondition(h.Cube.ObjectName,'<=',o.Value,h.Cube.Description,o.ValueFormatted,o.ValueFormatted);}break;case'Order':break;}}if(i){if(j&&k){var r=this.sina.createFilterConditionGroup();r.setOperator('AND');r.setLabel(a.label);if(j.value){r.addCondition(j);}if(k.value){r.addCondition(k);}a.labelRaw=r;}else if(j&&j.value&&!k){j.operator='=';a.labelRaw=j;}else if(k&&k.value&&!j){k.operator='=';a.labelRaw=k;}}},_parseNamedValuesForDataSource:function(a,c){a.dataSource=this.sina.createDataSource();for(var d=0;d<c.length;++d){var h=c[d];switch(h.Name){case'ObjectName':var i=h.ValueFormatted;a.dataSource.setLabel(i);a.dataSource.setObjectName(h.Value,h.ValueFormatted);break;case'PackageName':a.dataSource.setPackageName(h.Value,h.ValueFormatted);break;case'SchemaName':a.dataSource.setSchemaName(h.Value,h.ValueFormatted);break;case'Type':a.dataSource.setType(h.Value,h.ValueFormatted);break;default:a[h.Name]=h.Value;break;}}},setJsonFromResponse:function(d){this.elements=[];var h;if(d.Metadata){h=d.Metadata;}if(d.ResultSet){d=d.ResultSet;}var k={};for(var i=0;i<d.ItemLists.length;i++){k[d.ItemLists[i].Name]=d.ItemLists[i];}for(var a=0;a<d.Grids.length;a++){var o=d.Grids[a].Axes;var r=d.Grids[a].Cells;for(var z=0;z<r.length;++z){if(o[0].Dimensions.length===1){var Z=r[z];var _={valueRaw:Z.Value||Z.ValueFormatted||null,value:Z.ValueFormatted||Z.Value||null};for(var j=0;j<1;j++){var a1=Z.Index[j];var b1=o[j].Tuples[a1];if(b1===undefined){continue;}for(var c=0;c<b1.length;c++){var c1=o[j].Dimensions[c];var d1=b1[c];var e1=k[c1.ItemListName];var f1=e1.Items[d1].NamedValues;this._parseNamedValues(_,f1,h);}}this.elements.push(_);}}}},getElements:function(){return this.elements;}};m.GroupBarChartQuery=function(){this.init.apply(this,arguments);};m.GroupBarChartQuery.prototype=f.extend({},m.ChartQuery.prototype,{init:function(a){a=a||{};m.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=m.GroupBarChartResultSet;}});m.GroupBarChartResultSet=function(){this.init.apply(this,arguments);};m.GroupBarChartResultSet.prototype={init:function(a){a=a||{};this.elements=[];},setJsonFromResponse:function(d){var a=this;this.elements=[];var r=new ResultSetParser({resultSet:d});var c=r.parse();function h(i,j){for(var k in i){var o=i[k];var z={label:o.data.NamedValues[0].ValueFormatted,value:[]};if(o.data.cell){z.value={value:o.data.cell.ValueFormatted,valueRaw:o.data.cell.Value};}if(j){j.value.push(z);}else{a.elements.push(z);}if(o.subTree){h(o.subTree,z);}}}h(c.root.subTree);},getElements:function(){return this.elements;}};m.LineChartQuery=function(){this.init.apply(this,arguments);};m.LineChartQuery.prototype=f.extend({},m.ChartQuery.prototype,{init:function(a){a=a||{};m.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=m.LineChartResultSet;}});m.LineChartResultSet=function(){this.init.apply(this,arguments);};m.LineChartResultSet.prototype=f.extend({},m.GroupBarChartResultSet.prototype,{init:function(a){a=a||{};this.elements=[];},setJsonFromResponse:function(d){var a=this;this.elements=[];var r=new ResultSetParser({resultSet:d});var c=r.parse();function h(i,j){for(var k in i){var o=i[k];var z={label:o.data.NamedValues[0].ValueFormatted,value:[]};for(var Z in o.subTree){var _=o.subTree[Z];var a1={x:_.data.NamedValues[0].ValueFormatted};for(var b1 in _.subTree){var c1=_.subTree[b1];a1.y=c1.data.cell.Value;}z.value.push(a1);}a.elements.push(z);}}h(c.root.subTree);},getElements:function(){return this.elements;}});return m;}(F,p,C,I,f);K=function(s,w,c,e,h,m,n,f){var r={};var z=function(a){switch(a){case s.SuggestionType.HISTORY:return'SuggestSearchHistory';case s.SuggestionType.OBJECTDATA:return'SuggestObjectData';case s.SuggestionType.DATASOURCE:return'SuggestDataSources';default:throw'Unknown suggestion type '+a;}};var Z=function(a){switch(a){case'SearchHistory':return s.SuggestionType.HISTORY;case'ObjectData':return s.SuggestionType.OBJECTDATA;case'DataSources':return s.SuggestionType.DATASOURCE;default:return s.SuggestionType.OBJECTDATA;}};r.Suggestion=function(){this.init.apply(this,arguments);};r.SuggestionAutoQuery=function(a){if(a.system instanceof m.ABAPSystem){f.extend(this,r.Suggestion2Query.prototype);}if(a.system instanceof m.HANASystem){f.extend(this,r.SuggestionQuery.prototype);}this.init.apply(this,arguments);};r.SuggestionQuery=function(){this.init.apply(this,arguments);};r.SuggestionQuery.prototype=f.extend({},w.SuggestionQuery.prototype,h.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];h.Query.prototype.init.apply(this,arguments);w.SuggestionQuery.prototype.init.apply(this,arguments);this.resultSetClass=r.SuggestionResultSet;},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var a=e.getSuggestionRequest();a.Suggestions.Precalculated=false;var b=this.filter.getSearchTerms();if(this.attributes.length===0){throw'add at least one response attribute to your query';}a.Suggestions.SearchTerms=b;a.Suggestions.AttributeNames=this.attributes;a.DataSource=this.filter.dataSource.getDataForRequest();a.Suggestions.Top=this._top;var t=this.filter.getDataForRequest();if(t&&t.Selection){a.Suggestions.Filter=t;}return a;}});r.SuggestionResultSet=function(){this.init.apply(this,arguments);};r.SuggestionResultSet.prototype={init:function(){this.suggestions=[];},setJsonFromResponse:function(j){this.suggestions=[];var k={};for(var i=0;i<j.ItemLists.length;i++){k[j.ItemLists[i].Name]=j.ItemLists[i];}for(var a=0;a<k.Suggestions.Items.length;a++){var l=k.Suggestions.Items[a],_='',a1='',b1='';var c1={};for(var d=0;d<l.NamedValues.length;++d){var d1=l.NamedValues[d];switch(d1.Name){case'Term':_=d1.Value;c1.label=_;break;case'AttributeName':a1=d1.Value;c1.attribute=a1;break;case'$$AttributeDescription$$':b1=d1.Value;c1.attributeDescription=b1;break;case'Score':var e1=d1.Value;c1.score=parseInt(e1,10);break;}}this.suggestions.push(c1);}this.suggestions.sort(function(a,b){return b.score-a.score;});for(var o=this.suggestions.length-1;o>=0;o--){delete this.suggestions[o].score;}},getElements:function(){return this.suggestions;}};r.Suggestion2Query=function(){this.init.apply(this,arguments);};r.Suggestion2Query.prototype=f.extend({},w.SuggestionQuery.prototype,h.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];h.Query.prototype.init.apply(this,[a]);w.SuggestionQuery.prototype.init.apply(this,[a]);this.resultSetClass=r.Suggestion2ResultSet;this.suggestionTerm=a.suggestionTerm||'';this.options=[];},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setSuggestionTerm:function(a){if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet();}return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var a=e.getSuggestion2Request();a.Suggestions2.Precalculated=false;a.Suggestions2.NamedValues=[];for(var i=0;i<this.attributes.length;i++){a.Suggestions2.NamedValues.push({AttributeName:this.attributes[i],Name:this.attributes[i]});}a.DataSource=this.filter.dataSource.getDataForRequest();a.Suggestions2.Top=this.getTop();a.Suggestions2.Skip=this.getSkip();var b=this.sina.createFilterConditionGroup();this.splittedSuggestionTerm=this.splitSuggestionTerm(this.suggestionTerm);if(this.splittedSuggestionTerm.searchTerm){var d=this.sina.createFilterCondition('$$SearchTerms$$','contains',this.splittedSuggestionTerm.searchTerm);b.addCondition(d);}var k=this.sina.createFilterCondition('$$SuggestionTerms$$','contains',this.splittedSuggestionTerm.suggestionTerm);b.addCondition(k);b.addCondition(this.getFilter().getFilterConditions());a.Suggestions2.Filter=b.getDataForRequest();a.Options=this.options.slice();var l=[];for(var j=0;j<this.suggestionTypes.length;j++){l.push(z(this.suggestionTypes[j]));}a.Options.push.apply(a.Options,l);return a;},splitSuggestionTerm:function(a){var b=a.lastIndexOf(' ');if(b<0){return{searchTerm:null,suggestionTerm:a};}var d=a.slice(0,b);d=d.replace(/\s+$/,'');if(d.length===0){return{searchTerm:null,suggestionTerm:a};}var i=a.slice(b);i=i.replace(/^\s+/,'');if(i.length===0){return{searchTerm:null,suggestionTerm:a};}return{searchTerm:d,suggestionTerm:i};}});r.Suggestion2ResultSet=function(){this.init.apply(this,arguments);};r.Suggestion2ResultSet.prototype={init:function(a){this.datasources={};this.suggestions=[];this.sina=a.sina;this.query=a.query;},parseSuggestion:function(a,b){var d={label:b.dataFormatted.$$Term$$.ValueFormatted,labelRaw:b.dataFormatted.$$Term$$.Value,dataSource:this.query.getDataSource(),type:a,children:[]};if(this.query.getDataSource().type==='Category'||a===s.SuggestionType.HISTORY){this.suggestions.push(d);}if(a===s.SuggestionType.HISTORY){return;}for(var j=1;j<b.children.length;++j){var i=b.children[j];var k=this.sina.createDataSource({type:c.DataSourceType.BUSINESSOBJECT,objectName:i.dataFormatted.$$DataSource$$,label:i.dataFormatted.$$DataSourceDescription$$});var l={label:b.dataFormatted.$$Term$$.ValueFormatted,labelRaw:b.dataFormatted.$$Term$$.Value,dataSource:k,type:d.type};if(this.query.getDataSource().type==='Category'){d.children.push(l);}else{this.suggestions.push(l);}}},parseDataSourceSuggestion:function(a){var d=this.sina.createDataSource({type:c.DataSourceType.BUSINESSOBJECT,objectName:a.dataFormatted.$$Term$$.Value,label:f.removeHtmlTags(a.dataFormatted.$$Term$$.ValueFormatted)});var b={label:a.dataFormatted.$$Term$$.ValueFormatted,labelRaw:d,dataSource:d,type:s.SuggestionType.DATASOURCE,children:[]};this.suggestions.push(b);},setJsonFromResponse:function(d){if(!d.Grids||!d.Grids[0]||!d.Grids[0].Axes){return;}var a=new n.ResultSetParser({resultSet:d});var b=a.parse();for(var i=0;i<b.root.children.length;++i){var j=b.root.children[i];var k=Z(j.dataFormatted.$$Term$$.Scope);switch(k){case s.SuggestionType.OBJECTDATA:this.parseSuggestion(k,j);break;case s.SuggestionType.HISTORY:this.parseSuggestion(k,j);break;case s.SuggestionType.DATASOURCE:this.parseDataSourceSuggestion(j);break;}}},getElements:function(){this.concatenateSearchTerm(this.suggestions,this.query.splittedSuggestionTerm);return this.suggestions;},escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&');},concatenateSearchTerm:function(a,b){var d=this;if(!b.searchTerm){return;}var o=[];var _=b.searchTerm.split(' ');for(var k=0;k<_.length;k++){var a1=_[k];a1=a1.trim();o.push({term:a1,regExp:new RegExp(d.escapeRegExp(a1),'i')});}for(var i=0;i<a.length;++i){var b1=a[i];var c1=[];for(var j=0;j<o.length;++j){var d1=o[j];if(!d1.regExp.test(b1.labelRaw)){c1.push(d1.term);}}var e1=[];var f1=c1.join(' ');for(var l=0;l<c1.length;l++){var a1=c1[l];e1.push('<b>'+a1+'</b>');}e1=e1.join(' ');b1.label=e1+' '+b1.label;b1.labelRaw=f1+' '+b1.labelRaw;if(b1.children&&b1.children.length>0){this.concatenateSearchTerm(b1.children,b);}}}};return r;}(s,w,v,p,C,B,J,f);L=function(s,H,c,a,f){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype=f.extend({},H.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===s.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===s.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===s.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new a.SearchResultSet({sina:this.sina});}this.query.resultSet.setJsonFromResponse(d);this._parseServerSideFacetMetaData(d.Metadata);},_parseServerSideFacetMetaData:function(d){if(d&&d.Cube){this.title=d.Cube.Description;this.dimension=d.Cube.ObjectName;}}});return e;}(s,H,J,D,f);M=function(v,f){var e={};e.MetaDataService=function(){this.init.apply(this,arguments);};e.MetaDataService.prototype={init:function(a){a=a||{};this.allInOneMap={};this.allInOneMap.dataSourceList=[];this.allInOneMap.dataSourceMap={};this.dataSourcesDeferred=null;this.allInOneMap.businessObjectList=[];this.allInOneMap.businessObjectMap={};this.businessObjectsDeferred=null;},getDataSources:function(a){var b=this;return b._fillDataSourcesBuffer(a).then(function(){return b.allInOneMap.dataSourceList;});},getDataSourcesSync:function(a){var b=this;b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceList;},getDataSource:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}return b._fillDataSourcesBuffer().then(function(){return b.allInOneMap.dataSourceMap[d.key];});},getDataSourceByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}return b._fillDataSourcesBuffer().then(function(){return b.allInOneMap.dataSourceMap[d];});},getDataSourceSync:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceMap[d.key];},getDataSourceSyncByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceMap[d];},_fillDataSourcesBuffer:function(a){var b=this;if(b.dataSourcesDeferred){return b.dataSourcesDeferred;}b.dataSourcesDeferred=f.Deferred();if(b.allInOneMap.dataSourceList.length!==0){b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);return b.dataSourcesDeferred;}a.top=a.top||1000;var d=new v.DataSourceQuery(a);var c=d.getResultSet();c.done(function(r){b._extractDataSources(a,r);b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);});c.fail(function(h){d=new v.ESHConnectorDataSourceQuery(a);d.getResultSet().then(function(r){b._extractESHConnectorDataSources(a,r);b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);},function(h){b.dataSourcesDeferred.reject(h);b.dataSourcesDeferred=null;});});return b.dataSourcesDeferred;},_fillDataSourcesBufferSync:function(a){var b=this;if(b.allInOneMap.dataSourceList.length!==0){return;}a.top=a.top||1000;var d=new v.DataSourceQuery(a);var r=d.getResultSetSync();if(r.elements.length!==0){b._extractDataSources(a,r);}else{d=new v.ESHConnectorDataSourceQuery(a);r=d.getResultSetSync();b._extractESHConnectorDataSources(a,r);}},_extractDataSources:function(a,r){var b=this;var c=r.getElements();for(var i=0;i<c.length;++i){var d=c[i];if(d.Type.value.toLowerCase()!=='category'){var l=d.Description.value===null?d.ObjectName.value:d.Description.value;var h=d.DescriptionPlural===undefined||d.DescriptionPlural.value===null?l:d.DescriptionPlural.value;var j=a.sina.createDataSource({objectName:{label:d.ObjectName.value,value:d.ObjectName.value},packageName:{label:'ABAP',value:'ABAP'},schemaName:'',type:'View',label:l,labelPlural:h});var k=j.key;if(!(k in b.allInOneMap.dataSourceMap)){b.allInOneMap.dataSourceList.push(j);b.allInOneMap.dataSourceMap[k]=j;}}}b._setRemoteSystemName();},_extractESHConnectorDataSources:function(a,r){var b=this;var c=r.getElements();for(var i=0;i<c.length;++i){var d=c[i];if(d.$$DataSourceMetaData$$.type.toLowerCase()!=='category'){var l=d.DESCRIPTION.value===null?d.OBJECT_NAME.value:d.DESCRIPTION.value;var h=d.DESCRIPTIONPLURAL===undefined||d.DESCRIPTIONPLURAL.value===null?l:d.DESCRIPTIONPLURAL.value;var j=a.sina.createDataSource({objectName:{label:d.OBJECT_NAME.value,value:d.OBJECT_NAME.value},packageName:{label:'ABAP',value:'ABAP'},schemaName:'',type:'View',label:l,labelPlural:h});var k=j.key;if(!(k in b.allInOneMap.dataSourceMap)){b.allInOneMap.dataSourceList.push(j);b.allInOneMap.dataSourceMap[k]=j;}}}b._setRemoteSystemName();},_setRemoteSystemName:function(){var a=this;var k='';var b='';var l='';var c='';var d='';var h='';var j='';var m='';var n='';var o='';for(var i=0;i<a.allInOneMap.dataSourceList.length-1;i++){if(a.allInOneMap.dataSourceList[i].labelPlural===a.allInOneMap.dataSourceList[i+1].labelPlural){if(!a.allInOneMap.dataSourceList[i].isLabelProcessed){k=a.allInOneMap.dataSourceList[i].key;l=a.allInOneMap.dataSourceList[i].label;c=a.allInOneMap.dataSourceList[i].labelPlural;j=a.allInOneMap.dataSourceList[i].objectName.value.substr(0,3);n=a.allInOneMap.dataSourceList[i].objectName.value.substr(3,3);}if(!a.allInOneMap.dataSourceList[i+1].isLabelProcessed){b=a.allInOneMap.dataSourceList[i+1].key;d=a.allInOneMap.dataSourceList[i+1].label;h=a.allInOneMap.dataSourceList[i+1].labelPlural;m=a.allInOneMap.dataSourceList[i+1].objectName.value.substr(0,3);o=a.allInOneMap.dataSourceList[i+1].objectName.value.substr(3,3);}if(j!==m){l=l+" ("+j+")";c=c+" ("+j+")";d=d+" ("+m+")";h=h+" ("+m+")";}else{l=l+" ("+j+":"+n+")";c=c+" ("+j+":"+n+")";d=d+" ("+m+":"+o+")";h=h+" ("+m+":"+o+")";}if(!a.allInOneMap.dataSourceList[i].isLabelProcessed){a.allInOneMap.dataSourceList[i].label=l;a.allInOneMap.dataSourceList[i].labelPlural=c;a.allInOneMap.dataSourceList[i].isLabelProcessed=true;a.allInOneMap.dataSourceMap[k].label=l;a.allInOneMap.dataSourceMap[k].labelPlural=c;a.allInOneMap.dataSourceMap[k].isLabelProcessed=true;}if(!a.allInOneMap.dataSourceList[i+1].isLabelProcessed){a.allInOneMap.dataSourceList[i+1].label=d;a.allInOneMap.dataSourceList[i+1].labelPlural=h;a.allInOneMap.dataSourceList[i+1].isLabelProcessed=true;a.allInOneMap.dataSourceMap[b].label=d;a.allInOneMap.dataSourceMap[b].labelPlural=h;a.allInOneMap.dataSourceMap[b].isLabelProcessed=true;}}}},getBusinessObjectsMetaData:function(a){var b=this;return b.getDataSources(a).then(function(){return b._fillBusinessObjectsBuffer().then(function(){return b.allInOneMap.businessObjectList;});});},getBusinessObjectsMetaDataSync:function(a){var b=this;b.getDataSourcesSync(a);b._fillBusinessObjectsBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}return b.getDataSource(a,d).then(function(){return b._fillBusinessObjectBuffer(a,d.key).then(function(){return b.allInOneMap.businessObjectMap[d.key];});});},getBusinessObjectMetaDataByBusinessObjectName:function(d){var a=this;if(!d){throw'datasource key missing';}return a.getDataSourceByBusinessObjectName(d).then(function(){return a._fillBusinessObjectBuffer(properties,d).then(function(){return a.allInOneMap.businessObjectMap[d];});});},getBusinessObjectMetaDataSync:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}b.getDataSourceSync(a,d);b._fillBusinessObjectBufferSync(a,d.key);return b.allInOneMap.businessObjectMap[d.key];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}b.getDataSourceSyncByBusinessObjectName(a,d);b._fillBusinessObjectBufferSync(a,d);return b.allInOneMap.businessObjectMap[d];},_fillBusinessObjectsBuffer:function(a){var b=this;if(b.businessObjectsDeferred){return b.businessObjectsDeferred;}b.businessObjectsDeferred=f.Deferred();if(b.allInOneMap.businessObjectList.length!==0){b.dataSourcesDeferred.resolve(b.allInOneMap.businessObjectList);return b.dataSourcesDeferred;}var d=b.allInOneMap.dataSourceList;var c=[];for(var i=0;i<d.length;i++){c.push(b._businessObjectDeffered(a,d[i].key));}f.when.apply(null,c).then(function(){b.businessObjectsDeferred.resolve(b.allInOneMap.businessObjectList);},function(h){b.businessObjectsDeferred=null;b.businessObjectsDeferred.reject(h);});return b.businessObjectsDeferred;},_businessObjectDeffered:function(a,k){var b=this;var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,true,b.allInOneMap.dataSourceMap[k]));return j.then(function(r){var c=b._parseMetaDataResponse(r);b._setMetaData(k,c);return f.when(true);},function(c){return f.when(false);});},_fillBusinessObjectsBufferSync:function(a){var b=this;if(b.allInOneMap.businessObjectList.length!==0){return;}var d=b.allInOneMap.dataSourceList;for(var i=0;i<d.length;i++){if(!(d[i].key in b.allInOneMap.businessObjectMap)){b._fillBusinessObjectBufferSync(a,d[i].key);}}},_fillBusinessObjectBuffer:function(a,k){var b=this;var c=f.Deferred();if(b.allInOneMap.businessObjectMap[k]!==undefined&&b.allInOneMap.businessObjectMap[k].hasFulltextIndex!==undefined){c.resolve(b.allInOneMap.businessObjectMap[k]);return c;}var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,true,b.allInOneMap.dataSourceMap[k]));j.then(function(r){var d=b._parseMetaDataResponse(r);b._setMetaData(k,d);c.resolve(b.allInOneMap.businessObjectMap[k]);},function(d){c=null;c.reject(d);});return c;},_fillBusinessObjectBufferSync:function(a,k){var b=this;if(b.allInOneMap.businessObjectMap[k]!==undefined&&b.allInOneMap.businessObjectMap[k].hasFulltextIndex!==undefined){return;}var d=b.allInOneMap.dataSourceMap[k];var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,false,d));var c=$.parseJSON(j.responseText);if(!c.Error){var h=b._parseMetaDataResponse(c);b._setMetaData(d.key,h);}},_parseMetaDataRequest:function(a,i,d){var b={ObjectName:d.objectName.value,PackageName:d.packageName.value,SchemaName:d.schemaName.value,Type:d.type.value};var r={async:i,url:a.sina.getSystem().inaUrl,processData:false,contentType:'application/json',dataType:'json',data:{'DataSource':b,'Options':['SynchronousRun'],'Metadata':{'Context':'Search','Expand':['Cube']},'ServiceVersion':204},success:function(c){}};return r;},_parseMetaDataResponse:function(a){var b={};if(!a.Cube||!a.Cube.Dimensions){return b;}for(var i=0;i<a.Cube.Dimensions.length;i++){for(var j=0;j<a.Cube.Dimensions[i].Attributes.length;j++){var k=a.Cube.Dimensions[i].Attributes[j].Name;if(k===undefined||k===''||k.indexOf('$$')>-1){continue;}b[k]={displayOrder:a.Cube.Dimensions[i].Attributes[j].DisplayOrder||0,isTitle:$.inArray('Title',a.Cube.Dimensions[i].Attributes[j].presentationUsage)>-1?true:false,isKey:a.Cube.Dimensions[i].Attributes[j].IsKey,label:a.Cube.Dimensions[i].Attributes[j].Description||'',labelRaw:k,presentationUsage:a.Cube.Dimensions[i].Attributes[j].presentationUsage||[],accessUsage:a.Cube.Dimensions[i].Attributes[j].accessUsage||[],type:a.Cube.Dimensions[i].Attributes[j].DataType||'',hasFulltextIndex:a.Cube.Dimensions[i].Attributes[j].hasFulltextIndex||undefined};var h=b[k].hasFulltextIndex||false;if(h){b[k].type='Text';}}}return b;},setBusinessObjectMetaDataSync:function(v,d){var a=this;if(a.allInOneMap.businessObjectMap[v.key]){return;}var b={};for(var c in d){if(c.indexOf('$$')>-1||c==='title'||typeof d[c]==='function'||!d[c]||!d[c].$$MetaData$$){continue;}var h=d[c];var m=h.$$MetaData$$;var n={labelRaw:c,label:m.description,type:m.dataType,isTitle:m.isTitle,isKey:m.isKey,presentationUsage:m.presentationUsage,accessUsage:m.accessUsage,displayOrder:m.displayOrder,hasFulltextIndex:m.hasFulltextIndex||undefined};var i=n.hasFulltextIndex||false;if(i){n.type='Text';}b[c]=n;}a._setMetaData(v.key,b);},_setMetaData:function(k,a){var b=this;b.allInOneMap.businessObjectMap[k]={attributeMap:{}};b.allInOneMap.businessObjectMap[k].attributeMap=a;b.allInOneMap.businessObjectList.push(a);}};return e;}(E,f);N=function(f,b,g,q,j,t,v,a,c,d,e,h,y,m,k){var l={};l.Sina=function(){this.init.apply(this,arguments);};l.CatalogQuery=function(){this.init.apply(this,arguments);};l.SearchConfiguration=function(){this.init.apply(this,arguments);};l.UserHistory=function(){this.init.apply(this,arguments);};var n='INAV2';b.registerProvider({impl_type:n,sina:l.Sina,chartQuery:function(i){if(i.sina.getSystem()instanceof y.HANASystem){return new c.ChartQuery(i);}else{return new c.ABAPChartQuery(i);}},searchQuery:a.SearchQuery,groupBarChartQuery:c.GroupBarChartQuery,lineChartQuery:c.LineChartQuery,suggestionQuery:d.SuggestionAutoQuery,perspectiveQuery:e.PerspectiveQuery,perspectiveSearchQuery:e.PerspectiveSearchQuery,perspectiveGetQuery:e.PerspectiveGetQuery,Facet:h.Facet,DataSource:v.DataSource,metaDataService:new m.MetaDataService(),Filter:t.Filter,FilterCondition:t.Condition,FilterConditionGroup:t.ConditionGroup,DataSourceQuery:v.DataSourceQuery,searchConfiguration:l.SearchConfiguration,addUserHistoryEntry:function(i){var o=new l.UserHistory(i);return o.addUserHistoryEntry(i.oEntry);},emptyUserHistory:function(i){var o=new l.UserHistory(i);return o.emptyUserHistory();}});l.Sina.prototype=f.extend({},b.Sina.prototype,{init:function(i){i=i||{};b.Sina.prototype.init.apply(this,arguments);},getRootDataSource:function(i){return new v.DataSource({objectName:'$$ALL$$',packageName:'ABAP',schemaName:'',sina:this});},sapclient:function(i){var o;if(i){if(i<0){o=new y.HANASystem();}else{o=new y.ABAPSystem({'sapclient':i});}this.setSystem(o);}else{return this.getSystem().properties.sapclient();}return{};},_registerPostProcessor:function(i){if(!this.postProcessor){this.postProcessor=[];}this.postProcessor.push(i);},_postprocess:function(o,r){if(this.postProcessor){for(var i=0;i<this.postProcessor.length;i++){this.postProcessor[i](o,r);}}}});l.CatalogQuery.prototype=f.extend({},k.Query.prototype,{init:function(i){i=i||{};this.resultSetClass=SearchResultSet;},createJsonRequest:function(){return j.getCatalogRequest();}});l.UserHistory.prototype=f.extend({},q.Query.prototype,k.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);k.Query.prototype.init.apply(this,[i]);},addUserHistoryEntry:function(o,i){var r={'SearchConfiguration':{'Action':'Update','ClientEvent':o}};return this._fireRequest(r,i,'text');},emptyUserHistory:function(i){var o={'SearchConfiguration':{'Action':'Update','Data':{'PersonalizedSearch':{'ResetUserData':true}}}};return this._fireRequest(o,i,'text');}});l.SearchConfiguration.prototype=f.extend({},q.Query.prototype,k.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);k.Query.prototype.init.apply(this,[i]);},load:function(i){var o={'SearchConfiguration':{'Action':'Get','Data':{'PersonalizedSearch':{}}}};return this._fireRequest(o,i);},save:function(o,i){return this._fireRequest(o,i,'text');}});return l;}(f,s,g,q,p,u,E,D,J,K,I,L,B,M,C);O=function(f,b,y,x){var e={};e.System=function(){this.init.apply(this,arguments);};e.System.prototype=f.extend({},y.System.prototype,{init:function(a){a=a||{};a.servicePath=a.servicePath||'/es/odata/callbuildin.xsjs';a.proxy=a.proxy||new x.Proxy({system:this});y.System.prototype.init.apply(this,[a]);},getServerInfo:function(){return f.when({rawServerInfo:{Services:[{Service:'Suggestions2',Capabilities:[{Capability:'ScopeTypes'}]}]},services:{Suggestions:{suggestionTypes:['objectdata']},Search:{capabilities:['search']}}});}});return e;}(f,s,y,x);P=function(t,f){var e={};var n=function(o){o=o.toLowerCase();switch(o){case'=':o='eq';break;case'!=':o='ne';break;case'>':o='gt';break;case'>=':o='ge';break;case'<':o='lt';break;case'<=':o='le';break;}return o;};e.Filter=function(){this.init.apply(this,arguments);};e.Filter.prototype=f.extend({},t.Filter.prototype,{init:function(a){t.Filter.prototype.init.apply(this,[a]);},getDataForRequest:function(){return this.defaultConditionGroup.getDataForRequest();}});e.Condition=function(){this.init.apply(this,arguments);};e.Condition.prototype=f.extend(Object.create(t.Condition.prototype),{init:function(a,o,b,Y){t.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(){return this.attribute+' '+n(this.operator)+' \''+this.value+'\'';}});e.ConditionGroup=function(){this.init.apply(this,arguments);};e.ConditionGroup.prototype=f.extend(Object.create(t.ConditionGroup.prototype),{init:function(a){t.ConditionGroup.prototype.init.apply(this,[a]);},getDataForRequest:function(){var r=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];var a=c.getDataForRequest();if(a){r.push(c.getDataForRequest());}}var b=r.join(' '+n(this.operator)+' ');if(r.length>1){b='('+b+')';}return b;}});return e;}(t,f);Q=function(v,f){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSource.prototype=f.extend({},v.DataSource.prototype,{init:function(a){a=a||{};v.DataSource.prototype.init.apply(this,arguments);this.type=a.type||v.DataSourceType.BUSINESSOBJECT;this.entityType=a.entityType||a.name;this.name=a.name||'';this.schema=a.schema||'';this.label=a.label||'icognito datasource';this.labelPlural=a.labelPlural||'icognito datasource plural';this.sina=a.sina||null;this.constructKey();if(!this.key){throw'Datasource has no key!! '+JSON.stringify(a);}},constructKey:function(){this.key=this.type+'/'+this.entityType;},getIdentifier:function(){return this.name;},getType:function(){return this.type;},getEntityType:function(){return this.entityType;},getLabel:function(){return this.label;},getSchema:function(){return this.schema;},getLabelPlural:function(){return this.labelPlural;},getName:function(){return this.name;},clone:function(){var n=this.sina.createDataSource();n.type=this.type;n.entityType=this.entityType;n.name=this.name;n.schema=this.schema;n.label=this.label;n.labelPlural=this.labelPlural;n.key=this.key;return n;},setJson:function(j){this.type=j.type;this.entityType=j.entityType;this.schema=j.schema;this.label=j.label;this.labelPlural=j.labelPlural;this.name=j.name;this.constructKey();},getJson:function(){return{type:this.type,entityType:this.entityType,schema:this.schema,label:this.label,labelPlural:this.labelPlural,name:this.name};}});return e;}(v,f);R=function(b,f){var e={};e.ChartQuery=function(){this.init.apply(this,arguments);};e.ChartQuery.prototype=f.extend({},b.ChartQuery.prototype,{init:function(a){a=a||{};b.ChartQuery.prototype.init.apply(this,[a]);this.dimensions=[];this.attributeLimit=1000;},executeSync:function(){return this.resultSet;},addDimension:function(d){if(typeof d==='object'){if(Object.keys(d).length===0||!d.name){return;}this.dimensions.push(d.name);}else if(typeof d==='string'){if(!d){return;}this.dimensions.push(d);}},setAttributeLimit:function(l){this.attributeLimit=l;},getTitle:function(d){if(d===undefined&&this.filter.dataSource&&this.filter.dataSource.name){d=this.filter.dataSource.name;}if(!d){return'Default Title';}var m=this.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(d).attributeMap;var l=m[this.dimensions[0]].label;return l;},execute:function(){var a=this;var c=a.filter.searchTerms;var d=a.filter.dataSource;var h=this.attributeLimit||5;var i=0;var j=a.dimensions[0];var k='Search.search(query=\'';if(!d.equals(a.sina.getRootDataSource())){k+='scope:'+d.name+' ';}k+=c+'\')';var l='';var m=a.filter.getDataForRequest();if(m){l=l+' and '+m;}var n='';if(j){n='/groupby(('+j+'),aggregate($count as _Count))';}var o='filter('+k+l+')'+n;var r={$count:true,$top:h,$skip:i,$apply:o};var z=this.system.servicePath+'/$all';var Z={method:'GET',type:'GET',noXSRFToken:true,data:r,processData:true,url:z};return this.system.proxy.ajax(Z).then(function(r){var _=new e.ChartResultSet({dimensions:a.dimensions,sina:a.sina,datasource:a.filter.dataSource});return _.setJsonFromResponseGroupBy(r);});}});e.ChartResultSet=function(){this.init.apply(this,arguments);};e.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.sina=a.sina;this.datasource=a.datasource;this.elements=[];this.dimensions=a.dimensions;},setJsonFromResponse:function(d){var a=d['@com.sap.vocabularies.Search.v1.Facet'].PropertyName||d['@com.sap.vocabularies.Search.v1.Facet'].Dimensions[0].PropertyName;var c=d['@com.sap.vocabularies.Search.v1.Facet'].isConnectorFacet;this.elements=[];for(var i=0;i<d.Items.length;++i){var h=d.Items[i];var j={};if(c===true){var k=this.sina.getDataSourceSyncByBusinessObjectName(h[a]);j={dataSource:k,label:k.getLabel(),labelRaw:h[a],value:h._Count,valueRaw:h._Count};}else{var l=h[a];j={label:l,labelRaw:this.sina.createFilterCondition(a,'eq',h[a],this.datasource.getMetaDataSync().attributeMap[a].label,l,l),value:h._Count,valueRaw:h._Count};}this.elements.push(j);}},setJsonFromResponseGroupBy:function(d){var a=this;var c=a.dimensions[0];var l=c;var r=d.value;for(var i=0;i<r.length;++i){var h=r[i];var j={label:h[l],labelRaw:this.sina.createFilterCondition(c,'eq',h[c],this.datasource.getMetaDataSync().attributeMap[c].label,h[l],h[l]),value:h._Count,valueRaw:h._Count};a.elements.push(j);}return a;},getElements:function(){return this.elements;}};return e;}(F,f);S=function(b,f){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},b.SearchQuery.prototype,{init:function(){b.SearchQuery.prototype.init.apply(this,arguments);this.resultSet=new e.SearchResultSet({sina:this.sina});},executeSync:function(){return this.resultSet;}});e.SearchResultSet=function(){this.init.apply(this,arguments);};e.SearchResultSet.prototype={init:function(a){a=a||{};this.sina=a.sina;this.elements=[];this.totalcount=0;this.dataSource=a.dataSource;},getElements:function(){return this.elements;},createEmptyElement:function(d){return{$$RelatedActions$$:[],$$WhyFound$$:[],$$DataSourceMetaData$$:d};},createAttribute:function(a,c,d,h){var i;if(h){switch(h.type){case'Edm.DateTime':var r=/[-]?\d+/;var o=new Date(parseInt(r.exec(c)[0],10));var j=sap.ui.core.format.DateFormat.getDateInstance({style:'medium'});c=j.format(o);break;case'Edm.Decimal':case'Edm.Double':case'Edm.Int16':case'Edm.Int32':case'Edm.Int64':case'Edm.Single':if(c){c=c.toString();}break;default:if(c){c=c.toString();}}i={$$MetaData$$:{presentationUsage:h.presentationUsage,displayOrder:h.displayOrder},label:h.label,labelRaw:h.labelRaw,value:c,valueRaw:c};}else{i={$$MetaData$$:{presentationUsage:[],displayOrder:d},label:a,labelRaw:a,value:c,valueRaw:c};}return i;},parseRecord:function(r){var a=this;var c=r['@odata.context']||a.dataSource.entityType;var d=c.lastIndexOf('#');if(d>-1){c=c.slice(d+1);}var h=r['@com.sap.vocabularies.Search.v1.WhyFound']||{};return a.sina.getBusinessObjectMetaDataByBusinessObjectName(c).then(function(m){var i=a.createEmptyElement(m.dataSource);var j=0;for(var k in r){if(k[0]==='@'||k[0]==='_'){continue;}var l=r[k];for(var n in h){if(n===k&&h[n][0]){l=h[n][0];}}i[k]=a.createAttribute(k,l,++j,m.attributeMap[k]);}return i;});},setJsonFromResponse:function(d){var a=this;a.totalcount=d['@odata.count']||0;a.totalcount=parseInt(a.totalcount,10);var r=d.value||d.d.results;var c=[];a.elements=[];for(var i=0;i<r.length;++i){var h=r[i];c.push(this.parseRecord(h).done(function(j){a.elements.push(j);}));}return f.when.apply(null,c).then(function(){return arguments;});}};return e;}(g,f);T=function(s,H,f,c,a){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype=f.extend({},H.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===s.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===s.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina,datasource:this.dataSource});}else if(this.facetType===s.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new a.SearchResultSet({sina:this.sina});}if(this.facetType===s.FacetType.ATTRIBUTE){this.dimension=d['@com.sap.vocabularies.Search.v1.Facet'].Dimensions[0].PropertyName;this.query.addDimension(this.dimension);this.title=this.query.getTitle(this.dataSource.name);}return this.query.resultSet.setJsonFromResponse(d);}});return e;}(s,H,f,R,S);U=function(f,b,w,v){var e={};e.SuggestionQuery=function(){this.init.apply(this,arguments);};e.SuggestionQuery.prototype=f.extend({},w.SuggestionQuery.prototype,{init:function(){w.SuggestionQuery.prototype.init.apply(this,arguments);this.suggestionTerm=null;this.options=[];this.deferredResultSet=null;},setOptions:function(o){this.options=o;this._resetResultSet();},setSuggestionTerm:function(a){if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet();}return this;},_resetResultSet:function(){this.deferredResultSet=null;},execute:function(){var a=this;var c=5;var d=a.filter.dataSource;if(this.deferredResultSet){return this.deferredResultSet;}if(this.suggestionTypes.indexOf(b.SuggestionType.OBJECTDATA)<0){this.deferredResultSet=f.when(new e.SuggestionResultSet({sina:this.sina}));return this.deferredResultSet;}var h=this.sina.getSystem().servicePath+'/$all/GetSuggestion(term=\'';if(!d.equals(a.sina.getRootDataSource())){h+='scope:'+d.name+' ';}var i=h+this.suggestionTerm+'\')';this.deferredResultSet=this.system.proxy.ajax({method:'GET',type:'GET',noXSRFToken:true,$top:c,url:i}).then(function(j){var r=new e.SuggestionResultSet({sina:a.sina});return r.setJsonFromResponse(j);});return this.deferredResultSet;}});e.SuggestionResultSet=function(){this.init.apply(this,arguments);};e.SuggestionResultSet.prototype=f.extend({},w.SuggestionQuery.prototype,{init:function(a){this.sina=a.sina;this.elements=[];},setJsonFromResponse:function(d){var a=this;return a.sina.getDataSources().then(function(c){var h=d.value;for(var i=0;i<h.length;++i){var j=h[i];var k={children:[],label:j.term,labelRaw:j.term,value:0,valueRaw:0,dataSource:a.sina.getRootDataSource(),type:b.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};a.elements.push(k);k={children:[],label:j.term,labelRaw:j.term,value:0,valueRaw:0,dataSource:a.sina.getDataSourceSyncByBusinessObjectName(j.scope),type:b.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};a.elements.push(k);}return a;});},getElements:function(){return this.elements;}});return e;}(f,s,w,Q);V=function(s,f,b,H,q){var e={};e.PerspectiveQuery=function(){this.init.apply(this,arguments);};e.PerspectiveQuery.prototype=f.extend({},q.Query.prototype,b.PerspectiveQuery.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);b.PerspectiveQuery.prototype.init.apply(this,arguments);},_resetResultSet:function(){b.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},execute:function(){var a=this;var c=a.filter.searchTerms;var d;var h=a.filter.dataSource;var i=a.top()||10;var j=a.skip()||0;var k=5;var l='Search.search(query=\'';if(!h.equals(a.sina.getRootDataSource())){l+='scope:'+h.name+' ';}l+=c+'\')';var m='';var n=a.filter.getDataForRequest();if(n){m=m+' and '+n;}var o='filter('+l+m+')';var r={$count:true,$top:i,$skip:j,$apply:o,whyfound:true};var z=this.system.servicePath+'/$all';if(this.requestedEntities.indexOf('Facets')>-1){r.facets='all';r.facetlimit=k;}var Z={method:'GET',type:'GET',noXSRFToken:true,data:r,processData:true,url:z};return this.system.proxy.ajax(Z).then(function(r){d=new e.Perspective({sina:a.sina,dataSource:a.filter.dataSource});return d.setJsonFromResponse(r);});}});e.Perspective=function(){this.init.apply(this,arguments);};e.Perspective.prototype=f.extend({},b.Perspective.prototype,{setJsonFromResponse:function(d){var a=this;a.searchFacet=this.sina.createFacet({'facetType':s.FacetType.SEARCH});var r=a.searchFacet.setJsonFromResponse(d);a.chartFacets=[];var c=d['@com.sap.vocabularies.Search.v1.Facets'];if(c){for(var i=0;i<c.length;++i){var h=c[i];var j=h['@com.sap.vocabularies.Search.v1.Facet'].isConnectorFacet;var k=this.sina.createFacet({'facetType':j===true?s.FacetType.DATASOURCE:s.FacetType.ATTRIBUTE,dataSource:a.dataSource});k.setJsonFromResponse(h);a.chartFacets.push(k);}}return f.when([r]).then(function(){return a;});}});return e;}(s,f,G,H,q);W=function(f){var e={};e.MetaDataService=function(){this.init.apply(this,arguments);};e.MetaDataService.prototype={init:function(a){a=a||{};this.sina=a.sina||null;this.allInOneMap={};this.allInOneMapDeferred=null;this.presentationUsageConversionMap={TITLE:'Title',SUMMARY:'Summary',DETAIL:'Detail'};this.accessUsageConversionMap={AUTO_FACET:'AutoFacet',SUGGESTION:'Suggestion'};},getDataSources:function(a){var b=this;return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.dataSourcesList;});},getDataSourcesSync:function(a){this._fillInternalBufferSync(a.sina);return this.allInOneMap.dataSourcesList;},getDataSource:function(a,d){var b=this;var c=d.getName();if(!c){throw'EntitySetName missing';}return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.dataSourceMap[c];});},getDataSourceByBusinessObjectName:function(a,b){var c=this;if(!b){throw'EntitySetName missing';}return c._fillInternalBuffer(a.sina).then(function(){return c.allInOneMap.dataSourceMap[b];});},getDataSourceSync:function(a,d){var b=d.getName();if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[b];},getDataSourceSyncByBusinessObjectName:function(a,b){if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[b];},getBusinessObjectsMetaData:function(a){var b=this;return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.businessObjectList;});},getBusinessObjectsMetaDataSync:function(a){this._fillInternalBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(a,d){var b=this;var c=d.getName();if(!c){throw'EntitySetName missing';}return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.businessObjectMap[c];});},getBusinessObjectMetaDataByBusinessObjectName:function(a,b){var c=this;if(!b){throw'EntitySetName missing';}return c._fillInternalBuffer(a.sina).then(function(){return c.allInOneMap.businessObjectMap[b];});},getBusinessObjectMetaDataSync:function(a,d){var b=d.getName();if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[b];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(a,b){if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[b];},_fillInternalBufferSync:function(Y){if(this.allInOneMap&&Object.keys(this.allInOneMap).length>0){return;}this.allInOneMap=this._fireMetaRequest(Y,false);},_fillInternalBuffer:function(Y){var a=this;if(this.allInOneMapDeferred){return this.allInOneMapDeferred;}a.allInOneMapDeferred=a._fireMetaRequest(Y).then(function(b){a.allInOneMap=b;});return a.allInOneMapDeferred;},_getWindow:function(){var a=this;if(!this.windowDeferred){this.windowDeferred=f.Deferred();}if(typeof window==='undefined'){var j=j;var b=b;var c=b.readFileSync('./node_modules/jquery/dist/jquery.js','utf-8');j.env({html:'<html><body></body></html>',src:[c],done:function(d,h){if(!d){a.windowDeferred.resolve(h);}else{a.windowDeferred.reject(d);}}});}else{this.windowDeferred.resolve(window);}return this.windowDeferred.promise();},_parseEntityType:function(a,b){var c=this;var h={};a=b.$(a);a.find('EntityType').each(function(){var d=b.$(this).attr('Name');var i={schema:a.attr('Namespace'),keys:[],attributeMap:{}};h[d]=i;b.$(this).find('Key>PropertyRef').each(function(){i.keys.push(b.$(this).attr('Name'));});b.$(this).find('Property').each(function(j){var k=b.$(this).attr('Name');var l={labelRaw:k,label:null,type:b.$(this).attr('Type'),isTitle:false,presentationUsage:[],accessUsage:[],displayOrder:j,unknownAnnotation:[]};i.attributeMap[k]=l;b.$(this).find('Annotation').each(function(){switch(b.$(this).attr('Term')){case'SAP.Common.Label':l.label=b.$(this).attr('String');break;case'EnterpriseSearch.key':l.enterprisesearchkey=b.$(this).attr('Bool')=='true'?true:false;break;case'EnterpriseSearch.presentationMode':b.$(this).find('Collection>String').each(function(){var m=b.$(this).text();m=c.presentationUsageConversionMap[m];if(m){l.presentationUsage.push(m);if(m.toLocaleLowerCase()==='title'){l.isTitle=true;}}});break;case'EnterpriseSearch.usageMode':b.$(this).find('Collection>String').each(function(){var m=b.$(this).text();m=c.accessUsageConversionMap[m];if(m){l.accessUsage.push(m);}});break;default:l.unknownAnnotation.push(b.$(this));}});});});return h;},_parseEntityContainer:function(Y,a,h,b,c){a.find('EntityContainer>EntitySet').each(function(){if(c.$(this).attr('Name')&&c.$(this).attr('EntityType')){var n=c.$(this).attr('Name');var d=c.$(this).attr('EntityType');var i=d.slice(0,d.lastIndexOf('.'));var j=d.slice(d.lastIndexOf('.')+1);var k=Y.createDataSource({label:n,labelPlural:n,entityType:j,name:n,schema:i,sina:Y});b.dataSourceMap[n]=k;b.dataSourcesList.push(k);var l=h[j];if(l===undefined){throw'EntityType '+j+' has no corresponding meta data!';}l.name=n;l.dataSource=k;b.businessObjectMap[n]=l;b.businessObjectList.push(l);}});},_parseResponse:function(Y,m,d){var a=this;var b={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[]};var c=f.Deferred();this._getWindow().then(function(h){h.$(m).find('Schema').each(function(){var i=h.$(this);var j=a._parseEntityType(i,h);a._parseEntityContainer(Y,i,j,b,h);});c.resolve(b);});return c.promise();},_fireMetaRequest:function(Y,a){var b=this;var c=Y.getSystem().servicePath+'/$metadata';var r={async:a===undefined?true:a,method:'GET',type:'GET',url:c,processData:false,dataType:'xml',noXSRFToken:true};var d=f.Deferred();var m=Y.getSystem().proxy.ajax(r);if(r.async){m.done(function(h){b._parseResponse(Y,h).then(function(i){d.resolve(i);});});return d.promise();}else{var h=m.responseXML;return b._parseResponse(Y,h);}}};return e;}(f);X=function(f,b,y,t,v,x,d,a,c,e,h,i,m){var j={};j.Sina=function(){this.init.apply(this,arguments);};j.Sina.prototype=f.extend({},b.Sina.prototype,{init:function(){b.Sina.prototype.init.apply(this,arguments);this.rootDataSource=new v.DataSource({label:'All',labelPlural:'All',name:'$$ALL$$',type:d.DataSourceType.CATEGORY,sina:this});},getRootDataSource:function(){return this.rootDataSource;}});j.IMPL_TYPE='ODATA2';b.registerProvider({impl_type:j.IMPL_TYPE,sina:j.Sina,Facet:a.Facet,chartQuery:h.ChartQuery,searchQuery:c.SearchQuery,suggestionQuery:e.SuggestionQuery,perspectiveQuery:i.PerspectiveQuery,metaDataService:new m.MetaDataService(),Filter:t.Filter,FilterCondition:t.Condition,FilterConditionGroup:t.ConditionGroup,DataSource:v.DataSource});return j;}(f,s,O,P,Q,x,v,T,S,U,R,V,W);Y=function(i,a,b,c,d,o,e){var h={};h.getSina=function(j){var x;j=j||{};j.impl_type=j.impl_type||'INAV2';j.impl_type=j.impl_type.toUpperCase();if(j.impl_type==='INAV2'){if(!j.system){x=new a.Proxy(j);if(j.systemType&&j.systemType.toUpperCase()==='HANA'){j.system=new b.HANASystem();}else{j.system=new b.ABAPSystem();}x.setSystem(j.system);x.setXSRFService(j.system.infoUrl);}}else if(j.impl_type==='ODATA2'){if(!j.system){j.system=new e.System();}}else{throw new Error('Unknown provider type: '+j.impl_type);}var Y=new c.provider[j.impl_type].sina(j);Y._provider=c.provider[j.impl_type];return Y;};return h;}(N,A,B,s,x,X,O);window.sina=Y;window.sinabase=s;window.filter=t;}());
