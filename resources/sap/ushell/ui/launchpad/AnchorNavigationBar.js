/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
jQuery.sap.declare("sap.ushell.ui.launchpad.AnchorNavigationBar");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.m.Bar");sap.m.Bar.extend("sap.ushell.ui.launchpad.AnchorNavigationBar",{metadata:{library:"sap.ushell",properties:{"accessibilityLabel":{type:"string",group:"",defaultValue:null},"selectedItemIndex":{type:"int",group:"Misc",defaultValue:0}},aggregations:{"groups":{type:"sap.ushell.ui.launchpad.AnchorItem",multiple:true,singularName:"group"}},events:{"afterRendering":{},"itemPress":{}}}});sap.ushell.ui.launchpad.AnchorNavigationBar.M_EVENTS={'afterRendering':'afterRendering','itemPress':'itemPress'};(function(){"use strict";jQuery.sap.require("sap.ushell.override");var u=sap.ushell.override.updateAggregatesFactory("groups");sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.updateGroups=function(){u.apply(this,arguments);if(this.getDomRef()&&this.getGroups().length){this.reArrangeNavigationBarElements();}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.init=function(){sap.ui.Device.resize.attachHandler(this.reArrangeNavigationBarElements,this);this.bGroupWasPressed=false;this.bIsRtl=sap.ui.getCore().getConfiguration().getRTL();};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.handleExit=function(){if(this.oPopover){this.oPopover.destroy();}if(this.oOverflowButton){this.oOverflowButton.destroy();}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.updateVisibility=function(){var g=this.getGroups(),v=0;for(var i=0;i<g.length;i++){if(g[i].getProperty("visible")){v++;}}if(v>1){this.$().removeClass("sapUshellAnchorNavigationBarInvisible");this.$().next().removeClass("sapUshellSectionNoTop");}else{this.$().addClass("sapUshellAnchorNavigationBarInvisible");this.$().next().addClass("sapUshellSectionNoTop");}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.onAfterRendering=function(){this.reArrangeNavigationBarElements();var s=this.getSelectedItemIndex()||0;setTimeout(function(){this.adjustItemSelection(s);}.bind(this),100);var g=this.getGroups(),t=this;jQuery.each(g,function(i,G){this.attachPress(function(e){t.fireItemPress({group:e.getSource(),manualPress:true});t.bGroupWasPressed=true;});});if(this.bIsRtl){jQuery(".sapUshellAnchorNavigationBarItemsScroll").addClass("sapUshellRtl");}jQuery(".sapUshellAnchorNavigationBarItemsScroll").scroll(this.setNavigationBarItemsVisibility.bind(this));this.updateVisibility();jQuery(".sapUshellAnchorItem:visible:first").attr("accesskey","h");};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.openOverflowPopup=function(){var o=jQuery('.sapUshellAnchorItemOverFlow').hasClass("sapUshellAnchorItemOverFlowOpen");if(this.oOverflowButton&&!o){this.oOverflowButton.firePress();}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.closeOverflowPopup=function(){this.oPopover.close();};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.reArrangeNavigationBarElements=function(){this.anchorItems=this.getVisibleGroups();var s=this.getSelectedItemIndex()||0;if(this.anchorItems.length){this.adjustItemSelection(s);}if(sap.ui.Device.system.phone&&this.anchorItems.length){this.anchorItems.forEach(function(i,a){i.setIsGroupVisible(false);});this.anchorItems[this.getSelectedItemIndex()].setIsGroupVisible(true);}else{setTimeout(function(){this.setNavigationBarItemsVisibility();}.bind(this),200);}this._adjustAnchorBarAriaProperties(this.anchorItems);};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._scrollToGroupByGroupIndex=function(g){var a=sap.ui.Device.system.tablet?jQuery(".sapUshellAnchorNavigationBarItemsScroll"):jQuery(".sapUshellAnchorNavigationBarItems"),b=a.offset()?a.offset().left:0,j=this.anchorItems[g].getDomRef(),s,c;if(j){s=j.offsetLeft;c=this.bIsRtl?this._normalizeScrollBarWidth()+s+64:s-b-48;a.animate({scrollLeft:c},200,this.setNavigationBarItemsVisibility.bind(this));}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._normalizeScrollBarWidth=function(){var l=this.anchorItems[this.anchorItems.length-1].getDomRef().offsetLeft,f=this.anchorItems[0].getDomRef().offsetLeft,t=Math.abs(l)-Math.abs(f);return t;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.setNavigationBarItemsVisibility=function(){if(!sap.ui.Device.system.phone){if(this.anchorItems.length&&(!this.isMostRightAnchorItemVisible()||!this.isMostLeftAnchorItemVisible())||sap.ui.Device.system.phone){this.oOverflowButton.removeStyleClass("sapUshellShellHidden");jQuery('.sapUshellAnchorItemOverFlow').removeClass("sapUshellShellHidden");}else if(this.oOverflowButton){this.oOverflowButton.addStyleClass("sapUshellShellHidden");jQuery('.sapUshellAnchorItemOverFlow').addClass("sapUshellShellHidden");}if(this.bIsRtl){if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").addClass("sapUshellOverflowLeft");}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").removeClass("sapUshellOverflowLeft");}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").addClass("sapUshellOverflowRight");}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").removeClass("sapUshellOverflowRight");}}else{if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").addClass("sapUshellOverflowLeft");}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").removeClass("sapUshellOverflowLeft");}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").addClass("sapUshellOverflowRight");}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden");jQuery(".sapUshellAnchorNavigationBarItems").removeClass("sapUshellOverflowRight");}}jQuery(".sapUshellAnchorItem.firstItem").removeClass("firstItem");var j=jQuery(".sapUshellAnchorItem:visible").first();j.addClass("firstItem");}else{if(this.anchorItems.length){this.oOverflowButton.removeStyleClass("sapUshellShellHidden");var s=this.getSelectedItemIndex()||0;this.oPopover.setTitle(this.anchorItems[s].getTitle());}}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.adjustItemSelection=function(s){setTimeout(function(){if(this.anchorItems&&this.anchorItems.length){this.anchorItems.forEach(function(i){i.setSelected(false);});this.anchorItems[s].setSelected(true);this._scrollToGroupByGroupIndex(s);}}.bind(this),200);};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.isMostRightAnchorItemVisible=function(){var j=jQuery('.sapUshellAnchorNavigationBar'),n=!jQuery.isEmptyObject(j)?j.width():0,a=!jQuery.isEmptyObject(j)&&j.offset()?j.offset().left:0,l=this.bIsRtl?this.anchorItems[0].getDomRef():this.anchorItems[this.anchorItems.length-1].getDomRef(),b=!jQuery.isEmptyObject(l)?jQuery(l).width():0,c;if(b<0){b=80;}c=l&&jQuery(l).offset()?jQuery(l).offset().left:0;if(c+b<=a+n){return true;}return false;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.isMostLeftAnchorItemVisible=function(){var j=jQuery('.sapUshellAnchorNavigationBar'),n=!jQuery.isEmptyObject(j)&&j.offset()?j.offset().left:0,f=this.bIsRtl?this.anchorItems[this.anchorItems.length-1].getDomRef():this.anchorItems[0].getDomRef(),a=!jQuery.isEmptyObject(f)&&jQuery(f).offset()?jQuery(f).offset().left:0;if(a>=n){return true;}return false;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.setSelectedItemIndex=function(s){if(s!==undefined){this.setProperty("selectedItemIndex",s,true);}};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._getOverflowLeftArrowButton=function(){this.oOverflowLeftButton=new sap.m.Button({icon:'sap-icon://slim-arrow-left',tooltip:sap.ushell.resources.i18n.getText("scroll_beginning"),press:function(e){this._scrollToGroupByGroupIndex(0);}.bind(this)}).addStyleClass("sapUshellShellHidden");return this.oOverflowLeftButton;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._getOverflowRightArrowButton=function(){this.oOverflowRightButton=new sap.m.Button({icon:'sap-icon://slim-arrow-right',tooltip:sap.ushell.resources.i18n.getText("scroll_end"),press:function(e){this._scrollToGroupByGroupIndex(this.anchorItems.length-1);}.bind(this)}).addStyleClass("sapUshellShellHidden");return this.oOverflowRightButton;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._getOverflowButton=function(){var t=this,l;if(this.oOverflowButton){return this.oOverflowButton;}l=new sap.m.List({mode:sap.m.ListMode.SingleSelectMaster,rememberSelections:false,selectionChange:function(e){t.fireItemPress({group:e.getParameter('listItem')});t.oPopover.close();}});this.bOverFlowBtnClick=false;this.oPopover=new sap.m.Popover("sapUshellAnchorBarOverflowPopover",{showArrow:false,showHeader:false,placement:"Left",content:[l],horizontalScrolling:false,beforeOpen:function(){jQuery('.sapUshellAnchorItemOverFlow').addClass("sapUshellAnchorItemOverFlowOpen");var j=jQuery(".sapUshellAnchorItemOverFlow"),i=sap.ui.getCore().getConfiguration().getRTL(),o=i?-1*j.outerWidth():j.outerWidth();this.setOffsetX(o);},beforeClose:function(){if(document.activeElement.id===this.oOverflowButton.getId()){this.bOverFlowBtnClick=true;}}.bind(this),afterClose:function(){jQuery('.sapUshellAnchorItemOverFlow').removeClass("sapUshellAnchorItemOverFlowOpen");jQuery('.sapUshellAnchorItemOverFlow').toggleClass("sapUshellAnchorItemOverFlowPressed",false);}}).addStyleClass("sapUshellAnchorItemsPopover").addStyleClass('sapContrastPlus');this.oOverflowButton=new sap.m.Button("sapUshellAnchorBarOverflowButton",{icon:'sap-icon://slim-arrow-down',tooltip:sap.ushell.resources.i18n.getText("more_groups"),press:function(e){var o=false;var c=false;if(!sap.ui.Device.system.desktop){if(this.oPopover.isOpen()){c=true;}else{o=true;}}else{if(!this.bOverFlowBtnClick){o=true;}else{this.bOverFlowBtnClick=false;}}if(c){this.oPopover.close();}else if(o){this.anchorItems=this.getVisibleGroups();l.setModel(this.getModel());var a=this.getModel().getProperty("/tileActionModeActive");var v=new sap.ui.model.Filter('','EQ','a');v.fnTest=function(i){if(!i.visibilityModes[a?1:0]){return false;}return i.isGroupVisible||a;}.bind(this);l.bindItems({path:"/groups",template:new sap.ushell.ui.launchpad.GroupListItem({title:"{title}",groupId:"{groupId}",index:"{index}"}),filters:[v]});var s=jQuery(".sapUshellAnchorItemSelected").attr("id");var S=sap.ui.getCore().byId(s);jQuery.each(l.getItems(),function(i,b){if(S.mProperties.groupId===b.mProperties.groupId){b.addStyleClass("sapUshellAnchorPopoverItemSelected");}else{b.addStyleClass("sapUshellAnchorPopoverItemNonSelected");}});jQuery('.sapUshellAnchorItemOverFlow').toggleClass("sapUshellAnchorItemOverFlowPressed",true);this.oPopover.openBy(this.oOverflowButton);}}.bind(this)}).addStyleClass("sapUshellShellHidden").addStyleClass('sapContrastPlus');return this.oOverflowButton;};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype.getVisibleGroups=function(){return this.getGroups().filter(function(g){return g.getVisible();});};sap.ushell.ui.launchpad.AnchorNavigationBar.prototype._adjustAnchorBarAriaProperties=function(g){var i;for(i=0;i<g.length;i++){var j=jQuery(g[i].getDomRef());j.attr("aria-posinset",i+1);j.attr("aria-setsize",g.length);}};}());
