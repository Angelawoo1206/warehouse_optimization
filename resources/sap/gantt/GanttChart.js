/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/gantt/GanttChartBase","sap/ui/core/Core","sap/ui/table/TreeTable","sap/ui/table/Row","sap/gantt/misc/Utility","sap/ui/core/theming/Parameters","sap/gantt/shape/SelectedShape","sap/gantt/shape/ext/rls/SelectedRelationship","sap/gantt/drawer/ShapeInRow","sap/gantt/drawer/ShapeCrossRow","sap/gantt/drawer/CursorLine","sap/gantt/drawer/NowLine","sap/gantt/drawer/VerticalLine","sap/gantt/drawer/CalendarPattern","sap/gantt/drawer/ExpandedBackground","sap/gantt/config/TimeAxis","sap/gantt/misc/AxisTime","sap/gantt/misc/AxisOrdinal","sap/gantt/misc/Format","sap/gantt/axistime/AxisTimeStrategyBase","sap/gantt/axistime/ProportionZoomStrategy","sap/gantt/config/TimeHorizon","sap/gantt/shape/Group","sap/ui/thirdparty/d3"],function(q,D,G,C,T,R,U,P,S,a,b,c,e,N,V,f,E,h,A,m,F,n,o,p,r){"use strict";var s=G.extend("sap.gantt.GanttChart",{metadata:{aggregations:{_treeTable:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"}}}});s.prototype.init=function(){G.prototype.init.apply(this,arguments);q.sap.measure.start("GanttChart init","GanttPerf:GanttChart init function");this._oTT=new T(this.getId()+"-table",{visibleRowCountMode:"Auto",minAutoRowCount:1,selectionBehavior:sap.ui.table.SelectionBehavior.RowOnly,selectionMode:sap.ui.table.SelectionMode.MultiToggle,columnHeaderVisible:false});this._oRowStatusMap={};this._oTT._bVariableRowHeightEnabled=true;var t=this;this._oTT._collectRowHeights=function(H){var g=T.prototype._collectRowHeights.apply(this,arguments);if(H){return g;}t._aHeights=g;if(t._aHeights[0]!==undefined&&t._aHeights[0]!==0){t._iInferedBaseRowHeightOnTT=t._aHeights[0];}var B=t.getBaseRowHeight();var j=this.getFirstVisibleRow();var k=t._aHeights.length;var M=B;var l=t._getDrawingData([j,j+k-1]);if(l&&l.length>0){M=l[0].rowSpan*B;}for(var i=0;i<k;i++){var u=this.getContextByIndex(j+i);if(u){var v=u.getObject();var w=v?v.uid:undefined;if(w&&t._oRowStatusMap[w]){t._aHeights[i]=t._oRowStatusMap[w].visibleRowSpan*B;}else{t._aHeights[i]=M;}}else{t._aHeights[i]=B;}}return t._aHeights;};this._oColumn=new sap.ui.table.Column();this._oTT.addColumn(this._oColumn);this.setAggregation("_treeTable",this._oTT);this._oTT.attachEvent("_rowsUpdated",this._onTTRowUpdate.bind(this));this._oTT.attachRowSelectionChange(this._onRowSelectionChange,this);this._oTT.addEventDelegate({onAfterRendering:this._bindScrollLogicForTT},this);this._oTT.addEventDelegate({onAfterRendering:this._initialSvgDrawing},this);this._oShapeInRowDrawer=new b();this._oShapeCrossRowDrawer=new c();this._oCursorLineDrawer=new e();this._oCalendarPatternDrawer=new f();this._oExpandedBackgroundDrawer=new E();this._oAxisOrdinal=undefined;this._aFilteredRowData=undefined;this._aShapeInstance=undefined;this._oShapeInstance=undefined;this._oDataNamePerType={};this._oStatusSet=null;this._nLowerRange=0;this._nUpperRange=0;this._aSelectedRelationships=undefined;this._oSelectedShapes={};this._aSelectedShapeUids=undefined;this._aShapeIdsToBeSelected=[];this._bMouseDown=false;this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;this._lastHoverRowIndex=undefined;this._oChartSchemesConfigMap={};this._oChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._fExtendFactor=0.382;var d=new o();this.setAggregation("axisTimeStrategy",d,true);this._mTimeouts={};this._bCanApplyTableTransform=true;this._iFirstVisiableRowIndex=undefined;this._bSuppressHScrollEvent=false;this._bSuppressSetVisibleHorizon=false;q.sap.measure.end("GanttChart init");};s.prototype.setAxisTimeStrategy=function(d){this.setAggregation("axisTimeStrategy",d,true);this._createAxisTime(d);d.attachEvent("_redrawRequest",this._onRedrawRequest,this);this._oStatusSet=null;this._draw(true);return this;};s.prototype._onRedrawRequest=function(d){var g=d.getParameter("forceUpdate");this.redraw(g);};s.prototype.setTimeAxis=function(t){this.setProperty("timeAxis",t,true);if(t){var d=t.getZoomStrategy();this.setAxisTimeStrategy(new o({totalHorizon:t.getPlanHorizon(),visibleHorizon:t.getInitHorizon(),timeLineOption:d[t.getGranularity()],coarsestTimeLineOption:d[t.getCoarsestGranularity()],finestTimeLineOption:d[t.getFinestGranularity()],timeLineOptions:d}));}else{this.setAxisTimeStrategy(null);}};s.prototype.setLocale=function(l){this.setProperty("locale",l,true);var d=this.getAxisTime();if(d){d.setLocale(l);this._updateLocaleInShapeInstances();this._draw(true);}return this;};s.prototype.setChartSchemes=function(d){this.setProperty("chartSchemes",d,true);this._oChartSchemesConfigMap={};if(d){for(var i=0;i<d.length;i++){this._oChartSchemesConfigMap[d[i].getKey()]=d[i];}}this._draw(true);return this;};s.prototype.setObjectTypes=function(O){this.setProperty("objectTypes",O,true);this._oObjectTypesConfigMap={};if(O){for(var i=0;i<O.length;i++){this._oObjectTypesConfigMap[O[i].getKey()]=O[i];}}this._draw(true);return this;};s.prototype.setSelectionMode=function(d){this.setProperty("selectionMode",d,true);if(this._oTT){if(d==sap.gantt.SelectionMode.MultiWithKeyboard){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.MultiToggle);}else if(d==sap.gantt.SelectionMode.Multiple){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.MultiToggle);}else if(d==sap.gantt.SelectionMode.Single){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.Single);}else{this._oTT.setSelectionMode(sap.ui.table.SelectionMode.None);}}return this;};s.prototype._createAxisTime=function(d){if(d){d.createAxisTime(this.getLocale());this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1]);}};s.prototype.setShapes=function(d){this.setProperty("shapes",d,true);if(d&&d.length>0){this._oShapesConfigMap={};for(var i=0;i<d.length;i++){this._oShapesConfigMap[d[i].getKey()]=d[i];}this._parseAndSortShape(this._oShapesConfigMap);this._draw(true);}return this;};s.prototype._parseAndSortShape=function(d,t){var g=[];var l,u,v,w,x,y;for(var i in d){l=t?t:i;u={};if(d[i].getShapeClassName()){u=this._instantiateCustomerClass(d[i].getShapeClassName(),i,d[i],l);var z=u.getCategory(null,this.getAxisTime(),this._oAxisOrdinal);if(!t){y=d[i].getSelectedClassName();if(!y){if(z==sap.gantt.shape.ShapeCategory.Relationship){y="sap.gantt.shape.ext.rls.SelectedRelationship";v=new a();}else{y="sap.gantt.shape.SelectedShape";}}v=this._instantiateCustomerClass(y,"selected"+i,d[i],l,true);u.setAggregation("selectedShape",v);}if(d[i].getGroupAggregation()&&d[i].getGroupAggregation()instanceof Array){w=this._parseAndSortShape(d[i].getGroupAggregation(),l);for(var k=0;k<w.length;k++){u.addShape(w[k]);}}else if(d[i].getClippathAggregation()&&d[i].getClippathAggregation()instanceof Array){x=this._parseAndSortShape(d[i].getClippathAggregation(),l);for(var j=0;j<x.length;j++){u.addPath(x[j]);}}}g.push(u);}if(t){return g;}else{g.sort(function(H,I){var J=q.isNumeric(H.mShapeConfig.getLevel())?H.mShapeConfig.getLevel():99;var K=q.isNumeric(I.mShapeConfig.getLevel())?I.mShapeConfig.getLevel():99;return K-J;});this._aShapeInstance=g;var B={};q.each(this._aShapeInstance,function(K,H){B[H.mShapeConfig.getKey()]=H;});this._oShapeInstance=B;}};s.prototype._instantiateCustomerClass=function(d,g,i,t,j){var k=q.sap.getObject(d);if(!k){q.sap.require(d);k=q.sap.getObject(d);}var l=new k();var u=t;if(u===undefined){u=g;}this._storeCustomerClassId(g,l.getId(),t,j);l.mLocaleConfig=this.getLocale();l.mShapeConfig=i;l.mChartInstance=this;return l;};s.prototype._updateLocaleInShapeInstances=function(){if(this._aShapeInstance){var l=this.getLocale();q.each(this._aShapeInstance,function(k,v){v.mLocaleConfig=l;});}};s.prototype._storeCustomerClassId=function(d,i,t,g){if(!this._customerClassIds){this._customerClassIds={};}if(this._oShapesConfigMap[d]){this._customerClassIds[d]={"classId":i,"topShapeId":t};}else{var j=t+"_"+d;this._customerClassIds[j]={"classId":i,"topShapeId":g?undefined:t};}};s.prototype._getIdByShapeId=function(d){if(this._customerClassIds&&this._customerClassIds[d]){return this._customerClassIds[d].classId;}return null;};s.prototype._getShapeIdById=function(d){if(this._customerClassIds){for(var g in this._customerClassIds){var i=this._customerClassIds[g];if(i.classId===d){return{"shapeId":g,"topShapeId":i.topShapeId};}}}return null;};s.prototype._genShapeConfig=function(d,g){var i={},j;if(d!==null&&d!==undefined){i.shapeId=d;}if(g.data){i.data=g.data;}if(g.level){i.level=g.level;}if(g.draw){j=g.draw;}else{j=g;}for(var k in j){if(k!=="class"){i[k]=j[k];}}return i;};s.prototype.setTimeZoomRate=function(t){this.setProperty("timeZoomRate",t,true);this.getAxisTime().setZoomRate(t);this.redraw(true);return this;};s.prototype.redraw=function(d){if(!this._initHorizonApplied){return;}if(d){this.resetWidthInfo();}this._draw(d);};s.prototype.resetWidthInfo=function(){this.getAxisTime().setViewOffset(0);this._oStatusSet=null;this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1]);};s.prototype.updateRelationships=function(d){var B=this.getBinding("relationships");if(B){var g=B.getContexts(0,0);if(g&&g.length>0){this._aRelationshipsContexts=g;}}this._prepareRelationshipDataFromModel();};s.prototype.addRelationship=function(d){q.sap.log.error("The control manages the relationships aggregation. The method \"addRelationship\" cannot be used programmatically!");};s.prototype.insertRelationship=function(i,d){q.sap.log.error("The control manages the relationships aggregation. The method \"insertRelationship\" cannot be used programmatically!");};s.prototype.removeRelationship=function(d){q.sap.log.error("The control manages the relationships aggregation. The method \"removeRelationship\" cannot be used programmatically!");};s.prototype.getRelationships=function(){q.sap.log.error("The control manages the relationships aggregation. The method \"getRelationships\" cannot be used programmatically!");};s.prototype.destroyRelationships=function(){q.sap.log.error("The control manages the relationships aggregation. The method \"destroyRelationships\" cannot be used programmatically!");};s.prototype.indexOfRelationship=function(d){q.sap.log.error("The control manages the relationships aggregation. The method \"indexOfRelationship\" cannot be used programmatically!");};s.prototype.removeAllRelationships=function(){q.sap.log.error("The control manages the relationships aggregation. The method \"removeAllRelationships\" cannot be used programmatically!");};s.prototype._bindAggregation=function(d,B){if(d=="rows"&&B){var M=this.getModel(B.model);var g=this.getBindingContext(B.model);if(g&&M){B.path=M.resolve(B.path,g);}this._oTT.bindRows(B);}else{return sap.ui.core.Control.prototype._bindAggregation.apply(this,arguments);}};s.prototype.onBeforeRendering=function(){this._bTableReady=false;this._iSvgHeight=0;this._detachEvents();};s.prototype._detachEvents=function(){var d=q("#"+this.getId()+"-svg-ctn");var g=q("#"+this.getId()+"-header");d.unbind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel);d.unbind("wheel.sapUiTableMouseWheel",this._onMouseWheel);d.unbind("mouseleave",this._onSvgMouseLeave);d.unbind("mouseenter",this._onSvgMouseEnter);d.unbind("mousedown",this._onSvgMouseDown);d.unbind("mousemove",this._onSvgMouseMove);d.unbind("mouseup",this._onSvgMouseUp);d.unbind("dblclick",this._onSvgDoubleClick);if(D.support.touch){d.unbind("touchstart",this._onSvgTouchstart);d.unbind("touchend",this._onSvgTouchend);d.unbind("touchmove",this._onSvgTouchmove);g.unbind("touchstart",this._onSvgTouchstart);g.unbind("touchend",this._onSvgTouchend);g.unbind("touchmove",this._onSvgTouchmove);}};s.prototype.onAfterRendering=function(){this._attachEvents();};s.prototype._attachEvents=function(){var d=q("#"+this.getId()+"-svg-ctn");var g=q("#"+this.getId()+"-header");if(D.browser.firefox){d.bind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}else{d.bind("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}d.bind("mouseenter",this._onSvgMouseEnter.bind(this));d.bind("mouseleave",this._onSvgMouseLeave.bind(this));d.bind("mousedown",this._onSvgMouseDown.bind(this));d.bind("mousemove",this._onSvgMouseMove.bind(this));d.bind("mouseup",this._onSvgMouseUp.bind(this));d.bind("dblclick",this._onSvgDoubleClick.bind(this));if(D.support.touch){d.bind("touchstart",this._onSvgTouchstart.bind(this));d.bind("touchend",this._onSvgTouchend.bind(this));d.bind("touchmove",this._onSvgTouchmove.bind(this));g.bind("touchstart",this._onSvgTouchstart.bind(this));g.bind("touchend",this._onSvgTouchend.bind(this));g.bind("touchmove",this._onSvgTouchmove.bind(this));}};s.prototype._getMouseOrTouchPoint=function(d){if(d.targetTouches&&d.targetTouches.length>0){return d.targetTouches[d.targetTouches.length-1];}else if(d.changedTouches&&d.changedTouches.length>0){return d.changedTouches[d.changedTouches.length-1];}return{"pageX":d.pageX,"pageY":d.pageY};};s.prototype._onTouchScrollStart=function(d){if(D.system.combi||D.system.phone||D.system.tablet){this._aTouchStartPosition=null;this._bIsScrollVertical=null;var t=this._getMouseOrTouchPoint(d);this._aTouchStartPosition=[t.pageX,t.pageY];var v=this.getTTVsbDom();if(v){this._iTouchScrollTop=v.scrollTop;}var H=this.getTTHsbDom();if(H){this._iTouchScrollLeft=H.scrollLeft;}}};s.prototype._onTouchScroll=function(d){if((D.system.combi||D.system.phone||D.system.tablet)&&this._aTouchStartPosition){var t=this._getMouseOrTouchPoint(d);var i=(t.pageX-this._aTouchStartPosition[0]);var g=(t.pageY-this._aTouchStartPosition[1]);if(this._bIsScrollVertical==null){this._bIsScrollVertical=Math.abs(g)>Math.abs(i);}if(this._bIsScrollVertical){var v=sap.ui.table.SharedDomRef.VerticalScrollBar;var j=this._oTT.getDomRef(v);if(j){var k=this._iTouchScrollTop-g;if(k>0&&k<(this._oTT.getDomRef(v+"-content").clientHeight-j.clientHeight)-1){this._preventBubbleAndDefault(d);}j.scrollTop=k;}}else{var H=sap.ui.table.SharedDomRef.HorizontalScrollBar;var l=this._oTT.getDomRef(H);if(l){var u=this._iTouchScrollLeft-i;if(u>0&&u<(this._oTT.getDomRef(H+"-content").clientWidth-l.clientWidth)-1){this._preventBubbleAndDefault(d);}l.scrollLeft=u;}}this._bScrolling=true;}};s.prototype._onMouseWheel=function(d){var O=d.originalEvent;var i=O.shiftKey;var g=0;if(D.browser.firefox){g=O.detail;}else{if(i){if(D.browser.msie||D.browser.edge){g=O.deltaY;}else{g=O.deltaX;}}else{g=O.deltaY;}}if(i){var H=sap.ui.table.SharedDomRef.HorizontalScrollBar;var j=this._oTT.getDomRef(H);if(j){var k=j.scrollLeft+g;if(k>0&&k<(this._oTT.getDomRef(H+"-content").clientWidth-j.clientWidth)-1){this._preventBubbleAndDefault(d);}j.scrollLeft=k;}}else{var v=sap.ui.table.SharedDomRef.VerticalScrollBar;var l=this._oTT.getDomRef(v);if(l){var t=l.scrollTop+g;if(t>0&&t<(this._oTT.getDomRef(v+"-content").clientHeight-l.clientHeight)-1){this._preventBubbleAndDefault(d);}l.scrollTop=t;}}};s.prototype.handleExpandChartChange=function(d,g,i){i=i?i:this._oTT.getSelectedIndices();if(i.length>0){this._updateRowStatusMap(d,g,i);this._oTT.updateRows();}};s.prototype.invertRowExpandStatus=function(d,g){d=d?d:this._oTT.getSelectedIndices();if(d.length>0&&g){for(var i=0;i<d.length;i++){var I=d[i];var j=this._ifRowExpanded(I,g);if(j!==null){this._updateRowStatusMap(!j,g,[I]);}}this._oTT.updateRows();}};s.prototype._ifRowExpanded=function(i,d){var t=this._oTT;var B=t.getBinding();var g=B.getContextByIndex(i);var j=null;if(g){var k=g.getObject();var u=k.uid;var l=this._getRowSpanWithData(k,d),v=l.name;if(u&&this._oRowStatusMap[u]&&this._oRowStatusMap[u][v]){j=true;}else{j=false;}}return j;};s.prototype._updateRowStatusMap=function(d,g,j){var t=this._oTT;var B=t.getBinding();for(var i=0;i<j.length;i++){var I=j[i];var k=B.getContextByIndex(I);if(k){var l=k.getObject();var u=l.uid;if(u){var v=this._getRowSpanWithData(l,g),w=v.name;if(d){if(this._oRowStatusMap[u]){this._oRowStatusMap[u][w]=v;}else{this._oRowStatusMap[u]={};this._oRowStatusMap[u][w]=v;}}else if(!d&&this._oRowStatusMap[u]){delete this._oRowStatusMap[u][w];delete this._oRowStatusMap[u].visibleRowSpan;if(q.isEmptyObject(this._oRowStatusMap[u])){delete this._oRowStatusMap[u];continue;}}this._getDrawingData([I,I]);}}}};s.prototype.isRowExpanded=function(){var d=!q.isEmptyObject(this._oRowStatusMap);return d;};s.prototype._getRowSpanWithData=function(d,g){var i=1,j=null,k=null;for(var l=0;l<g.length;l++){var t=g[l];var M;if(this._oChartSchemesConfigMap[t]&&this._oChartSchemesConfigMap[t].getModeKey()){M=this._oChartSchemesConfigMap[t].getModeKey();}else{M=this.getMode();}if(this._oObjectTypesConfigMap[d.type]&&this._oObjectTypesConfigMap[d.type].getExpandedChartSchemeKeys().length>0){var v=this._oObjectTypesConfigMap[d.type].getExpandedChartSchemeKeys();if($.inArray(t,v)>-1){var u=this._collectDataNameForValidChartScheme(t,M);if(u){k=u.drawData;i+=u.rowSpan;j=t;}}}}return{rowSpan:i,name:j,data:k};};s.prototype._updateTableRowHeights=function(){if(this._aHeights){this._oTT._updateRowHeights(this._aHeights,false);}};s.prototype.notifySourceChange=function(){this._oTT.setFirstVisibleRow(0);this.resetRowStatusMap();};s.prototype.resetRowStatusMap=function(){this._oRowStatusMap={};};s.prototype._collectDataNameForValidChartScheme=function(d,M){if(this._oChartSchemesConfigMap[d]){var g=[],i;var j=this._oChartSchemesConfigMap[d].getShapeKeys();i=this._oChartSchemesConfigMap[d].getRowSpan();var t=this;q.each(j,function(k,v){if(t._oShapesConfigMap[v]){var l=t._oShapesConfigMap[v].getModeKeys();if((l&&l.length>0&&$.inArray(M,l)>-1)||l.length==0||M==sap.gantt.config.DEFAULT_MODE_KEY){g.push(t._oShapesConfigMap[v].getShapeDataName());}}});if(g.length>0&&i>=1){return{"drawData":g,"rowSpan":i};}}};s.prototype._composeParameterForClickPosition=function(d){var g=q("#"+this.getId()+"-svg");var i=this._getSvgCoodinateByDiv(g[0],d.pageX,d.pageY);var x=d.pageX-g.offset().left||d.offsetX;var y=d.pageY-g.offset().top||d.offsetY;if(!this._oAxisOrdinalOfVisibleRow){return null;}var j=this.getAxisTime().viewToTime(x);var l,L=this._oAxisOrdinalOfVisibleRow.viewToRowIndex(y,this._getVisibleRowCount())+this._oTT.getFirstVisibleRow();var k=this._oTT.getContextByIndex(L);if(k){l=this._getRowById(k.getObject()?k.getObject().id:null);}var t=false;var u=this._oAxisOrdinal.viewToElementIndex(y);var v=this._aFilteredRowData[u];if(v&&v.index&&v.index!==0){t=true;}var w={"startTime":j,"svgPoint":i,"leadingRowNum":L,"leadingRowInfo":l,"rowIndex":u,"rowInfo":v,"isExpandedRow":t};return w;};s.prototype.getAllRowData=function(){var B=this._oTT.getBinding("rows");return this._getDrawingData([0,B.getLength()-1]);};s.prototype.getAllSelections=function(){var d=this.getSelectedRows();var g=this.getSelectedShapes();var i=this.getSelectedRelationships();var j={"rows":d,"shapes":g,"relationships":i};return j;};s.prototype.getSelectedRows=function(){var d=[];var g=this._oTT.getSelectedIndices();var k=this.getAllRowData();var M=[];for(var i=0;i<k.length;i++){if(k[i]&&!k[i].parentId){M.push(k[i]);}}for(var j=0;j<g.length;j++){if(g[j]>-1&&g[j]<M.length&&M[g[j]]){d.push(M[g[j]]);}}return d;};s.prototype.getSelectedShapes=function(){this._setSelectedStatusFromData(this.getShapeDataNames(),this.getAllRowData());return this._oSelectedShapes;};s.prototype.getSelectedRelationships=function(){return this._aSelectedRelationships;};s.prototype.getRowByShapeUid=function(d){return this._getRowByShapeUid(d);};s.prototype.selectShapes=function(I,d){if(!this._aFilteredRowData||!this._aFilteredRowData.length>0){if(d){this._aShapeIdsToBeSelected=[];}this._aShapeIdsToBeSelected=this._aShapeIdsToBeSelected.concat(I);}var i,j,g,k;if(this._aSelectedShapeUids===undefined){this._aSelectedShapeUids=[];}if(!I||I.length<1){this._oSelectedShapes={};this._aSelectedShapeUids=[];}else if(d){this._oSelectedShapes={};this._aSelectedShapeUids=[];for(i=0;i<I.length;i++){g=this._getShapeDataById(I[i],false);for(j=0;j<g.length;j++){k=g[j];if(this._judgeEnableSelection(k)){this._selectShape(k);}}}}else{for(i=0;i<I.length;i++){g=this._getShapeDataById(I[i],false);for(j=0;j<g.length;j++){k=g[j];if(q.inArray(k.uid,this._aSelectedShapeUids)>-1){continue;}else if(this._judgeEnableSelection(k)){this._selectShape(k);}}}}this._drawSelectedShapes();return this;};s.prototype.deselectShapes=function(I){if(!I||I.length<1){this._oSelectedShapes={};this._aSelectedShapeUids=[];this._drawSelectedShapes();return this;}for(var i=0;i<I.length;i++){var d=this._getShapeDataById(I[i]);for(var j=0;j<d.length;j++){this._deselectShape(d[j]);}}this._drawSelectedShapes();return this;};s.prototype.selectRowsAndShapes=function(I,d){if(!I||I.length<1){this.deselectShapes();this.deselectRows();return this;}this.selectRows(I,d);if(d){this._oSelectedShapes={};this._aSelectedShapeUids=[];}if(!this._aSelectedShapeUids){this._aSelectedShapeUids=[];}for(var g in I){var j=I[g];var k=this._getRowById(j);if(k){for(var l in k.data){if(k.data[l]instanceof Array){for(var i=0;i<k.data[l].length;i++){var t=k.data[l][i];if(q.inArray(t.uid,this._aSelectedShapeUids)<0){this._selectShape(t);}}}}}}this._drawSelectedShapes();return this;};s.prototype.selectRelationships=function(I,d){var i,g;if(!this._aSelectedRelationships){this._aSelectedRelationships=[];}if(!I||I.length<1){if(this._aSelectedRelationships.length>0){this._aSelectedRelationships=[];this._drawSelectedShapes();}return this;}if(d){this._aSelectedRelationships=[];for(i=0;i<I.length;i++){g=this._getShapeDataById(I[i],true)[0];if(g&&this._judgeEnableSelection(g)){this._aSelectedRelationships.push(g);}}}else{for(i=0;i<I.length;i++){g=this._getShapeDataById(I[i],true)[0];if(!g||q.inArray(g,this._aSelectedRelationships)>=0){continue;}else if(this._judgeEnableSelection(g)){this._aSelectedRelationships.push(g);}}}this._drawSelectedShapes();return this;};s.prototype.deselectRelationships=function(I){var u=[];if(!I||I.length<1){this._aSelectedRelationships=[];this._drawSelectedShapes();return this;}if(I){for(var i=0;i<I.length;i++){var d=this._getUidById(I[i],true)[0];if(d!==undefined){u.push(d);}}}for(var j in this._aSelectedRelationships){var g=this._aSelectedRelationships[j];if(q.inArray(g.uid,u)>-1){var k=this._aSelectedRelationships.indexOf(g);this._aSelectedRelationships.splice(k,1);}}this._drawSelectedShapes();return this;};s.prototype.selectRows=function(i,I){var B=this.getAllRowData();var d=this._oTT.getSelectedIndices();if(I&&d.length>0){this._oTT.clearSelection();}for(var g=0;g<B.length;g++){if(q.inArray(B[g].id,i)>-1&&q.inArray(g,d)<0){var j=this._oTT.getSelectionMode();if(j===sap.ui.table.SelectionMode.Multi||j===sap.ui.table.SelectionMode.MultiToggle){this._oTT.addSelectionInterval(g,g);}else{this._oTT.setSelectedIndex(g);}}}return this;};s.prototype.deselectRows=function(I){if(!I||I.length<1){this._oTT.clearSelection();return this;}var d=this._oTT.getSelectedIndices();var B=this.getAllRowData();for(var i=0;i<d.length;i++){var g=d[i];if(q.inArray(B[g].id,I)>-1){this._oTT.removeSelectionInterval(g,g);}}return this;};s.prototype.expandToLevel=function(l){this._oTT.expandToLevel(l);return this;};s.prototype._isRelationship=function(d){if(U.getShapeDataNameByUid(d)===sap.gantt.shape.ShapeCategory.Relationship){return true;}return false;};s.prototype._onRowSelectionChange=function(d){this.fireRowSelectionChange({originEvent:d});};s.prototype._selectionChange=function(d,g,i,j){if(this._aSelectedRelationships==undefined){this._aSelectedRelationships=[];}if(this._aSelectedShapeUids==undefined){this._aSelectedShapeUids=[];}var k=false;var l=false;var t=d.uid;var u=this._isRelationship(t);if((g&&this.getSelectionMode()===sap.gantt.SelectionMode.MultiWithKeyboard)||this.getSelectionMode()===sap.gantt.SelectionMode.Multiple){if(!u){if(this._aSelectedShapeUids!==undefined&&q.inArray(t,this._aSelectedShapeUids)>-1){if(!this._bDragging){k=this._deselectShape(d);}}else{k=this._selectShape(d);}}else{if(q.inArray(d,this._aSelectedRelationships)<0){this._aSelectedRelationships.push(d);}else{var v=this._aSelectedRelationships.indexOf(d);this._aSelectedRelationships.splice(v,1);}l=true;}}else if(!u){if((q.inArray(t,this._aSelectedShapeUids)<0||this._aSelectedShapeUids.length>1)&&!this._bDragging){this._oSelectedShapes={};this._aSelectedShapeUids=[];k=true;}if(q.inArray(t,this._aSelectedShapeUids)<0){var w=this._selectShape(d);if(!k&&w){k=true;}}if(this._aSelectedRelationships.length>0){this._aSelectedRelationships=[];l=true;}}else{if((q.inArray(d,this._aSelectedRelationships)<0)||this._aSelectedRelationships.length>1){this._aSelectedRelationships=[];this._aSelectedRelationships.push(d);l=true;}if(this._aSelectedShapeUids!==undefined&&this._aSelectedShapeUids.length>0){this._oSelectedShapes={};this._aSelectedShapeUids=[];k=true;}}if(k||l){this._drawSelectedShapes();}return{shapeSelectionChange:k,relationshipSelectionChange:l};};s.prototype._setSelectedStatusToData=function(){var d=this.getAllRowData();if(d&&d.length>0&&this._aShapeIdsToBeSelected.length>0){for(var k in this._aShapeIdsToBeSelected){var g=this._getShapeDataById(this._aShapeIdsToBeSelected[k],false);for(var l in g){this._selectShape(g[l]);}}}for(var t in d){var u=d[t];for(var v in u.data){var w=u.data[v];if(w instanceof Array){for(var I=0;I<w.length;I++){var x=w[I];if(q.inArray(x.uid,this._aSelectedShapeUids)>-1){x.selected=true;}else{x.selected=false;}}}}}for(var i in this._aRelationships){this._aRelationships[i].selected=false;if(this._aSelectedRelationships!==undefined&&this._aSelectedRelationships.length>0){for(var j in this._aSelectedRelationships){if(this._aRelationships[i].uid===this._aSelectedRelationships[j].uid){this._aRelationships[i].selected=true;}}}}};s.prototype._setSelectedStatusFromData=function(d,g){this._oSelectedShapes=this._oSelectedShapes?this._oSelectedShapes:{};this._aSelectedShapeUids=this._aSelectedShapeUids?this._aSelectedShapeUids:[];this._bSelectedStatusUpdated=true;var u=[];for(var l in g){var t=g[l];for(var v in t.data){var w=t.data[v];if(w instanceof Array&&q.inArray(v,d)>-1){for(var i=0;i<w.length;i++){var x=w[i];if(q.inArray(x.uid,this._aSelectedShapeUids)>-1){for(var k=0;k<this._oSelectedShapes[v].length;k++){if(this._oSelectedShapes[v][k].shapeUid===x.uid){this._oSelectedShapes[v][k].shapeData=x;this._oSelectedShapes[v][k].objectInfoRef=t;u.push(x.uid);break;}}}else if(x.selected){this._oSelectedShapes[v]=this._oSelectedShapes[v]?this._oSelectedShapes[v]:[];this._oSelectedShapes[v].push({"shapeUid":x.uid,"shapeData":x,"objectInfoRef":t});this._aSelectedShapeUids.push(x.uid);u.push(x.uid);}}}}}if(u.length<1){this._oSelectedShapes={};}else{for(var y in this._oSelectedShapes){for(var z=this._oSelectedShapes[y].length-1;z>=0;z--){var B=this._oSelectedShapes[y][z];if(q.inArray(B.shapeUid,u)<0){this._oSelectedShapes[y].splice(z,1);}}}}this._aSelectedShapeUids=u;this._aSelectedRelationships=this._aSelectedRelationships?this._aSelectedRelationships:[];var H=[];for(var j in this._aRelationships){var I=false;for(var J=0;J<this._aSelectedRelationships.length;J++){if(this._aSelectedRelationships[J].uid===this._aRelationships[j].uid){H.push(this._aRelationships[j]);I=true;break;}}if(!I&&this._aRelationships[j].selected){H.push(this._aRelationships[j]);}}this._aSelectedRelationships=H;};s.prototype._syncTTSelection=function(d){q.sap.measure.start("GanttChart syncTTSelection","GanttPerf:GanttChart syncTTSelection function");var t=this._getMouseOrTouchPoint(d);var g=d.shiftKey;var i=d.ctrlKey;var j=q("#"+this.getId()+"-svg")[0];var k=this._getSvgCoodinateByDiv(j,t.pageX,t.pageY);var l=parseInt(this._oAxisOrdinalOfVisibleRow.viewToElementIndex(k.y),10);if(l<0){return false;}var v=this._oTT.getRows();var I,u=d3.select("#"+v[l].getId());if(l<v.length&&u&&u.attr("data-sap-ui-rowindex")){I=this._oTT.getFirstVisibleRow()+parseInt(u.attr("data-sap-ui-rowindex"),10);}var w=this._oTT.getSelectionMode();if(I>=0&&w!==sap.ui.table.SelectionMode.None){if(w===sap.ui.table.SelectionMode.Single){if(!this._oTT.isIndexSelected(I)){this._oTT.setSelectedIndex(I);}else{this._oTT.clearSelection();}}else{i=true;if(g){var x=this._oTT.getSelectedIndex();if(x>=0){if(x<I){this._oTT.addSelectionInterval(x,I);}else{this._oTT.addSelectionInterval(I,x);}}else{this._oTT.setSelectedIndex(I);}}else if(!this._oTT.isIndexSelected(I)){if(i){this._oTT.addSelectionInterval(I,I);}else{this._oTT.setSelectedIndex(I);}}else if(i){this._oTT.removeSelectionInterval(I,I);}else if(this._oTT.getSelectedIndices().length>1){this._oTT.setSelectedIndex(I);}}}q.sap.measure.end("GanttChart syncTTSelection");};s.prototype._setEventStatus=function(d){switch(d){case"dragEnter":this._bDragStart=true;break;case"mouseDown":this._bMouseDown=true;this._bDragging=false;this._bDragStart=false;this._bScrolling=false;break;case"shapeDragStart":this._bDragStart=true;break;case"shapeDragging":if(this._bDragStart){this._bDragging=true;}break;case"mouseUp":this._bMouseDown=false;this._bScrolling=false;break;case"shapeDragEnd":this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;break;case"dragLeave":this._bDragging=false;this._bDragStart=false;break;default:break;}};s.prototype._handleShapeDragStart=function(d){var g=q("#"+this.getId()+"-svg");var j=d3.select(d.target).data()[0];var k=d.target.getAttribute("class").split(" ")[0];if(j!==undefined&&this._judgeEnableDnD(j,k)){var l=this._getRowByShapeUid(j.uid);if(l){var x=d.pageX-g.offset().left||d.offsetX;var y=d.pageY-g.offset().top||d.offsetY;var t,u;if(d.target.getAttribute("x")&&d.target.getAttribute("width")){t=parseInt(d.target.getAttribute("x"),10);u=parseInt(d.target.getAttribute("width"),10);}else if(j.startTime){var v=this.getAxisTime().timeToView(F.abapTimestampToDate(j.startTime));var w=this.getAxisTime().timeToView(F.abapTimestampToDate(j.endTime));if(C.getConfiguration().getRTL()){t=w;u=(v-w)>0?(v-w):1;}else{t=v;u=(w-v)>0?(w-v):1;}}else{t=x;u=1;}var z={"x":x,"y":y,"shapeX":t,"shapeWidth":u};var B=[];B.push({"shapeData":j,"objectInfo":l});for(var H in this._oSelectedShapes){var I=this._oSelectedShapes[H];if(I!==undefined){for(var i in I){if(I[i].shapeUid!==j.uid&&this._judgeEnableDnD(I[i].shapeData)){B.push({"shapeData":I[i].shapeData,"objectInfo":I[i].objectInfoRef});}}}}this._oDraggingData={"sourceShapeData":B,"dragStartPoint":z,"sourceSvgId":this.getId(),"targetSvgId":this.getId(),"domObject":this._getDraggingDomObjs(d)};this._setEventStatus("shapeDragStart");q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q(document.body).bind("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));q(document).bind("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));}}};s.prototype._getDraggingDomObjs=function(d){var g=d3.select(d.target)[0][0];var i;if(g.parentElement){i=g.parentElement.getAttribute("class");}else if(g.parentNode){i=g.parentNode.getAttribute("class");}if(i){var t=i.split(" ")[0];if(sap.ui.getCore().byId(t)instanceof sap.gantt.shape.Group){return g.parentNode.childNodes;}}return[g];};s.prototype._handleShapeDragging=function(d){if(!D.support.touch&&(d.button!==0||d.buttons===0||d.ctrlKey)){return false;}var j=q("#"+this.getId()+"-svg");var l=Math.abs((d.pageX-j.offset().left||d.offsetX)-this._oDraggingData.dragStartPoint.x);var t=Math.abs((d.pageY-j.offset().top||d.offsetY)-this._oDraggingData.dragStartPoint.y);if(l>3||t>3){var u=d3.select("#dragDropShadow");var v=u[0];if(this._oDraggingData===undefined){if(!u.empty()){u.remove();}}else{var w=this._oDraggingData.dragStartPoint.shapeX;var x=this._oDraggingData.dragStartPoint.x;if(u.empty()||v===null){this._handleDragWithoutSelection(d);var y=this._oDraggingData.sourceShapeData.length;v=d3.select("body").append("div").attr("id","dragDropShadow");v.classed("sapGanttDraggingShadow",true);var z=[];var B=12;var H=10;var I=12;for(var i=0;i<this._oDraggingData.domObject.length;i++){var J=d3.select(this._oDraggingData.domObject[i]);if(!J.empty()){var K=parseInt(J.attr("width"),10);var L=parseInt(J.attr("height"),10);var M=J.attr("transform");B=K>B?K:B;H=L>H?L:H;var O="";if(M){var Q=M.split(")");for(var W=0;W<Q.length-1;W++){if(Q[W].indexOf("translate")<0){O=O+Q[W]+") ";}}O.replace("))",")");}var X=d3.select(this._oDraggingData.domObject[i].cloneNode()).classed("shadow",true).attr("fill-opacity","0.5").attr("x",0).attr("y",0).attr("transform",O);z.push(X);}}var g=v.append("svg").attr("id","dragDropShadowSvg").attr("width",B).append("g").attr("id","dragDropShadowSvgGroup");for(var k=0;k<z.length;k++){g.node().appendChild(z[k].node());}g.append("text").attr("x",B/2-I/2).attr("y",H-I/2+4).attr("fill","blue").attr("font-size",I).text(function(){return y;});}var Y=w+(d.pageX-x);var Z=d.pageY;d3.select("#dragDropShadow").style("left",Y+4+"px");d3.select("#dragDropShadow").style("top",Z+4+"px");q(document.body).addClass("sapGanttDraggingCursor");this._setEventStatus("shapeDragging");}}};s.prototype._handleDragWithoutSelection=function(d){if(q.inArray(this._oDraggingData.sourceShapeData[0].shapeData.uid,this._aSelectedShapeUids)<0){var g=false;if(this.getSelectionMode()!==sap.gantt.SelectionMode.Multiple){if(this._aSelectedShapeUids&&this._aSelectedShapeUids.length>0){this._aSelectedShapeUids=[];this._oSelectedShapes={};this._oDraggingData.sourceShapeData.splice(1,this._oDraggingData.sourceShapeData.length-1);}if(this._aSelectedRelationships&&this._aSelectedRelationships.length>0){this._aSelectedRelationships=[];g=true;}}this._selectShape(this._oDraggingData.sourceShapeData[0].shapeData);this._drawSelectedShapes();this.fireShapeSelectionChange({originEvent:d});if(g){this.fireRelationshipSelectionChange({originEvent:d});}}};s.prototype._handleShapeDragEnd=function(d){var g=d3.select("#dragDropShadow");if(!g.empty()){g.remove();}if(this._bDragging&&this._oDraggingData!==undefined){var t=this.getId();this._collectDraggingShapeData(this._oDraggingData,d);this.fireShapeDragEnd({originEvent:d,sourceSvgId:this._oDraggingData.sourceSvgId,targetSvgId:t,sourceShapeData:this._oDraggingData.sourceShapeData,targetData:this._oDraggingData.targetData});}q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q(document.body).removeClass("sapGanttDraggingCursor");this._setEventStatus("shapeDragEnd");};s.prototype._collectDraggingShapeData=function(d,g){var i=q("#"+this.getId()+"-svg");var x=g.pageX-i.offset().left||g.offsetX;var j=d.dragStartPoint.x;var k=parseInt(x,10)-parseInt(j,10);var l=parseInt(d.dragStartPoint.shapeX,10)+k;var t=l+parseInt(d.dragStartPoint.shapeWidth,10);var u,v;if(C.getConfiguration().getRTL()===true){u=this.getAxisTime().viewToTime(t).getTime();v=this.getAxisTime().viewToTime(l).getTime();}else{u=this.getAxisTime().viewToTime(l).getTime();v=this.getAxisTime().viewToTime(t).getTime();}var w=this._composeParameterForClickPosition(g);var y=w?w.rowInfo:undefined;d.targetData={"mouseTimestamp":{startTime:u,endTime:v},"mode":this.getMode(),"objectInfo":y};};s.prototype.setDraggingData=function(d){this._oDraggingData=d;if(this._oDraggingData!==undefined){this._oDraggingData.targetSvgId=this.getId();q(document.body).unbind("mousemove.ganttChartDragDrop");q(document).unbind("mouseup.ganttChartDragDrop");q(document.body).bind("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));q(document).bind("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));this._setEventStatus("dragEnter");}};s.prototype._onSvgMouseEnter=function(d){if(d.button===0&&d.buttons!==0&&d.target&&!this._bDragging&&(d.target.id===this.getId()+"-svg-ctn"||d.target.id===this.getId()+"-svg"||this._mouseInSvgCtn(d))){this.fireChartDragEnter({originEvent:d});}};s.prototype._onSvgMouseLeave=function(d){if(d.target&&(d.target.id===this.getId()+"-svg-ctn"||d.target.id===this.getId()+"-svg"||!this._mouseInSvgCtn(d))){if(this._bDragStart&&this._oDraggingData!==undefined){this._handleDragLeave(d);}this._destroyCursorLine();this._handleHoverLeave();}};s.prototype._mouseInSvgCtn=function(d){var g=q("#"+this.getId()+"-svg-ctn");var i=g.width()-((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width());var j=g.height()-q(this.getTTHsbDom()).height();var k=g.offset();var l=(d.pageX||d.clientX)-k.left;var t=(d.pageY||d.clientY)-k.top;if(t>=0&&t<j-2&&l>=0&&l<i-2){return true;}return false;};s.prototype._onSvgMouseDown=function(d){this._prepareSelection(d);this._prepareDragging(d);};s.prototype._onSvgMouseMove=function(d){this._drawCursorLine(d);this._handleHover(d);};s.prototype._onSvgMouseUp=function(d){if(d.button==2){this._handleRightClick(d);}else if(d.button==0&&!this._bDragging&&this._bMouseDown){this._handleSelectionChange(d);}};s.prototype._onSvgDoubleClick=function(d){if(!this._bDragging&&!d.ctrlKey&&!d.shiftKey){var g=this._composeParameterForClickPosition(d);this.fireChartDoubleClick({objectInfo:g?g.rowInfo:undefined,leadingRowInfo:g?g.leadingRowInfo:undefined,timestamp:g?g.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:g?g.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});}};s.prototype._onSvgTouchstart=function(d){this._prepareSelection(d);this._onTouchScrollStart(d);};s.prototype._onSvgTouchmove=function(d){this._onTouchScroll(d);};s.prototype._onSvgTouchend=function(d){if(!this._bScrolling){this._handleSelectionChange(d);}else{this._setEventStatus("mouseUp");this._oLastSelectedShape=undefined;}};s.prototype._preventBubbleAndDefault=function(d){d.preventDefault();d.stopPropagation();};s.prototype._prepareSelection=function(d){if(!D.support.touch&&d.button!==0){return false;}if(!this._bDragging){var g=d3.select(d.target).data()[0];var i;if(d.target.getAttribute("class")){i=d.target.getAttribute("class").split(" ")[0];}if(i&&g&&this._judgeEnableSelection(g,i)){this._oLastSelectedShape=g;}this._setEventStatus("mouseDown");}};s.prototype._prepareDragging=function(d){if(d.button==0){var g=d3.select(d.target).data()[0];var i;if(d.target.getAttribute("class")){i=d.target.getAttribute("class").split(" ")[0];}if(i&&g&&this._judgeEnableSelection(g,i)){if(this._bMouseDown){this._handleShapeDragStart(d);}this._preventBubbleAndDefault(d);}}};s.prototype._handleRightClick=function(d){var g=this._composeParameterForClickPosition(d);this.fireChartRightClick({objectInfo:g?g.rowInfo:undefined,leadingRowInfo:g?g.leadingRowInfo:undefined,timestamp:g?g.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:g?g.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});};s.prototype._handleClick=function(d){var g=this._composeParameterForClickPosition(d);this.fireChartClick({objectInfo:g?g.rowInfo:undefined,leadingRowInfo:g?g.leadingRowInfo:undefined,timestamp:g?g.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:g?g.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});};s.prototype._drawCursorLine=function(d){if(this.getEnableCursorLine()){var g=q("#"+this.getId()+"-svg");var i=this._getSvgCoodinateByDiv(g[0],d.pageX||d.clientX,d.pageY||d.clientY);this._oCursorLineDrawer.drawSvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"),this.getLocale(),i);}};s.prototype._destroyCursorLine=function(){if(this.getEnableCursorLine()){this._oCursorLineDrawer.destroySvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"));}};s.prototype._handleHover=function(d){var g=this._composeParameterForClickPosition(d);var i=g?g.leadingRowNum-this._oTT.getFirstVisibleRow():-1;i=i<0?-1:i;var j=g?g.isExpandedRow:false;var k=d3.select(d.target).data()[0];if(i>-1&&((k!==undefined&&k.uid!==this._lastHoverShapeUid)||(k===undefined&&this._lastHoverShapeUid!==undefined)||i!==this._lastHoverRowIndex)){this.fireChartMouseOver({objectInfo:g?g.rowInfo:undefined,leadingRowInfo:g?g.leadingRowInfo:undefined,timestamp:g?g.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:g?g.svgPoint:undefined,effectingMode:this.getMode(),originEvent:d});if(k!==undefined){this._lastHoverShapeUid=k.uid;}else{this._lastHoverShapeUid=undefined;}}if(i>-1&&i!==this._lastHoverRowIndex){var t=this._oTT;var H=t.getRows()[i];if(H){t.$().find(".sapUiTableRowHvr").trigger("mouseout");if(!j){H.$().trigger("mouseover");}}}if(i!==this._lastHoverRowIndex){this._lastHoverRowIndex=i;}};s.prototype._handleDragLeave=function(d){this._oDraggingData.targetSvgId=undefined;this._setEventStatus("dragLeave");this.fireChartDragLeave({originEvent:d,draggingSource:this._oDraggingData});};s.prototype._handleHoverLeave=function(){var t=this._oTT;t.$().find(".sapUiTableRowHvr").trigger("mouseleave");this._lastHoverShapeUid=undefined;this._lastHoverRowIndex=-1;};s.prototype._handleSelectionChange=function(d){this._aShapeIdsToBeSelected=[];var g=d3.select(d.target).data()[0];var i;if(d.target.getAttribute("class")){i=d.target.getAttribute("class").split(" ")[0];}var j={};if(g!==undefined&&this._judgeEnableSelection(g,i)&&this._oLastSelectedShape!==undefined&&this._oLastSelectedShape.uid===g.uid){j=this._selectionChange(g,d.ctrlKey,d.shiftKey,d);}else if(this.getSelectionMode()===sap.gantt.SelectionMode.MultiWithKeyboard){var k=this._composeParameterForClickPosition(d);if(k&&!k.isExpandedRow){this._syncTTSelection(d);this._oLastSelectedShape=undefined;}else{return null;}}else{if(this._aSelectedShapeUids!==undefined&&this._aSelectedShapeUids.length>0){this._oSelectedShapes={};this._aSelectedShapeUids=[];j.shapeSelectionChange=true;}if(this._aSelectedRelationships.length>0){this._aSelectedRelationships=[];j.relationshipSelectionChange=true;}if(j.shapeSelectionChange||j.relationshipSelectionChange){this._drawSelectedShapes();}}this._setEventStatus("mouseUp");this._oLastSelectedShape=undefined;if(j.shapeSelectionChange){this.fireShapeSelectionChange({originEvent:d});}if(j.relationshipSelectionChange){this.fireRelationshipSelectionChange({originEvent:d});}this._handleClick(d);};s.prototype._bindScrollLogicForTT=function(){this._bindHorizontalScroll();this._bindVerticalScroll();};s.prototype._bindHorizontalScroll=function(){this._updateScrollLeft();var d=q(this.getTTHsbDom());d.unbind("scroll.sapUiTableHScroll");d.unbind("scroll.sapUiTableHScrollForGanttChart",this._onHSbScroll);d.bind("scroll.sapUiTableHScrollForGanttChart",q.proxy(this._onHSbScroll,this));};s.prototype._bindVerticalScroll=function(){var d=q(this.getTTVsbDom());d.unbind("scroll.sapUiTableVScrollForGanttChart",this._onVSbScroll);d.bind("scroll.sapUiTableVScrollForGanttChart",q.proxy(this._onVSbScroll,this));};s.prototype._getSvgHeight=function(){return this._oTT.$().find(".sapUiTableCCnt").height();};s.prototype._getRowHeights=function(){return this._aHeights;};s.prototype.setBaseRowHeight=function(d){this.setProperty("baseRowHeight",d);this._oTT.setRowHeight(d);};s.prototype._setInferedBaseRowHeight=function(d){this._iInferedBaseRowHeight=d;};s.prototype.getBaseRowHeight=function(){return this._iInferedBaseRowHeight?this._iInferedBaseRowHeight:this._iInferedBaseRowHeightOnTT;};s.prototype._initialSvgDrawing=function(){if(this.getBaseRowHeight()&&this._iSvgHeight!=this._getSvgHeight()){this._iSvgHeight=this._getSvgHeight();this._bTableReady=true;this._onTTRowUpdate();}};s.prototype._onHSbScroll=function(d){if(this._initHorizonApplied){var g=q(this.getTTHsbDom());var i=(C.getConfiguration().getRTL()&&D.browser.firefox)?g.scrollLeftRTL():g.scrollLeft();if(!this._bSuppressSetVisibleHorizon){var j=this._getScrollRateByScrollLeft(i);var t=this._getVisibleHorizonByScrollRate(j);this._updateVisibleHorizon(t);}this._bSuppressSetVisibleHorizon=false;if(!this._bSuppressHScrollEvent){var k=this.getAxisTimeStrategy();this.fireHorizontalScroll({scrollSteps:i,startTime:k.getVisibleHorizon().getStartTime(),endTime:k.getVisibleHorizon().getEndTime()});}this._bSuppressHScrollEvent=false;}};s.prototype._getScrollRateByScrollLeft=function(i){var H=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var d=H.width();var g=this.getVisibleWidth();var j=0;if(d!==g){if(C.getConfiguration().getRTL()===true&&D.browser.msie){j=(d-i-g)/(d-g);}else{j=i/(d-g);}j=j<0?0:j;j=j>1?1:j;}return j;};s.prototype._getScrollRateByHorizon=function(t){var d=0;var g=this._nUpperRange-this._nLowerRange;var i=this.getVisibleWidth();if(this._initHorizonApplied&&g!==i){var j;if(C.getConfiguration().getRTL()){j=this.getAxisTime().timeToView(F.abapTimestampToDate(t.getEndTime()),true);d=j/(g-i);}else{j=this.getAxisTime().timeToView(F.abapTimestampToDate(t.getStartTime()),true);d=j/(g-i);}d=d<0?0:d;d=d>1?1:d;}return d;};s.prototype._getHSBScrollLeftByScrollRate=function(d){var H=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var g=H.width();var i=this.getVisibleWidth();var j=d*(g-i);if(C.getConfiguration().getRTL()&&D.browser.msie){j=g-i-j;}return j;};s.prototype._getContentScrollLeftByScrollRate=function(d){var g=this._nUpperRange-this._nLowerRange;var i=this.getVisibleWidth();var j=d*(g-i);return j;};s.prototype._getVisibleHorizonByScrollRate=function(d){var g=this._getContentScrollLeftByScrollRate(d);var t=this.getAxisTimeStrategy().getTotalHorizon();var v;var i={};var j=C.getConfiguration().getRTL();if(d===0){i.startTime=j?undefined:t.getStartTime();i.endTime=j?t.getEndTime():undefined;}else if(d===1){i.startTime=j?t.getStartTime():undefined;i.endTime=j?undefined:t.getEndTime();}else{var k=this.getAxisTime().viewToTime(g,true);i.startTime=j?undefined:k;i.endTime=j?k:undefined;}v=new p(i);return v;};s.prototype.syncVisibleHorizon=function(t){this._bSuppressHScrollEvent=true;this._updateVisibleHorizon(t);};s.prototype._onVSbScroll=function(){this._bSelectedStatusUpdated=true;if(!this._mTimeouts._drawSvg){this.$().find(".sapGanttChartSvg").css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");}this.fireVerticalScroll({scrollSteps:this._oTT.getFirstVisibleRow(),scrollPosition:q(this.getTTVsbDom()).scrollTop()});};s.prototype._hSbScrollLeft=function(d){var g=q("#"+this.getId()+"-svg-ctn");var i=q("#"+this.getId()+"-header");var j;if(C.getConfiguration().getRTL()===true){j=this._oStatusSet.aViewBoundary[1]-i.width()-d;if(j<0){j=0;}}else{j=d;}if(C.getConfiguration().getRTL()===true&&D.browser.firefox){if(Math.abs(g.scrollLeftRTL()-j)>1){g.scrollLeftRTL(j);}if(Math.abs(i.scrollLeftRTL()-j)>1){i.scrollLeftRTL(j);}}else{if(Math.abs(g.scrollLeft()-j)>1){g.scrollLeft(j);}if(Math.abs(i.scrollLeft()-j)>1){i.scrollLeft(j);}}};s.prototype.jumpToPosition=function(v){if(v instanceof Date){this._updateVisibleHorizon(new p({startTime:v}));}if(v instanceof Array){this._updateVisibleHorizon(new p({startTime:v[0],endTime:v[1]}));}};s.prototype._updateVisibleHorizon=function(t){var d=this.getAxisTimeStrategy();var g=this.getVisibleWidth();d.updateGanttVisibleWidth(g);d.setVisibleHorizon(t);};s.prototype._onTTRowUpdate=function(){if(this._bTableReady){this._syncSvgHeightWithTT();this._syncSvgDataWithTT();this._draw(true);}};s.prototype._updateDataString=function(){var d=JSON.stringify(this._aFilteredRowData,function(k,v){if(k==="bindingObj"||k==="contextObj"){return undefined;}return v;});if(this._sShapeData&&d===this._sShapeData){this._sShapeData=d;return false;}else{this._sShapeData=d;return true;}};s.prototype._syncSvgHeightWithTT=function(){var d=this.$().find(".sapGanttChartSvgCtn");d.height(this._getSvgHeight());var g=this.$().find(".sapGanttChartSvg");g.height($(this._oTT.$().find(".sapUiTableCtrlRowScroll:not(.sapUiTableCHT)")).height());};s.prototype._syncSvgDataWithTT=function(){var B=this._oTT.getBinding("rows");if(!B){return false;}var j=B.getMetadata().getName()==="sap.ui.model.json.JSONTreeBinding";var i=this._oTT.getFirstVisibleRow();var v=this._getVisibleRowCount();this._aFilteredRowData=[];this._aNonVisibleShapeData=[];var _=[];var d=[];var g=[i,i+v-1];var I=this._aRelationshipsContexts&&this._aRelationshipsContexts.length>0;if(j){if(I){B.getContexts(0,0);if(i>0){_=this._getDrawingData([0,i-1]);}d=this._getDrawingData([i+v,B.getLength()-1]);B.getContexts(g[0],g[1]);}this._aFilteredRowData=this._getDrawingData(g);}else{if(I){if(i>0){_=this._createRowDataForODataModel(B.getContexts(0,i));}d=this._createRowDataForODataModel(B.getContexts(i+v,B.getLength()));}var k=B.getContexts(i,v);this._aFilteredRowData=this._createRowDataForODataModel(k);var l=this.getShapeDataNames();U.generateRowUid(this._aFilteredRowData,this._oObjectTypesConfigMap,l);}this._aNonVisibleShapeData=_.concat(d);if(!this._bSelectedStatusUpdated){this._setSelectedStatusFromData(l,this._aFilteredRowData);}var t=this.getBaseRowHeight();if(!t){t=0;}this._oAxisOrdinal=this._createAxisOrdinal(this._aFilteredRowData,t,0);this._cacheObjectPosition(this._aFilteredRowData,this._oAxisOrdinal);this._cacheObjectPosition(_,this._oAxisOrdinal,true);this._cacheObjectPosition(d,this._oAxisOrdinal,false);if(!this._aVisibleRange||this._aVisibleRange[0]!==g[0]||this._aVisibleRange[1]!==g[1]){this._aVisibleRange=g;return true;}return false;};s.prototype._createRowDataForODataModel=function(d){var g=this.getShapeDataNames();var B=this._oTT.getBinding("rows");var M=B.getModel();var l=[];for(var i=0;i<d.length;i++){if(d[i]!=undefined){var t={"bindingObj":B,"contextObj":d[i],"data":d[i].getObject(),"id":d[i].getObject().id,"rowIndex":i};if(g&&g.length>0){for(var j=0;j<g.length;j++){var u=g[j];var v=d[i].getProperty(u);var w;if(v){t.data[u]=[];for(var k=0;k<v.length;k++){var x=v[k];if(typeof x==="string"){w=M.getData("/"+x);}else{w=x;}t.data[u].push(w);}}}}l.push(t);}}return l;};s.prototype._cacheObjectPosition=function(d,g,l){if(d&&d.length>0){if(l===true){for(var i=0;i<d.length;i++){d[i].y=-100;d[i].rowHeight=g.getViewBandWidth();}}else if(l===false){for(var j=0;j<d.length;j++){d[j].y=g.getViewRange()[1]+100;d[j].rowHeight=g.getViewBandWidth();}}else{var v=[];var t=[];for(var k=0;k<d.length;k++){d[k].y=g.elementToView(d[k].uid);if(k>0){d[k-1].rowHeight=d[k].y-d[k-1].y;}if(d[k].visibleRowSpan){d[k].visibleRowHeight=d[k].visibleRowSpan*g.getViewBandWidth();v.push(d[k].uid);t.push(d[k].visibleRowSpan);}}d[d.length-1].rowHeight=g.getViewRange()[1]-d[d.length-1].y;this._oAxisOrdinalOfVisibleRow=new m(v,t,this.getBaseRowHeight(),0);}}};s.prototype._prepareRelationshipDataFromModel=function(){this._aRelationships=[];if(this._aRelationshipsContexts){for(var i=0;i<this._aRelationshipsContexts.length;i++){var d=this._aRelationshipsContexts[i].getObject();if(d!==undefined){this._aRelationships.push(d);}}}U.generateUidByShapeDataName(this._aRelationships,"relationship");};s.prototype._createAxisOrdinal=function(d,B,g){var i=d.map(function(k){return k.uid;});var j=d.map(function(k){if(k.rowSpan){return k.rowSpan;}else{return 1;}});return new m(i,j,B,g);};s.prototype.getFilteredRowData=function(d){return this._aFilteredRowData;};s.prototype._getDrawingData=function(d){var g=function(O,W,Y,Z){if(!O[W]){O.push({});}if(!O[W][Y]){O[W][Y]=[];}O[W][Y].push(Z);};var i,j,k,l,t,u;var B=this._oTT.getBinding("rows");var v=this._oTT.getBindingInfo("rows");var w=[];var x=this.getShapeDataNames();for(i=d[0];i<=d[1];i++){var y=this._oTT.getContextByIndex(i);if(!y){continue;}else{t=y.getObject();if(!t){continue;}}var z=1;u=this._oObjectTypesConfigMap[t.type]?this._oObjectTypesConfigMap[t.type].getMainChartSchemeKey():sap.gantt.config.DEFAULT_CHART_SCHEME_KEY;if(t.type){var H=this._oChartSchemesConfigMap[u];if(H){z=H.getRowSpan();}}var I={"bindingObj":B,"bindingInfo":v,"contextObj":y,"data":t,"id":t.id,"rowSpan":z,"chartScheme":u,"rowIndex":i,"index":0,"visibleRowSpan":z};U.generateRowUid([I],this._oObjectTypesConfigMap,x);w.push(I);var J=t.uid;if(J&&this._oRowStatusMap[J]){for(u in this._oRowStatusMap[J]){var M;if(this._oChartSchemesConfigMap[u]&&this._oChartSchemesConfigMap[u].getModeKey()&&this._oChartSchemesConfigMap[u].getModeKey()!==sap.gantt.config.DEFAULT_MODE_KEY){M=this._oChartSchemesConfigMap[u].getModeKey();}else{M=this.getMode();}var K=this._collectDataNameForValidChartScheme(u,M);if(K&&K.drawData){var L=0;var O=[{}];for(j=0;j<K.drawData.length;j++){if(!t[K.drawData[j]]){continue;}for(k=0;k<t[K.drawData[j]].length;k++){var Q=t[K.drawData[j]][k].rowIndex;if(Q&&L<Q){L=Q;}}}if(L>0){for(j=0;j<K.drawData.length;j++){if(!t[K.drawData[j]]){continue;}for(k=0;k<t[K.drawData[j]].length;k++){var W=t[K.drawData[j]][k].rowIndex;if(W){g(O,W,K.drawData[j],t[K.drawData[j]][k]);}else{for(l=1;l<=L;l++){g(O,l,K.drawData[j],t[K.drawData[j]][k]);}}}}for(j=1;j<=L;j++){var X={"bindingObj":B,"bindingInfo":v,"data":O[j],"id":t.id,"parentId":I.id,"rowSpan":K.rowSpan,"chartScheme":u,"rowIndex":i,"index":j,"icon":this._oChartSchemesConfigMap[u].getIcon(),"closeIcon":"./image/closeChart.png","name":this._oChartSchemesConfigMap[u].getName()};U.generateRowUid([X],this._oObjectTypesConfigMap,x);w.push(X);I.visibleRowSpan+=K.rowSpan;}}}}this._oRowStatusMap[J].visibleRowSpan=I.visibleRowSpan;}}return w;};s.prototype._prepareVerticalDrawingRange=function(){var d=this._oTT.getBinding("rows").getLength()-1;if(d<0){return[0,-1];}var g=this._oTT.getFirstVisibleRow();var i=g+this._getVisibleRowCount()-1;var j=g;var k=i<d?i:d;return[j,k];};s.prototype._prepareHorizontalDrawingRange=function(){var d=this._nUpperRange-this._nLowerRange;var g=this.getVisibleWidth();if(!this._oStatusSet){this._updateScrollWidth();}var i=this._getContentScrollLeft();if(this._oStatusSet){if((g>=d||(this._oStatusSet.aViewBoundary[0]<=i-this._oStatusSet.nOffset&&this._oStatusSet.aViewBoundary[1]>=i+g-this._oStatusSet.nOffset))){if(!this._mTimeouts._drawSvg){this._updateScrollLeft();this._scrollSvg();}return false;}}var j=g*(1+this._fExtendFactor*2);var k=i-g*this._fExtendFactor;if(k<this._nLowerRange){j+=k;k=0;}if(k+j>this._nUpperRange){j=this._nUpperRange-k;}this.getAxisTime().setViewOffset(k);if(j<0){return false;}this._oStatusSet={nWidth:j,nOffset:k,nScrollLeft:i,aViewBoundary:[0,j],aTimeBoundary:[this.getAxisTime().viewToTime(0),this.getAxisTime().viewToTime(j)],bRTL:C.getConfiguration().getRTL()};return true;};s.prototype._draw=function(d){if(!this._bTableReady){return;}var g=this._nUpperRange-this._nLowerRange;if(g<=2){return;}var i=this.getVisibleWidth();if(!i||i<=0||i>document.body.clientWidth){return;}var j=this.getAxisTimeStrategy().syncContext(i);this.fireEvent("_zoomInfoUpdated",j);if(j.axisTimeChanged){this.setProperty("timeZoomRate",this.getAxisTime().getZoomRate(),true);this.resetWidthInfo();}if(!this._prepareHorizontalDrawingRange()&&!d){return;}this._updateTableRowHeights();var t=this;this._mTimeouts._drawSvg=this._mTimeouts._drawSvg||window.setTimeout(function(){t._drawSvg();},0);};s.prototype.getVisibleWidth=function(){var d=q("#"+this.getId()+"-svg-ctn");if(!d){return null;}var g=d.width()-((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width());if(!g||g<=0){return null;}return g;};s.prototype._updateScrollWidth=function(){var d=this._nUpperRange-this._nLowerRange;this._oColumn.setWidth((d-4)+"px");};s.prototype._updateScrollLeft=function(u){var d=q(this.getTTHsbDom());var g=this._getHSBScrollLeft();if((C.getConfiguration().getRTL()===true&&sap.ui.Device.browser.name==="ff")){if(Math.abs(d.scrollLeftRTL()-g)>1){this._bSuppressSetVisibleHorizon=!u;d.scrollLeftRTL(g);}}else if(Math.abs(d.scrollLeft()-g)>1){this._bSuppressSetVisibleHorizon=!u;d.scrollLeft(g);}};s.prototype._getHSBScrollLeft=function(){var t=this.getAxisTimeStrategy().getVisibleHorizon();var d=this._getScrollRateByHorizon(t);var g=this._getHSBScrollLeftByScrollRate(d);return g;};s.prototype._scrollSvg=function(){var d=q("#"+this.getId()+"-svg");var g=q("#"+this.getId()+"-header-svg");if(Math.abs(this._oStatusSet.nWidth-d.width())>1){d.width(this._oStatusSet.nWidth+((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width()));}if(Math.abs(this._oStatusSet.nWidth-g.width())>1){g.width(this._oStatusSet.nWidth+((C.getConfiguration().getRTL())?0:q(this.getTTVsbDom()).width()));}var i=this.getVisibleWidth();var j=this._getContentScrollLeft();if(C.getConfiguration().getRTL()===true&&sap.ui.Device.browser.name!=="ie"){this._hSbScrollLeft(this._oStatusSet.nOffset-j+this._oStatusSet.nWidth-i);}else{this._hSbScrollLeft(j-this._oStatusSet.nOffset);}};s.prototype._getContentScrollLeft=function(){var t=this.getAxisTimeStrategy().getVisibleHorizon();var d=this._getScrollRateByHorizon(t);var g=this._getContentScrollLeftByScrollRate(d);return g;};s.prototype._drawSvg=function(){q.sap.measure.start("GanttChart _drawSvg","GanttPerf:GanttChart _drawSvg function");if(!this._initHorizonApplied){this._prepareHorizontalDrawingRange();this._initHorizonApplied=true;this._updateScrollLeft(true);}else{this._updateScrollLeft();}q("#"+this.getId()+"-svg-ctn").css("visibility","hidden");this._scrollSvg();q("#"+this.getId()+"-svg-ctn").css("visibility","visible");this._sUiSizeMode=U.findSapUiSizeClass(this);this._drawCalendarPattern();this._drawHeader();this._drawNowLine();this._drawVerticalLine();this._drawExpandedBackground();this._drawShapes();this._drawSelectedShapes(true);delete this._mTimeouts._drawSvg;this.$().find(".sapGanttChartSvg").css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");this._iFirstVisiableRowIndex=this._oTT.getFirstVisibleRow();this._bCanApplyTableTransform=true;this.fireEvent("_shapesUpdated",{aSvg:q("#"+this.getId()+"-svg")});this._bSelectedStatusUpdated=undefined;q.sap.measure.end("GanttChart _drawSvg");};s.prototype._drawHeader=function(){var g=q(this.getDomRef()).find(".sapGanttChartHeader");var j=g.height();var H=d3.select(q(this.getDomRef()).find(".sapGanttChartHeaderSvg").get(0));H.attr("height",j);var k=j/5*2;var l=j/5*4;var t=j/5*4;var u=this.getAxisTimeStrategy();var L=this.getAxisTime().getTickTimeIntervalLabel(u.getTimeLineOption(),null,[0,this._oStatusSet.nWidth]);H.selectAll("g").remove();var v=H.append("g");v.selectAll("label0").data(L[0]).enter().append("text").classed("sapGanttTimeHeaderSvgText0",true).text(function(d){return d.label;}).attr("x",function(d){return d.value;}).attr("y",function(d){return k;}).attr("text-anchor","start");v.selectAll("label1").data(L[1]).enter().append("text").classed("sapGanttTimeHeaderSvgText1",true).text(function(d){return d.label;}).attr("x",function(d){return d.value+(C.getConfiguration().getRTL()?-5:5);}).attr("y",function(d){return t;});if((D.browser.msie||D.browser.edge)&&C.getConfiguration().getRTL()){d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText0").each(function(d,i){d3.select(this).attr("transform",function(d){var O="translate("+(-U.calculateStringLength(d.label)*parseInt($(".sapGanttTimeHeaderSvgText0").css("font-size"),10)/2)+")";return O;});});d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText1").each(function(d,i){d3.select(this).attr("transform",function(d){var O="translate("+(-U.calculateStringLength(d.label)*parseInt($(".sapGanttTimeHeaderSvgText1").css("font-size"),10)/2)+")";return O;});});}var w="";for(var i=0;i<L[1].length;i++){var x=L[1][i];if(x){w+=" M"+" "+(x.value-1/2)+" "+l+" L"+" "+(x.value-1/2)+" "+j;}}v.append("path").classed("sapGanttTimeHeaderSvgPath",true).attr("d",w);};s.prototype._drawCalendarPattern=function(){var g=d3.select("#"+this.getId()+"-svg");this._oCalendarPatternDrawer.drawSvg(g,this.getId(),this.getCalendarDef(),this._oStatusSet,this.getBaseRowHeight());};s.prototype._drawNowLine=function(){this._oNowlineDrawer=new N(this.getAxisTime());var g=d3.select("#"+this.getId()+"-header-svg"),d=d3.select("#"+this.getId()+"-svg");if(this.getEnableNowLine()){this._oNowlineDrawer.drawSvg(d,g);}else{this._oNowlineDrawer.destroySvg(d,g);}};s.prototype._drawVerticalLine=function(){this._oVerticalLineDrawer=new V(this.getAxisTime());var g=d3.select("#"+this.getId()+"-svg");if(this.getEnableVerticalLine()){this._oVerticalLineDrawer.drawSvg(g);}else{this._oVerticalLineDrawer.destroySvg(g);}};s.prototype._drawExpandedBackground=function(){var d=d3.select("#"+this.getId()+"-svg");if(!this._oTT||!this._oTT.getRows()||this._oTT.getRows().length<=0){return;}if(this._aFilteredRowData){var g=this._composeChartSchemeBackgroundConfig();this._oExpandedBackgroundDrawer.drawSvg(d,this._aFilteredRowData,g);}};s.prototype._composeChartSchemeBackgroundConfig=function(){var d=this._oChartSchemesConfigMap;var B={};if(d){for(var g in d){if(d[g].getHaveBackground()){B[g]=d[g].getBackgroundClass();}}}return B;};s.prototype._drawShapes=function(){var d=d3.select("#"+this.getId()+"-svg");if(this._aFilteredRowData&&this._aShapeInstance&&this._aShapeInstance.length>0){this._collectDataPerShapeId();var g=this.getAxisTime();var j=this._oShapeCrossRowDrawer.generateRelationshipDataSet(d,this._oShapeInstance,this._aNonVisibleShapeData,this.getShapeDataNames(),this._aRelationships,g,this._oAxisOrdinal);for(var i=0;i<this._aShapeInstance.length;i++){switch(this._aShapeInstance[i].getCategory(null,g,this._oAxisOrdinal)){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(d,this._aShapeInstance[i],g,this._oAxisOrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:this._aShapeInstance[i].dataSet=this._judgeDisplayableOfRLS(this._aShapeInstance[i])?j:[];this._oShapeCrossRowDrawer.drawSvg(d,this._aShapeInstance[i],g,this._oAxisOrdinal);break;default:break;}}}};s.prototype._drawSelectedShapes=function(i){var d=d3.select("#"+this.getId()+"-svg");if(!i){this._setSelectedStatusToData();}this._collectSelectedDataPerShapeId();var g=this.getAxisTime();var j=this._oShapeCrossRowDrawer.generateRelationshipDataSet(d,this._oShapeInstance,this._aNonVisibleShapeData,this.getShapeDataNames(),this._aSelectedRelationships,g,this._oAxisOrdinal);for(var k in this._oShapeInstance){var l=this._oShapeInstance[k].getAggregation("selectedShape");var t=l.getCategory(null,g,this._oAxisOrdinal);switch(t){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(d,l,g,this._oAxisrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:l.dataSet=j;this._oShapeCrossRowDrawer.drawSvg(d,l,g,this._oAxisOrdinal);break;default:break;}}};s.prototype._collectDataPerShapeId=function(){var d,g;for(var j in this._oShapeInstance){var k=this._oShapeInstance[j].mShapeConfig.getShapeDataName();this._oShapeInstance[j].dataSet=[];if(this._oShapeInstance[j]._attributeNameBindingMap){this._oShapeInstance[j]._attributeNameBindingMap=undefined;}for(var i=0;i<this._aFilteredRowData.length;i++){d=this._aFilteredRowData[i];if(d.isBlank){continue;}if(!k){this._oShapeInstance[j].dataSet.push({"objectInfoRef":d,"shapeData":d.data});continue;}if(!this._judgeDisplayableByShapeId(d,j)){continue;}g=d.data[k];if(g){this._oShapeInstance[j].dataSet.push({"objectInfoRef":d,"shapeData":g});}}}};s.prototype._collectSelectedDataPerShapeId=function(){for(var d in this._oShapeInstance){var g=this._oShapeInstance[d].mShapeConfig.getShapeDataName()?this._oShapeInstance[d].mShapeConfig.getShapeDataName():undefined;var k=this._oShapeInstance[d].getAggregation("selectedShape");var l=k.getCategory(null,this.getAxisTime(),this._oAxisOrdinal);k.dataSet=[];if(l==sap.gantt.shape.ShapeCategory.Relationship){var t=[];for(var j in this._aSelectedRelationships){var u=this._aSelectedRelationships[j];if(this._getShapeDataById(u.id,true)!==undefined){t.push(u);}}k.dataSet.push({"shapeData":t});}else if(this._oSelectedShapes[g]!==undefined){for(var i in this._oSelectedShapes[g]){var v=this._oSelectedShapes[g][i];var w=this._getVisibleRowByShapeUid(v.shapeUid);if(w!==undefined&&w!==null&&this._judgeDisplayableByShapeId(w,d)){v.objectInfoRef=w;k.dataSet.push({"objectInfoRef":v.objectInfoRef,"shapeData":[v.shapeData]});}}}}};s.prototype._judgeDisplayableByShapeId=function(d,g){var i,j,k,M;if(d.chartScheme){i=d.chartScheme;}else{i=this._oObjectTypesConfigMap[d.data.type]?this._oObjectTypesConfigMap[d.data.type].getMainChartSchemeKey():sap.gantt.config.DEFAULT_CHART_SCHEME_KEY;}j=this._oChartSchemesConfigMap[i];if(j==undefined){return false;}k=j.getShapeKeys();M=j.getModeKey()!==sap.gantt.config.DEFAULT_MODE_KEY?j.getModeKey():this.getMode();if((i!==sap.gantt.config.DEFAULT_CHART_SCHEME_KEY&&k.indexOf(g)<0)||(M!==sap.gantt.config.DEFAULT_MODE_KEY&&this._oShapesConfigMap[g].getModeKeys()&&this._oShapesConfigMap[g].getModeKeys().length>0&&this._oShapesConfigMap[g].getModeKeys().indexOf(M)<0)||!d.data){return false;}return true;};s.prototype._judgeDisplayableOfRLS=function(d){var g=this._oShapesConfigMap[d.mShapeConfig.getKey()]?this._oShapesConfigMap[d.mShapeConfig.getKey()].getModeKeys():[];if(q.inArray(this.getMode(),g)<0&&this.getMode()!==sap.gantt.config.DEFAULT_MODE_KEY){return false;}return true;};s.prototype._getUidById=function(I,d){var u=[];if(d){for(var i in this._aRelationships){var g=this._aRelationships[i];if(g.id==I){u.push(g.uid);break;}}}else{var j=this.getAllRowData();q.each(j,function(k,v){var l=v;for(var t in l.data){if(l.data[t]instanceof Array){for(var i in l.data[t]){if(l.data[t][i].id==I){u.push(l.data[t][i].uid);}}}}});}return u;};s.prototype._getShapeDataByUid=function(u,d){if(d){for(var i in this._aRelationships){var g=this._aRelationships[i];if(g.uid===u){return g;}}}else{var k=this._getRowByShapeUid(u);var l=U.getShapeDataNameByUid(u);if(k!==undefined&&k.data[l]!==undefined){for(var j=0;j<k.data[l].length;j++){var t=k.data[l][j];if(t.uid==u){return t;}}}}return undefined;};s.prototype._getShapeDataById=function(I,d){var g=[];var u=this._getUidById(I,d);for(var i in u){var j=this._getShapeDataByUid(u[i],d);if(j!==undefined){g.push(j);}}return g;};s.prototype._getRowByShapeUid=function(d){var g;var j=U.getShapeDataNameByUid(d);var J=(this._oTT.getBinding("rows").getMetadata().getName()==="sap.ui.model.json.JSONTreeBinding");var l=U.getChartSchemeByShapeUid(d);var t=this.getAllRowData();q.each(t,function(k,v){var u=v;if(l===""||l===u.chartScheme){if(J&&u.data[j]){for(var i=0;i<u.data[j].length;i++){if(u.data[j][i].uid==d){g=u;return false;}}}else if(u.data.uid===d){g=u;return false;}}});return g;};s.prototype._getVisibleRowByShapeUid=function(d){var g;var j=U.getShapeDataNameByUid(d);var J=(this._oTT.getBinding("rows").getMetadata().getName()==="sap.ui.model.json.JSONTreeBinding");var l=U.getChartSchemeByShapeUid(d);q.each(this._aFilteredRowData,function(k,v){var t=v;if(l===""||l===t.chartScheme){if(J&&t.data[j]){for(var i=0;i<t.data[j].length;i++){if(t.data[j][i].uid==d){g=t;return false;}}}else if(t.data.uid===d){g=t;return false;}}});return g;};s.prototype._getRowById=function(d){var g;var i=this.getAllRowData();q.each(i,function(k,v){var j=v;if(j.data.id==d){g=j;return false;}});return g;};s.prototype._getSvgCoodinateByDiv=function(d,x,y){var g=d.createSVGPoint();g.x=x;g.y=y;g=g.matrixTransform(d.getScreenCTM().inverse());g.svgHeight=d.height.baseVal.value;g.svgId=this.getId()+"-svg";return g;};s.prototype._getTopShapeInstance=function(d,g){if(g!==undefined){var i=this._getShapeIdById(g);if(i!==undefined&&i!==null){if(i.topShapeId!==undefined){return this._oShapeInstance[i.topShapeId];}else{return this._oShapeInstance[i.shapeId];}}}else{var j=U.getShapeDataNameByUid(d.uid);for(var k in this._oShapeInstance){var l=this._oShapeInstance[k].mShapeConfig.getShapeDataName();if(j===l){var t=this._customerClassIds[k].topShapeId;if(t!==undefined){return this._oShapeInstance[t];}else{return this._oShapeInstance[k];}}}}return undefined;};s.prototype._judgeEnableSelection=function(d,g){if(d===undefined){return false;}var t=this._getTopShapeInstance(d,g);if(t!==undefined){return t.getEnableSelection(d);}var i=sap.ui.getCore().byId(g);if(i){return i.getEnableSelection(d);}return false;};s.prototype._judgeEnableDnD=function(d,g){if(d===undefined){return false;}var t=this._getTopShapeInstance(d,g);if(t!==undefined){return t.getEnableDnD(d);}var i=sap.ui.getCore().byId(g);if(i){return i.getEnableDnD(d);}return false;};s.prototype._selectShape=function(d){var g=this._getRowByShapeUid(d.uid);if(g==undefined){return false;}if(this._aSelectedShapeUids===undefined){this._aSelectedShapeUids=[];}var i=U.getShapeDataNameByUid(d.uid);if(this._oSelectedShapes[i]!==undefined&&this._oSelectedShapes[i]!==null){var j=this._oSelectedShapes[i];if(q.inArray(d.uid,this._aSelectedShapeUids)>-1){return false;}else{this._aSelectedShapeUids.push(d.uid);j.push({"shapeUid":d.uid,"shapeData":d,"objectInfoRef":g});return true;}}else{this._aSelectedShapeUids.push(d.uid);this._oSelectedShapes[i]=[];this._oSelectedShapes[i].push({"shapeUid":d.uid,"shapeData":d,"objectInfoRef":g});return true;}};s.prototype._deselectShape=function(d){var g=U.getShapeDataNameByUid(d.uid);if(q.inArray(d.uid,this._aSelectedShapeUids)>-1){var I=this._aSelectedShapeUids.indexOf(d.uid);this._aSelectedShapeUids.splice(I,1);var j=this._oSelectedShapes[g];for(var i in j){if(j[i].shapeUid===d.uid){j.splice(i,1);break;}}return true;}return false;};s.prototype.getAxisOrdinal=function(){return this._oAxisOrdinal;};s.prototype.getAxisTime=function(){return this.getAxisTimeStrategy().getAxisTime();};s.prototype.ondblclick=function(d){return null;};s.prototype.onclick=function(d){return null;};s.prototype.getSapUiSizeClass=function(){return this._sUiSizeMode;};s.prototype.setFirstVisibleRow=function(i){this._oTT.setFirstVisibleRow(i);return this;};s.prototype._getVisibleRowCount=function(){return this._oTT.getVisibleRowCount()+1;};s.prototype._setLargeDataScrolling=function(l){if(this._oTT._setLargeDataScrolling){this._oTT._setLargeDataScrolling(!!l);}};s.prototype.exit=function(){this._detachEvents();this._cleanUpTimers();};s.prototype._cleanUpTimers=function(){for(var k in this._mTimeouts){if(this._mTimeouts[k]){clearTimeout(this._mTimeouts[k]);this._mTimeouts[k]=undefined;}}};s.prototype.getTTHsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.HorizontalScrollBar);};s.prototype.getTTVsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.VerticalScrollBar);};return s;},true);
