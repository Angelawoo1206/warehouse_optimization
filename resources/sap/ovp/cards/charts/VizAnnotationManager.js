(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.charts.VizAnnotationManager");sap.ovp.cards.charts.VizAnnotationManager=sap.ovp.cards.charts.VizAnnotationManager||{};sap.ovp.cards.charts.VizAnnotationManager.constants={LABEL_KEY:"sap:label",TEXT_KEY:"sap:text",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32"};sap.ovp.cards.charts.VizAnnotationManager.errorMessages={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure"};sap.ovp.cards.charts.VizAnnotationManager.formatItems=function(c,e,s,p,D,M,a){var b=c.getSetting("dataModel");if(a&&a.EnumMember){var f=a.EnumMember.split("/");if(f&&(f[1]==='Donut')){b.setDefaultCountMode(sap.ui.model.odata.CountMode.Inline);}}var r="{";var g=[];var h=[];var j=[];var F=s&&s.SelectOptions;var P=s&&s.Parameters;var S=p&&p.SortOrder;var k=p&&p.MaxItems,l=null;var C;var t;var n=null;var o=sap.ovp.cards.charts.VizAnnotationManager;var q=o.constants.TEXT_KEY;var u=o.constants.UNIT_KEY;if(k){l=k.Int32?k.Int32:k.Int;}if(l){if(l=="0"){jQuery.sap.log.error("OVP-AC: Analytic card Error: maxItems is configured as "+l);r+="}";return r;}if(!/^\d+$/.test(l)){jQuery.sap.log.error("OVP-AC: Analytic card Error: maxItems is Invalid. "+"Please enter an Integer.");r+="}";return r;}}if(P){var v=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(b,e,s);r+="path: '"+v+"'";}else{r+="path: '/"+e.name+"'";}var w=[];if(!c||!c.getSetting('ovpCardProperties')){jQuery.sap.log.error(o.errorMessages.ANALYTICAL_CONFIG_ERROR);r+="}";return r;}n=c.getSetting('ovpCardProperties').getProperty("/entitySet");if(!b||!n){return r;}var x=o.getMetadata(b,n);C=c.getSetting('ovpCardProperties').getProperty("/filters");if(F){jQuery.each(s.SelectOptions,function(){var d=this.PropertyName.PropertyPath;jQuery.each(this.Ranges,function(){if(this.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"){var m=sap.ovp.cards.charts.VizAnnotationManager.getPrimitiveValue(this.Low);var I=this.High&&this.High.String;var J=o.formatByType;m=J(x,d,m);var K={path:d,operator:this.Option.EnumMember.split("/")[1],value1:m};if(I){K.value2=J(x,d,I);}w.push(K);}});});}if(C&&C.length>0){w=w.concat(C);}if(w.length>0){r+=", filters: "+JSON.stringify(w);}if(S){var y=p.SortOrder;if(y.length<1){jQuery.sap.log.warning(o.errorMessages.CARD_WARNING+o.errorMessages.SORTORDER_WARNING);}else{var z="";var A;var B;var E;for(var i=0;i<y.length;i++){A=y[i];E=A.Property.PropertyPath;j.push(E);if(typeof A.Descending=="undefined"){B='true';}else{var G=A.Descending.Bool||A.Descending.Boolean;if(!G){jQuery.sap.log.warning(o.errorMessages.CARD_WARNING+o.errorMessages.BOOLEAN_ERROR);B='true';}else{B=G.toLowerCase()=='true'?'true':'false';}}z=z+"{path: '"+E+"',descending: "+B+"},";}r+=", sorter: ["+z.substring(0,z.length-1)+"]";}}var H=c.getSetting("ovpCardProperties").getProperty("/entityType");jQuery.each(M,function(i,m){t=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=H[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&d.ForecastValue.PropertyPath){h.push(d.ForecastValue.PropertyPath);}}h.push(t);if(x&&x[t]&&x[t][q]&&t!=x[t][q]){h.push(x[t][q]?x[t][q]:t);}if(x&&x[t]&&x[t][u]){var I=x[t][u];if(jQuery.inArray(I,h)===-1){h.push(I);}}});jQuery.each(D,function(i,d){t=d.Dimension.PropertyPath;g.push(t);if(x&&x[t]&&x[t][q]&&t!=x[t][q]){g.push(x[t][q]?x[t][q]:t);}});r+=", parameters: {select:'"+[].concat(g,h).join(",");if(j.length>0){r+=","+j.join(",");}r+="'}";if(l){r+=", length: "+l;}r+="}";return r;};sap.ovp.cards.charts.VizAnnotationManager.formatItems.requiresIContext=true;sap.ovp.cards.charts.VizAnnotationManager.checkForecastMeasure=function(m,e){var s=sap.ovp.cards.charts.VizAnnotationManager;var b=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=e[m.DataPoint.AnnotationPath.substring(1)];if(d&&d.ForecastValue&&d.ForecastValue.PropertyPath){b=true;r=m;}}if(b==true){return r;}else{jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_FORECAST);return undefined;}};sap.ovp.cards.charts.VizAnnotationManager.getSapLabel=function(m,M){var a;jQuery.each(M,function(i,v){if(v.name==m){a=v["sap:label"];return false;}});return a;};sap.ovp.cards.charts.VizAnnotationManager.getMeasureDimCheck=function(f,c){var s=sap.ovp.cards.charts.VizAnnotationManager;var b=true;if(c=="line"||c=="column"){jQuery.each(f,function(i,v){if((v.getUid()=='valueAxis')||(v.getUid()=='categoryAxis')){if(v.getValues().length!=1){b=false;jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_DIMMEAS);return false;}}});}else if(c=="vertical_bullet"){jQuery.each(f,function(i,v){if((v.getUid()=='actualValues')||(v.getUid()=='categoryAxis')){if(v.getValues().length!=1){b=false;jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_DIMMEAS);return false;}}});}if(b==true){return true;}};sap.ovp.cards.charts.VizAnnotationManager.formatByType=function(m,p,v){var s=sap.ovp.cards.charts.VizAnnotationManager;var t=s.constants.TYPE_KEY;if(!m||!m[p]||!m[p][t]){return v;}var n=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var c=m[p][t];if(jQuery.inArray(c,n)!==-1){return Number(v);}return v;};sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat=function(d){if(d){jQuery.sap.require("sap.ui.core.format.DateFormat");var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd-MMM"});return D.format(new Date(d));}return"";};sap.ovp.cards.charts.VizAnnotationManager.formatChartAxes=function(v){jQuery.sap.require("sap.ui.core.format.NumberFormat");var c={locale:function(){},format:function(a,p){var b="";if(p){b=p.split('/');}if(b.length>0){var m,s;if(b.length==3){m=Number(b[1]);s=Number(b[2]);if(isNaN(m)){m=2;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(b[0]=="axisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});return n.format(Number(a));}else if(b[0]=="CURR"){var d=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});return d.format(Number(a));}else if(b[0]=="0.0%"){var f=sap.ui.core.format.NumberFormat.getPercentInstance({style:'standard',pattern:b[0],minFractionDigits:3});return f.format(a);}}if(a.constructor==Date){jQuery.sap.require("sap.ui.core.format.DateFormat");var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd-MMM"});a=D.format(new Date(a));}return a;}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(c);};sap.ovp.cards.charts.VizAnnotationManager.hideDateTimeAxis=function(v,f){var d=v.getModel();var t=v.getVizType();if(t!="line"&&t!="bubble"){return;}if(!f){f=t=="line"?"categoryAxis":"valueAxis";}var e=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!e){return;}var m=this.getMetadata(d,e);var a=v.getFeeds();for(var i=0;i<a.length;i++){if(a[i].getUid()==f){var b=a[i].getValues();if(!b){return;}for(var j=0;j<b.length;j++){if(m[b[j][this.constants.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}};sap.ovp.cards.charts.VizAnnotationManager.checkExists=function(t,a,b,m,l,c){var s=sap.ovp.cards.charts.VizAnnotationManager;m=typeof m==="undefined"?false:m;var r=false;var d;if(!t&&m){jQuery.sap.log.error(l+s.errorMessages.CARD_ERROR+b+s.errorMessages.IS_MANDATORY);return r;}if(!t){jQuery.sap.log.warning(l+s.errorMessagesCARD_WARNING+b+s.errorMessages.IS_MISSING);r=true;return r;}d=a[t];if(!d||typeof d!=="object"){var e=m?jQuery.sap.log.error:jQuery.sap.log.warning;e(l+s.errorMessages.CARD_ERROR+"in "+b+". ("+t+" "+s.errorMessages.NOT_WELL_FORMED);return r;}if(c&&c=="sap.ovp.cards.charts.analytical.analyticalChart"&&b=="Chart Annotation"&&(!d.ChartType||!d.ChartType.EnumMember)){jQuery.sap.log.error(l+s.errorMessages.CARD_ERROR+s.errorMessages.MISSING_CHARTTYPE+s.errorMessages.CHART_ANNO);return r;}r=true;return r;};sap.ovp.cards.charts.VizAnnotationManager.validateCardConfiguration=function(c){var s=sap.ovp.cards.charts.VizAnnotationManager;var r=false;if(!c){return r;}var a;var b;var d;var p;var i;var P;var e;var l="";var C;var v=c.getView();if(v){l="["+v.getId()+"] ";}if(!(C=c.getCardPropertiesModel())){jQuery.sap.log.error(l+s.errorMessages.CARD_ERROR+"in "+s.errorMessages.CARD_CONFIG+s.errorMessages.NO_CARD_MODEL);return r;}e=C.getProperty("/entityType");if(!e||jQuery.isEmptyObject(e)){jQuery.sap.log.error(l+s.errorMessages.CARD_ERROR+"in "+s.errorMessages.CARD_ANNO);return r;}a=C.getProperty("/selectionAnnotationPath");b=C.getProperty("/chartAnnotationPath");p=C.getProperty("/presentationAnnotationPath");i=C.getProperty("/identificationAnnotationPath");P=C.getProperty("/dataPointAnnotationPath");d=C.getProperty("/contentFragment");r=this.checkExists(a,e,"Selection Variant",false,l);r=this.checkExists(b,e,"Chart Annotation",true,l,d)&&r;r=this.checkExists(p,e,"Presentation Variant",false,l)&&r;r=this.checkExists(i,e,"Identification Annotation",true,l)&&r;r=this.checkExists(P,e,"Data Point",false,l)&&r;return r;};sap.ovp.cards.charts.VizAnnotationManager.checkNoData=function(e,c,v){};sap.ovp.cards.charts.VizAnnotationManager.getConfig=function(c){var s=sap.ovp.cards.charts.VizAnnotationManager;var r={};var a,b,d,f,g=null;var C=!!c;if(!jQuery.sap.getObject("sap.ovp.cards.charts.config")){d=jQuery.sap.getModulePath("sap.ovp.cards.charts");sap.ovp.cards=sap.ovp.cards||{};sap.ovp.cards.charts=sap.ovp.cards.charts||{};try{sap.ovp.cards.charts.config=jQuery.sap.loadResource({url:d+"/config.json",dataType:"json",async:false});}catch(e){jQuery.sap.log.error(s.errorMessages.CONFIG_LOAD_ERROR+e);}sap.ovp.cards.charts.config=sap.ovp.cards.charts.config||{};}g=sap.ovp.cards.charts.config;if(!C){return g;}if(!c.EnumMember||!(a=c.EnumMember.split("/"))||a.length<2){jQuery.sap.log.error(s.errorMessages.CARD_ERROR+s.errorMessages.INVALID_CHARTTYPE+s.errorMessages.ANNO_REF);return r;}b=a[1];if(!g[b]){jQuery.sap.log.error(s.errorMessages.INVALID_CONFIG+b+" "+s.errorMessages.CONFIG_JSON);return r;}if((f=g[b].reference)&&g[f]){var v=jQuery.extend(true,{},g[f]);g[b]=v;}r=g[b];return r;};sap.ovp.cards.charts.VizAnnotationManager.hasTimeSemantics=function(d,c,a,e){var r=false;var m;var b;var f;var g;var s;if(!c.time||jQuery.isEmptyObject(c.time)){return r;}if(!d){return r;}if(d.length!=1){return r;}if(!d[0].Dimension||!(b=d[0].Dimension.PropertyPath)){return r;}m=this.getMetadata(a,e);if(m&&m[b]){f=m[b][this.constants.TYPE_KEY];g=m[b][this.constants.DISPLAY_FORMAT_KEY];s=m[b][this.constants.SEMANTICS_KEY];}if(f&&g&&f.lastIndexOf("Edm.Date",0)===0&&g.toLowerCase()=="date"){r=true;}if(f=="Edm.String"&&s&&s.lastIndexOf("year",0)===0){r=true;}return r;};sap.ovp.cards.charts.VizAnnotationManager.getChartType=function(c,C,d){var r="";var s=sap.ovp.cards.charts.VizAnnotationManager;var a=s.getConfig(C);var b,e;if(!a){return r;}r=a.default.type;b=c.getSetting("dataModel");e=c.getSetting('ovpCardProperties').getProperty("/entitySet");if(s.hasTimeSemantics(d,a,b,e)){r=a.time.type;}return r;};sap.ovp.cards.charts.VizAnnotationManager.getChartType.requiresIContext=true;sap.ovp.cards.charts.VizAnnotationManager.checkRolesForProperty=function(q,c,t){var s=sap.ovp.cards.charts.VizAnnotationManager;if(!q.length){return;}var a=t=="dimension"?"Dimension":"Measure";var b=[];jQuery.each(q,function(i,v){if(!v||!v[a]||!v[a].PropertyPath){jQuery.sap.log.error(s.errorMessages.INVALID_CHART_ANNO);return false;}b.push(v[a].PropertyPath);});var d=jQuery.map(c.feeds,function(f){if(f.type==t){if(f.role){return f.role.split("|");}return[];}});d=jQuery.grep(d,function(r,i){return jQuery.inArray(r,d)==i;}).join(", ");jQuery.sap.log.error(s.errorMessages.CARD_ERROR+s.errorMessages.INVALID_REDUNDANT+t+"(s) "+b.join(", ")+". "+s.errorMessages.ALLOWED_ROLES+c.type+s.errorMessages.CHART_IS+d);};sap.ovp.cards.charts.VizAnnotationManager.getPrimitiveValue=function(v){var a;if(v){if(v.String){a=v.String;}else if(v.Boolean||v.Bool){a=sap.ovp.cards.charts.VizAnnotationManager.getBooleanValue(v);}else{a=sap.ovp.cards.charts.VizAnnotationManager.getNumberValue(v);}}return a;};sap.ovp.cards.charts.VizAnnotationManager.getBooleanValue=function(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;};sap.ovp.cards.charts.VizAnnotationManager.getNumberValue=function(v){var a;if(v){if(v.String){a=Number(v.String);}else if(v.Int){a=Number(v.Int);}else if(v.Decimal){a=Number(v.Decimal);}else if(v.Double){a=Number(v.Double);}else if(v.Single){a=Number(v.Single);}}return a;};sap.ovp.cards.charts.VizAnnotationManager.formThePathForCriticalityStateCalculation=function(c,d){function g(I){if(I){if(I.Path){return"{path:'"+I.Path+"'}";}else{return sap.ovp.cards.charts.VizAnnotationManager.getPrimitiveValue(I);}}else{return"";}}var v=c[c.measureNames];var i=d.CriticalityCalculation.ImprovementDirection.EnumMember;var a=g(d.CriticalityCalculation.DeviationRangeLowValue);var b=g(d.CriticalityCalculation.DeviationRangeHighValue);var t=g(d.CriticalityCalculation.ToleranceRangeLowValue);var e=g(d.CriticalityCalculation.ToleranceRangeHighValue);return sap.ovp.cards.AnnotationHelper._calculateCriticalityState(v,i,a,b,t,e,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);};sap.ovp.cards.charts.VizAnnotationManager.mapMeasures=function(c,m,M){var a,d;jQuery.each(m,function(i,v){if(v["sap:label"]==c.measureNames){a=v.name;return false;}});jQuery.each(M,function(i,v){if(v.Measure.PropertyPath==a){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}d=v.DataPoint.AnnotationPath;return false;}});return d;};sap.ovp.cards.charts.VizAnnotationManager.checkFlag=function(m,e){function a(S,c){return S&&S.indexOf(c,S.length-c.length)!==-1;}var b=false;var s=sap.ovp.cards.charts.VizAnnotationManager;jQuery.each(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var d=e[v.DataPoint.AnnotationPath.substring(1)];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection&&d.CriticalityCalculation.ImprovementDirection.EnumMember){var I=d.CriticalityCalculation.ImprovementDirection.EnumMember;var c=d.CriticalityCalculation.DeviationRangeLowValue&&d.CriticalityCalculation.DeviationRangeLowValue.String||"";var f=d.CriticalityCalculation.DeviationRangeHighValue&&d.CriticalityCalculation.DeviationRangeHighValue.String||"";var t=d.CriticalityCalculation.ToleranceRangeLowValue&&d.CriticalityCalculation.ToleranceRangeLowValue.String||"";var g=d.CriticalityCalculation.ToleranceRangeHighValue&&d.CriticalityCalculation.ToleranceRangeHighValue.String||"";if(a(I,"Minimize")||a(I,"Minimizing")){if(g&&f){b=true;return false;}else{jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_CRITICALITY);}}else if(a(I,"Maximize")||a(I,"Maximizing")){if(t&&c){b=true;return false;}else{jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_CRITICALITY);}}else if(a(I,"Target")){if(t&&c&&g&&f){b=true;return false;}else{jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_CRITICALITY);}}}else{jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_IMPROVEMENT_DIR);}}});if(b==true&&m.length>1){jQuery.sap.log.warning(s.errorMessages.CARD_WARNING+s.errorMessages.INVALID_SEMANTIC_MEASURES);}return b;};sap.ovp.cards.charts.VizAnnotationManager.buildSemanticLegends=function(m,e,M){function a(s,S){return s&&s.indexOf(S,s.length-S.length)!==-1;}var r=[null,null];var b=m.Measure.PropertyPath;if(M[b]){b=M[b][this.constants.LABEL_KEY]||b;}var d=m.DataPoint.AnnotationPath;var D=e[d.substring(1)];if(!D.CriticalityCalculation||!D.CriticalityCalculation.ImprovementDirection||!D.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var i=D.CriticalityCalculation.ImprovementDirection.EnumMember;var c=D.CriticalityCalculation.DeviationRangeLowValue&&D.CriticalityCalculation.DeviationRangeLowValue.String||"";var f=D.CriticalityCalculation.DeviationRangeHighValue&&D.CriticalityCalculation.DeviationRangeHighValue.String||"";var t=D.CriticalityCalculation.ToleranceRangeLowValue&&D.CriticalityCalculation.ToleranceRangeLowValue.String||"";var g=D.CriticalityCalculation.ToleranceRangeHighValue&&D.CriticalityCalculation.ToleranceRangeHighValue.String||"";jQuery.sap.require("sap.ui.core.format.NumberFormat");var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(c){c=n.format(Number(c));}if(f){f=n.format(Number(f));}if(t){t=n.format(Number(t));}if(g){g=n.format(Number(g));}if(a(i,"Minimize")||a(i,"Minimizing")){if(g&&f){r[0]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MINIMIZING_LESS",[b,g]);r[1]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MINIMIZING_MORE",[b,f]);}}else if(a(i,"Maximize")||a(i,"Maximizing")){if(t&&c){r[0]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MAXIMISING_MORE",[b,t]);r[1]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MAXIMISING_LESS",[b,c]);}}else if(a(i,"Target")){if(t&&c&&g&&f){r[0]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("TARGET_BETWEEN",[t,b,g]);r[1]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("TARGET_AROUND",[b,c,f]);}}return r;};sap.ovp.cards.charts.VizAnnotationManager.checkNumberFormat=function(m,v,e){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var d=e[v.DataPoint.AnnotationPath.substring(1)];var f,a;if(d&&d.ValueFormat){f=d.ValueFormat;}else if(d&&d.NumberFormat){f=d.NumberFormat;}if(f&&f.NumberOfFractionalDigits&&f.NumberOfFractionalDigits.Int){a=f.NumberOfFractionalDigits.Int;if(m<Number(a)){m=Number(a);}}}return m;};sap.ovp.cards.charts.VizAnnotationManager.getMaxScaleFactor=function(m,v,e){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var d=e[v.DataPoint.AnnotationPath.substring(1)];var s,S;if(d&&d.ValueFormat){s=d.ValueFormat;}else if(d&&d.NumberFormat){s=d.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){S=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){S=Number(s.ScaleFactor.Int);}if(!isNaN(S)){if(m===undefined){m=Number(S);}else if(m>Number(S)){m=Number(S);}}}}return m;};sap.ovp.cards.charts.VizAnnotationManager.isMeasureCurrency=function(m,s){var a=sap.ovp.cards.charts.VizAnnotationManager;if(m&&m[s]&&m[s][a.constants.SEMANTICS_KEY]&&m[s][a.constants.SEMANTICS_KEY]===a.constants.CURRENCY_CODE){return true;}return false;};sap.ovp.cards.charts.VizAnnotationManager.fractionalDigitsExists=function(v,e){if(v.DataPoint&&v.DataPoint.AnnotationPath){var d=e[v.DataPoint.AnnotationPath.substring(1)];if(d&&d.ValueFormat&&d.ValueFormat.NumberOfFractionalDigits&&d.ValueFormat.NumberOfFractionalDigits.Int){return true;}else if(d&&d.NumberFormat&&d.NumberFormat.NumberOfFractionalDigits&&d.NumberFormat.NumberOfFractionalDigits.Int){return true;}}return false;};sap.ovp.cards.charts.VizAnnotationManager.checkEDMINT32Exists=function(m,v,f){var s=sap.ovp.cards.charts.VizAnnotationManager;if(m[v[f].PropertyPath][s.constants.EDM_TYPE]==s.constants.EDM_INT32){return true;}return false;};sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes=function(a,h,c){var C,e,b,d;var f,g,l,D,m;var V;var q,Q,n;var p,o=[],M=[];var s;var r;var t=sap.ovp.cards.charts.VizAnnotationManager;f=a.getVizType();g=this.getConfig();for(var u in g){if((r=g[u].reference)&&g[r]){var w=jQuery.extend(true,{},g[r]);g[u]=w;}if(g[u].default.type==f||(g[u].time&&g[u].time.type==f)){l=g[u];break;}}if(!l){jQuery.sap.log.error(t.errorMessages.CARD_ERROR+"in "+t.errorMessages.CARD_CONFIG+t.errorMessages.CARD_CONFIG_ERROR+f+" "+t.errorMessages.CARD_CONFIG_JSON);return;}if(!(C=a.getModel('ovpCardProperties'))){jQuery.sap.log.error(t.errorMessages.CARD_ERROR+"in "+t.errorMessages.CARD_CONFIG+t.errorMessages.NO_CARD_MODEL);return;}var x=a.getModel();var y=C.getProperty("/entitySet");if(!x||!y){return;}e=C.getProperty("/entityType");if(!e){jQuery.sap.log.error(t.errorMessages.CARD_ANNO_ERROR+"in "+t.errorMessages.CARD_ANNO);return;}var z=t.getMetadata(x,y);b=C.getProperty("/chartAnnotationPath");if(!b||!(d=e[b])){jQuery.sap.log.error(t.errorMessages.CARD_ANNO_ERROR+"in "+t.errorMessages.CARD_ANNO);return;}if(!(D=d.DimensionAttributes)||!D.length){jQuery.sap.log.error(t.errorMessages.CHART_ANNO_ERROR+"in "+t.errorMessages.CHART_ANNO+" "+t.errorMessages.DIMENSIONS_MANDATORY);return;}if(!(m=d.MeasureAttributes)||!m.length){jQuery.sap.log.error(t.errorMessages.CHART_ANNO_ERROR+"in "+t.errorMessages.CHART_ANNO+" "+t.errorMessages.MEASURES_MANDATORY);return;}s=t.hasTimeSemantics(D,l,x,y);if(s){l=l.time;}else{l=l.default;}var E=false;[l.dimensions,l.measures].forEach(function(j,i){var k=i?m:D;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){jQuery.sap.log.error(t.errorMessages.CARD_ERROR+"in "+f+" "+t.errorMessages.CARD_LEAST+j.min+" "+v);E=true;}if(j.max&&k.length>j.max){jQuery.sap.log.error(t.errorMessages.CARD_ERROR+"in "+f+t.errorMessages.CARD_MOST+j.max+" "+v);E=true;}});if(E){return;}var H=true;if(l.properties&&l.properties.hasOwnProperty("hideLabel")&&!l.properties["hideLabel"]){H=false;}var A=true;var N=C.getProperty("/navigation");if(N=="chartNav"){A=false;}var B=false;if(f=='donut'){B=true;}a.removeAllAggregation();V={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:A?false:true,selectability:{legendSelection:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:B?true:false,type:'percentage'},dataPoint:{invalidity:'ignore'}},general:{groupData:false}};if(l.properties&&l.properties.semanticColor==true&&sap.ovp.cards.charts.VizAnnotationManager.checkFlag(m,e)){var F=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("GOOD");var G=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("BAD");var I=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("OTHERS");if(m.length==1){var J=t.buildSemanticLegends(m[0],e,z);var F=J[0]||F,G=J[1]||G,I=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("OTHERS");}V.plotArea={dataPointStyle:{rules:[{callback:function(i){var j=sap.ovp.cards.charts.VizAnnotationManager.mapMeasures(i,z,m);if(!j){return false;}var k=e[j.substring(1)];var v=sap.ovp.cards.charts.VizAnnotationManager.formThePathForCriticalityStateCalculation(i,k);if(v==sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues.Positive){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":F},{callback:function(i){var j=sap.ovp.cards.charts.VizAnnotationManager.mapMeasures(i,z,m);if(!j){return false;}var k=e[j.substring(1)];var v=sap.ovp.cards.charts.VizAnnotationManager.formThePathForCriticalityStateCalculation(i,k);if(v==sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues.Negative){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":G},{callback:function(i){var j=sap.ovp.cards.charts.VizAnnotationManager.mapMeasures(i,z,m);if(!j){return false;}var k=e[j.substring(1)];var v=sap.ovp.cards.charts.VizAnnotationManager.formThePathForCriticalityStateCalculation(i,k);if(v==sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues.Critical){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":I}]}};}Q=D.slice();n=m.slice();var K=0;var L=0;var O;var P;var R=false;var S=false;var T=false;var U=false;var W;var X=[];var Y=[],Z=[];jQuery.each(l.feeds,function(i,v){var b1=v.uid;var c1=[];if(v.type){var d1,e1,f1;if(v.type==="dimension"){d1=D.length;e1="Dimension";f1="dimensions";q=Q;p=o;}else{d1=m.length;e1="Measure";f1="measures";q=n;p=M;}var g1=0,h1=d1;if(v.min){g1=g1>v.min?g1:v.min;}if(v.max){h1=h1<v.max?h1:v.max;}if(!v.role){var i1=q.length;for(var j=0;j<i1&&c1.length<h1;++j){var j1=q[j];q.splice(j,1);--i1;--j;c1.push(j1);W=z[j1[e1].PropertyPath][t.constants.UNIT_KEY];if(!U){U=t.checkEDMINT32Exists(z,j1,e1);}if(t.isMeasureCurrency(z,W)){R=true;}else{S=true;}if(!T){T=t.fractionalDigitsExists(j1,e);}if(!R){K=t.checkNumberFormat(K,j1,e);O=t.getMaxScaleFactor(O,j1,e);}else{L=t.checkNumberFormat(L,j1,e);P=t.getMaxScaleFactor(P,j1,e);}}}else{var k1=v.role.split("|");jQuery.each(k1,function(j,C1){if(c1.length==h1){return false;}var i1=q.length;for(var k=0;k<i1&&c1.length<h1;++k){var j1=q[k];if(j1&&j1.Role&&j1.Role.EnumMember&&j1.Role.EnumMember.split("/")&&j1.Role.EnumMember.split("/")[1]){var D1=j1.Role.EnumMember.split("/")[1];if(D1==C1){q.splice(k,1);--i1;--k;c1.push(j1);W=z[j1[e1].PropertyPath][t.constants.UNIT_KEY];if(t.isMeasureCurrency(z,W)){R=true;}else{S=true;}if(!U){U=t.checkEDMINT32Exists(z,j1,e1);}if(!T){T=t.fractionalDigitsExists(j1,e);}if(!R){K=t.checkNumberFormat(K,j1,e);O=t.getMaxScaleFactor(O,j1,e);}else{L=t.checkNumberFormat(L,j1,e);P=t.getMaxScaleFactor(P,j1,e);}}}else if(jQuery.inArray(j1,p)==-1){p.push(j1);}}});if(c1.length<h1){jQuery.each(p,function(k,j1){var C1;var D1;if((C1=l[f1].defaultRole)&&(jQuery.inArray(C1,k1)!==-1)&&(D1=jQuery.inArray(j1,q))!==-1){q.splice(D1,1);c1.push(j1);W=z[j1[e1].PropertyPath][t.constants.UNIT_KEY];if(t.isMeasureCurrency(z,W)){R=true;}else{S=true;}if(!U){U=t.checkEDMINT32Exists(z,j1,e1);}if(!T){T=t.fractionalDigitsExists(j1,e);}if(!R){K=t.checkNumberFormat(K,j1,e);O=t.getMaxScaleFactor(O,j1,e);}else{L=t.checkNumberFormat(L,j1,e);P=t.getMaxScaleFactor(P,j1,e);}if(c1.length==h1){return false;}}});}if(c1.length<g1){jQuery.sap.log.error(t.errorMessages.CARD_ERROR+t.errorMessages.MIN_FEEDS+f+" "+t.errorMessages.FEEDS_OBTAINED+c1.length+" "+t.errorMessages.FEEDS_REQUIRED+g1+" "+t.errorMessages.FEEDS);return false;}}if(c1.length){var l1=[];var m1;if(!(m1=a.getDataset())){jQuery.sap.log.error(t.errorMessages.NO_DATASET);return false;}jQuery.each(c1,function(i,j1){if(!j1||!j1[e1]||!j1[e1].PropertyPath){jQuery.sap.log.error(t.errorMessages.INVALID_CHART_ANNO);return false;}var k=j1[e1].PropertyPath;var C1=k;var D1=k;var E1=null;if(z&&z[k]){C1=z[k][t.constants.LABEL_KEY]||k;D1=z[k][t.constants.TEXT_KEY]||k;E1=z[k][t.constants.TYPE_KEY]||null;}var F1;if(E1=="Edm.DateTime"&&D1==k){F1="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{F1="{"+D1+"}";}l1.push(C1);if(e1=="Dimension"){var G1=new sap.viz.ui5.data.DimensionDefinition({name:C1,value:"{"+k+"}",displayValue:F1});if(s){G1.setDataType("date");}m1.addDimension(G1);if(jQuery.inArray(C1,Z)===-1){Z.push(C1);}}else{m1.addMeasure(new sap.viz.ui5.data.MeasureDefinition({name:C1,value:"{"+k+"}"}));if((jQuery.inArray(C1,Y)===-1)&&(b1!="bubbleWidth")){Y.push(C1);}}});a.addFeed(new sap.viz.ui5.controls.common.feeds.FeedItem({'uid':b1,'type':e1,'values':l1}));V[b1]={title:{visible:H?false:true,text:l1.join(", ")},label:{formatString:R?'CURR':'axisFormatter'}};X.push(V[b1]);if(l.hasOwnProperty("vizProperties")){var n1=0;var o1=l.vizProperties.length;var p1;var q1;for(;n1<o1;n1++){if(l.vizProperties[n1].hasOwnProperty("value")){q1=l.vizProperties[n1].value;}if(l.vizProperties[n1].hasOwnProperty("path")){p1=(l.vizProperties[n1].path).split(".");var r1=p1.length;var s1;var t1;for(var u1=0,t1=p1[0],s1=V;u1<r1;++u1){if(u1==r1-1){s1[t1]=q1;break;}s1[t1]=s1[t1]||{};s1=s1[t1];t1=p1[u1+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var v1=v.vizProperties.length;var w1;var x1;var y1;for(;i<v1;i++){if(v.vizProperties[i].hasOwnProperty("method")){x1=v.vizProperties[i].method;switch(x1){case'count':w1=l1.length;if(v.vizProperties[i].hasOwnProperty("min")&&w1<=v.vizProperties[i].min){w1=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&w1>=v.vizProperties[i].max){w1=v.vizProperties[i].max;}break;}}else if(v.vizProperties[i].hasOwnProperty("value")){w1=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){y1=(v.vizProperties[i].path).split(".");var z1=y1.length;var A1;var B1;for(var j=0,B1=y1[0],A1=V;j<z1;++j){if(j==z1-1){A1[B1]=w1;break;}A1[B1]=A1[B1]||{};A1=A1[B1];B1=y1[j+1];}}}}}}});var $=a.getFeeds();if(l.properties&&l.properties.semanticPattern==true&&sap.ovp.cards.charts.VizAnnotationManager.getMeasureDimCheck($,f)){jQuery.each($,function(i,v){if($[i].getType()=='Measure'&&(($[i].getUid()=='valueAxis')||($[i].getUid()=='actualValues'))){var j;jQuery.each(m,function(g1,h1){var i1=sap.ovp.cards.charts.VizAnnotationManager.getSapLabel(h1.Measure.PropertyPath,z);if(i1==$[i].getValues()[0]){j=sap.ovp.cards.charts.VizAnnotationManager.checkForecastMeasure(h1,e);return false;}});if(j){var k=sap.ovp.cards.charts.VizAnnotationManager.getSapLabel(j.Measure.PropertyPath,z);var b1=e[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath;var c1=sap.ovp.cards.charts.VizAnnotationManager.getSapLabel(b1,z);var d1=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("ACTUAL",[k]);var e1=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("FORECAST",[c1]);V.plotArea={dataPointStyle:{rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:d1},{dataContext:{MeasureNamesDimension:c1},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:e1}]}};a.getDataset().addMeasure(new sap.viz.ui5.data.MeasureDefinition({name:c1,value:"{"+b1+"}"}));var f1=$[i].getValues();f1.push(c1);$[i].setValues(f1);}return false;}});}if(R&&S){jQuery.sap.log.warning(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Currency_non_currency_measure"));}if(U&&!T){L=K=0;}else if(!U&&!T){L=K=2;}var _;if(P===undefined){P="";}if(O===undefined){O="";}if(R){_=sap.ovp.cards.charts.VizAnnotationManager.getScaleUnit(P,R);}else{_=sap.ovp.cards.charts.VizAnnotationManager.getScaleUnit(O,R);}if(h){h.setScale(_);}sap.ovp.cards.charts.VizAnnotationManager.setFormattedChartTitle(Y,Z,c);var a1="";jQuery.each(X,function(i,j){var k=j.label.formatString;a1="";if(R){if(k==='CURR'){a1='CURR/'+L.toString()+"/"+P.toString();}else{a1='axisFormatter/'+L.toString()+"/"+P.toString();}}else{a1='axisFormatter/'+K.toString()+"/"+O.toString();}j.label={formatString:a1};});if(f=="vertical_bullet"){V["valueAxis"]={label:{formatString:a1}};}this.checkRolesForProperty(Q,l,"dimension");this.checkRolesForProperty(n,l,"measure");a.setVizProperties(V);};sap.ovp.cards.charts.VizAnnotationManager.setChartScaleTitle=function(v,a,h,c){var C,e,b,d;var M;var s=sap.ovp.cards.charts.VizAnnotationManager;var u=s.constants.UNIT_KEY;var s=sap.ovp.cards.charts.VizAnnotationManager;if(!(C=v.getModel('ovpCardProperties'))){jQuery.sap.log.error(s.errorMessages.CARD_ERROR+"in "+s.errorMessages.CARD_CONFIG+s.errorMessages.NO_CARD_MODEL);return;}var f=v.getModel();var g=C.getProperty("/entitySet");if(!f||!g){return;}e=C.getProperty("/entityType");if(!e){jQuery.sap.log.error(s.errorMessages.CARD_ANNO_ERROR+"in "+s.errorMessages.CARD_ANNO);return;}var o=s.getMetadata(f,g);b=C.getProperty("/chartAnnotationPath");if(!b||!(d=e[b])){jQuery.sap.log.error(s.errorMessages.CARD_ANNO_ERROR+"in "+s.errorMessages.CARD_ANNO);return;}if(!(M=d.MeasureAttributes)||!M.length){jQuery.sap.log.error(s.errorMessages.CHART_ANNO_ERROR+"in "+s.errorMessages.CHART_ANNO+" "+s.errorMessages.MEASURES_MANDATORY);return;}var r=a?a.results:null;var p,j="",k=[];var l=true;var n=[];var q=v.getFeeds();jQuery.each(q,function(i,m){if(m.getType()==="Measure"){n=n.concat(m.getValues());}});var t="";if(r){jQuery.each(M,function(i,m){var x="";p=m.Measure.PropertyPath;if(o&&o[p]){x=o[p][s.constants.LABEL_KEY]||p;}if(jQuery.inArray(x,n)!=-1){if(o&&o[p]&&o[p][u]){var y=o[p][u];if(y&&o[y]){for(var i=0;i<r.length;i++){var z=r[i];if(l){if(j&&z[y]&&(z[y]!="")&&(j!="")&&(j!=z[y])){l=false;}}j=z[y];if(j&&j!=""){var A={};A.name=x;A.value=j;k.push(A);break;}}}}}});}var V=v.getVizProperties();var w="";if(h){t=h.getScale();}if(l){if(isNaN(Number(t))&&t!=undefined){if(j!=""){w=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("IN",[t,j]);}else{w=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("IN_NO_SCALE",[t]);}}else if(j!=""){w=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("IN_NO_SCALE",[j]);}if(c){c.setText(w);c.data("aria-label",w,true);}}else if(!l){jQuery.each(V,function(i,m){if(m&&m.title){var x=m.title.text;for(var i=0;i<k.length;i++){if(k[i].name===x){var y="";if(isNaN(Number(t))&&t!=undefined){if(j!=""){y=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("AXES_TITLE",[x,t,k[i].value]);}else{y=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("AXES_TITLE_NO_SCALE",[t]);}}else if(j!=""){y=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("AXES_TITLE_NO_SCALE",[x,k[i].value]);}m.title={text:y};}}}});v.setVizProperties(V);}};sap.ovp.cards.charts.VizAnnotationManager.getMetadata=function(m,e){var a=this.cacheODataMetadata(m);if(!a){return undefined;}return a[e];};sap.ovp.cards.charts.VizAnnotationManager.setFormattedChartTitle=function(m,d,c){var t="",a="",b="";if(c){t=c.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(a!=""){a+=", ";}a+=m[i];}a=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MEAS_DIM_TITLE",[a,m[i]]);}else if(m){a=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(b!=""){b+=", ";}b+=d[i];}b=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MEAS_DIM_TITLE",[b,d[i]]);}else if(d){b=d[0];}if(c&&(t=="")){t=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("NO_CHART_TITLE",[a,b]);c.setText(t);c.data("aria-label",t,true);}};sap.ovp.cards.charts.VizAnnotationManager.getScaleUnit=function(m,i){var n=1;var s;if(i){var c=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=c.format(Number(n));}else{var a=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',shortRefNumber:m});s=a.format(Number(n));}var b=s.slice(-1);return b;};sap.ovp.cards.charts.VizAnnotationManager.cacheODataMetadata=function(m){var s=sap.ovp.cards.charts.VizAnnotationManager;if(m){if(!jQuery.sap.getObject("sap.ovp.cards.charts.cachedMetaModel")){sap.ovp.cards.charts.cachedMetaModel={};}var a=sap.ovp.cards.charts.cachedMetaModel[m.getId()];if(!a){var b=m.getMetaModel();a={};var c=b.getODataEntityContainer();jQuery.each(c.entitySet,function(d,e){var f=b.getODataEntityType(e.entityType);var g={};jQuery.each(f.property,function(p,h){g[h.name]=h;});a[e.name]=g;});sap.ovp.cards.charts.cachedMetaModel[m.getId()]=a;}return a;}else{jQuery.sap.log.error(s.errorMessages.CARD_ERROR+s.errorMessages.CACHING_ERROR);}};sap.ovp.cards.charts.VizAnnotationManager.getSelectedDataPoint=function(v,c){v.attachSelectData(function(e){var s=sap.ovp.cards.charts.VizAnnotationManager;var C=v.getModel('ovpCardProperties');var d=v.getModel();var a=C.getProperty("/entitySet");var m=s.getMetadata(d,a);var b=[],f=[];var g={};var h=v.getDataset().getDimensions();var l;for(var i=0;i<h.length;i++){b.push(h[i].getName());}var n=jQuery.map(v.getDataset().getBinding("data").getCurrentContexts(),function(x){return x.getObject();});if(e.getParameter("data")&&e.getParameter("data")[0]&&e.getParameter("data")[0].data){l=e.getParameter("data")[0].data._context_row_number;if(n[l].$isDonut&&n[l].$isDonut==true){var o={$isDonut:true};var p={getObject:function(){return o;}};c.doNavigation(p);}else{f=Object.keys(e.getParameter("data")[0].data);for(var j=0;j<b.length;j++){for(var k=0;k<f.length;k++){if(b[j]==f[k]){for(var q in m){if(m.hasOwnProperty(q)){var r=m[q][s.constants.LABEL_KEY]||m[q][s.constants.NAME_KEY]||m[q][s.constants.NAME_CAP_KEY];if(r==f[k]){g[q]=n[l][q];}}}}}}var p={getObject:function(){return g;}};c.doNavigation(p);}}});};sap.ovp.cards.charts.VizAnnotationManager.checkBubbleChart=function(c){if(c.EnumMember.endsWith("Bubble")){return true;}else{return false;}};sap.ovp.cards.charts.VizAnnotationManager.dimensionAttrCheck=function(d){var r=false;var s=sap.ovp.cards.charts.VizAnnotationManager;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){jQuery.sap.log.error(s.errorMessages.CHART_ANNO_ERROR+"in "+s.errorMessages.CHART_ANNO+" "+s.errorMessages.DIMENSIONS_MANDATORY);return r;}r=true;return r;};sap.ovp.cards.charts.VizAnnotationManager.measureAttrCheck=function(m){var r=false;var s=sap.ovp.cards.charts.VizAnnotationManager;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){jQuery.sap.log.error(s.errorMessages.CHART_ANNO_ERROR+"in "+s.errorMessages.CHART_ANNO+" "+s.errorMessages.MEASURES_MANDATORY);return r;}r=true;return r;};}());
